function pj(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();function EC(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function mj(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var P_={exports:{}},Bm={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var XM;function gj(){if(XM)return Bm;XM=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,r,i){var o=null;if(i!==void 0&&(o=""+i),r.key!==void 0&&(o=""+r.key),"key"in r){i={};for(var a in r)a!=="key"&&(i[a]=r[a])}else i=r;return r=i.ref,{$$typeof:n,type:s,key:o,ref:r!==void 0?r:null,props:i}}return Bm.Fragment=e,Bm.jsx=t,Bm.jsxs=t,Bm}var YM;function yj(){return YM||(YM=1,P_.exports=gj()),P_.exports}var Me=yj(),F_={exports:{}},ft={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JM;function bj(){if(JM)return ft;JM=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.for("react.activity"),p=Symbol.iterator;function g(W){return W===null||typeof W!="object"?null:(W=p&&W[p]||W["@@iterator"],typeof W=="function"?W:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,w={};function _(W,ne,ue){this.props=W,this.context=ne,this.refs=w,this.updater=ue||b}_.prototype.isReactComponent={},_.prototype.setState=function(W,ne){if(typeof W!="object"&&typeof W!="function"&&W!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,W,ne,"setState")},_.prototype.forceUpdate=function(W){this.updater.enqueueForceUpdate(this,W,"forceUpdate")};function C(){}C.prototype=_.prototype;function N(W,ne,ue){this.props=W,this.context=ne,this.refs=w,this.updater=ue||b}var A=N.prototype=new C;A.constructor=N,T(A,_.prototype),A.isPureReactComponent=!0;var P=Array.isArray;function V(){}var D={H:null,A:null,T:null,S:null},M=Object.prototype.hasOwnProperty;function $(W,ne,ue){var Te=ue.ref;return{$$typeof:n,type:W,key:ne,ref:Te!==void 0?Te:null,props:ue}}function O(W,ne){return $(W.type,ne,W.props)}function k(W){return typeof W=="object"&&W!==null&&W.$$typeof===n}function z(W){var ne={"=":"=0",":":"=2"};return"$"+W.replace(/[=:]/g,function(ue){return ne[ue]})}var U=/\/+/g;function te(W,ne){return typeof W=="object"&&W!==null&&W.key!=null?z(""+W.key):ne.toString(36)}function se(W){switch(W.status){case"fulfilled":return W.value;case"rejected":throw W.reason;default:switch(typeof W.status=="string"?W.then(V,V):(W.status="pending",W.then(function(ne){W.status==="pending"&&(W.status="fulfilled",W.value=ne)},function(ne){W.status==="pending"&&(W.status="rejected",W.reason=ne)})),W.status){case"fulfilled":return W.value;case"rejected":throw W.reason}}throw W}function X(W,ne,ue,Te,Ie){var Re=typeof W;(Re==="undefined"||Re==="boolean")&&(W=null);var Fe=!1;if(W===null)Fe=!0;else switch(Re){case"bigint":case"string":case"number":Fe=!0;break;case"object":switch(W.$$typeof){case n:case e:Fe=!0;break;case h:return Fe=W._init,X(Fe(W._payload),ne,ue,Te,Ie)}}if(Fe)return Ie=Ie(W),Fe=Te===""?"."+te(W,0):Te,P(Ie)?(ue="",Fe!=null&&(ue=Fe.replace(U,"$&/")+"/"),X(Ie,ne,ue,"",function(it){return it})):Ie!=null&&(k(Ie)&&(Ie=O(Ie,ue+(Ie.key==null||W&&W.key===Ie.key?"":(""+Ie.key).replace(U,"$&/")+"/")+Fe)),ne.push(Ie)),1;Fe=0;var We=Te===""?".":Te+":";if(P(W))for(var Be=0;Be<W.length;Be++)Te=W[Be],Re=We+te(Te,Be),Fe+=X(Te,ne,ue,Re,Ie);else if(Be=g(W),typeof Be=="function")for(W=Be.call(W),Be=0;!(Te=W.next()).done;)Te=Te.value,Re=We+te(Te,Be++),Fe+=X(Te,ne,ue,Re,Ie);else if(Re==="object"){if(typeof W.then=="function")return X(se(W),ne,ue,Te,Ie);throw ne=String(W),Error("Objects are not valid as a React child (found: "+(ne==="[object Object]"?"object with keys {"+Object.keys(W).join(", ")+"}":ne)+"). If you meant to render a collection of children, use an array instead.")}return Fe}function Q(W,ne,ue){if(W==null)return W;var Te=[],Ie=0;return X(W,Te,"","",function(Re){return ne.call(ue,Re,Ie++)}),Te}function re(W){if(W._status===-1){var ne=W._result;ne=ne(),ne.then(function(ue){(W._status===0||W._status===-1)&&(W._status=1,W._result=ue)},function(ue){(W._status===0||W._status===-1)&&(W._status=2,W._result=ue)}),W._status===-1&&(W._status=0,W._result=ne)}if(W._status===1)return W._result.default;throw W._result}var fe=typeof reportError=="function"?reportError:function(W){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ne=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof W=="object"&&W!==null&&typeof W.message=="string"?String(W.message):String(W),error:W});if(!window.dispatchEvent(ne))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",W);return}console.error(W)},be={map:Q,forEach:function(W,ne,ue){Q(W,function(){ne.apply(this,arguments)},ue)},count:function(W){var ne=0;return Q(W,function(){ne++}),ne},toArray:function(W){return Q(W,function(ne){return ne})||[]},only:function(W){if(!k(W))throw Error("React.Children.only expected to receive a single React element child.");return W}};return ft.Activity=f,ft.Children=be,ft.Component=_,ft.Fragment=t,ft.Profiler=r,ft.PureComponent=N,ft.StrictMode=s,ft.Suspense=l,ft.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,ft.__COMPILER_RUNTIME={__proto__:null,c:function(W){return D.H.useMemoCache(W)}},ft.cache=function(W){return function(){return W.apply(null,arguments)}},ft.cacheSignal=function(){return null},ft.cloneElement=function(W,ne,ue){if(W==null)throw Error("The argument must be a React element, but you passed "+W+".");var Te=T({},W.props),Ie=W.key;if(ne!=null)for(Re in ne.key!==void 0&&(Ie=""+ne.key),ne)!M.call(ne,Re)||Re==="key"||Re==="__self"||Re==="__source"||Re==="ref"&&ne.ref===void 0||(Te[Re]=ne[Re]);var Re=arguments.length-2;if(Re===1)Te.children=ue;else if(1<Re){for(var Fe=Array(Re),We=0;We<Re;We++)Fe[We]=arguments[We+2];Te.children=Fe}return $(W.type,Ie,Te)},ft.createContext=function(W){return W={$$typeof:o,_currentValue:W,_currentValue2:W,_threadCount:0,Provider:null,Consumer:null},W.Provider=W,W.Consumer={$$typeof:i,_context:W},W},ft.createElement=function(W,ne,ue){var Te,Ie={},Re=null;if(ne!=null)for(Te in ne.key!==void 0&&(Re=""+ne.key),ne)M.call(ne,Te)&&Te!=="key"&&Te!=="__self"&&Te!=="__source"&&(Ie[Te]=ne[Te]);var Fe=arguments.length-2;if(Fe===1)Ie.children=ue;else if(1<Fe){for(var We=Array(Fe),Be=0;Be<Fe;Be++)We[Be]=arguments[Be+2];Ie.children=We}if(W&&W.defaultProps)for(Te in Fe=W.defaultProps,Fe)Ie[Te]===void 0&&(Ie[Te]=Fe[Te]);return $(W,Re,Ie)},ft.createRef=function(){return{current:null}},ft.forwardRef=function(W){return{$$typeof:a,render:W}},ft.isValidElement=k,ft.lazy=function(W){return{$$typeof:h,_payload:{_status:-1,_result:W},_init:re}},ft.memo=function(W,ne){return{$$typeof:u,type:W,compare:ne===void 0?null:ne}},ft.startTransition=function(W){var ne=D.T,ue={};D.T=ue;try{var Te=W(),Ie=D.S;Ie!==null&&Ie(ue,Te),typeof Te=="object"&&Te!==null&&typeof Te.then=="function"&&Te.then(V,fe)}catch(Re){fe(Re)}finally{ne!==null&&ue.types!==null&&(ne.types=ue.types),D.T=ne}},ft.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},ft.use=function(W){return D.H.use(W)},ft.useActionState=function(W,ne,ue){return D.H.useActionState(W,ne,ue)},ft.useCallback=function(W,ne){return D.H.useCallback(W,ne)},ft.useContext=function(W){return D.H.useContext(W)},ft.useDebugValue=function(){},ft.useDeferredValue=function(W,ne){return D.H.useDeferredValue(W,ne)},ft.useEffect=function(W,ne){return D.H.useEffect(W,ne)},ft.useEffectEvent=function(W){return D.H.useEffectEvent(W)},ft.useId=function(){return D.H.useId()},ft.useImperativeHandle=function(W,ne,ue){return D.H.useImperativeHandle(W,ne,ue)},ft.useInsertionEffect=function(W,ne){return D.H.useInsertionEffect(W,ne)},ft.useLayoutEffect=function(W,ne){return D.H.useLayoutEffect(W,ne)},ft.useMemo=function(W,ne){return D.H.useMemo(W,ne)},ft.useOptimistic=function(W,ne){return D.H.useOptimistic(W,ne)},ft.useReducer=function(W,ne,ue){return D.H.useReducer(W,ne,ue)},ft.useRef=function(W){return D.H.useRef(W)},ft.useState=function(W){return D.H.useState(W)},ft.useSyncExternalStore=function(W,ne,ue){return D.H.useSyncExternalStore(W,ne,ue)},ft.useTransition=function(){return D.H.useTransition()},ft.version="19.2.1",ft}var jM;function IC(){return jM||(jM=1,F_.exports=bj()),F_.exports}var Dn=IC();const vj=EC(Dn);var L_={exports:{}},Um={},V_={exports:{}},B_={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QM;function wj(){return QM||(QM=1,(function(n){function e(X,Q){var re=X.length;X.push(Q);e:for(;0<re;){var fe=re-1>>>1,be=X[fe];if(0<r(be,Q))X[fe]=Q,X[re]=be,re=fe;else break e}}function t(X){return X.length===0?null:X[0]}function s(X){if(X.length===0)return null;var Q=X[0],re=X.pop();if(re!==Q){X[0]=re;e:for(var fe=0,be=X.length,W=be>>>1;fe<W;){var ne=2*(fe+1)-1,ue=X[ne],Te=ne+1,Ie=X[Te];if(0>r(ue,re))Te<be&&0>r(Ie,ue)?(X[fe]=Ie,X[Te]=re,fe=Te):(X[fe]=ue,X[ne]=re,fe=ne);else if(Te<be&&0>r(Ie,re))X[fe]=Ie,X[Te]=re,fe=Te;else break e}}return Q}function r(X,Q){var re=X.sortIndex-Q.sortIndex;return re!==0?re:X.id-Q.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],h=1,f=null,p=3,g=!1,b=!1,T=!1,w=!1,_=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,N=typeof setImmediate<"u"?setImmediate:null;function A(X){for(var Q=t(u);Q!==null;){if(Q.callback===null)s(u);else if(Q.startTime<=X)s(u),Q.sortIndex=Q.expirationTime,e(l,Q);else break;Q=t(u)}}function P(X){if(T=!1,A(X),!b)if(t(l)!==null)b=!0,V||(V=!0,z());else{var Q=t(u);Q!==null&&se(P,Q.startTime-X)}}var V=!1,D=-1,M=5,$=-1;function O(){return w?!0:!(n.unstable_now()-$<M)}function k(){if(w=!1,V){var X=n.unstable_now();$=X;var Q=!0;try{e:{b=!1,T&&(T=!1,C(D),D=-1),g=!0;var re=p;try{t:{for(A(X),f=t(l);f!==null&&!(f.expirationTime>X&&O());){var fe=f.callback;if(typeof fe=="function"){f.callback=null,p=f.priorityLevel;var be=fe(f.expirationTime<=X);if(X=n.unstable_now(),typeof be=="function"){f.callback=be,A(X),Q=!0;break t}f===t(l)&&s(l),A(X)}else s(l);f=t(l)}if(f!==null)Q=!0;else{var W=t(u);W!==null&&se(P,W.startTime-X),Q=!1}}break e}finally{f=null,p=re,g=!1}Q=void 0}}finally{Q?z():V=!1}}}var z;if(typeof N=="function")z=function(){N(k)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,te=U.port2;U.port1.onmessage=k,z=function(){te.postMessage(null)}}else z=function(){_(k,0)};function se(X,Q){D=_(function(){X(n.unstable_now())},Q)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(X){X.callback=null},n.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<X?Math.floor(1e3/X):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_next=function(X){switch(p){case 1:case 2:case 3:var Q=3;break;default:Q=p}var re=p;p=Q;try{return X()}finally{p=re}},n.unstable_requestPaint=function(){w=!0},n.unstable_runWithPriority=function(X,Q){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var re=p;p=X;try{return Q()}finally{p=re}},n.unstable_scheduleCallback=function(X,Q,re){var fe=n.unstable_now();switch(typeof re=="object"&&re!==null?(re=re.delay,re=typeof re=="number"&&0<re?fe+re:fe):re=fe,X){case 1:var be=-1;break;case 2:be=250;break;case 5:be=1073741823;break;case 4:be=1e4;break;default:be=5e3}return be=re+be,X={id:h++,callback:Q,priorityLevel:X,startTime:re,expirationTime:be,sortIndex:-1},re>fe?(X.sortIndex=re,e(u,X),t(l)===null&&X===t(u)&&(T?(C(D),D=-1):T=!0,se(P,re-fe))):(X.sortIndex=be,e(l,X),b||g||(b=!0,V||(V=!0,z()))),X},n.unstable_shouldYield=O,n.unstable_wrapCallback=function(X){var Q=p;return function(){var re=p;p=Q;try{return X.apply(this,arguments)}finally{p=re}}}})(B_)),B_}var ZM;function Tj(){return ZM||(ZM=1,V_.exports=wj()),V_.exports}var U_={exports:{}},cr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eO;function xj(){if(eO)return cr;eO=1;var n=IC();function e(l){var u="https://react.dev/errors/"+l;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)u+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+l+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function i(l,u,h){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:f==null?null:""+f,children:l,containerInfo:u,implementation:h}}var o=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(l,u){if(l==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return cr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,cr.createPortal=function(l,u){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return i(l,u,null,h)},cr.flushSync=function(l){var u=o.T,h=s.p;try{if(o.T=null,s.p=2,l)return l()}finally{o.T=u,s.p=h,s.d.f()}},cr.preconnect=function(l,u){typeof l=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,s.d.C(l,u))},cr.prefetchDNS=function(l){typeof l=="string"&&s.d.D(l)},cr.preinit=function(l,u){if(typeof l=="string"&&u&&typeof u.as=="string"){var h=u.as,f=a(h,u.crossOrigin),p=typeof u.integrity=="string"?u.integrity:void 0,g=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;h==="style"?s.d.S(l,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:f,integrity:p,fetchPriority:g}):h==="script"&&s.d.X(l,{crossOrigin:f,integrity:p,fetchPriority:g,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},cr.preinitModule=function(l,u){if(typeof l=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var h=a(u.as,u.crossOrigin);s.d.M(l,{crossOrigin:h,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&s.d.M(l)},cr.preload=function(l,u){if(typeof l=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var h=u.as,f=a(h,u.crossOrigin);s.d.L(l,h,{crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},cr.preloadModule=function(l,u){if(typeof l=="string")if(u){var h=a(u.as,u.crossOrigin);s.d.m(l,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:h,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else s.d.m(l)},cr.requestFormReset=function(l){s.d.r(l)},cr.unstable_batchedUpdates=function(l,u){return l(u)},cr.useFormState=function(l,u,h){return o.H.useFormState(l,u,h)},cr.useFormStatus=function(){return o.H.useHostTransitionStatus()},cr.version="19.2.1",cr}var tO;function Sj(){if(tO)return U_.exports;tO=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),U_.exports=xj(),U_.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nO;function _j(){if(nO)return Um;nO=1;var n=Tj(),e=IC(),t=Sj();function s(c){var d="https://react.dev/errors/"+c;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)d+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+c+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function i(c){var d=c,m=c;if(c.alternate)for(;d.return;)d=d.return;else{c=d;do d=c,(d.flags&4098)!==0&&(m=d.return),c=d.return;while(c)}return d.tag===3?m:null}function o(c){if(c.tag===13){var d=c.memoizedState;if(d===null&&(c=c.alternate,c!==null&&(d=c.memoizedState)),d!==null)return d.dehydrated}return null}function a(c){if(c.tag===31){var d=c.memoizedState;if(d===null&&(c=c.alternate,c!==null&&(d=c.memoizedState)),d!==null)return d.dehydrated}return null}function l(c){if(i(c)!==c)throw Error(s(188))}function u(c){var d=c.alternate;if(!d){if(d=i(c),d===null)throw Error(s(188));return d!==c?null:c}for(var m=c,y=d;;){var E=m.return;if(E===null)break;var I=E.alternate;if(I===null){if(y=E.return,y!==null){m=y;continue}break}if(E.child===I.child){for(I=E.child;I;){if(I===m)return l(E),c;if(I===y)return l(E),d;I=I.sibling}throw Error(s(188))}if(m.return!==y.return)m=E,y=I;else{for(var L=!1,G=E.child;G;){if(G===m){L=!0,m=E,y=I;break}if(G===y){L=!0,y=E,m=I;break}G=G.sibling}if(!L){for(G=I.child;G;){if(G===m){L=!0,m=I,y=E;break}if(G===y){L=!0,y=I,m=E;break}G=G.sibling}if(!L)throw Error(s(189))}}if(m.alternate!==y)throw Error(s(190))}if(m.tag!==3)throw Error(s(188));return m.stateNode.current===m?c:d}function h(c){var d=c.tag;if(d===5||d===26||d===27||d===6)return c;for(c=c.child;c!==null;){if(d=h(c),d!==null)return d;c=c.sibling}return null}var f=Object.assign,p=Symbol.for("react.element"),g=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),C=Symbol.for("react.consumer"),N=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),V=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),M=Symbol.for("react.lazy"),$=Symbol.for("react.activity"),O=Symbol.for("react.memo_cache_sentinel"),k=Symbol.iterator;function z(c){return c===null||typeof c!="object"?null:(c=k&&c[k]||c["@@iterator"],typeof c=="function"?c:null)}var U=Symbol.for("react.client.reference");function te(c){if(c==null)return null;if(typeof c=="function")return c.$$typeof===U?null:c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case T:return"Fragment";case _:return"Profiler";case w:return"StrictMode";case P:return"Suspense";case V:return"SuspenseList";case $:return"Activity"}if(typeof c=="object")switch(c.$$typeof){case b:return"Portal";case N:return c.displayName||"Context";case C:return(c._context.displayName||"Context")+".Consumer";case A:var d=c.render;return c=c.displayName,c||(c=d.displayName||d.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case D:return d=c.displayName||null,d!==null?d:te(c.type)||"Memo";case M:d=c._payload,c=c._init;try{return te(c(d))}catch{}}return null}var se=Array.isArray,X=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,re={pending:!1,data:null,method:null,action:null},fe=[],be=-1;function W(c){return{current:c}}function ne(c){0>be||(c.current=fe[be],fe[be]=null,be--)}function ue(c,d){be++,fe[be]=c.current,c.current=d}var Te=W(null),Ie=W(null),Re=W(null),Fe=W(null);function We(c,d){switch(ue(Re,d),ue(Ie,c),ue(Te,null),d.nodeType){case 9:case 11:c=(c=d.documentElement)&&(c=c.namespaceURI)?yM(c):0;break;default:if(c=d.tagName,d=d.namespaceURI)d=yM(d),c=bM(d,c);else switch(c){case"svg":c=1;break;case"math":c=2;break;default:c=0}}ne(Te),ue(Te,c)}function Be(){ne(Te),ne(Ie),ne(Re)}function it(c){c.memoizedState!==null&&ue(Fe,c);var d=Te.current,m=bM(d,c.type);d!==m&&(ue(Ie,c),ue(Te,m))}function ct(c){Ie.current===c&&(ne(Te),ne(Ie)),Fe.current===c&&(ne(Fe),Pm._currentValue=re)}var It,Bt;function Ut(c){if(It===void 0)try{throw Error()}catch(m){var d=m.stack.trim().match(/\n( *(at )?)/);It=d&&d[1]||"",Bt=-1<m.stack.indexOf(`
    at`)?" (<anonymous>)":-1<m.stack.indexOf("@")?"@unknown:0:0":""}return`
`+It+c+Bt}var Ht=!1;function Ct(c,d){if(!c||Ht)return"";Ht=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var y={DetermineComponentFrameRoot:function(){try{if(d){var $e=function(){throw Error()};if(Object.defineProperty($e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct($e,[])}catch(Se){var ve=Se}Reflect.construct(c,[],$e)}else{try{$e.call()}catch(Se){ve=Se}c.call($e.prototype)}}else{try{throw Error()}catch(Se){ve=Se}($e=c())&&typeof $e.catch=="function"&&$e.catch(function(){})}}catch(Se){if(Se&&ve&&typeof Se.stack=="string")return[Se.stack,ve.stack]}return[null,null]}};y.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var E=Object.getOwnPropertyDescriptor(y.DetermineComponentFrameRoot,"name");E&&E.configurable&&Object.defineProperty(y.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var I=y.DetermineComponentFrameRoot(),L=I[0],G=I[1];if(L&&G){var ee=L.split(`
`),ye=G.split(`
`);for(E=y=0;y<ee.length&&!ee[y].includes("DetermineComponentFrameRoot");)y++;for(;E<ye.length&&!ye[E].includes("DetermineComponentFrameRoot");)E++;if(y===ee.length||E===ye.length)for(y=ee.length-1,E=ye.length-1;1<=y&&0<=E&&ee[y]!==ye[E];)E--;for(;1<=y&&0<=E;y--,E--)if(ee[y]!==ye[E]){if(y!==1||E!==1)do if(y--,E--,0>E||ee[y]!==ye[E]){var Ce=`
`+ee[y].replace(" at new "," at ");return c.displayName&&Ce.includes("<anonymous>")&&(Ce=Ce.replace("<anonymous>",c.displayName)),Ce}while(1<=y&&0<=E);break}}}finally{Ht=!1,Error.prepareStackTrace=m}return(m=c?c.displayName||c.name:"")?Ut(m):""}function nn(c,d){switch(c.tag){case 26:case 27:case 5:return Ut(c.type);case 16:return Ut("Lazy");case 13:return c.child!==d&&d!==null?Ut("Suspense Fallback"):Ut("Suspense");case 19:return Ut("SuspenseList");case 0:case 15:return Ct(c.type,!1);case 11:return Ct(c.type.render,!1);case 1:return Ct(c.type,!0);case 31:return Ut("Activity");default:return""}}function Qt(c){try{var d="",m=null;do d+=nn(c,m),m=c,c=c.return;while(c);return d}catch(y){return`
Error generating stack: `+y.message+`
`+y.stack}}var sn=Object.prototype.hasOwnProperty,Et=n.unstable_scheduleCallback,qs=n.unstable_cancelCallback,Ws=n.unstable_shouldYield,Ai=n.unstable_requestPaint,wn=n.unstable_now,Ks=n.unstable_getCurrentPriorityLevel,Ur=n.unstable_ImmediatePriority,zr=n.unstable_UserBlockingPriority,Xs=n.unstable_NormalPriority,Va=n.unstable_LowPriority,Ul=n.unstable_IdlePriority,zl=n.log,fd=n.unstable_setDisableYieldValue,ur=null,Es=null;function Gr(c){if(typeof zl=="function"&&fd(c),Es&&typeof Es.setStrictMode=="function")try{Es.setStrictMode(ur,c)}catch{}}var Qn=Math.clz32?Math.clz32:Kb,Wb=Math.log,pd=Math.LN2;function Kb(c){return c>>>=0,c===0?32:31-(Wb(c)/pd|0)|0}var Bo=256,Rc=262144,as=4194304;function Uo(c){var d=c&42;if(d!==0)return d;switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return c&261888;case 262144:case 524288:case 1048576:case 2097152:return c&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return c&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return c}}function zo(c,d,m){var y=c.pendingLanes;if(y===0)return 0;var E=0,I=c.suspendedLanes,L=c.pingedLanes;c=c.warmLanes;var G=y&134217727;return G!==0?(y=G&~I,y!==0?E=Uo(y):(L&=G,L!==0?E=Uo(L):m||(m=G&~c,m!==0&&(E=Uo(m))))):(G=y&~I,G!==0?E=Uo(G):L!==0?E=Uo(L):m||(m=y&~c,m!==0&&(E=Uo(m)))),E===0?0:d!==0&&d!==E&&(d&I)===0&&(I=E&-E,m=d&-d,I>=m||I===32&&(m&4194048)!==0)?d:E}function io(c,d){return(c.pendingLanes&~(c.suspendedLanes&~c.pingedLanes)&d)===0}function Bx(c,d){switch(c){case 1:case 2:case 4:case 8:case 64:return d+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Xb(){var c=as;return as<<=1,(as&62914560)===0&&(as=4194304),c}function Go(c){for(var d=[],m=0;31>m;m++)d.push(c);return d}function Dc(c,d){c.pendingLanes|=d,d!==268435456&&(c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0)}function Ux(c,d,m,y,E,I){var L=c.pendingLanes;c.pendingLanes=m,c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0,c.expiredLanes&=m,c.entangledLanes&=m,c.errorRecoveryDisabledLanes&=m,c.shellSuspendCounter=0;var G=c.entanglements,ee=c.expirationTimes,ye=c.hiddenUpdates;for(m=L&~m;0<m;){var Ce=31-Qn(m),$e=1<<Ce;G[Ce]=0,ee[Ce]=-1;var ve=ye[Ce];if(ve!==null)for(ye[Ce]=null,Ce=0;Ce<ve.length;Ce++){var Se=ve[Ce];Se!==null&&(Se.lane&=-536870913)}m&=~$e}y!==0&&Mc(c,y,0),I!==0&&E===0&&c.tag!==0&&(c.suspendedLanes|=I&~(L&~d))}function Mc(c,d,m){c.pendingLanes|=d,c.suspendedLanes&=~d;var y=31-Qn(d);c.entangledLanes|=d,c.entanglements[y]=c.entanglements[y]|1073741824|m&261930}function Up(c,d){var m=c.entangledLanes|=d;for(c=c.entanglements;m;){var y=31-Qn(m),E=1<<y;E&d|c[y]&d&&(c[y]|=d),m&=~E}}function zp(c,d){var m=d&-d;return m=(m&42)!==0?1:Oc(m),(m&(c.suspendedLanes|d))!==0?0:m}function Oc(c){switch(c){case 2:c=1;break;case 8:c=4;break;case 32:c=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:c=128;break;case 268435456:c=134217728;break;default:c=0}return c}function Ba(c){return c&=-c,2<c?8<c?(c&134217727)!==0?32:268435456:8:2}function Yb(){var c=Q.p;return c!==0?c:(c=window.event,c===void 0?32:UM(c.type))}function oo(c,d){var m=Q.p;try{return Q.p=c,d()}finally{Q.p=m}}var ao=Math.random().toString(36).slice(2),ls="__reactFiber$"+ao,Ms="__reactProps$"+ao,Ho="__reactContainer$"+ao,md="__reactEvents$"+ao,zx="__reactListeners$"+ao,Jb="__reactHandles$"+ao,jb="__reactResources$"+ao,qo="__reactMarker$"+ao;function gd(c){delete c[ls],delete c[Ms],delete c[md],delete c[zx],delete c[Jb]}function Wo(c){var d=c[ls];if(d)return d;for(var m=c.parentNode;m;){if(d=m[Ho]||m[ls]){if(m=d.alternate,d.child!==null||m!==null&&m.child!==null)for(c=EM(c);c!==null;){if(m=c[ls])return m;c=EM(c)}return d}c=m,m=c.parentNode}return null}function ki(c){if(c=c[ls]||c[Ho]){var d=c.tag;if(d===5||d===6||d===13||d===31||d===26||d===27||d===3)return c}return null}function hi(c){var d=c.tag;if(d===5||d===26||d===27||d===6)return c.stateNode;throw Error(s(33))}function Ko(c){var d=c[jb];return d||(d=c[jb]={hoistableStyles:new Map,hoistableScripts:new Map}),d}function us(c){c[qo]=!0}var Gp=new Set,Hp={};function Xo(c,d){Yo(c,d),Yo(c+"Capture",d)}function Yo(c,d){for(Hp[c]=d,c=0;c<d.length;c++)Gp.add(d[c])}var qp=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Wp={},Kp={};function Qb(c){return sn.call(Kp,c)?!0:sn.call(Wp,c)?!1:qp.test(c)?Kp[c]=!0:(Wp[c]=!0,!1)}function yd(c,d,m){if(Qb(d))if(m===null)c.removeAttribute(d);else{switch(typeof m){case"undefined":case"function":case"symbol":c.removeAttribute(d);return;case"boolean":var y=d.toLowerCase().slice(0,5);if(y!=="data-"&&y!=="aria-"){c.removeAttribute(d);return}}c.setAttribute(d,""+m)}}function di(c,d,m){if(m===null)c.removeAttribute(d);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(d);return}c.setAttribute(d,""+m)}}function cs(c,d,m,y){if(y===null)c.removeAttribute(m);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(m);return}c.setAttributeNS(d,m,""+y)}}function Os(c){switch(typeof c){case"bigint":case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function Gl(c){var d=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function Xp(c,d,m){var y=Object.getOwnPropertyDescriptor(c.constructor.prototype,d);if(!c.hasOwnProperty(d)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var E=y.get,I=y.set;return Object.defineProperty(c,d,{configurable:!0,get:function(){return E.call(this)},set:function(L){m=""+L,I.call(this,L)}}),Object.defineProperty(c,d,{enumerable:y.enumerable}),{getValue:function(){return m},setValue:function(L){m=""+L},stopTracking:function(){c._valueTracker=null,delete c[d]}}}}function ln(c){if(!c._valueTracker){var d=Gl(c)?"checked":"value";c._valueTracker=Xp(c,d,""+c[d])}}function Pc(c){if(!c)return!1;var d=c._valueTracker;if(!d)return!0;var m=d.getValue(),y="";return c&&(y=Gl(c)?c.checked?"true":"false":c.value),c=y,c!==m?(d.setValue(c),!0):!1}function Jo(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}var Fc=/[\n"\\]/g;function Hr(c){return c.replace(Fc,function(d){return"\\"+d.charCodeAt(0).toString(16)+" "})}function bd(c,d,m,y,E,I,L,G){c.name="",L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"?c.type=L:c.removeAttribute("type"),d!=null?L==="number"?(d===0&&c.value===""||c.value!=d)&&(c.value=""+Os(d)):c.value!==""+Os(d)&&(c.value=""+Os(d)):L!=="submit"&&L!=="reset"||c.removeAttribute("value"),d!=null?Yp(c,L,Os(d)):m!=null?Yp(c,L,Os(m)):y!=null&&c.removeAttribute("value"),E==null&&I!=null&&(c.defaultChecked=!!I),E!=null&&(c.checked=E&&typeof E!="function"&&typeof E!="symbol"),G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"?c.name=""+Os(G):c.removeAttribute("name")}function Zb(c,d,m,y,E,I,L,G){if(I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"&&(c.type=I),d!=null||m!=null){if(!(I!=="submit"&&I!=="reset"||d!=null)){ln(c);return}m=m!=null?""+Os(m):"",d=d!=null?""+Os(d):m,G||d===c.value||(c.value=d),c.defaultValue=d}y=y??E,y=typeof y!="function"&&typeof y!="symbol"&&!!y,c.checked=G?c.checked:!!y,c.defaultChecked=!!y,L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"&&(c.name=L),ln(c)}function Yp(c,d,m){d==="number"&&Jo(c.ownerDocument)===c||c.defaultValue===""+m||(c.defaultValue=""+m)}function Hl(c,d,m,y){if(c=c.options,d){d={};for(var E=0;E<m.length;E++)d["$"+m[E]]=!0;for(m=0;m<c.length;m++)E=d.hasOwnProperty("$"+c[m].value),c[m].selected!==E&&(c[m].selected=E),E&&y&&(c[m].defaultSelected=!0)}else{for(m=""+Os(m),d=null,E=0;E<c.length;E++){if(c[E].value===m){c[E].selected=!0,y&&(c[E].defaultSelected=!0);return}d!==null||c[E].disabled||(d=c[E])}d!==null&&(d.selected=!0)}}function e0(c,d,m){if(d!=null&&(d=""+Os(d),d!==c.value&&(c.value=d),m==null)){c.defaultValue!==d&&(c.defaultValue=d);return}c.defaultValue=m!=null?""+Os(m):""}function ql(c,d,m,y){if(d==null){if(y!=null){if(m!=null)throw Error(s(92));if(se(y)){if(1<y.length)throw Error(s(93));y=y[0]}m=y}m==null&&(m=""),d=m}m=Os(d),c.defaultValue=m,y=c.textContent,y===m&&y!==""&&y!==null&&(c.value=y),ln(c)}function qr(c,d){if(d){var m=c.firstChild;if(m&&m===c.lastChild&&m.nodeType===3){m.nodeValue=d;return}}c.textContent=d}var t0=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Jp(c,d,m){var y=d.indexOf("--")===0;m==null||typeof m=="boolean"||m===""?y?c.setProperty(d,""):d==="float"?c.cssFloat="":c[d]="":y?c.setProperty(d,m):typeof m!="number"||m===0||t0.has(d)?d==="float"?c.cssFloat=m:c[d]=(""+m).trim():c[d]=m+"px"}function jp(c,d,m){if(d!=null&&typeof d!="object")throw Error(s(62));if(c=c.style,m!=null){for(var y in m)!m.hasOwnProperty(y)||d!=null&&d.hasOwnProperty(y)||(y.indexOf("--")===0?c.setProperty(y,""):y==="float"?c.cssFloat="":c[y]="");for(var E in d)y=d[E],d.hasOwnProperty(E)&&m[E]!==y&&Jp(c,E,y)}else for(var I in d)d.hasOwnProperty(I)&&Jp(c,I,d[I])}function vd(c){if(c.indexOf("-")===-1)return!1;switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var n0=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Wl=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function wd(c){return Wl.test(""+c)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":c}function lo(){}var Qp=null;function $i(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var Kl=null,jo=null;function Lc(c){var d=ki(c);if(d&&(c=d.stateNode)){var m=c[Ms]||null;e:switch(c=d.stateNode,d.type){case"input":if(bd(c,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name),d=m.name,m.type==="radio"&&d!=null){for(m=c;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll('input[name="'+Hr(""+d)+'"][type="radio"]'),d=0;d<m.length;d++){var y=m[d];if(y!==c&&y.form===c.form){var E=y[Ms]||null;if(!E)throw Error(s(90));bd(y,E.value,E.defaultValue,E.defaultValue,E.checked,E.defaultChecked,E.type,E.name)}}for(d=0;d<m.length;d++)y=m[d],y.form===c.form&&Pc(y)}break e;case"textarea":e0(c,m.value,m.defaultValue);break e;case"select":d=m.value,d!=null&&Hl(c,!!m.multiple,d,!1)}}}var Td=!1;function Xl(c,d,m){if(Td)return c(d,m);Td=!0;try{var y=c(d);return y}finally{if(Td=!1,(Kl!==null||jo!==null)&&(Y0(),Kl&&(d=Kl,c=jo,jo=Kl=null,Lc(d),c)))for(d=0;d<c.length;d++)Lc(c[d])}}function uo(c,d){var m=c.stateNode;if(m===null)return null;var y=m[Ms]||null;if(y===null)return null;m=y[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(y=!y.disabled)||(c=c.type,y=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!y;break e;default:c=!1}if(c)return null;if(m&&typeof m!="function")throw Error(s(231,d,typeof m));return m}var Ri=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Vc=!1;if(Ri)try{var pn={};Object.defineProperty(pn,"passive",{get:function(){Vc=!0}}),window.addEventListener("test",pn,pn),window.removeEventListener("test",pn,pn)}catch{Vc=!1}var Qo=null,Zp=null,Bc=null;function em(){if(Bc)return Bc;var c,d=Zp,m=d.length,y,E="value"in Qo?Qo.value:Qo.textContent,I=E.length;for(c=0;c<m&&d[c]===E[c];c++);var L=m-c;for(y=1;y<=L&&d[m-y]===E[I-y];y++);return Bc=E.slice(c,1<y?1-y:void 0)}function Uc(c){var d=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&d===13&&(c=13)):c=d,c===10&&(c=13),32<=c||c===13?c:0}function Ua(){return!0}function co(){return!1}function Ys(c){function d(m,y,E,I,L){this._reactName=m,this._targetInst=E,this.type=y,this.nativeEvent=I,this.target=L,this.currentTarget=null;for(var G in c)c.hasOwnProperty(G)&&(m=c[G],this[G]=m?m(I):I[G]);return this.isDefaultPrevented=(I.defaultPrevented!=null?I.defaultPrevented:I.returnValue===!1)?Ua:co,this.isPropagationStopped=co,this}return f(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=Ua)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=Ua)},persist:function(){},isPersistent:Ua}),d}var za={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zo=Ys(za),Yl=f({},za,{view:0,detail:0}),tm=Ys(Yl),Jl,xd,ea,Sd=f({},Yl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:jl,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==ea&&(ea&&c.type==="mousemove"?(Jl=c.screenX-ea.screenX,xd=c.screenY-ea.screenY):xd=Jl=0,ea=c),Jl)},movementY:function(c){return"movementY"in c?c.movementY:xd}}),nm=Ys(Sd),zc=f({},Sd,{dataTransfer:0}),s0=Ys(zc),r0=f({},Yl,{relatedTarget:0}),Gc=Ys(r0),sm=f({},za,{animationName:0,elapsedTime:0,pseudoElement:0}),i0=Ys(sm),_d=f({},za,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),o0=Ys(_d),a0=f({},za,{data:0}),ta=Ys(a0),l0={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},u0={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},c0={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function h0(c){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(c):(c=c0[c])?!!d[c]:!1}function jl(){return h0}var Nr=f({},Yl,{key:function(c){if(c.key){var d=l0[c.key]||c.key;if(d!=="Unidentified")return d}return c.type==="keypress"?(c=Uc(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?u0[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:jl,charCode:function(c){return c.type==="keypress"?Uc(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?Uc(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),d0=Ys(Nr),f0=f({},Sd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ga=Ys(f0),S=f({},Yl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:jl}),R=Ys(S),B=f({},za,{propertyName:0,elapsedTime:0,pseudoElement:0}),K=Ys(B),pe=f({},Sd,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),xe=Ys(pe),Le=f({},za,{newState:0,oldState:0}),gt=Ys(Le),Zn=[9,13,27,32],Zt=Ri&&"CompositionEvent"in window,Fn=null;Ri&&"documentMode"in document&&(Fn=document.documentMode);var Di=Ri&&"TextEvent"in window&&!Fn,na=Ri&&(!Zt||Fn&&8<Fn&&11>=Fn),ho=" ",fo=!1;function Hc(c,d){switch(c){case"keyup":return Zn.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ed(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var Id=!1;function LY(c,d){switch(c){case"compositionend":return Ed(d);case"keypress":return d.which!==32?null:(fo=!0,ho);case"textInput":return c=d.data,c===ho&&fo?null:c;default:return null}}function VY(c,d){if(Id)return c==="compositionend"||!Zt&&Hc(c,d)?(c=em(),Bc=Zp=Qo=null,Id=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return na&&d.locale!=="ko"?null:d.data;default:return null}}var BY={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function N$(c){var d=c&&c.nodeName&&c.nodeName.toLowerCase();return d==="input"?!!BY[c.type]:d==="textarea"}function A$(c,d,m,y){Kl?jo?jo.push(y):jo=[y]:Kl=y,d=n1(d,"onChange"),0<d.length&&(m=new Zo("onChange","change",null,m,y),c.push({event:m,listeners:d}))}var rm=null,im=null;function UY(c){hM(c,0)}function p0(c){var d=hi(c);if(Pc(d))return c}function k$(c,d){if(c==="change")return d}var $$=!1;if(Ri){var Gx;if(Ri){var Hx="oninput"in document;if(!Hx){var R$=document.createElement("div");R$.setAttribute("oninput","return;"),Hx=typeof R$.oninput=="function"}Gx=Hx}else Gx=!1;$$=Gx&&(!document.documentMode||9<document.documentMode)}function D$(){rm&&(rm.detachEvent("onpropertychange",M$),im=rm=null)}function M$(c){if(c.propertyName==="value"&&p0(im)){var d=[];A$(d,im,c,$i(c)),Xl(UY,d)}}function zY(c,d,m){c==="focusin"?(D$(),rm=d,im=m,rm.attachEvent("onpropertychange",M$)):c==="focusout"&&D$()}function GY(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return p0(im)}function HY(c,d){if(c==="click")return p0(d)}function qY(c,d){if(c==="input"||c==="change")return p0(d)}function WY(c,d){return c===d&&(c!==0||1/c===1/d)||c!==c&&d!==d}var fi=typeof Object.is=="function"?Object.is:WY;function om(c,d){if(fi(c,d))return!0;if(typeof c!="object"||c===null||typeof d!="object"||d===null)return!1;var m=Object.keys(c),y=Object.keys(d);if(m.length!==y.length)return!1;for(y=0;y<m.length;y++){var E=m[y];if(!sn.call(d,E)||!fi(c[E],d[E]))return!1}return!0}function O$(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function P$(c,d){var m=O$(c);c=0;for(var y;m;){if(m.nodeType===3){if(y=c+m.textContent.length,c<=d&&y>=d)return{node:m,offset:d-c};c=y}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=O$(m)}}function F$(c,d){return c&&d?c===d?!0:c&&c.nodeType===3?!1:d&&d.nodeType===3?F$(c,d.parentNode):"contains"in c?c.contains(d):c.compareDocumentPosition?!!(c.compareDocumentPosition(d)&16):!1:!1}function L$(c){c=c!=null&&c.ownerDocument!=null&&c.ownerDocument.defaultView!=null?c.ownerDocument.defaultView:window;for(var d=Jo(c.document);d instanceof c.HTMLIFrameElement;){try{var m=typeof d.contentWindow.location.href=="string"}catch{m=!1}if(m)c=d.contentWindow;else break;d=Jo(c.document)}return d}function qx(c){var d=c&&c.nodeName&&c.nodeName.toLowerCase();return d&&(d==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||d==="textarea"||c.contentEditable==="true")}var KY=Ri&&"documentMode"in document&&11>=document.documentMode,Cd=null,Wx=null,am=null,Kx=!1;function V$(c,d,m){var y=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;Kx||Cd==null||Cd!==Jo(y)||(y=Cd,"selectionStart"in y&&qx(y)?y={start:y.selectionStart,end:y.selectionEnd}:(y=(y.ownerDocument&&y.ownerDocument.defaultView||window).getSelection(),y={anchorNode:y.anchorNode,anchorOffset:y.anchorOffset,focusNode:y.focusNode,focusOffset:y.focusOffset}),am&&om(am,y)||(am=y,y=n1(Wx,"onSelect"),0<y.length&&(d=new Zo("onSelect","select",null,d,m),c.push({event:d,listeners:y}),d.target=Cd)))}function qc(c,d){var m={};return m[c.toLowerCase()]=d.toLowerCase(),m["Webkit"+c]="webkit"+d,m["Moz"+c]="moz"+d,m}var Nd={animationend:qc("Animation","AnimationEnd"),animationiteration:qc("Animation","AnimationIteration"),animationstart:qc("Animation","AnimationStart"),transitionrun:qc("Transition","TransitionRun"),transitionstart:qc("Transition","TransitionStart"),transitioncancel:qc("Transition","TransitionCancel"),transitionend:qc("Transition","TransitionEnd")},Xx={},B$={};Ri&&(B$=document.createElement("div").style,"AnimationEvent"in window||(delete Nd.animationend.animation,delete Nd.animationiteration.animation,delete Nd.animationstart.animation),"TransitionEvent"in window||delete Nd.transitionend.transition);function Wc(c){if(Xx[c])return Xx[c];if(!Nd[c])return c;var d=Nd[c],m;for(m in d)if(d.hasOwnProperty(m)&&m in B$)return Xx[c]=d[m];return c}var U$=Wc("animationend"),z$=Wc("animationiteration"),G$=Wc("animationstart"),XY=Wc("transitionrun"),YY=Wc("transitionstart"),JY=Wc("transitioncancel"),H$=Wc("transitionend"),q$=new Map,Yx="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Yx.push("scrollEnd");function po(c,d){q$.set(c,d),Xo(d,[c])}var m0=typeof reportError=="function"?reportError:function(c){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var d=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof c=="object"&&c!==null&&typeof c.message=="string"?String(c.message):String(c),error:c});if(!window.dispatchEvent(d))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",c);return}console.error(c)},Mi=[],Ad=0,Jx=0;function g0(){for(var c=Ad,d=Jx=Ad=0;d<c;){var m=Mi[d];Mi[d++]=null;var y=Mi[d];Mi[d++]=null;var E=Mi[d];Mi[d++]=null;var I=Mi[d];if(Mi[d++]=null,y!==null&&E!==null){var L=y.pending;L===null?E.next=E:(E.next=L.next,L.next=E),y.pending=E}I!==0&&W$(m,E,I)}}function y0(c,d,m,y){Mi[Ad++]=c,Mi[Ad++]=d,Mi[Ad++]=m,Mi[Ad++]=y,Jx|=y,c.lanes|=y,c=c.alternate,c!==null&&(c.lanes|=y)}function jx(c,d,m,y){return y0(c,d,m,y),b0(c)}function Kc(c,d){return y0(c,null,null,d),b0(c)}function W$(c,d,m){c.lanes|=m;var y=c.alternate;y!==null&&(y.lanes|=m);for(var E=!1,I=c.return;I!==null;)I.childLanes|=m,y=I.alternate,y!==null&&(y.childLanes|=m),I.tag===22&&(c=I.stateNode,c===null||c._visibility&1||(E=!0)),c=I,I=I.return;return c.tag===3?(I=c.stateNode,E&&d!==null&&(E=31-Qn(m),c=I.hiddenUpdates,y=c[E],y===null?c[E]=[d]:y.push(d),d.lane=m|536870912),I):null}function b0(c){if(50<Am)throw Am=0,o_=null,Error(s(185));for(var d=c.return;d!==null;)c=d,d=c.return;return c.tag===3?c.stateNode:null}var kd={};function jY(c,d,m,y){this.tag=c,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function pi(c,d,m,y){return new jY(c,d,m,y)}function Qx(c){return c=c.prototype,!(!c||!c.isReactComponent)}function Ha(c,d){var m=c.alternate;return m===null?(m=pi(c.tag,d,c.key,c.mode),m.elementType=c.elementType,m.type=c.type,m.stateNode=c.stateNode,m.alternate=c,c.alternate=m):(m.pendingProps=d,m.type=c.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=c.flags&65011712,m.childLanes=c.childLanes,m.lanes=c.lanes,m.child=c.child,m.memoizedProps=c.memoizedProps,m.memoizedState=c.memoizedState,m.updateQueue=c.updateQueue,d=c.dependencies,m.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},m.sibling=c.sibling,m.index=c.index,m.ref=c.ref,m.refCleanup=c.refCleanup,m}function K$(c,d){c.flags&=65011714;var m=c.alternate;return m===null?(c.childLanes=0,c.lanes=d,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=m.childLanes,c.lanes=m.lanes,c.child=m.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=m.memoizedProps,c.memoizedState=m.memoizedState,c.updateQueue=m.updateQueue,c.type=m.type,d=m.dependencies,c.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),c}function v0(c,d,m,y,E,I){var L=0;if(y=c,typeof c=="function")Qx(c)&&(L=1);else if(typeof c=="string")L=nj(c,m,Te.current)?26:c==="html"||c==="head"||c==="body"?27:5;else e:switch(c){case $:return c=pi(31,m,d,E),c.elementType=$,c.lanes=I,c;case T:return Xc(m.children,E,I,d);case w:L=8,E|=24;break;case _:return c=pi(12,m,d,E|2),c.elementType=_,c.lanes=I,c;case P:return c=pi(13,m,d,E),c.elementType=P,c.lanes=I,c;case V:return c=pi(19,m,d,E),c.elementType=V,c.lanes=I,c;default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case N:L=10;break e;case C:L=9;break e;case A:L=11;break e;case D:L=14;break e;case M:L=16,y=null;break e}L=29,m=Error(s(130,c===null?"null":typeof c,"")),y=null}return d=pi(L,m,d,E),d.elementType=c,d.type=y,d.lanes=I,d}function Xc(c,d,m,y){return c=pi(7,c,y,d),c.lanes=m,c}function Zx(c,d,m){return c=pi(6,c,null,d),c.lanes=m,c}function X$(c){var d=pi(18,null,null,0);return d.stateNode=c,d}function eS(c,d,m){return d=pi(4,c.children!==null?c.children:[],c.key,d),d.lanes=m,d.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},d}var Y$=new WeakMap;function Oi(c,d){if(typeof c=="object"&&c!==null){var m=Y$.get(c);return m!==void 0?m:(d={value:c,source:d,stack:Qt(d)},Y$.set(c,d),d)}return{value:c,source:d,stack:Qt(d)}}var $d=[],Rd=0,w0=null,lm=0,Pi=[],Fi=0,Ql=null,sa=1,ra="";function qa(c,d){$d[Rd++]=lm,$d[Rd++]=w0,w0=c,lm=d}function J$(c,d,m){Pi[Fi++]=sa,Pi[Fi++]=ra,Pi[Fi++]=Ql,Ql=c;var y=sa;c=ra;var E=32-Qn(y)-1;y&=~(1<<E),m+=1;var I=32-Qn(d)+E;if(30<I){var L=E-E%5;I=(y&(1<<L)-1).toString(32),y>>=L,E-=L,sa=1<<32-Qn(d)+E|m<<E|y,ra=I+c}else sa=1<<I|m<<E|y,ra=c}function tS(c){c.return!==null&&(qa(c,1),J$(c,1,0))}function nS(c){for(;c===w0;)w0=$d[--Rd],$d[Rd]=null,lm=$d[--Rd],$d[Rd]=null;for(;c===Ql;)Ql=Pi[--Fi],Pi[Fi]=null,ra=Pi[--Fi],Pi[Fi]=null,sa=Pi[--Fi],Pi[Fi]=null}function j$(c,d){Pi[Fi++]=sa,Pi[Fi++]=ra,Pi[Fi++]=Ql,sa=d.id,ra=d.overflow,Ql=c}var Js=null,kn=null,Pt=!1,Zl=null,Li=!1,sS=Error(s(519));function eu(c){var d=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw um(Oi(d,c)),sS}function Q$(c){var d=c.stateNode,m=c.type,y=c.memoizedProps;switch(d[ls]=c,d[Ms]=y,m){case"dialog":At("cancel",d),At("close",d);break;case"iframe":case"object":case"embed":At("load",d);break;case"video":case"audio":for(m=0;m<$m.length;m++)At($m[m],d);break;case"source":At("error",d);break;case"img":case"image":case"link":At("error",d),At("load",d);break;case"details":At("toggle",d);break;case"input":At("invalid",d),Zb(d,y.value,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name,!0);break;case"select":At("invalid",d);break;case"textarea":At("invalid",d),ql(d,y.value,y.defaultValue,y.children)}m=y.children,typeof m!="string"&&typeof m!="number"&&typeof m!="bigint"||d.textContent===""+m||y.suppressHydrationWarning===!0||mM(d.textContent,m)?(y.popover!=null&&(At("beforetoggle",d),At("toggle",d)),y.onScroll!=null&&At("scroll",d),y.onScrollEnd!=null&&At("scrollend",d),y.onClick!=null&&(d.onclick=lo),d=!0):d=!1,d||eu(c,!0)}function Z$(c){for(Js=c.return;Js;)switch(Js.tag){case 5:case 31:case 13:Li=!1;return;case 27:case 3:Li=!0;return;default:Js=Js.return}}function Dd(c){if(c!==Js)return!1;if(!Pt)return Z$(c),Pt=!0,!1;var d=c.tag,m;if((m=d!==3&&d!==27)&&((m=d===5)&&(m=c.type,m=!(m!=="form"&&m!=="button")||T_(c.type,c.memoizedProps)),m=!m),m&&kn&&eu(c),Z$(c),d===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(s(317));kn=_M(c)}else if(d===31){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(s(317));kn=_M(c)}else d===27?(d=kn,pu(c.type)?(c=I_,I_=null,kn=c):kn=d):kn=Js?Bi(c.stateNode.nextSibling):null;return!0}function Yc(){kn=Js=null,Pt=!1}function rS(){var c=Zl;return c!==null&&(Yr===null?Yr=c:Yr.push.apply(Yr,c),Zl=null),c}function um(c){Zl===null?Zl=[c]:Zl.push(c)}var iS=W(null),Jc=null,Wa=null;function tu(c,d,m){ue(iS,d._currentValue),d._currentValue=m}function Ka(c){c._currentValue=iS.current,ne(iS)}function oS(c,d,m){for(;c!==null;){var y=c.alternate;if((c.childLanes&d)!==d?(c.childLanes|=d,y!==null&&(y.childLanes|=d)):y!==null&&(y.childLanes&d)!==d&&(y.childLanes|=d),c===m)break;c=c.return}}function aS(c,d,m,y){var E=c.child;for(E!==null&&(E.return=c);E!==null;){var I=E.dependencies;if(I!==null){var L=E.child;I=I.firstContext;e:for(;I!==null;){var G=I;I=E;for(var ee=0;ee<d.length;ee++)if(G.context===d[ee]){I.lanes|=m,G=I.alternate,G!==null&&(G.lanes|=m),oS(I.return,m,c),y||(L=null);break e}I=G.next}}else if(E.tag===18){if(L=E.return,L===null)throw Error(s(341));L.lanes|=m,I=L.alternate,I!==null&&(I.lanes|=m),oS(L,m,c),L=null}else L=E.child;if(L!==null)L.return=E;else for(L=E;L!==null;){if(L===c){L=null;break}if(E=L.sibling,E!==null){E.return=L.return,L=E;break}L=L.return}E=L}}function Md(c,d,m,y){c=null;for(var E=d,I=!1;E!==null;){if(!I){if((E.flags&524288)!==0)I=!0;else if((E.flags&262144)!==0)break}if(E.tag===10){var L=E.alternate;if(L===null)throw Error(s(387));if(L=L.memoizedProps,L!==null){var G=E.type;fi(E.pendingProps.value,L.value)||(c!==null?c.push(G):c=[G])}}else if(E===Fe.current){if(L=E.alternate,L===null)throw Error(s(387));L.memoizedState.memoizedState!==E.memoizedState.memoizedState&&(c!==null?c.push(Pm):c=[Pm])}E=E.return}c!==null&&aS(d,c,m,y),d.flags|=262144}function T0(c){for(c=c.firstContext;c!==null;){if(!fi(c.context._currentValue,c.memoizedValue))return!0;c=c.next}return!1}function jc(c){Jc=c,Wa=null,c=c.dependencies,c!==null&&(c.firstContext=null)}function js(c){return eR(Jc,c)}function x0(c,d){return Jc===null&&jc(c),eR(c,d)}function eR(c,d){var m=d._currentValue;if(d={context:d,memoizedValue:m,next:null},Wa===null){if(c===null)throw Error(s(308));Wa=d,c.dependencies={lanes:0,firstContext:d},c.flags|=524288}else Wa=Wa.next=d;return m}var QY=typeof AbortController<"u"?AbortController:function(){var c=[],d=this.signal={aborted:!1,addEventListener:function(m,y){c.push(y)}};this.abort=function(){d.aborted=!0,c.forEach(function(m){return m()})}},ZY=n.unstable_scheduleCallback,eJ=n.unstable_NormalPriority,hs={$$typeof:N,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function lS(){return{controller:new QY,data:new Map,refCount:0}}function cm(c){c.refCount--,c.refCount===0&&ZY(eJ,function(){c.controller.abort()})}var hm=null,uS=0,Od=0,Pd=null;function tJ(c,d){if(hm===null){var m=hm=[];uS=0,Od=d_(),Pd={status:"pending",value:void 0,then:function(y){m.push(y)}}}return uS++,d.then(tR,tR),d}function tR(){if(--uS===0&&hm!==null){Pd!==null&&(Pd.status="fulfilled");var c=hm;hm=null,Od=0,Pd=null;for(var d=0;d<c.length;d++)(0,c[d])()}}function nJ(c,d){var m=[],y={status:"pending",value:null,reason:null,then:function(E){m.push(E)}};return c.then(function(){y.status="fulfilled",y.value=d;for(var E=0;E<m.length;E++)(0,m[E])(d)},function(E){for(y.status="rejected",y.reason=E,E=0;E<m.length;E++)(0,m[E])(void 0)}),y}var nR=X.S;X.S=function(c,d){VD=wn(),typeof d=="object"&&d!==null&&typeof d.then=="function"&&tJ(c,d),nR!==null&&nR(c,d)};var Qc=W(null);function cS(){var c=Qc.current;return c!==null?c:Tn.pooledCache}function S0(c,d){d===null?ue(Qc,Qc.current):ue(Qc,d.pool)}function sR(){var c=cS();return c===null?null:{parent:hs._currentValue,pool:c}}var Fd=Error(s(460)),hS=Error(s(474)),_0=Error(s(542)),E0={then:function(){}};function rR(c){return c=c.status,c==="fulfilled"||c==="rejected"}function iR(c,d,m){switch(m=c[m],m===void 0?c.push(d):m!==d&&(d.then(lo,lo),d=m),d.status){case"fulfilled":return d.value;case"rejected":throw c=d.reason,aR(c),c;default:if(typeof d.status=="string")d.then(lo,lo);else{if(c=Tn,c!==null&&100<c.shellSuspendCounter)throw Error(s(482));c=d,c.status="pending",c.then(function(y){if(d.status==="pending"){var E=d;E.status="fulfilled",E.value=y}},function(y){if(d.status==="pending"){var E=d;E.status="rejected",E.reason=y}})}switch(d.status){case"fulfilled":return d.value;case"rejected":throw c=d.reason,aR(c),c}throw eh=d,Fd}}function Zc(c){try{var d=c._init;return d(c._payload)}catch(m){throw m!==null&&typeof m=="object"&&typeof m.then=="function"?(eh=m,Fd):m}}var eh=null;function oR(){if(eh===null)throw Error(s(459));var c=eh;return eh=null,c}function aR(c){if(c===Fd||c===_0)throw Error(s(483))}var Ld=null,dm=0;function I0(c){var d=dm;return dm+=1,Ld===null&&(Ld=[]),iR(Ld,c,d)}function fm(c,d){d=d.props.ref,c.ref=d!==void 0?d:null}function C0(c,d){throw d.$$typeof===p?Error(s(525)):(c=Object.prototype.toString.call(d),Error(s(31,c==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":c)))}function lR(c){function d(de,oe){if(c){var me=de.deletions;me===null?(de.deletions=[oe],de.flags|=16):me.push(oe)}}function m(de,oe){if(!c)return null;for(;oe!==null;)d(de,oe),oe=oe.sibling;return null}function y(de){for(var oe=new Map;de!==null;)de.key!==null?oe.set(de.key,de):oe.set(de.index,de),de=de.sibling;return oe}function E(de,oe){return de=Ha(de,oe),de.index=0,de.sibling=null,de}function I(de,oe,me){return de.index=me,c?(me=de.alternate,me!==null?(me=me.index,me<oe?(de.flags|=67108866,oe):me):(de.flags|=67108866,oe)):(de.flags|=1048576,oe)}function L(de){return c&&de.alternate===null&&(de.flags|=67108866),de}function G(de,oe,me,Ne){return oe===null||oe.tag!==6?(oe=Zx(me,de.mode,Ne),oe.return=de,oe):(oe=E(oe,me),oe.return=de,oe)}function ee(de,oe,me,Ne){var et=me.type;return et===T?Ce(de,oe,me.props.children,Ne,me.key):oe!==null&&(oe.elementType===et||typeof et=="object"&&et!==null&&et.$$typeof===M&&Zc(et)===oe.type)?(oe=E(oe,me.props),fm(oe,me),oe.return=de,oe):(oe=v0(me.type,me.key,me.props,null,de.mode,Ne),fm(oe,me),oe.return=de,oe)}function ye(de,oe,me,Ne){return oe===null||oe.tag!==4||oe.stateNode.containerInfo!==me.containerInfo||oe.stateNode.implementation!==me.implementation?(oe=eS(me,de.mode,Ne),oe.return=de,oe):(oe=E(oe,me.children||[]),oe.return=de,oe)}function Ce(de,oe,me,Ne,et){return oe===null||oe.tag!==7?(oe=Xc(me,de.mode,Ne,et),oe.return=de,oe):(oe=E(oe,me),oe.return=de,oe)}function $e(de,oe,me){if(typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint")return oe=Zx(""+oe,de.mode,me),oe.return=de,oe;if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case g:return me=v0(oe.type,oe.key,oe.props,null,de.mode,me),fm(me,oe),me.return=de,me;case b:return oe=eS(oe,de.mode,me),oe.return=de,oe;case M:return oe=Zc(oe),$e(de,oe,me)}if(se(oe)||z(oe))return oe=Xc(oe,de.mode,me,null),oe.return=de,oe;if(typeof oe.then=="function")return $e(de,I0(oe),me);if(oe.$$typeof===N)return $e(de,x0(de,oe),me);C0(de,oe)}return null}function ve(de,oe,me,Ne){var et=oe!==null?oe.key:null;if(typeof me=="string"&&me!==""||typeof me=="number"||typeof me=="bigint")return et!==null?null:G(de,oe,""+me,Ne);if(typeof me=="object"&&me!==null){switch(me.$$typeof){case g:return me.key===et?ee(de,oe,me,Ne):null;case b:return me.key===et?ye(de,oe,me,Ne):null;case M:return me=Zc(me),ve(de,oe,me,Ne)}if(se(me)||z(me))return et!==null?null:Ce(de,oe,me,Ne,null);if(typeof me.then=="function")return ve(de,oe,I0(me),Ne);if(me.$$typeof===N)return ve(de,oe,x0(de,me),Ne);C0(de,me)}return null}function Se(de,oe,me,Ne,et){if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number"||typeof Ne=="bigint")return de=de.get(me)||null,G(oe,de,""+Ne,et);if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case g:return de=de.get(Ne.key===null?me:Ne.key)||null,ee(oe,de,Ne,et);case b:return de=de.get(Ne.key===null?me:Ne.key)||null,ye(oe,de,Ne,et);case M:return Ne=Zc(Ne),Se(de,oe,me,Ne,et)}if(se(Ne)||z(Ne))return de=de.get(me)||null,Ce(oe,de,Ne,et,null);if(typeof Ne.then=="function")return Se(de,oe,me,I0(Ne),et);if(Ne.$$typeof===N)return Se(de,oe,me,x0(oe,Ne),et);C0(oe,Ne)}return null}function Xe(de,oe,me,Ne){for(var et=null,Wt=null,je=oe,vt=oe=0,$t=null;je!==null&&vt<me.length;vt++){je.index>vt?($t=je,je=null):$t=je.sibling;var Kt=ve(de,je,me[vt],Ne);if(Kt===null){je===null&&(je=$t);break}c&&je&&Kt.alternate===null&&d(de,je),oe=I(Kt,oe,vt),Wt===null?et=Kt:Wt.sibling=Kt,Wt=Kt,je=$t}if(vt===me.length)return m(de,je),Pt&&qa(de,vt),et;if(je===null){for(;vt<me.length;vt++)je=$e(de,me[vt],Ne),je!==null&&(oe=I(je,oe,vt),Wt===null?et=je:Wt.sibling=je,Wt=je);return Pt&&qa(de,vt),et}for(je=y(je);vt<me.length;vt++)$t=Se(je,de,vt,me[vt],Ne),$t!==null&&(c&&$t.alternate!==null&&je.delete($t.key===null?vt:$t.key),oe=I($t,oe,vt),Wt===null?et=$t:Wt.sibling=$t,Wt=$t);return c&&je.forEach(function(vu){return d(de,vu)}),Pt&&qa(de,vt),et}function st(de,oe,me,Ne){if(me==null)throw Error(s(151));for(var et=null,Wt=null,je=oe,vt=oe=0,$t=null,Kt=me.next();je!==null&&!Kt.done;vt++,Kt=me.next()){je.index>vt?($t=je,je=null):$t=je.sibling;var vu=ve(de,je,Kt.value,Ne);if(vu===null){je===null&&(je=$t);break}c&&je&&vu.alternate===null&&d(de,je),oe=I(vu,oe,vt),Wt===null?et=vu:Wt.sibling=vu,Wt=vu,je=$t}if(Kt.done)return m(de,je),Pt&&qa(de,vt),et;if(je===null){for(;!Kt.done;vt++,Kt=me.next())Kt=$e(de,Kt.value,Ne),Kt!==null&&(oe=I(Kt,oe,vt),Wt===null?et=Kt:Wt.sibling=Kt,Wt=Kt);return Pt&&qa(de,vt),et}for(je=y(je);!Kt.done;vt++,Kt=me.next())Kt=Se(je,de,vt,Kt.value,Ne),Kt!==null&&(c&&Kt.alternate!==null&&je.delete(Kt.key===null?vt:Kt.key),oe=I(Kt,oe,vt),Wt===null?et=Kt:Wt.sibling=Kt,Wt=Kt);return c&&je.forEach(function(fj){return d(de,fj)}),Pt&&qa(de,vt),et}function yn(de,oe,me,Ne){if(typeof me=="object"&&me!==null&&me.type===T&&me.key===null&&(me=me.props.children),typeof me=="object"&&me!==null){switch(me.$$typeof){case g:e:{for(var et=me.key;oe!==null;){if(oe.key===et){if(et=me.type,et===T){if(oe.tag===7){m(de,oe.sibling),Ne=E(oe,me.props.children),Ne.return=de,de=Ne;break e}}else if(oe.elementType===et||typeof et=="object"&&et!==null&&et.$$typeof===M&&Zc(et)===oe.type){m(de,oe.sibling),Ne=E(oe,me.props),fm(Ne,me),Ne.return=de,de=Ne;break e}m(de,oe);break}else d(de,oe);oe=oe.sibling}me.type===T?(Ne=Xc(me.props.children,de.mode,Ne,me.key),Ne.return=de,de=Ne):(Ne=v0(me.type,me.key,me.props,null,de.mode,Ne),fm(Ne,me),Ne.return=de,de=Ne)}return L(de);case b:e:{for(et=me.key;oe!==null;){if(oe.key===et)if(oe.tag===4&&oe.stateNode.containerInfo===me.containerInfo&&oe.stateNode.implementation===me.implementation){m(de,oe.sibling),Ne=E(oe,me.children||[]),Ne.return=de,de=Ne;break e}else{m(de,oe);break}else d(de,oe);oe=oe.sibling}Ne=eS(me,de.mode,Ne),Ne.return=de,de=Ne}return L(de);case M:return me=Zc(me),yn(de,oe,me,Ne)}if(se(me))return Xe(de,oe,me,Ne);if(z(me)){if(et=z(me),typeof et!="function")throw Error(s(150));return me=et.call(me),st(de,oe,me,Ne)}if(typeof me.then=="function")return yn(de,oe,I0(me),Ne);if(me.$$typeof===N)return yn(de,oe,x0(de,me),Ne);C0(de,me)}return typeof me=="string"&&me!==""||typeof me=="number"||typeof me=="bigint"?(me=""+me,oe!==null&&oe.tag===6?(m(de,oe.sibling),Ne=E(oe,me),Ne.return=de,de=Ne):(m(de,oe),Ne=Zx(me,de.mode,Ne),Ne.return=de,de=Ne),L(de)):m(de,oe)}return function(de,oe,me,Ne){try{dm=0;var et=yn(de,oe,me,Ne);return Ld=null,et}catch(je){if(je===Fd||je===_0)throw je;var Wt=pi(29,je,null,de.mode);return Wt.lanes=Ne,Wt.return=de,Wt}finally{}}}var th=lR(!0),uR=lR(!1),nu=!1;function dS(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function fS(c,d){c=c.updateQueue,d.updateQueue===c&&(d.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,callbacks:null})}function su(c){return{lane:c,tag:0,payload:null,callback:null,next:null}}function ru(c,d,m){var y=c.updateQueue;if(y===null)return null;if(y=y.shared,(en&2)!==0){var E=y.pending;return E===null?d.next=d:(d.next=E.next,E.next=d),y.pending=d,d=b0(c),W$(c,null,m),d}return y0(c,y,d,m),b0(c)}function pm(c,d,m){if(d=d.updateQueue,d!==null&&(d=d.shared,(m&4194048)!==0)){var y=d.lanes;y&=c.pendingLanes,m|=y,d.lanes=m,Up(c,m)}}function pS(c,d){var m=c.updateQueue,y=c.alternate;if(y!==null&&(y=y.updateQueue,m===y)){var E=null,I=null;if(m=m.firstBaseUpdate,m!==null){do{var L={lane:m.lane,tag:m.tag,payload:m.payload,callback:null,next:null};I===null?E=I=L:I=I.next=L,m=m.next}while(m!==null);I===null?E=I=d:I=I.next=d}else E=I=d;m={baseState:y.baseState,firstBaseUpdate:E,lastBaseUpdate:I,shared:y.shared,callbacks:y.callbacks},c.updateQueue=m;return}c=m.lastBaseUpdate,c===null?m.firstBaseUpdate=d:c.next=d,m.lastBaseUpdate=d}var mS=!1;function mm(){if(mS){var c=Pd;if(c!==null)throw c}}function gm(c,d,m,y){mS=!1;var E=c.updateQueue;nu=!1;var I=E.firstBaseUpdate,L=E.lastBaseUpdate,G=E.shared.pending;if(G!==null){E.shared.pending=null;var ee=G,ye=ee.next;ee.next=null,L===null?I=ye:L.next=ye,L=ee;var Ce=c.alternate;Ce!==null&&(Ce=Ce.updateQueue,G=Ce.lastBaseUpdate,G!==L&&(G===null?Ce.firstBaseUpdate=ye:G.next=ye,Ce.lastBaseUpdate=ee))}if(I!==null){var $e=E.baseState;L=0,Ce=ye=ee=null,G=I;do{var ve=G.lane&-536870913,Se=ve!==G.lane;if(Se?(kt&ve)===ve:(y&ve)===ve){ve!==0&&ve===Od&&(mS=!0),Ce!==null&&(Ce=Ce.next={lane:0,tag:G.tag,payload:G.payload,callback:null,next:null});e:{var Xe=c,st=G;ve=d;var yn=m;switch(st.tag){case 1:if(Xe=st.payload,typeof Xe=="function"){$e=Xe.call(yn,$e,ve);break e}$e=Xe;break e;case 3:Xe.flags=Xe.flags&-65537|128;case 0:if(Xe=st.payload,ve=typeof Xe=="function"?Xe.call(yn,$e,ve):Xe,ve==null)break e;$e=f({},$e,ve);break e;case 2:nu=!0}}ve=G.callback,ve!==null&&(c.flags|=64,Se&&(c.flags|=8192),Se=E.callbacks,Se===null?E.callbacks=[ve]:Se.push(ve))}else Se={lane:ve,tag:G.tag,payload:G.payload,callback:G.callback,next:null},Ce===null?(ye=Ce=Se,ee=$e):Ce=Ce.next=Se,L|=ve;if(G=G.next,G===null){if(G=E.shared.pending,G===null)break;Se=G,G=Se.next,Se.next=null,E.lastBaseUpdate=Se,E.shared.pending=null}}while(!0);Ce===null&&(ee=$e),E.baseState=ee,E.firstBaseUpdate=ye,E.lastBaseUpdate=Ce,I===null&&(E.shared.lanes=0),uu|=L,c.lanes=L,c.memoizedState=$e}}function cR(c,d){if(typeof c!="function")throw Error(s(191,c));c.call(d)}function hR(c,d){var m=c.callbacks;if(m!==null)for(c.callbacks=null,c=0;c<m.length;c++)cR(m[c],d)}var Vd=W(null),N0=W(0);function dR(c,d){c=nl,ue(N0,c),ue(Vd,d),nl=c|d.baseLanes}function gS(){ue(N0,nl),ue(Vd,Vd.current)}function yS(){nl=N0.current,ne(Vd),ne(N0)}var mi=W(null),Vi=null;function iu(c){var d=c.alternate;ue(es,es.current&1),ue(mi,c),Vi===null&&(d===null||Vd.current!==null||d.memoizedState!==null)&&(Vi=c)}function bS(c){ue(es,es.current),ue(mi,c),Vi===null&&(Vi=c)}function fR(c){c.tag===22?(ue(es,es.current),ue(mi,c),Vi===null&&(Vi=c)):ou()}function ou(){ue(es,es.current),ue(mi,mi.current)}function gi(c){ne(mi),Vi===c&&(Vi=null),ne(es)}var es=W(0);function A0(c){for(var d=c;d!==null;){if(d.tag===13){var m=d.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||__(m)||E_(m)))return d}else if(d.tag===19&&(d.memoizedProps.revealOrder==="forwards"||d.memoizedProps.revealOrder==="backwards"||d.memoizedProps.revealOrder==="unstable_legacy-backwards"||d.memoizedProps.revealOrder==="together")){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===c)break;for(;d.sibling===null;){if(d.return===null||d.return===c)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var Xa=0,yt=null,mn=null,ds=null,k0=!1,Bd=!1,nh=!1,$0=0,ym=0,Ud=null,sJ=0;function Hn(){throw Error(s(321))}function vS(c,d){if(d===null)return!1;for(var m=0;m<d.length&&m<c.length;m++)if(!fi(c[m],d[m]))return!1;return!0}function wS(c,d,m,y,E,I){return Xa=I,yt=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,X.H=c===null||c.memoizedState===null?JR:OS,nh=!1,I=m(y,E),nh=!1,Bd&&(I=mR(d,m,y,E)),pR(c),I}function pR(c){X.H=wm;var d=mn!==null&&mn.next!==null;if(Xa=0,ds=mn=yt=null,k0=!1,ym=0,Ud=null,d)throw Error(s(300));c===null||fs||(c=c.dependencies,c!==null&&T0(c)&&(fs=!0))}function mR(c,d,m,y){yt=c;var E=0;do{if(Bd&&(Ud=null),ym=0,Bd=!1,25<=E)throw Error(s(301));if(E+=1,ds=mn=null,c.updateQueue!=null){var I=c.updateQueue;I.lastEffect=null,I.events=null,I.stores=null,I.memoCache!=null&&(I.memoCache.index=0)}X.H=jR,I=d(m,y)}while(Bd);return I}function rJ(){var c=X.H,d=c.useState()[0];return d=typeof d.then=="function"?bm(d):d,c=c.useState()[0],(mn!==null?mn.memoizedState:null)!==c&&(yt.flags|=1024),d}function TS(){var c=$0!==0;return $0=0,c}function xS(c,d,m){d.updateQueue=c.updateQueue,d.flags&=-2053,c.lanes&=~m}function SS(c){if(k0){for(c=c.memoizedState;c!==null;){var d=c.queue;d!==null&&(d.pending=null),c=c.next}k0=!1}Xa=0,ds=mn=yt=null,Bd=!1,ym=$0=0,Ud=null}function Ar(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ds===null?yt.memoizedState=ds=c:ds=ds.next=c,ds}function ts(){if(mn===null){var c=yt.alternate;c=c!==null?c.memoizedState:null}else c=mn.next;var d=ds===null?yt.memoizedState:ds.next;if(d!==null)ds=d,mn=c;else{if(c===null)throw yt.alternate===null?Error(s(467)):Error(s(310));mn=c,c={memoizedState:mn.memoizedState,baseState:mn.baseState,baseQueue:mn.baseQueue,queue:mn.queue,next:null},ds===null?yt.memoizedState=ds=c:ds=ds.next=c}return ds}function R0(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function bm(c){var d=ym;return ym+=1,Ud===null&&(Ud=[]),c=iR(Ud,c,d),d=yt,(ds===null?d.memoizedState:ds.next)===null&&(d=d.alternate,X.H=d===null||d.memoizedState===null?JR:OS),c}function D0(c){if(c!==null&&typeof c=="object"){if(typeof c.then=="function")return bm(c);if(c.$$typeof===N)return js(c)}throw Error(s(438,String(c)))}function _S(c){var d=null,m=yt.updateQueue;if(m!==null&&(d=m.memoCache),d==null){var y=yt.alternate;y!==null&&(y=y.updateQueue,y!==null&&(y=y.memoCache,y!=null&&(d={data:y.data.map(function(E){return E.slice()}),index:0})))}if(d==null&&(d={data:[],index:0}),m===null&&(m=R0(),yt.updateQueue=m),m.memoCache=d,m=d.data[d.index],m===void 0)for(m=d.data[d.index]=Array(c),y=0;y<c;y++)m[y]=O;return d.index++,m}function Ya(c,d){return typeof d=="function"?d(c):d}function M0(c){var d=ts();return ES(d,mn,c)}function ES(c,d,m){var y=c.queue;if(y===null)throw Error(s(311));y.lastRenderedReducer=m;var E=c.baseQueue,I=y.pending;if(I!==null){if(E!==null){var L=E.next;E.next=I.next,I.next=L}d.baseQueue=E=I,y.pending=null}if(I=c.baseState,E===null)c.memoizedState=I;else{d=E.next;var G=L=null,ee=null,ye=d,Ce=!1;do{var $e=ye.lane&-536870913;if($e!==ye.lane?(kt&$e)===$e:(Xa&$e)===$e){var ve=ye.revertLane;if(ve===0)ee!==null&&(ee=ee.next={lane:0,revertLane:0,gesture:null,action:ye.action,hasEagerState:ye.hasEagerState,eagerState:ye.eagerState,next:null}),$e===Od&&(Ce=!0);else if((Xa&ve)===ve){ye=ye.next,ve===Od&&(Ce=!0);continue}else $e={lane:0,revertLane:ye.revertLane,gesture:null,action:ye.action,hasEagerState:ye.hasEagerState,eagerState:ye.eagerState,next:null},ee===null?(G=ee=$e,L=I):ee=ee.next=$e,yt.lanes|=ve,uu|=ve;$e=ye.action,nh&&m(I,$e),I=ye.hasEagerState?ye.eagerState:m(I,$e)}else ve={lane:$e,revertLane:ye.revertLane,gesture:ye.gesture,action:ye.action,hasEagerState:ye.hasEagerState,eagerState:ye.eagerState,next:null},ee===null?(G=ee=ve,L=I):ee=ee.next=ve,yt.lanes|=$e,uu|=$e;ye=ye.next}while(ye!==null&&ye!==d);if(ee===null?L=I:ee.next=G,!fi(I,c.memoizedState)&&(fs=!0,Ce&&(m=Pd,m!==null)))throw m;c.memoizedState=I,c.baseState=L,c.baseQueue=ee,y.lastRenderedState=I}return E===null&&(y.lanes=0),[c.memoizedState,y.dispatch]}function IS(c){var d=ts(),m=d.queue;if(m===null)throw Error(s(311));m.lastRenderedReducer=c;var y=m.dispatch,E=m.pending,I=d.memoizedState;if(E!==null){m.pending=null;var L=E=E.next;do I=c(I,L.action),L=L.next;while(L!==E);fi(I,d.memoizedState)||(fs=!0),d.memoizedState=I,d.baseQueue===null&&(d.baseState=I),m.lastRenderedState=I}return[I,y]}function gR(c,d,m){var y=yt,E=ts(),I=Pt;if(I){if(m===void 0)throw Error(s(407));m=m()}else m=d();var L=!fi((mn||E).memoizedState,m);if(L&&(E.memoizedState=m,fs=!0),E=E.queue,AS(vR.bind(null,y,E,c),[c]),E.getSnapshot!==d||L||ds!==null&&ds.memoizedState.tag&1){if(y.flags|=2048,zd(9,{destroy:void 0},bR.bind(null,y,E,m,d),null),Tn===null)throw Error(s(349));I||(Xa&127)!==0||yR(y,d,m)}return m}function yR(c,d,m){c.flags|=16384,c={getSnapshot:d,value:m},d=yt.updateQueue,d===null?(d=R0(),yt.updateQueue=d,d.stores=[c]):(m=d.stores,m===null?d.stores=[c]:m.push(c))}function bR(c,d,m,y){d.value=m,d.getSnapshot=y,wR(d)&&TR(c)}function vR(c,d,m){return m(function(){wR(d)&&TR(c)})}function wR(c){var d=c.getSnapshot;c=c.value;try{var m=d();return!fi(c,m)}catch{return!0}}function TR(c){var d=Kc(c,2);d!==null&&Jr(d,c,2)}function CS(c){var d=Ar();if(typeof c=="function"){var m=c;if(c=m(),nh){Gr(!0);try{m()}finally{Gr(!1)}}}return d.memoizedState=d.baseState=c,d.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ya,lastRenderedState:c},d}function xR(c,d,m,y){return c.baseState=m,ES(c,mn,typeof y=="function"?y:Ya)}function iJ(c,d,m,y,E){if(F0(c))throw Error(s(485));if(c=d.action,c!==null){var I={payload:E,action:c,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(L){I.listeners.push(L)}};X.T!==null?m(!0):I.isTransition=!1,y(I),m=d.pending,m===null?(I.next=d.pending=I,SR(d,I)):(I.next=m.next,d.pending=m.next=I)}}function SR(c,d){var m=d.action,y=d.payload,E=c.state;if(d.isTransition){var I=X.T,L={};X.T=L;try{var G=m(E,y),ee=X.S;ee!==null&&ee(L,G),_R(c,d,G)}catch(ye){NS(c,d,ye)}finally{I!==null&&L.types!==null&&(I.types=L.types),X.T=I}}else try{I=m(E,y),_R(c,d,I)}catch(ye){NS(c,d,ye)}}function _R(c,d,m){m!==null&&typeof m=="object"&&typeof m.then=="function"?m.then(function(y){ER(c,d,y)},function(y){return NS(c,d,y)}):ER(c,d,m)}function ER(c,d,m){d.status="fulfilled",d.value=m,IR(d),c.state=m,d=c.pending,d!==null&&(m=d.next,m===d?c.pending=null:(m=m.next,d.next=m,SR(c,m)))}function NS(c,d,m){var y=c.pending;if(c.pending=null,y!==null){y=y.next;do d.status="rejected",d.reason=m,IR(d),d=d.next;while(d!==y)}c.action=null}function IR(c){c=c.listeners;for(var d=0;d<c.length;d++)(0,c[d])()}function CR(c,d){return d}function NR(c,d){if(Pt){var m=Tn.formState;if(m!==null){e:{var y=yt;if(Pt){if(kn){t:{for(var E=kn,I=Li;E.nodeType!==8;){if(!I){E=null;break t}if(E=Bi(E.nextSibling),E===null){E=null;break t}}I=E.data,E=I==="F!"||I==="F"?E:null}if(E){kn=Bi(E.nextSibling),y=E.data==="F!";break e}}eu(y)}y=!1}y&&(d=m[0])}}return m=Ar(),m.memoizedState=m.baseState=d,y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:CR,lastRenderedState:d},m.queue=y,m=KR.bind(null,yt,y),y.dispatch=m,y=CS(!1),I=MS.bind(null,yt,!1,y.queue),y=Ar(),E={state:d,dispatch:null,action:c,pending:null},y.queue=E,m=iJ.bind(null,yt,E,I,m),E.dispatch=m,y.memoizedState=c,[d,m,!1]}function AR(c){var d=ts();return kR(d,mn,c)}function kR(c,d,m){if(d=ES(c,d,CR)[0],c=M0(Ya)[0],typeof d=="object"&&d!==null&&typeof d.then=="function")try{var y=bm(d)}catch(L){throw L===Fd?_0:L}else y=d;d=ts();var E=d.queue,I=E.dispatch;return m!==d.memoizedState&&(yt.flags|=2048,zd(9,{destroy:void 0},oJ.bind(null,E,m),null)),[y,I,c]}function oJ(c,d){c.action=d}function $R(c){var d=ts(),m=mn;if(m!==null)return kR(d,m,c);ts(),d=d.memoizedState,m=ts();var y=m.queue.dispatch;return m.memoizedState=c,[d,y,!1]}function zd(c,d,m,y){return c={tag:c,create:m,deps:y,inst:d,next:null},d=yt.updateQueue,d===null&&(d=R0(),yt.updateQueue=d),m=d.lastEffect,m===null?d.lastEffect=c.next=c:(y=m.next,m.next=c,c.next=y,d.lastEffect=c),c}function RR(){return ts().memoizedState}function O0(c,d,m,y){var E=Ar();yt.flags|=c,E.memoizedState=zd(1|d,{destroy:void 0},m,y===void 0?null:y)}function P0(c,d,m,y){var E=ts();y=y===void 0?null:y;var I=E.memoizedState.inst;mn!==null&&y!==null&&vS(y,mn.memoizedState.deps)?E.memoizedState=zd(d,I,m,y):(yt.flags|=c,E.memoizedState=zd(1|d,I,m,y))}function DR(c,d){O0(8390656,8,c,d)}function AS(c,d){P0(2048,8,c,d)}function aJ(c){yt.flags|=4;var d=yt.updateQueue;if(d===null)d=R0(),yt.updateQueue=d,d.events=[c];else{var m=d.events;m===null?d.events=[c]:m.push(c)}}function MR(c){var d=ts().memoizedState;return aJ({ref:d,nextImpl:c}),function(){if((en&2)!==0)throw Error(s(440));return d.impl.apply(void 0,arguments)}}function OR(c,d){return P0(4,2,c,d)}function PR(c,d){return P0(4,4,c,d)}function FR(c,d){if(typeof d=="function"){c=c();var m=d(c);return function(){typeof m=="function"?m():d(null)}}if(d!=null)return c=c(),d.current=c,function(){d.current=null}}function LR(c,d,m){m=m!=null?m.concat([c]):null,P0(4,4,FR.bind(null,d,c),m)}function kS(){}function VR(c,d){var m=ts();d=d===void 0?null:d;var y=m.memoizedState;return d!==null&&vS(d,y[1])?y[0]:(m.memoizedState=[c,d],c)}function BR(c,d){var m=ts();d=d===void 0?null:d;var y=m.memoizedState;if(d!==null&&vS(d,y[1]))return y[0];if(y=c(),nh){Gr(!0);try{c()}finally{Gr(!1)}}return m.memoizedState=[y,d],y}function $S(c,d,m){return m===void 0||(Xa&1073741824)!==0&&(kt&261930)===0?c.memoizedState=d:(c.memoizedState=m,c=UD(),yt.lanes|=c,uu|=c,m)}function UR(c,d,m,y){return fi(m,d)?m:Vd.current!==null?(c=$S(c,m,y),fi(c,d)||(fs=!0),c):(Xa&42)===0||(Xa&1073741824)!==0&&(kt&261930)===0?(fs=!0,c.memoizedState=m):(c=UD(),yt.lanes|=c,uu|=c,d)}function zR(c,d,m,y,E){var I=Q.p;Q.p=I!==0&&8>I?I:8;var L=X.T,G={};X.T=G,MS(c,!1,d,m);try{var ee=E(),ye=X.S;if(ye!==null&&ye(G,ee),ee!==null&&typeof ee=="object"&&typeof ee.then=="function"){var Ce=nJ(ee,y);vm(c,d,Ce,vi(c))}else vm(c,d,y,vi(c))}catch($e){vm(c,d,{then:function(){},status:"rejected",reason:$e},vi())}finally{Q.p=I,L!==null&&G.types!==null&&(L.types=G.types),X.T=L}}function lJ(){}function RS(c,d,m,y){if(c.tag!==5)throw Error(s(476));var E=GR(c).queue;zR(c,E,d,re,m===null?lJ:function(){return HR(c),m(y)})}function GR(c){var d=c.memoizedState;if(d!==null)return d;d={memoizedState:re,baseState:re,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ya,lastRenderedState:re},next:null};var m={};return d.next={memoizedState:m,baseState:m,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ya,lastRenderedState:m},next:null},c.memoizedState=d,c=c.alternate,c!==null&&(c.memoizedState=d),d}function HR(c){var d=GR(c);d.next===null&&(d=c.alternate.memoizedState),vm(c,d.next.queue,{},vi())}function DS(){return js(Pm)}function qR(){return ts().memoizedState}function WR(){return ts().memoizedState}function uJ(c){for(var d=c.return;d!==null;){switch(d.tag){case 24:case 3:var m=vi();c=su(m);var y=ru(d,c,m);y!==null&&(Jr(y,d,m),pm(y,d,m)),d={cache:lS()},c.payload=d;return}d=d.return}}function cJ(c,d,m){var y=vi();m={lane:y,revertLane:0,gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},F0(c)?XR(d,m):(m=jx(c,d,m,y),m!==null&&(Jr(m,c,y),YR(m,d,y)))}function KR(c,d,m){var y=vi();vm(c,d,m,y)}function vm(c,d,m,y){var E={lane:y,revertLane:0,gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null};if(F0(c))XR(d,E);else{var I=c.alternate;if(c.lanes===0&&(I===null||I.lanes===0)&&(I=d.lastRenderedReducer,I!==null))try{var L=d.lastRenderedState,G=I(L,m);if(E.hasEagerState=!0,E.eagerState=G,fi(G,L))return y0(c,d,E,0),Tn===null&&g0(),!1}catch{}finally{}if(m=jx(c,d,E,y),m!==null)return Jr(m,c,y),YR(m,d,y),!0}return!1}function MS(c,d,m,y){if(y={lane:2,revertLane:d_(),gesture:null,action:y,hasEagerState:!1,eagerState:null,next:null},F0(c)){if(d)throw Error(s(479))}else d=jx(c,m,y,2),d!==null&&Jr(d,c,2)}function F0(c){var d=c.alternate;return c===yt||d!==null&&d===yt}function XR(c,d){Bd=k0=!0;var m=c.pending;m===null?d.next=d:(d.next=m.next,m.next=d),c.pending=d}function YR(c,d,m){if((m&4194048)!==0){var y=d.lanes;y&=c.pendingLanes,m|=y,d.lanes=m,Up(c,m)}}var wm={readContext:js,use:D0,useCallback:Hn,useContext:Hn,useEffect:Hn,useImperativeHandle:Hn,useLayoutEffect:Hn,useInsertionEffect:Hn,useMemo:Hn,useReducer:Hn,useRef:Hn,useState:Hn,useDebugValue:Hn,useDeferredValue:Hn,useTransition:Hn,useSyncExternalStore:Hn,useId:Hn,useHostTransitionStatus:Hn,useFormState:Hn,useActionState:Hn,useOptimistic:Hn,useMemoCache:Hn,useCacheRefresh:Hn};wm.useEffectEvent=Hn;var JR={readContext:js,use:D0,useCallback:function(c,d){return Ar().memoizedState=[c,d===void 0?null:d],c},useContext:js,useEffect:DR,useImperativeHandle:function(c,d,m){m=m!=null?m.concat([c]):null,O0(4194308,4,FR.bind(null,d,c),m)},useLayoutEffect:function(c,d){return O0(4194308,4,c,d)},useInsertionEffect:function(c,d){O0(4,2,c,d)},useMemo:function(c,d){var m=Ar();d=d===void 0?null:d;var y=c();if(nh){Gr(!0);try{c()}finally{Gr(!1)}}return m.memoizedState=[y,d],y},useReducer:function(c,d,m){var y=Ar();if(m!==void 0){var E=m(d);if(nh){Gr(!0);try{m(d)}finally{Gr(!1)}}}else E=d;return y.memoizedState=y.baseState=E,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:E},y.queue=c,c=c.dispatch=cJ.bind(null,yt,c),[y.memoizedState,c]},useRef:function(c){var d=Ar();return c={current:c},d.memoizedState=c},useState:function(c){c=CS(c);var d=c.queue,m=KR.bind(null,yt,d);return d.dispatch=m,[c.memoizedState,m]},useDebugValue:kS,useDeferredValue:function(c,d){var m=Ar();return $S(m,c,d)},useTransition:function(){var c=CS(!1);return c=zR.bind(null,yt,c.queue,!0,!1),Ar().memoizedState=c,[!1,c]},useSyncExternalStore:function(c,d,m){var y=yt,E=Ar();if(Pt){if(m===void 0)throw Error(s(407));m=m()}else{if(m=d(),Tn===null)throw Error(s(349));(kt&127)!==0||yR(y,d,m)}E.memoizedState=m;var I={value:m,getSnapshot:d};return E.queue=I,DR(vR.bind(null,y,I,c),[c]),y.flags|=2048,zd(9,{destroy:void 0},bR.bind(null,y,I,m,d),null),m},useId:function(){var c=Ar(),d=Tn.identifierPrefix;if(Pt){var m=ra,y=sa;m=(y&~(1<<32-Qn(y)-1)).toString(32)+m,d="_"+d+"R_"+m,m=$0++,0<m&&(d+="H"+m.toString(32)),d+="_"}else m=sJ++,d="_"+d+"r_"+m.toString(32)+"_";return c.memoizedState=d},useHostTransitionStatus:DS,useFormState:NR,useActionState:NR,useOptimistic:function(c){var d=Ar();d.memoizedState=d.baseState=c;var m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return d.queue=m,d=MS.bind(null,yt,!0,m),m.dispatch=d,[c,d]},useMemoCache:_S,useCacheRefresh:function(){return Ar().memoizedState=uJ.bind(null,yt)},useEffectEvent:function(c){var d=Ar(),m={impl:c};return d.memoizedState=m,function(){if((en&2)!==0)throw Error(s(440));return m.impl.apply(void 0,arguments)}}},OS={readContext:js,use:D0,useCallback:VR,useContext:js,useEffect:AS,useImperativeHandle:LR,useInsertionEffect:OR,useLayoutEffect:PR,useMemo:BR,useReducer:M0,useRef:RR,useState:function(){return M0(Ya)},useDebugValue:kS,useDeferredValue:function(c,d){var m=ts();return UR(m,mn.memoizedState,c,d)},useTransition:function(){var c=M0(Ya)[0],d=ts().memoizedState;return[typeof c=="boolean"?c:bm(c),d]},useSyncExternalStore:gR,useId:qR,useHostTransitionStatus:DS,useFormState:AR,useActionState:AR,useOptimistic:function(c,d){var m=ts();return xR(m,mn,c,d)},useMemoCache:_S,useCacheRefresh:WR};OS.useEffectEvent=MR;var jR={readContext:js,use:D0,useCallback:VR,useContext:js,useEffect:AS,useImperativeHandle:LR,useInsertionEffect:OR,useLayoutEffect:PR,useMemo:BR,useReducer:IS,useRef:RR,useState:function(){return IS(Ya)},useDebugValue:kS,useDeferredValue:function(c,d){var m=ts();return mn===null?$S(m,c,d):UR(m,mn.memoizedState,c,d)},useTransition:function(){var c=IS(Ya)[0],d=ts().memoizedState;return[typeof c=="boolean"?c:bm(c),d]},useSyncExternalStore:gR,useId:qR,useHostTransitionStatus:DS,useFormState:$R,useActionState:$R,useOptimistic:function(c,d){var m=ts();return mn!==null?xR(m,mn,c,d):(m.baseState=c,[c,m.queue.dispatch])},useMemoCache:_S,useCacheRefresh:WR};jR.useEffectEvent=MR;function PS(c,d,m,y){d=c.memoizedState,m=m(y,d),m=m==null?d:f({},d,m),c.memoizedState=m,c.lanes===0&&(c.updateQueue.baseState=m)}var FS={enqueueSetState:function(c,d,m){c=c._reactInternals;var y=vi(),E=su(y);E.payload=d,m!=null&&(E.callback=m),d=ru(c,E,y),d!==null&&(Jr(d,c,y),pm(d,c,y))},enqueueReplaceState:function(c,d,m){c=c._reactInternals;var y=vi(),E=su(y);E.tag=1,E.payload=d,m!=null&&(E.callback=m),d=ru(c,E,y),d!==null&&(Jr(d,c,y),pm(d,c,y))},enqueueForceUpdate:function(c,d){c=c._reactInternals;var m=vi(),y=su(m);y.tag=2,d!=null&&(y.callback=d),d=ru(c,y,m),d!==null&&(Jr(d,c,m),pm(d,c,m))}};function QR(c,d,m,y,E,I,L){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(y,I,L):d.prototype&&d.prototype.isPureReactComponent?!om(m,y)||!om(E,I):!0}function ZR(c,d,m,y){c=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(m,y),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(m,y),d.state!==c&&FS.enqueueReplaceState(d,d.state,null)}function sh(c,d){var m=d;if("ref"in d){m={};for(var y in d)y!=="ref"&&(m[y]=d[y])}if(c=c.defaultProps){m===d&&(m=f({},m));for(var E in c)m[E]===void 0&&(m[E]=c[E])}return m}function eD(c){m0(c)}function tD(c){console.error(c)}function nD(c){m0(c)}function L0(c,d){try{var m=c.onUncaughtError;m(d.value,{componentStack:d.stack})}catch(y){setTimeout(function(){throw y})}}function sD(c,d,m){try{var y=c.onCaughtError;y(m.value,{componentStack:m.stack,errorBoundary:d.tag===1?d.stateNode:null})}catch(E){setTimeout(function(){throw E})}}function LS(c,d,m){return m=su(m),m.tag=3,m.payload={element:null},m.callback=function(){L0(c,d)},m}function rD(c){return c=su(c),c.tag=3,c}function iD(c,d,m,y){var E=m.type.getDerivedStateFromError;if(typeof E=="function"){var I=y.value;c.payload=function(){return E(I)},c.callback=function(){sD(d,m,y)}}var L=m.stateNode;L!==null&&typeof L.componentDidCatch=="function"&&(c.callback=function(){sD(d,m,y),typeof E!="function"&&(cu===null?cu=new Set([this]):cu.add(this));var G=y.stack;this.componentDidCatch(y.value,{componentStack:G!==null?G:""})})}function hJ(c,d,m,y,E){if(m.flags|=32768,y!==null&&typeof y=="object"&&typeof y.then=="function"){if(d=m.alternate,d!==null&&Md(d,m,E,!0),m=mi.current,m!==null){switch(m.tag){case 31:case 13:return Vi===null?J0():m.alternate===null&&qn===0&&(qn=3),m.flags&=-257,m.flags|=65536,m.lanes=E,y===E0?m.flags|=16384:(d=m.updateQueue,d===null?m.updateQueue=new Set([y]):d.add(y),u_(c,y,E)),!1;case 22:return m.flags|=65536,y===E0?m.flags|=16384:(d=m.updateQueue,d===null?(d={transitions:null,markerInstances:null,retryQueue:new Set([y])},m.updateQueue=d):(m=d.retryQueue,m===null?d.retryQueue=new Set([y]):m.add(y)),u_(c,y,E)),!1}throw Error(s(435,m.tag))}return u_(c,y,E),J0(),!1}if(Pt)return d=mi.current,d!==null?((d.flags&65536)===0&&(d.flags|=256),d.flags|=65536,d.lanes=E,y!==sS&&(c=Error(s(422),{cause:y}),um(Oi(c,m)))):(y!==sS&&(d=Error(s(423),{cause:y}),um(Oi(d,m))),c=c.current.alternate,c.flags|=65536,E&=-E,c.lanes|=E,y=Oi(y,m),E=LS(c.stateNode,y,E),pS(c,E),qn!==4&&(qn=2)),!1;var I=Error(s(520),{cause:y});if(I=Oi(I,m),Nm===null?Nm=[I]:Nm.push(I),qn!==4&&(qn=2),d===null)return!0;y=Oi(y,m),m=d;do{switch(m.tag){case 3:return m.flags|=65536,c=E&-E,m.lanes|=c,c=LS(m.stateNode,y,c),pS(m,c),!1;case 1:if(d=m.type,I=m.stateNode,(m.flags&128)===0&&(typeof d.getDerivedStateFromError=="function"||I!==null&&typeof I.componentDidCatch=="function"&&(cu===null||!cu.has(I))))return m.flags|=65536,E&=-E,m.lanes|=E,E=rD(E),iD(E,c,m,y),pS(m,E),!1}m=m.return}while(m!==null);return!1}var VS=Error(s(461)),fs=!1;function Qs(c,d,m,y){d.child=c===null?uR(d,null,m,y):th(d,c.child,m,y)}function oD(c,d,m,y,E){m=m.render;var I=d.ref;if("ref"in y){var L={};for(var G in y)G!=="ref"&&(L[G]=y[G])}else L=y;return jc(d),y=wS(c,d,m,L,I,E),G=TS(),c!==null&&!fs?(xS(c,d,E),Ja(c,d,E)):(Pt&&G&&tS(d),d.flags|=1,Qs(c,d,y,E),d.child)}function aD(c,d,m,y,E){if(c===null){var I=m.type;return typeof I=="function"&&!Qx(I)&&I.defaultProps===void 0&&m.compare===null?(d.tag=15,d.type=I,lD(c,d,I,y,E)):(c=v0(m.type,null,y,d,d.mode,E),c.ref=d.ref,c.return=d,d.child=c)}if(I=c.child,!KS(c,E)){var L=I.memoizedProps;if(m=m.compare,m=m!==null?m:om,m(L,y)&&c.ref===d.ref)return Ja(c,d,E)}return d.flags|=1,c=Ha(I,y),c.ref=d.ref,c.return=d,d.child=c}function lD(c,d,m,y,E){if(c!==null){var I=c.memoizedProps;if(om(I,y)&&c.ref===d.ref)if(fs=!1,d.pendingProps=y=I,KS(c,E))(c.flags&131072)!==0&&(fs=!0);else return d.lanes=c.lanes,Ja(c,d,E)}return BS(c,d,m,y,E)}function uD(c,d,m,y){var E=y.children,I=c!==null?c.memoizedState:null;if(c===null&&d.stateNode===null&&(d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),y.mode==="hidden"){if((d.flags&128)!==0){if(I=I!==null?I.baseLanes|m:m,c!==null){for(y=d.child=c.child,E=0;y!==null;)E=E|y.lanes|y.childLanes,y=y.sibling;y=E&~I}else y=0,d.child=null;return cD(c,d,I,m,y)}if((m&536870912)!==0)d.memoizedState={baseLanes:0,cachePool:null},c!==null&&S0(d,I!==null?I.cachePool:null),I!==null?dR(d,I):gS(),fR(d);else return y=d.lanes=536870912,cD(c,d,I!==null?I.baseLanes|m:m,m,y)}else I!==null?(S0(d,I.cachePool),dR(d,I),ou(),d.memoizedState=null):(c!==null&&S0(d,null),gS(),ou());return Qs(c,d,E,m),d.child}function Tm(c,d){return c!==null&&c.tag===22||d.stateNode!==null||(d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.sibling}function cD(c,d,m,y,E){var I=cS();return I=I===null?null:{parent:hs._currentValue,pool:I},d.memoizedState={baseLanes:m,cachePool:I},c!==null&&S0(d,null),gS(),fR(d),c!==null&&Md(c,d,y,!0),d.childLanes=E,null}function V0(c,d){return d=U0({mode:d.mode,children:d.children},c.mode),d.ref=c.ref,c.child=d,d.return=c,d}function hD(c,d,m){return th(d,c.child,null,m),c=V0(d,d.pendingProps),c.flags|=2,gi(d),d.memoizedState=null,c}function dJ(c,d,m){var y=d.pendingProps,E=(d.flags&128)!==0;if(d.flags&=-129,c===null){if(Pt){if(y.mode==="hidden")return c=V0(d,y),d.lanes=536870912,Tm(null,c);if(bS(d),(c=kn)?(c=SM(c,Li),c=c!==null&&c.data==="&"?c:null,c!==null&&(d.memoizedState={dehydrated:c,treeContext:Ql!==null?{id:sa,overflow:ra}:null,retryLane:536870912,hydrationErrors:null},m=X$(c),m.return=d,d.child=m,Js=d,kn=null)):c=null,c===null)throw eu(d);return d.lanes=536870912,null}return V0(d,y)}var I=c.memoizedState;if(I!==null){var L=I.dehydrated;if(bS(d),E)if(d.flags&256)d.flags&=-257,d=hD(c,d,m);else if(d.memoizedState!==null)d.child=c.child,d.flags|=128,d=null;else throw Error(s(558));else if(fs||Md(c,d,m,!1),E=(m&c.childLanes)!==0,fs||E){if(y=Tn,y!==null&&(L=zp(y,m),L!==0&&L!==I.retryLane))throw I.retryLane=L,Kc(c,L),Jr(y,c,L),VS;J0(),d=hD(c,d,m)}else c=I.treeContext,kn=Bi(L.nextSibling),Js=d,Pt=!0,Zl=null,Li=!1,c!==null&&j$(d,c),d=V0(d,y),d.flags|=4096;return d}return c=Ha(c.child,{mode:y.mode,children:y.children}),c.ref=d.ref,d.child=c,c.return=d,c}function B0(c,d){var m=d.ref;if(m===null)c!==null&&c.ref!==null&&(d.flags|=4194816);else{if(typeof m!="function"&&typeof m!="object")throw Error(s(284));(c===null||c.ref!==m)&&(d.flags|=4194816)}}function BS(c,d,m,y,E){return jc(d),m=wS(c,d,m,y,void 0,E),y=TS(),c!==null&&!fs?(xS(c,d,E),Ja(c,d,E)):(Pt&&y&&tS(d),d.flags|=1,Qs(c,d,m,E),d.child)}function dD(c,d,m,y,E,I){return jc(d),d.updateQueue=null,m=mR(d,y,m,E),pR(c),y=TS(),c!==null&&!fs?(xS(c,d,I),Ja(c,d,I)):(Pt&&y&&tS(d),d.flags|=1,Qs(c,d,m,I),d.child)}function fD(c,d,m,y,E){if(jc(d),d.stateNode===null){var I=kd,L=m.contextType;typeof L=="object"&&L!==null&&(I=js(L)),I=new m(y,I),d.memoizedState=I.state!==null&&I.state!==void 0?I.state:null,I.updater=FS,d.stateNode=I,I._reactInternals=d,I=d.stateNode,I.props=y,I.state=d.memoizedState,I.refs={},dS(d),L=m.contextType,I.context=typeof L=="object"&&L!==null?js(L):kd,I.state=d.memoizedState,L=m.getDerivedStateFromProps,typeof L=="function"&&(PS(d,m,L,y),I.state=d.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof I.getSnapshotBeforeUpdate=="function"||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(L=I.state,typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount(),L!==I.state&&FS.enqueueReplaceState(I,I.state,null),gm(d,y,I,E),mm(),I.state=d.memoizedState),typeof I.componentDidMount=="function"&&(d.flags|=4194308),y=!0}else if(c===null){I=d.stateNode;var G=d.memoizedProps,ee=sh(m,G);I.props=ee;var ye=I.context,Ce=m.contextType;L=kd,typeof Ce=="object"&&Ce!==null&&(L=js(Ce));var $e=m.getDerivedStateFromProps;Ce=typeof $e=="function"||typeof I.getSnapshotBeforeUpdate=="function",G=d.pendingProps!==G,Ce||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(G||ye!==L)&&ZR(d,I,y,L),nu=!1;var ve=d.memoizedState;I.state=ve,gm(d,y,I,E),mm(),ye=d.memoizedState,G||ve!==ye||nu?(typeof $e=="function"&&(PS(d,m,$e,y),ye=d.memoizedState),(ee=nu||QR(d,m,ee,y,ve,ye,L))?(Ce||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount()),typeof I.componentDidMount=="function"&&(d.flags|=4194308)):(typeof I.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=y,d.memoizedState=ye),I.props=y,I.state=ye,I.context=L,y=ee):(typeof I.componentDidMount=="function"&&(d.flags|=4194308),y=!1)}else{I=d.stateNode,fS(c,d),L=d.memoizedProps,Ce=sh(m,L),I.props=Ce,$e=d.pendingProps,ve=I.context,ye=m.contextType,ee=kd,typeof ye=="object"&&ye!==null&&(ee=js(ye)),G=m.getDerivedStateFromProps,(ye=typeof G=="function"||typeof I.getSnapshotBeforeUpdate=="function")||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(L!==$e||ve!==ee)&&ZR(d,I,y,ee),nu=!1,ve=d.memoizedState,I.state=ve,gm(d,y,I,E),mm();var Se=d.memoizedState;L!==$e||ve!==Se||nu||c!==null&&c.dependencies!==null&&T0(c.dependencies)?(typeof G=="function"&&(PS(d,m,G,y),Se=d.memoizedState),(Ce=nu||QR(d,m,Ce,y,ve,Se,ee)||c!==null&&c.dependencies!==null&&T0(c.dependencies))?(ye||typeof I.UNSAFE_componentWillUpdate!="function"&&typeof I.componentWillUpdate!="function"||(typeof I.componentWillUpdate=="function"&&I.componentWillUpdate(y,Se,ee),typeof I.UNSAFE_componentWillUpdate=="function"&&I.UNSAFE_componentWillUpdate(y,Se,ee)),typeof I.componentDidUpdate=="function"&&(d.flags|=4),typeof I.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof I.componentDidUpdate!="function"||L===c.memoizedProps&&ve===c.memoizedState||(d.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||L===c.memoizedProps&&ve===c.memoizedState||(d.flags|=1024),d.memoizedProps=y,d.memoizedState=Se),I.props=y,I.state=Se,I.context=ee,y=Ce):(typeof I.componentDidUpdate!="function"||L===c.memoizedProps&&ve===c.memoizedState||(d.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||L===c.memoizedProps&&ve===c.memoizedState||(d.flags|=1024),y=!1)}return I=y,B0(c,d),y=(d.flags&128)!==0,I||y?(I=d.stateNode,m=y&&typeof m.getDerivedStateFromError!="function"?null:I.render(),d.flags|=1,c!==null&&y?(d.child=th(d,c.child,null,E),d.child=th(d,null,m,E)):Qs(c,d,m,E),d.memoizedState=I.state,c=d.child):c=Ja(c,d,E),c}function pD(c,d,m,y){return Yc(),d.flags|=256,Qs(c,d,m,y),d.child}var US={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function zS(c){return{baseLanes:c,cachePool:sR()}}function GS(c,d,m){return c=c!==null?c.childLanes&~m:0,d&&(c|=bi),c}function mD(c,d,m){var y=d.pendingProps,E=!1,I=(d.flags&128)!==0,L;if((L=I)||(L=c!==null&&c.memoizedState===null?!1:(es.current&2)!==0),L&&(E=!0,d.flags&=-129),L=(d.flags&32)!==0,d.flags&=-33,c===null){if(Pt){if(E?iu(d):ou(),(c=kn)?(c=SM(c,Li),c=c!==null&&c.data!=="&"?c:null,c!==null&&(d.memoizedState={dehydrated:c,treeContext:Ql!==null?{id:sa,overflow:ra}:null,retryLane:536870912,hydrationErrors:null},m=X$(c),m.return=d,d.child=m,Js=d,kn=null)):c=null,c===null)throw eu(d);return E_(c)?d.lanes=32:d.lanes=536870912,null}var G=y.children;return y=y.fallback,E?(ou(),E=d.mode,G=U0({mode:"hidden",children:G},E),y=Xc(y,E,m,null),G.return=d,y.return=d,G.sibling=y,d.child=G,y=d.child,y.memoizedState=zS(m),y.childLanes=GS(c,L,m),d.memoizedState=US,Tm(null,y)):(iu(d),HS(d,G))}var ee=c.memoizedState;if(ee!==null&&(G=ee.dehydrated,G!==null)){if(I)d.flags&256?(iu(d),d.flags&=-257,d=qS(c,d,m)):d.memoizedState!==null?(ou(),d.child=c.child,d.flags|=128,d=null):(ou(),G=y.fallback,E=d.mode,y=U0({mode:"visible",children:y.children},E),G=Xc(G,E,m,null),G.flags|=2,y.return=d,G.return=d,y.sibling=G,d.child=y,th(d,c.child,null,m),y=d.child,y.memoizedState=zS(m),y.childLanes=GS(c,L,m),d.memoizedState=US,d=Tm(null,y));else if(iu(d),E_(G)){if(L=G.nextSibling&&G.nextSibling.dataset,L)var ye=L.dgst;L=ye,y=Error(s(419)),y.stack="",y.digest=L,um({value:y,source:null,stack:null}),d=qS(c,d,m)}else if(fs||Md(c,d,m,!1),L=(m&c.childLanes)!==0,fs||L){if(L=Tn,L!==null&&(y=zp(L,m),y!==0&&y!==ee.retryLane))throw ee.retryLane=y,Kc(c,y),Jr(L,c,y),VS;__(G)||J0(),d=qS(c,d,m)}else __(G)?(d.flags|=192,d.child=c.child,d=null):(c=ee.treeContext,kn=Bi(G.nextSibling),Js=d,Pt=!0,Zl=null,Li=!1,c!==null&&j$(d,c),d=HS(d,y.children),d.flags|=4096);return d}return E?(ou(),G=y.fallback,E=d.mode,ee=c.child,ye=ee.sibling,y=Ha(ee,{mode:"hidden",children:y.children}),y.subtreeFlags=ee.subtreeFlags&65011712,ye!==null?G=Ha(ye,G):(G=Xc(G,E,m,null),G.flags|=2),G.return=d,y.return=d,y.sibling=G,d.child=y,Tm(null,y),y=d.child,G=c.child.memoizedState,G===null?G=zS(m):(E=G.cachePool,E!==null?(ee=hs._currentValue,E=E.parent!==ee?{parent:ee,pool:ee}:E):E=sR(),G={baseLanes:G.baseLanes|m,cachePool:E}),y.memoizedState=G,y.childLanes=GS(c,L,m),d.memoizedState=US,Tm(c.child,y)):(iu(d),m=c.child,c=m.sibling,m=Ha(m,{mode:"visible",children:y.children}),m.return=d,m.sibling=null,c!==null&&(L=d.deletions,L===null?(d.deletions=[c],d.flags|=16):L.push(c)),d.child=m,d.memoizedState=null,m)}function HS(c,d){return d=U0({mode:"visible",children:d},c.mode),d.return=c,c.child=d}function U0(c,d){return c=pi(22,c,null,d),c.lanes=0,c}function qS(c,d,m){return th(d,c.child,null,m),c=HS(d,d.pendingProps.children),c.flags|=2,d.memoizedState=null,c}function gD(c,d,m){c.lanes|=d;var y=c.alternate;y!==null&&(y.lanes|=d),oS(c.return,d,m)}function WS(c,d,m,y,E,I){var L=c.memoizedState;L===null?c.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:y,tail:m,tailMode:E,treeForkCount:I}:(L.isBackwards=d,L.rendering=null,L.renderingStartTime=0,L.last=y,L.tail=m,L.tailMode=E,L.treeForkCount=I)}function yD(c,d,m){var y=d.pendingProps,E=y.revealOrder,I=y.tail;y=y.children;var L=es.current,G=(L&2)!==0;if(G?(L=L&1|2,d.flags|=128):L&=1,ue(es,L),Qs(c,d,y,m),y=Pt?lm:0,!G&&c!==null&&(c.flags&128)!==0)e:for(c=d.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&gD(c,m,d);else if(c.tag===19)gD(c,m,d);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===d)break e;for(;c.sibling===null;){if(c.return===null||c.return===d)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}switch(E){case"forwards":for(m=d.child,E=null;m!==null;)c=m.alternate,c!==null&&A0(c)===null&&(E=m),m=m.sibling;m=E,m===null?(E=d.child,d.child=null):(E=m.sibling,m.sibling=null),WS(d,!1,E,m,I,y);break;case"backwards":case"unstable_legacy-backwards":for(m=null,E=d.child,d.child=null;E!==null;){if(c=E.alternate,c!==null&&A0(c)===null){d.child=E;break}c=E.sibling,E.sibling=m,m=E,E=c}WS(d,!0,m,null,I,y);break;case"together":WS(d,!1,null,null,void 0,y);break;default:d.memoizedState=null}return d.child}function Ja(c,d,m){if(c!==null&&(d.dependencies=c.dependencies),uu|=d.lanes,(m&d.childLanes)===0)if(c!==null){if(Md(c,d,m,!1),(m&d.childLanes)===0)return null}else return null;if(c!==null&&d.child!==c.child)throw Error(s(153));if(d.child!==null){for(c=d.child,m=Ha(c,c.pendingProps),d.child=m,m.return=d;c.sibling!==null;)c=c.sibling,m=m.sibling=Ha(c,c.pendingProps),m.return=d;m.sibling=null}return d.child}function KS(c,d){return(c.lanes&d)!==0?!0:(c=c.dependencies,!!(c!==null&&T0(c)))}function fJ(c,d,m){switch(d.tag){case 3:We(d,d.stateNode.containerInfo),tu(d,hs,c.memoizedState.cache),Yc();break;case 27:case 5:it(d);break;case 4:We(d,d.stateNode.containerInfo);break;case 10:tu(d,d.type,d.memoizedProps.value);break;case 31:if(d.memoizedState!==null)return d.flags|=128,bS(d),null;break;case 13:var y=d.memoizedState;if(y!==null)return y.dehydrated!==null?(iu(d),d.flags|=128,null):(m&d.child.childLanes)!==0?mD(c,d,m):(iu(d),c=Ja(c,d,m),c!==null?c.sibling:null);iu(d);break;case 19:var E=(c.flags&128)!==0;if(y=(m&d.childLanes)!==0,y||(Md(c,d,m,!1),y=(m&d.childLanes)!==0),E){if(y)return yD(c,d,m);d.flags|=128}if(E=d.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),ue(es,es.current),y)break;return null;case 22:return d.lanes=0,uD(c,d,m,d.pendingProps);case 24:tu(d,hs,c.memoizedState.cache)}return Ja(c,d,m)}function bD(c,d,m){if(c!==null)if(c.memoizedProps!==d.pendingProps)fs=!0;else{if(!KS(c,m)&&(d.flags&128)===0)return fs=!1,fJ(c,d,m);fs=(c.flags&131072)!==0}else fs=!1,Pt&&(d.flags&1048576)!==0&&J$(d,lm,d.index);switch(d.lanes=0,d.tag){case 16:e:{var y=d.pendingProps;if(c=Zc(d.elementType),d.type=c,typeof c=="function")Qx(c)?(y=sh(c,y),d.tag=1,d=fD(null,d,c,y,m)):(d.tag=0,d=BS(null,d,c,y,m));else{if(c!=null){var E=c.$$typeof;if(E===A){d.tag=11,d=oD(null,d,c,y,m);break e}else if(E===D){d.tag=14,d=aD(null,d,c,y,m);break e}}throw d=te(c)||c,Error(s(306,d,""))}}return d;case 0:return BS(c,d,d.type,d.pendingProps,m);case 1:return y=d.type,E=sh(y,d.pendingProps),fD(c,d,y,E,m);case 3:e:{if(We(d,d.stateNode.containerInfo),c===null)throw Error(s(387));y=d.pendingProps;var I=d.memoizedState;E=I.element,fS(c,d),gm(d,y,null,m);var L=d.memoizedState;if(y=L.cache,tu(d,hs,y),y!==I.cache&&aS(d,[hs],m,!0),mm(),y=L.element,I.isDehydrated)if(I={element:y,isDehydrated:!1,cache:L.cache},d.updateQueue.baseState=I,d.memoizedState=I,d.flags&256){d=pD(c,d,y,m);break e}else if(y!==E){E=Oi(Error(s(424)),d),um(E),d=pD(c,d,y,m);break e}else{switch(c=d.stateNode.containerInfo,c.nodeType){case 9:c=c.body;break;default:c=c.nodeName==="HTML"?c.ownerDocument.body:c}for(kn=Bi(c.firstChild),Js=d,Pt=!0,Zl=null,Li=!0,m=uR(d,null,y,m),d.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling}else{if(Yc(),y===E){d=Ja(c,d,m);break e}Qs(c,d,y,m)}d=d.child}return d;case 26:return B0(c,d),c===null?(m=AM(d.type,null,d.pendingProps,null))?d.memoizedState=m:Pt||(m=d.type,c=d.pendingProps,y=s1(Re.current).createElement(m),y[ls]=d,y[Ms]=c,Zs(y,m,c),us(y),d.stateNode=y):d.memoizedState=AM(d.type,c.memoizedProps,d.pendingProps,c.memoizedState),null;case 27:return it(d),c===null&&Pt&&(y=d.stateNode=IM(d.type,d.pendingProps,Re.current),Js=d,Li=!0,E=kn,pu(d.type)?(I_=E,kn=Bi(y.firstChild)):kn=E),Qs(c,d,d.pendingProps.children,m),B0(c,d),c===null&&(d.flags|=4194304),d.child;case 5:return c===null&&Pt&&((E=y=kn)&&(y=GJ(y,d.type,d.pendingProps,Li),y!==null?(d.stateNode=y,Js=d,kn=Bi(y.firstChild),Li=!1,E=!0):E=!1),E||eu(d)),it(d),E=d.type,I=d.pendingProps,L=c!==null?c.memoizedProps:null,y=I.children,T_(E,I)?y=null:L!==null&&T_(E,L)&&(d.flags|=32),d.memoizedState!==null&&(E=wS(c,d,rJ,null,null,m),Pm._currentValue=E),B0(c,d),Qs(c,d,y,m),d.child;case 6:return c===null&&Pt&&((c=m=kn)&&(m=HJ(m,d.pendingProps,Li),m!==null?(d.stateNode=m,Js=d,kn=null,c=!0):c=!1),c||eu(d)),null;case 13:return mD(c,d,m);case 4:return We(d,d.stateNode.containerInfo),y=d.pendingProps,c===null?d.child=th(d,null,y,m):Qs(c,d,y,m),d.child;case 11:return oD(c,d,d.type,d.pendingProps,m);case 7:return Qs(c,d,d.pendingProps,m),d.child;case 8:return Qs(c,d,d.pendingProps.children,m),d.child;case 12:return Qs(c,d,d.pendingProps.children,m),d.child;case 10:return y=d.pendingProps,tu(d,d.type,y.value),Qs(c,d,y.children,m),d.child;case 9:return E=d.type._context,y=d.pendingProps.children,jc(d),E=js(E),y=y(E),d.flags|=1,Qs(c,d,y,m),d.child;case 14:return aD(c,d,d.type,d.pendingProps,m);case 15:return lD(c,d,d.type,d.pendingProps,m);case 19:return yD(c,d,m);case 31:return dJ(c,d,m);case 22:return uD(c,d,m,d.pendingProps);case 24:return jc(d),y=js(hs),c===null?(E=cS(),E===null&&(E=Tn,I=lS(),E.pooledCache=I,I.refCount++,I!==null&&(E.pooledCacheLanes|=m),E=I),d.memoizedState={parent:y,cache:E},dS(d),tu(d,hs,E)):((c.lanes&m)!==0&&(fS(c,d),gm(d,null,null,m),mm()),E=c.memoizedState,I=d.memoizedState,E.parent!==y?(E={parent:y,cache:y},d.memoizedState=E,d.lanes===0&&(d.memoizedState=d.updateQueue.baseState=E),tu(d,hs,y)):(y=I.cache,tu(d,hs,y),y!==E.cache&&aS(d,[hs],m,!0))),Qs(c,d,d.pendingProps.children,m),d.child;case 29:throw d.pendingProps}throw Error(s(156,d.tag))}function ja(c){c.flags|=4}function XS(c,d,m,y,E){if((d=(c.mode&32)!==0)&&(d=!1),d){if(c.flags|=16777216,(E&335544128)===E)if(c.stateNode.complete)c.flags|=8192;else if(qD())c.flags|=8192;else throw eh=E0,hS}else c.flags&=-16777217}function vD(c,d){if(d.type!=="stylesheet"||(d.state.loading&4)!==0)c.flags&=-16777217;else if(c.flags|=16777216,!MM(d))if(qD())c.flags|=8192;else throw eh=E0,hS}function z0(c,d){d!==null&&(c.flags|=4),c.flags&16384&&(d=c.tag!==22?Xb():536870912,c.lanes|=d,Wd|=d)}function xm(c,d){if(!Pt)switch(c.tailMode){case"hidden":d=c.tail;for(var m=null;d!==null;)d.alternate!==null&&(m=d),d=d.sibling;m===null?c.tail=null:m.sibling=null;break;case"collapsed":m=c.tail;for(var y=null;m!==null;)m.alternate!==null&&(y=m),m=m.sibling;y===null?d||c.tail===null?c.tail=null:c.tail.sibling=null:y.sibling=null}}function $n(c){var d=c.alternate!==null&&c.alternate.child===c.child,m=0,y=0;if(d)for(var E=c.child;E!==null;)m|=E.lanes|E.childLanes,y|=E.subtreeFlags&65011712,y|=E.flags&65011712,E.return=c,E=E.sibling;else for(E=c.child;E!==null;)m|=E.lanes|E.childLanes,y|=E.subtreeFlags,y|=E.flags,E.return=c,E=E.sibling;return c.subtreeFlags|=y,c.childLanes=m,d}function pJ(c,d,m){var y=d.pendingProps;switch(nS(d),d.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $n(d),null;case 1:return $n(d),null;case 3:return m=d.stateNode,y=null,c!==null&&(y=c.memoizedState.cache),d.memoizedState.cache!==y&&(d.flags|=2048),Ka(hs),Be(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(c===null||c.child===null)&&(Dd(d)?ja(d):c===null||c.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,rS())),$n(d),null;case 26:var E=d.type,I=d.memoizedState;return c===null?(ja(d),I!==null?($n(d),vD(d,I)):($n(d),XS(d,E,null,y,m))):I?I!==c.memoizedState?(ja(d),$n(d),vD(d,I)):($n(d),d.flags&=-16777217):(c=c.memoizedProps,c!==y&&ja(d),$n(d),XS(d,E,c,y,m)),null;case 27:if(ct(d),m=Re.current,E=d.type,c!==null&&d.stateNode!=null)c.memoizedProps!==y&&ja(d);else{if(!y){if(d.stateNode===null)throw Error(s(166));return $n(d),null}c=Te.current,Dd(d)?Q$(d):(c=IM(E,y,m),d.stateNode=c,ja(d))}return $n(d),null;case 5:if(ct(d),E=d.type,c!==null&&d.stateNode!=null)c.memoizedProps!==y&&ja(d);else{if(!y){if(d.stateNode===null)throw Error(s(166));return $n(d),null}if(I=Te.current,Dd(d))Q$(d);else{var L=s1(Re.current);switch(I){case 1:I=L.createElementNS("http://www.w3.org/2000/svg",E);break;case 2:I=L.createElementNS("http://www.w3.org/1998/Math/MathML",E);break;default:switch(E){case"svg":I=L.createElementNS("http://www.w3.org/2000/svg",E);break;case"math":I=L.createElementNS("http://www.w3.org/1998/Math/MathML",E);break;case"script":I=L.createElement("div"),I.innerHTML="<script><\/script>",I=I.removeChild(I.firstChild);break;case"select":I=typeof y.is=="string"?L.createElement("select",{is:y.is}):L.createElement("select"),y.multiple?I.multiple=!0:y.size&&(I.size=y.size);break;default:I=typeof y.is=="string"?L.createElement(E,{is:y.is}):L.createElement(E)}}I[ls]=d,I[Ms]=y;e:for(L=d.child;L!==null;){if(L.tag===5||L.tag===6)I.appendChild(L.stateNode);else if(L.tag!==4&&L.tag!==27&&L.child!==null){L.child.return=L,L=L.child;continue}if(L===d)break e;for(;L.sibling===null;){if(L.return===null||L.return===d)break e;L=L.return}L.sibling.return=L.return,L=L.sibling}d.stateNode=I;e:switch(Zs(I,E,y),E){case"button":case"input":case"select":case"textarea":y=!!y.autoFocus;break e;case"img":y=!0;break e;default:y=!1}y&&ja(d)}}return $n(d),XS(d,d.type,c===null?null:c.memoizedProps,d.pendingProps,m),null;case 6:if(c&&d.stateNode!=null)c.memoizedProps!==y&&ja(d);else{if(typeof y!="string"&&d.stateNode===null)throw Error(s(166));if(c=Re.current,Dd(d)){if(c=d.stateNode,m=d.memoizedProps,y=null,E=Js,E!==null)switch(E.tag){case 27:case 5:y=E.memoizedProps}c[ls]=d,c=!!(c.nodeValue===m||y!==null&&y.suppressHydrationWarning===!0||mM(c.nodeValue,m)),c||eu(d,!0)}else c=s1(c).createTextNode(y),c[ls]=d,d.stateNode=c}return $n(d),null;case 31:if(m=d.memoizedState,c===null||c.memoizedState!==null){if(y=Dd(d),m!==null){if(c===null){if(!y)throw Error(s(318));if(c=d.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(s(557));c[ls]=d}else Yc(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;$n(d),c=!1}else m=rS(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=m),c=!0;if(!c)return d.flags&256?(gi(d),d):(gi(d),null);if((d.flags&128)!==0)throw Error(s(558))}return $n(d),null;case 13:if(y=d.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(E=Dd(d),y!==null&&y.dehydrated!==null){if(c===null){if(!E)throw Error(s(318));if(E=d.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(s(317));E[ls]=d}else Yc(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;$n(d),E=!1}else E=rS(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=E),E=!0;if(!E)return d.flags&256?(gi(d),d):(gi(d),null)}return gi(d),(d.flags&128)!==0?(d.lanes=m,d):(m=y!==null,c=c!==null&&c.memoizedState!==null,m&&(y=d.child,E=null,y.alternate!==null&&y.alternate.memoizedState!==null&&y.alternate.memoizedState.cachePool!==null&&(E=y.alternate.memoizedState.cachePool.pool),I=null,y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(I=y.memoizedState.cachePool.pool),I!==E&&(y.flags|=2048)),m!==c&&m&&(d.child.flags|=8192),z0(d,d.updateQueue),$n(d),null);case 4:return Be(),c===null&&g_(d.stateNode.containerInfo),$n(d),null;case 10:return Ka(d.type),$n(d),null;case 19:if(ne(es),y=d.memoizedState,y===null)return $n(d),null;if(E=(d.flags&128)!==0,I=y.rendering,I===null)if(E)xm(y,!1);else{if(qn!==0||c!==null&&(c.flags&128)!==0)for(c=d.child;c!==null;){if(I=A0(c),I!==null){for(d.flags|=128,xm(y,!1),c=I.updateQueue,d.updateQueue=c,z0(d,c),d.subtreeFlags=0,c=m,m=d.child;m!==null;)K$(m,c),m=m.sibling;return ue(es,es.current&1|2),Pt&&qa(d,y.treeForkCount),d.child}c=c.sibling}y.tail!==null&&wn()>K0&&(d.flags|=128,E=!0,xm(y,!1),d.lanes=4194304)}else{if(!E)if(c=A0(I),c!==null){if(d.flags|=128,E=!0,c=c.updateQueue,d.updateQueue=c,z0(d,c),xm(y,!0),y.tail===null&&y.tailMode==="hidden"&&!I.alternate&&!Pt)return $n(d),null}else 2*wn()-y.renderingStartTime>K0&&m!==536870912&&(d.flags|=128,E=!0,xm(y,!1),d.lanes=4194304);y.isBackwards?(I.sibling=d.child,d.child=I):(c=y.last,c!==null?c.sibling=I:d.child=I,y.last=I)}return y.tail!==null?(c=y.tail,y.rendering=c,y.tail=c.sibling,y.renderingStartTime=wn(),c.sibling=null,m=es.current,ue(es,E?m&1|2:m&1),Pt&&qa(d,y.treeForkCount),c):($n(d),null);case 22:case 23:return gi(d),yS(),y=d.memoizedState!==null,c!==null?c.memoizedState!==null!==y&&(d.flags|=8192):y&&(d.flags|=8192),y?(m&536870912)!==0&&(d.flags&128)===0&&($n(d),d.subtreeFlags&6&&(d.flags|=8192)):$n(d),m=d.updateQueue,m!==null&&z0(d,m.retryQueue),m=null,c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(m=c.memoizedState.cachePool.pool),y=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(y=d.memoizedState.cachePool.pool),y!==m&&(d.flags|=2048),c!==null&&ne(Qc),null;case 24:return m=null,c!==null&&(m=c.memoizedState.cache),d.memoizedState.cache!==m&&(d.flags|=2048),Ka(hs),$n(d),null;case 25:return null;case 30:return null}throw Error(s(156,d.tag))}function mJ(c,d){switch(nS(d),d.tag){case 1:return c=d.flags,c&65536?(d.flags=c&-65537|128,d):null;case 3:return Ka(hs),Be(),c=d.flags,(c&65536)!==0&&(c&128)===0?(d.flags=c&-65537|128,d):null;case 26:case 27:case 5:return ct(d),null;case 31:if(d.memoizedState!==null){if(gi(d),d.alternate===null)throw Error(s(340));Yc()}return c=d.flags,c&65536?(d.flags=c&-65537|128,d):null;case 13:if(gi(d),c=d.memoizedState,c!==null&&c.dehydrated!==null){if(d.alternate===null)throw Error(s(340));Yc()}return c=d.flags,c&65536?(d.flags=c&-65537|128,d):null;case 19:return ne(es),null;case 4:return Be(),null;case 10:return Ka(d.type),null;case 22:case 23:return gi(d),yS(),c!==null&&ne(Qc),c=d.flags,c&65536?(d.flags=c&-65537|128,d):null;case 24:return Ka(hs),null;case 25:return null;default:return null}}function wD(c,d){switch(nS(d),d.tag){case 3:Ka(hs),Be();break;case 26:case 27:case 5:ct(d);break;case 4:Be();break;case 31:d.memoizedState!==null&&gi(d);break;case 13:gi(d);break;case 19:ne(es);break;case 10:Ka(d.type);break;case 22:case 23:gi(d),yS(),c!==null&&ne(Qc);break;case 24:Ka(hs)}}function Sm(c,d){try{var m=d.updateQueue,y=m!==null?m.lastEffect:null;if(y!==null){var E=y.next;m=E;do{if((m.tag&c)===c){y=void 0;var I=m.create,L=m.inst;y=I(),L.destroy=y}m=m.next}while(m!==E)}}catch(G){cn(d,d.return,G)}}function au(c,d,m){try{var y=d.updateQueue,E=y!==null?y.lastEffect:null;if(E!==null){var I=E.next;y=I;do{if((y.tag&c)===c){var L=y.inst,G=L.destroy;if(G!==void 0){L.destroy=void 0,E=d;var ee=m,ye=G;try{ye()}catch(Ce){cn(E,ee,Ce)}}}y=y.next}while(y!==I)}}catch(Ce){cn(d,d.return,Ce)}}function TD(c){var d=c.updateQueue;if(d!==null){var m=c.stateNode;try{hR(d,m)}catch(y){cn(c,c.return,y)}}}function xD(c,d,m){m.props=sh(c.type,c.memoizedProps),m.state=c.memoizedState;try{m.componentWillUnmount()}catch(y){cn(c,d,y)}}function _m(c,d){try{var m=c.ref;if(m!==null){switch(c.tag){case 26:case 27:case 5:var y=c.stateNode;break;case 30:y=c.stateNode;break;default:y=c.stateNode}typeof m=="function"?c.refCleanup=m(y):m.current=y}}catch(E){cn(c,d,E)}}function ia(c,d){var m=c.ref,y=c.refCleanup;if(m!==null)if(typeof y=="function")try{y()}catch(E){cn(c,d,E)}finally{c.refCleanup=null,c=c.alternate,c!=null&&(c.refCleanup=null)}else if(typeof m=="function")try{m(null)}catch(E){cn(c,d,E)}else m.current=null}function SD(c){var d=c.type,m=c.memoizedProps,y=c.stateNode;try{e:switch(d){case"button":case"input":case"select":case"textarea":m.autoFocus&&y.focus();break e;case"img":m.src?y.src=m.src:m.srcSet&&(y.srcset=m.srcSet)}}catch(E){cn(c,c.return,E)}}function YS(c,d,m){try{var y=c.stateNode;FJ(y,c.type,m,d),y[Ms]=d}catch(E){cn(c,c.return,E)}}function _D(c){return c.tag===5||c.tag===3||c.tag===26||c.tag===27&&pu(c.type)||c.tag===4}function JS(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||_D(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.tag===27&&pu(c.type)||c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function jS(c,d,m){var y=c.tag;if(y===5||y===6)c=c.stateNode,d?(m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m).insertBefore(c,d):(d=m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m,d.appendChild(c),m=m._reactRootContainer,m!=null||d.onclick!==null||(d.onclick=lo));else if(y!==4&&(y===27&&pu(c.type)&&(m=c.stateNode,d=null),c=c.child,c!==null))for(jS(c,d,m),c=c.sibling;c!==null;)jS(c,d,m),c=c.sibling}function G0(c,d,m){var y=c.tag;if(y===5||y===6)c=c.stateNode,d?m.insertBefore(c,d):m.appendChild(c);else if(y!==4&&(y===27&&pu(c.type)&&(m=c.stateNode),c=c.child,c!==null))for(G0(c,d,m),c=c.sibling;c!==null;)G0(c,d,m),c=c.sibling}function ED(c){var d=c.stateNode,m=c.memoizedProps;try{for(var y=c.type,E=d.attributes;E.length;)d.removeAttributeNode(E[0]);Zs(d,y,m),d[ls]=c,d[Ms]=m}catch(I){cn(c,c.return,I)}}var Qa=!1,ps=!1,QS=!1,ID=typeof WeakSet=="function"?WeakSet:Set,Ps=null;function gJ(c,d){if(c=c.containerInfo,v_=c1,c=L$(c),qx(c)){if("selectionStart"in c)var m={start:c.selectionStart,end:c.selectionEnd};else e:{m=(m=c.ownerDocument)&&m.defaultView||window;var y=m.getSelection&&m.getSelection();if(y&&y.rangeCount!==0){m=y.anchorNode;var E=y.anchorOffset,I=y.focusNode;y=y.focusOffset;try{m.nodeType,I.nodeType}catch{m=null;break e}var L=0,G=-1,ee=-1,ye=0,Ce=0,$e=c,ve=null;t:for(;;){for(var Se;$e!==m||E!==0&&$e.nodeType!==3||(G=L+E),$e!==I||y!==0&&$e.nodeType!==3||(ee=L+y),$e.nodeType===3&&(L+=$e.nodeValue.length),(Se=$e.firstChild)!==null;)ve=$e,$e=Se;for(;;){if($e===c)break t;if(ve===m&&++ye===E&&(G=L),ve===I&&++Ce===y&&(ee=L),(Se=$e.nextSibling)!==null)break;$e=ve,ve=$e.parentNode}$e=Se}m=G===-1||ee===-1?null:{start:G,end:ee}}else m=null}m=m||{start:0,end:0}}else m=null;for(w_={focusedElem:c,selectionRange:m},c1=!1,Ps=d;Ps!==null;)if(d=Ps,c=d.child,(d.subtreeFlags&1028)!==0&&c!==null)c.return=d,Ps=c;else for(;Ps!==null;){switch(d=Ps,I=d.alternate,c=d.flags,d.tag){case 0:if((c&4)!==0&&(c=d.updateQueue,c=c!==null?c.events:null,c!==null))for(m=0;m<c.length;m++)E=c[m],E.ref.impl=E.nextImpl;break;case 11:case 15:break;case 1:if((c&1024)!==0&&I!==null){c=void 0,m=d,E=I.memoizedProps,I=I.memoizedState,y=m.stateNode;try{var Xe=sh(m.type,E);c=y.getSnapshotBeforeUpdate(Xe,I),y.__reactInternalSnapshotBeforeUpdate=c}catch(st){cn(m,m.return,st)}}break;case 3:if((c&1024)!==0){if(c=d.stateNode.containerInfo,m=c.nodeType,m===9)S_(c);else if(m===1)switch(c.nodeName){case"HEAD":case"HTML":case"BODY":S_(c);break;default:c.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((c&1024)!==0)throw Error(s(163))}if(c=d.sibling,c!==null){c.return=d.return,Ps=c;break}Ps=d.return}}function CD(c,d,m){var y=m.flags;switch(m.tag){case 0:case 11:case 15:el(c,m),y&4&&Sm(5,m);break;case 1:if(el(c,m),y&4)if(c=m.stateNode,d===null)try{c.componentDidMount()}catch(L){cn(m,m.return,L)}else{var E=sh(m.type,d.memoizedProps);d=d.memoizedState;try{c.componentDidUpdate(E,d,c.__reactInternalSnapshotBeforeUpdate)}catch(L){cn(m,m.return,L)}}y&64&&TD(m),y&512&&_m(m,m.return);break;case 3:if(el(c,m),y&64&&(c=m.updateQueue,c!==null)){if(d=null,m.child!==null)switch(m.child.tag){case 27:case 5:d=m.child.stateNode;break;case 1:d=m.child.stateNode}try{hR(c,d)}catch(L){cn(m,m.return,L)}}break;case 27:d===null&&y&4&&ED(m);case 26:case 5:el(c,m),d===null&&y&4&&SD(m),y&512&&_m(m,m.return);break;case 12:el(c,m);break;case 31:el(c,m),y&4&&kD(c,m);break;case 13:el(c,m),y&4&&$D(c,m),y&64&&(c=m.memoizedState,c!==null&&(c=c.dehydrated,c!==null&&(m=EJ.bind(null,m),qJ(c,m))));break;case 22:if(y=m.memoizedState!==null||Qa,!y){d=d!==null&&d.memoizedState!==null||ps,E=Qa;var I=ps;Qa=y,(ps=d)&&!I?tl(c,m,(m.subtreeFlags&8772)!==0):el(c,m),Qa=E,ps=I}break;case 30:break;default:el(c,m)}}function ND(c){var d=c.alternate;d!==null&&(c.alternate=null,ND(d)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(d=c.stateNode,d!==null&&gd(d)),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}var Ln=null,Wr=!1;function Za(c,d,m){for(m=m.child;m!==null;)AD(c,d,m),m=m.sibling}function AD(c,d,m){if(Es&&typeof Es.onCommitFiberUnmount=="function")try{Es.onCommitFiberUnmount(ur,m)}catch{}switch(m.tag){case 26:ps||ia(m,d),Za(c,d,m),m.memoizedState?m.memoizedState.count--:m.stateNode&&(m=m.stateNode,m.parentNode.removeChild(m));break;case 27:ps||ia(m,d);var y=Ln,E=Wr;pu(m.type)&&(Ln=m.stateNode,Wr=!1),Za(c,d,m),Dm(m.stateNode),Ln=y,Wr=E;break;case 5:ps||ia(m,d);case 6:if(y=Ln,E=Wr,Ln=null,Za(c,d,m),Ln=y,Wr=E,Ln!==null)if(Wr)try{(Ln.nodeType===9?Ln.body:Ln.nodeName==="HTML"?Ln.ownerDocument.body:Ln).removeChild(m.stateNode)}catch(I){cn(m,d,I)}else try{Ln.removeChild(m.stateNode)}catch(I){cn(m,d,I)}break;case 18:Ln!==null&&(Wr?(c=Ln,TM(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,m.stateNode),ef(c)):TM(Ln,m.stateNode));break;case 4:y=Ln,E=Wr,Ln=m.stateNode.containerInfo,Wr=!0,Za(c,d,m),Ln=y,Wr=E;break;case 0:case 11:case 14:case 15:au(2,m,d),ps||au(4,m,d),Za(c,d,m);break;case 1:ps||(ia(m,d),y=m.stateNode,typeof y.componentWillUnmount=="function"&&xD(m,d,y)),Za(c,d,m);break;case 21:Za(c,d,m);break;case 22:ps=(y=ps)||m.memoizedState!==null,Za(c,d,m),ps=y;break;default:Za(c,d,m)}}function kD(c,d){if(d.memoizedState===null&&(c=d.alternate,c!==null&&(c=c.memoizedState,c!==null))){c=c.dehydrated;try{ef(c)}catch(m){cn(d,d.return,m)}}}function $D(c,d){if(d.memoizedState===null&&(c=d.alternate,c!==null&&(c=c.memoizedState,c!==null&&(c=c.dehydrated,c!==null))))try{ef(c)}catch(m){cn(d,d.return,m)}}function yJ(c){switch(c.tag){case 31:case 13:case 19:var d=c.stateNode;return d===null&&(d=c.stateNode=new ID),d;case 22:return c=c.stateNode,d=c._retryCache,d===null&&(d=c._retryCache=new ID),d;default:throw Error(s(435,c.tag))}}function H0(c,d){var m=yJ(c);d.forEach(function(y){if(!m.has(y)){m.add(y);var E=IJ.bind(null,c,y);y.then(E,E)}})}function Kr(c,d){var m=d.deletions;if(m!==null)for(var y=0;y<m.length;y++){var E=m[y],I=c,L=d,G=L;e:for(;G!==null;){switch(G.tag){case 27:if(pu(G.type)){Ln=G.stateNode,Wr=!1;break e}break;case 5:Ln=G.stateNode,Wr=!1;break e;case 3:case 4:Ln=G.stateNode.containerInfo,Wr=!0;break e}G=G.return}if(Ln===null)throw Error(s(160));AD(I,L,E),Ln=null,Wr=!1,I=E.alternate,I!==null&&(I.return=null),E.return=null}if(d.subtreeFlags&13886)for(d=d.child;d!==null;)RD(d,c),d=d.sibling}var mo=null;function RD(c,d){var m=c.alternate,y=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:Kr(d,c),Xr(c),y&4&&(au(3,c,c.return),Sm(3,c),au(5,c,c.return));break;case 1:Kr(d,c),Xr(c),y&512&&(ps||m===null||ia(m,m.return)),y&64&&Qa&&(c=c.updateQueue,c!==null&&(y=c.callbacks,y!==null&&(m=c.shared.hiddenCallbacks,c.shared.hiddenCallbacks=m===null?y:m.concat(y))));break;case 26:var E=mo;if(Kr(d,c),Xr(c),y&512&&(ps||m===null||ia(m,m.return)),y&4){var I=m!==null?m.memoizedState:null;if(y=c.memoizedState,m===null)if(y===null)if(c.stateNode===null){e:{y=c.type,m=c.memoizedProps,E=E.ownerDocument||E;t:switch(y){case"title":I=E.getElementsByTagName("title")[0],(!I||I[qo]||I[ls]||I.namespaceURI==="http://www.w3.org/2000/svg"||I.hasAttribute("itemprop"))&&(I=E.createElement(y),E.head.insertBefore(I,E.querySelector("head > title"))),Zs(I,y,m),I[ls]=c,us(I),y=I;break e;case"link":var L=RM("link","href",E).get(y+(m.href||""));if(L){for(var G=0;G<L.length;G++)if(I=L[G],I.getAttribute("href")===(m.href==null||m.href===""?null:m.href)&&I.getAttribute("rel")===(m.rel==null?null:m.rel)&&I.getAttribute("title")===(m.title==null?null:m.title)&&I.getAttribute("crossorigin")===(m.crossOrigin==null?null:m.crossOrigin)){L.splice(G,1);break t}}I=E.createElement(y),Zs(I,y,m),E.head.appendChild(I);break;case"meta":if(L=RM("meta","content",E).get(y+(m.content||""))){for(G=0;G<L.length;G++)if(I=L[G],I.getAttribute("content")===(m.content==null?null:""+m.content)&&I.getAttribute("name")===(m.name==null?null:m.name)&&I.getAttribute("property")===(m.property==null?null:m.property)&&I.getAttribute("http-equiv")===(m.httpEquiv==null?null:m.httpEquiv)&&I.getAttribute("charset")===(m.charSet==null?null:m.charSet)){L.splice(G,1);break t}}I=E.createElement(y),Zs(I,y,m),E.head.appendChild(I);break;default:throw Error(s(468,y))}I[ls]=c,us(I),y=I}c.stateNode=y}else DM(E,c.type,c.stateNode);else c.stateNode=$M(E,y,c.memoizedProps);else I!==y?(I===null?m.stateNode!==null&&(m=m.stateNode,m.parentNode.removeChild(m)):I.count--,y===null?DM(E,c.type,c.stateNode):$M(E,y,c.memoizedProps)):y===null&&c.stateNode!==null&&YS(c,c.memoizedProps,m.memoizedProps)}break;case 27:Kr(d,c),Xr(c),y&512&&(ps||m===null||ia(m,m.return)),m!==null&&y&4&&YS(c,c.memoizedProps,m.memoizedProps);break;case 5:if(Kr(d,c),Xr(c),y&512&&(ps||m===null||ia(m,m.return)),c.flags&32){E=c.stateNode;try{qr(E,"")}catch(Xe){cn(c,c.return,Xe)}}y&4&&c.stateNode!=null&&(E=c.memoizedProps,YS(c,E,m!==null?m.memoizedProps:E)),y&1024&&(QS=!0);break;case 6:if(Kr(d,c),Xr(c),y&4){if(c.stateNode===null)throw Error(s(162));y=c.memoizedProps,m=c.stateNode;try{m.nodeValue=y}catch(Xe){cn(c,c.return,Xe)}}break;case 3:if(o1=null,E=mo,mo=r1(d.containerInfo),Kr(d,c),mo=E,Xr(c),y&4&&m!==null&&m.memoizedState.isDehydrated)try{ef(d.containerInfo)}catch(Xe){cn(c,c.return,Xe)}QS&&(QS=!1,DD(c));break;case 4:y=mo,mo=r1(c.stateNode.containerInfo),Kr(d,c),Xr(c),mo=y;break;case 12:Kr(d,c),Xr(c);break;case 31:Kr(d,c),Xr(c),y&4&&(y=c.updateQueue,y!==null&&(c.updateQueue=null,H0(c,y)));break;case 13:Kr(d,c),Xr(c),c.child.flags&8192&&c.memoizedState!==null!=(m!==null&&m.memoizedState!==null)&&(W0=wn()),y&4&&(y=c.updateQueue,y!==null&&(c.updateQueue=null,H0(c,y)));break;case 22:E=c.memoizedState!==null;var ee=m!==null&&m.memoizedState!==null,ye=Qa,Ce=ps;if(Qa=ye||E,ps=Ce||ee,Kr(d,c),ps=Ce,Qa=ye,Xr(c),y&8192)e:for(d=c.stateNode,d._visibility=E?d._visibility&-2:d._visibility|1,E&&(m===null||ee||Qa||ps||rh(c)),m=null,d=c;;){if(d.tag===5||d.tag===26){if(m===null){ee=m=d;try{if(I=ee.stateNode,E)L=I.style,typeof L.setProperty=="function"?L.setProperty("display","none","important"):L.display="none";else{G=ee.stateNode;var $e=ee.memoizedProps.style,ve=$e!=null&&$e.hasOwnProperty("display")?$e.display:null;G.style.display=ve==null||typeof ve=="boolean"?"":(""+ve).trim()}}catch(Xe){cn(ee,ee.return,Xe)}}}else if(d.tag===6){if(m===null){ee=d;try{ee.stateNode.nodeValue=E?"":ee.memoizedProps}catch(Xe){cn(ee,ee.return,Xe)}}}else if(d.tag===18){if(m===null){ee=d;try{var Se=ee.stateNode;E?xM(Se,!0):xM(ee.stateNode,!1)}catch(Xe){cn(ee,ee.return,Xe)}}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===c)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===c)break e;for(;d.sibling===null;){if(d.return===null||d.return===c)break e;m===d&&(m=null),d=d.return}m===d&&(m=null),d.sibling.return=d.return,d=d.sibling}y&4&&(y=c.updateQueue,y!==null&&(m=y.retryQueue,m!==null&&(y.retryQueue=null,H0(c,m))));break;case 19:Kr(d,c),Xr(c),y&4&&(y=c.updateQueue,y!==null&&(c.updateQueue=null,H0(c,y)));break;case 30:break;case 21:break;default:Kr(d,c),Xr(c)}}function Xr(c){var d=c.flags;if(d&2){try{for(var m,y=c.return;y!==null;){if(_D(y)){m=y;break}y=y.return}if(m==null)throw Error(s(160));switch(m.tag){case 27:var E=m.stateNode,I=JS(c);G0(c,I,E);break;case 5:var L=m.stateNode;m.flags&32&&(qr(L,""),m.flags&=-33);var G=JS(c);G0(c,G,L);break;case 3:case 4:var ee=m.stateNode.containerInfo,ye=JS(c);jS(c,ye,ee);break;default:throw Error(s(161))}}catch(Ce){cn(c,c.return,Ce)}c.flags&=-3}d&4096&&(c.flags&=-4097)}function DD(c){if(c.subtreeFlags&1024)for(c=c.child;c!==null;){var d=c;DD(d),d.tag===5&&d.flags&1024&&d.stateNode.reset(),c=c.sibling}}function el(c,d){if(d.subtreeFlags&8772)for(d=d.child;d!==null;)CD(c,d.alternate,d),d=d.sibling}function rh(c){for(c=c.child;c!==null;){var d=c;switch(d.tag){case 0:case 11:case 14:case 15:au(4,d,d.return),rh(d);break;case 1:ia(d,d.return);var m=d.stateNode;typeof m.componentWillUnmount=="function"&&xD(d,d.return,m),rh(d);break;case 27:Dm(d.stateNode);case 26:case 5:ia(d,d.return),rh(d);break;case 22:d.memoizedState===null&&rh(d);break;case 30:rh(d);break;default:rh(d)}c=c.sibling}}function tl(c,d,m){for(m=m&&(d.subtreeFlags&8772)!==0,d=d.child;d!==null;){var y=d.alternate,E=c,I=d,L=I.flags;switch(I.tag){case 0:case 11:case 15:tl(E,I,m),Sm(4,I);break;case 1:if(tl(E,I,m),y=I,E=y.stateNode,typeof E.componentDidMount=="function")try{E.componentDidMount()}catch(ye){cn(y,y.return,ye)}if(y=I,E=y.updateQueue,E!==null){var G=y.stateNode;try{var ee=E.shared.hiddenCallbacks;if(ee!==null)for(E.shared.hiddenCallbacks=null,E=0;E<ee.length;E++)cR(ee[E],G)}catch(ye){cn(y,y.return,ye)}}m&&L&64&&TD(I),_m(I,I.return);break;case 27:ED(I);case 26:case 5:tl(E,I,m),m&&y===null&&L&4&&SD(I),_m(I,I.return);break;case 12:tl(E,I,m);break;case 31:tl(E,I,m),m&&L&4&&kD(E,I);break;case 13:tl(E,I,m),m&&L&4&&$D(E,I);break;case 22:I.memoizedState===null&&tl(E,I,m),_m(I,I.return);break;case 30:break;default:tl(E,I,m)}d=d.sibling}}function ZS(c,d){var m=null;c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(m=c.memoizedState.cachePool.pool),c=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(c=d.memoizedState.cachePool.pool),c!==m&&(c!=null&&c.refCount++,m!=null&&cm(m))}function e_(c,d){c=null,d.alternate!==null&&(c=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==c&&(d.refCount++,c!=null&&cm(c))}function go(c,d,m,y){if(d.subtreeFlags&10256)for(d=d.child;d!==null;)MD(c,d,m,y),d=d.sibling}function MD(c,d,m,y){var E=d.flags;switch(d.tag){case 0:case 11:case 15:go(c,d,m,y),E&2048&&Sm(9,d);break;case 1:go(c,d,m,y);break;case 3:go(c,d,m,y),E&2048&&(c=null,d.alternate!==null&&(c=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==c&&(d.refCount++,c!=null&&cm(c)));break;case 12:if(E&2048){go(c,d,m,y),c=d.stateNode;try{var I=d.memoizedProps,L=I.id,G=I.onPostCommit;typeof G=="function"&&G(L,d.alternate===null?"mount":"update",c.passiveEffectDuration,-0)}catch(ee){cn(d,d.return,ee)}}else go(c,d,m,y);break;case 31:go(c,d,m,y);break;case 13:go(c,d,m,y);break;case 23:break;case 22:I=d.stateNode,L=d.alternate,d.memoizedState!==null?I._visibility&2?go(c,d,m,y):Em(c,d):I._visibility&2?go(c,d,m,y):(I._visibility|=2,Gd(c,d,m,y,(d.subtreeFlags&10256)!==0||!1)),E&2048&&ZS(L,d);break;case 24:go(c,d,m,y),E&2048&&e_(d.alternate,d);break;default:go(c,d,m,y)}}function Gd(c,d,m,y,E){for(E=E&&((d.subtreeFlags&10256)!==0||!1),d=d.child;d!==null;){var I=c,L=d,G=m,ee=y,ye=L.flags;switch(L.tag){case 0:case 11:case 15:Gd(I,L,G,ee,E),Sm(8,L);break;case 23:break;case 22:var Ce=L.stateNode;L.memoizedState!==null?Ce._visibility&2?Gd(I,L,G,ee,E):Em(I,L):(Ce._visibility|=2,Gd(I,L,G,ee,E)),E&&ye&2048&&ZS(L.alternate,L);break;case 24:Gd(I,L,G,ee,E),E&&ye&2048&&e_(L.alternate,L);break;default:Gd(I,L,G,ee,E)}d=d.sibling}}function Em(c,d){if(d.subtreeFlags&10256)for(d=d.child;d!==null;){var m=c,y=d,E=y.flags;switch(y.tag){case 22:Em(m,y),E&2048&&ZS(y.alternate,y);break;case 24:Em(m,y),E&2048&&e_(y.alternate,y);break;default:Em(m,y)}d=d.sibling}}var Im=8192;function Hd(c,d,m){if(c.subtreeFlags&Im)for(c=c.child;c!==null;)OD(c,d,m),c=c.sibling}function OD(c,d,m){switch(c.tag){case 26:Hd(c,d,m),c.flags&Im&&c.memoizedState!==null&&sj(m,mo,c.memoizedState,c.memoizedProps);break;case 5:Hd(c,d,m);break;case 3:case 4:var y=mo;mo=r1(c.stateNode.containerInfo),Hd(c,d,m),mo=y;break;case 22:c.memoizedState===null&&(y=c.alternate,y!==null&&y.memoizedState!==null?(y=Im,Im=16777216,Hd(c,d,m),Im=y):Hd(c,d,m));break;default:Hd(c,d,m)}}function PD(c){var d=c.alternate;if(d!==null&&(c=d.child,c!==null)){d.child=null;do d=c.sibling,c.sibling=null,c=d;while(c!==null)}}function Cm(c){var d=c.deletions;if((c.flags&16)!==0){if(d!==null)for(var m=0;m<d.length;m++){var y=d[m];Ps=y,LD(y,c)}PD(c)}if(c.subtreeFlags&10256)for(c=c.child;c!==null;)FD(c),c=c.sibling}function FD(c){switch(c.tag){case 0:case 11:case 15:Cm(c),c.flags&2048&&au(9,c,c.return);break;case 3:Cm(c);break;case 12:Cm(c);break;case 22:var d=c.stateNode;c.memoizedState!==null&&d._visibility&2&&(c.return===null||c.return.tag!==13)?(d._visibility&=-3,q0(c)):Cm(c);break;default:Cm(c)}}function q0(c){var d=c.deletions;if((c.flags&16)!==0){if(d!==null)for(var m=0;m<d.length;m++){var y=d[m];Ps=y,LD(y,c)}PD(c)}for(c=c.child;c!==null;){switch(d=c,d.tag){case 0:case 11:case 15:au(8,d,d.return),q0(d);break;case 22:m=d.stateNode,m._visibility&2&&(m._visibility&=-3,q0(d));break;default:q0(d)}c=c.sibling}}function LD(c,d){for(;Ps!==null;){var m=Ps;switch(m.tag){case 0:case 11:case 15:au(8,m,d);break;case 23:case 22:if(m.memoizedState!==null&&m.memoizedState.cachePool!==null){var y=m.memoizedState.cachePool.pool;y!=null&&y.refCount++}break;case 24:cm(m.memoizedState.cache)}if(y=m.child,y!==null)y.return=m,Ps=y;else e:for(m=c;Ps!==null;){y=Ps;var E=y.sibling,I=y.return;if(ND(y),y===m){Ps=null;break e}if(E!==null){E.return=I,Ps=E;break e}Ps=I}}}var bJ={getCacheForType:function(c){var d=js(hs),m=d.data.get(c);return m===void 0&&(m=c(),d.data.set(c,m)),m},cacheSignal:function(){return js(hs).controller.signal}},vJ=typeof WeakMap=="function"?WeakMap:Map,en=0,Tn=null,Nt=null,kt=0,un=0,yi=null,lu=!1,qd=!1,t_=!1,nl=0,qn=0,uu=0,ih=0,n_=0,bi=0,Wd=0,Nm=null,Yr=null,s_=!1,W0=0,VD=0,K0=1/0,X0=null,cu=null,Is=0,hu=null,Kd=null,sl=0,r_=0,i_=null,BD=null,Am=0,o_=null;function vi(){return(en&2)!==0&&kt!==0?kt&-kt:X.T!==null?d_():Yb()}function UD(){if(bi===0)if((kt&536870912)===0||Pt){var c=Rc;Rc<<=1,(Rc&3932160)===0&&(Rc=262144),bi=c}else bi=536870912;return c=mi.current,c!==null&&(c.flags|=32),bi}function Jr(c,d,m){(c===Tn&&(un===2||un===9)||c.cancelPendingCommit!==null)&&(Xd(c,0),du(c,kt,bi,!1)),Dc(c,m),((en&2)===0||c!==Tn)&&(c===Tn&&((en&2)===0&&(ih|=m),qn===4&&du(c,kt,bi,!1)),oa(c))}function zD(c,d,m){if((en&6)!==0)throw Error(s(327));var y=!m&&(d&127)===0&&(d&c.expiredLanes)===0||io(c,d),E=y?xJ(c,d):l_(c,d,!0),I=y;do{if(E===0){qd&&!y&&du(c,d,0,!1);break}else{if(m=c.current.alternate,I&&!wJ(m)){E=l_(c,d,!1),I=!1;continue}if(E===2){if(I=d,c.errorRecoveryDisabledLanes&I)var L=0;else L=c.pendingLanes&-536870913,L=L!==0?L:L&536870912?536870912:0;if(L!==0){d=L;e:{var G=c;E=Nm;var ee=G.current.memoizedState.isDehydrated;if(ee&&(Xd(G,L).flags|=256),L=l_(G,L,!1),L!==2){if(t_&&!ee){G.errorRecoveryDisabledLanes|=I,ih|=I,E=4;break e}I=Yr,Yr=E,I!==null&&(Yr===null?Yr=I:Yr.push.apply(Yr,I))}E=L}if(I=!1,E!==2)continue}}if(E===1){Xd(c,0),du(c,d,0,!0);break}e:{switch(y=c,I=E,I){case 0:case 1:throw Error(s(345));case 4:if((d&4194048)!==d)break;case 6:du(y,d,bi,!lu);break e;case 2:Yr=null;break;case 3:case 5:break;default:throw Error(s(329))}if((d&62914560)===d&&(E=W0+300-wn(),10<E)){if(du(y,d,bi,!lu),zo(y,0,!0)!==0)break e;sl=d,y.timeoutHandle=vM(GD.bind(null,y,m,Yr,X0,s_,d,bi,ih,Wd,lu,I,"Throttled",-0,0),E);break e}GD(y,m,Yr,X0,s_,d,bi,ih,Wd,lu,I,null,-0,0)}}break}while(!0);oa(c)}function GD(c,d,m,y,E,I,L,G,ee,ye,Ce,$e,ve,Se){if(c.timeoutHandle=-1,$e=d.subtreeFlags,$e&8192||($e&16785408)===16785408){$e={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:lo},OD(d,I,$e);var Xe=(I&62914560)===I?W0-wn():(I&4194048)===I?VD-wn():0;if(Xe=rj($e,Xe),Xe!==null){sl=I,c.cancelPendingCommit=Xe(jD.bind(null,c,d,I,m,y,E,L,G,ee,Ce,$e,null,ve,Se)),du(c,I,L,!ye);return}}jD(c,d,I,m,y,E,L,G,ee)}function wJ(c){for(var d=c;;){var m=d.tag;if((m===0||m===11||m===15)&&d.flags&16384&&(m=d.updateQueue,m!==null&&(m=m.stores,m!==null)))for(var y=0;y<m.length;y++){var E=m[y],I=E.getSnapshot;E=E.value;try{if(!fi(I(),E))return!1}catch{return!1}}if(m=d.child,d.subtreeFlags&16384&&m!==null)m.return=d,d=m;else{if(d===c)break;for(;d.sibling===null;){if(d.return===null||d.return===c)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function du(c,d,m,y){d&=~n_,d&=~ih,c.suspendedLanes|=d,c.pingedLanes&=~d,y&&(c.warmLanes|=d),y=c.expirationTimes;for(var E=d;0<E;){var I=31-Qn(E),L=1<<I;y[I]=-1,E&=~L}m!==0&&Mc(c,m,d)}function Y0(){return(en&6)===0?(km(0),!1):!0}function a_(){if(Nt!==null){if(un===0)var c=Nt.return;else c=Nt,Wa=Jc=null,SS(c),Ld=null,dm=0,c=Nt;for(;c!==null;)wD(c.alternate,c),c=c.return;Nt=null}}function Xd(c,d){var m=c.timeoutHandle;m!==-1&&(c.timeoutHandle=-1,BJ(m)),m=c.cancelPendingCommit,m!==null&&(c.cancelPendingCommit=null,m()),sl=0,a_(),Tn=c,Nt=m=Ha(c.current,null),kt=d,un=0,yi=null,lu=!1,qd=io(c,d),t_=!1,Wd=bi=n_=ih=uu=qn=0,Yr=Nm=null,s_=!1,(d&8)!==0&&(d|=d&32);var y=c.entangledLanes;if(y!==0)for(c=c.entanglements,y&=d;0<y;){var E=31-Qn(y),I=1<<E;d|=c[E],y&=~I}return nl=d,g0(),m}function HD(c,d){yt=null,X.H=wm,d===Fd||d===_0?(d=oR(),un=3):d===hS?(d=oR(),un=4):un=d===VS?8:d!==null&&typeof d=="object"&&typeof d.then=="function"?6:1,yi=d,Nt===null&&(qn=1,L0(c,Oi(d,c.current)))}function qD(){var c=mi.current;return c===null?!0:(kt&4194048)===kt?Vi===null:(kt&62914560)===kt||(kt&536870912)!==0?c===Vi:!1}function WD(){var c=X.H;return X.H=wm,c===null?wm:c}function KD(){var c=X.A;return X.A=bJ,c}function J0(){qn=4,lu||(kt&4194048)!==kt&&mi.current!==null||(qd=!0),(uu&134217727)===0&&(ih&134217727)===0||Tn===null||du(Tn,kt,bi,!1)}function l_(c,d,m){var y=en;en|=2;var E=WD(),I=KD();(Tn!==c||kt!==d)&&(X0=null,Xd(c,d)),d=!1;var L=qn;e:do try{if(un!==0&&Nt!==null){var G=Nt,ee=yi;switch(un){case 8:a_(),L=6;break e;case 3:case 2:case 9:case 6:mi.current===null&&(d=!0);var ye=un;if(un=0,yi=null,Yd(c,G,ee,ye),m&&qd){L=0;break e}break;default:ye=un,un=0,yi=null,Yd(c,G,ee,ye)}}TJ(),L=qn;break}catch(Ce){HD(c,Ce)}while(!0);return d&&c.shellSuspendCounter++,Wa=Jc=null,en=y,X.H=E,X.A=I,Nt===null&&(Tn=null,kt=0,g0()),L}function TJ(){for(;Nt!==null;)XD(Nt)}function xJ(c,d){var m=en;en|=2;var y=WD(),E=KD();Tn!==c||kt!==d?(X0=null,K0=wn()+500,Xd(c,d)):qd=io(c,d);e:do try{if(un!==0&&Nt!==null){d=Nt;var I=yi;t:switch(un){case 1:un=0,yi=null,Yd(c,d,I,1);break;case 2:case 9:if(rR(I)){un=0,yi=null,YD(d);break}d=function(){un!==2&&un!==9||Tn!==c||(un=7),oa(c)},I.then(d,d);break e;case 3:un=7;break e;case 4:un=5;break e;case 7:rR(I)?(un=0,yi=null,YD(d)):(un=0,yi=null,Yd(c,d,I,7));break;case 5:var L=null;switch(Nt.tag){case 26:L=Nt.memoizedState;case 5:case 27:var G=Nt;if(L?MM(L):G.stateNode.complete){un=0,yi=null;var ee=G.sibling;if(ee!==null)Nt=ee;else{var ye=G.return;ye!==null?(Nt=ye,j0(ye)):Nt=null}break t}}un=0,yi=null,Yd(c,d,I,5);break;case 6:un=0,yi=null,Yd(c,d,I,6);break;case 8:a_(),qn=6;break e;default:throw Error(s(462))}}SJ();break}catch(Ce){HD(c,Ce)}while(!0);return Wa=Jc=null,X.H=y,X.A=E,en=m,Nt!==null?0:(Tn=null,kt=0,g0(),qn)}function SJ(){for(;Nt!==null&&!Ws();)XD(Nt)}function XD(c){var d=bD(c.alternate,c,nl);c.memoizedProps=c.pendingProps,d===null?j0(c):Nt=d}function YD(c){var d=c,m=d.alternate;switch(d.tag){case 15:case 0:d=dD(m,d,d.pendingProps,d.type,void 0,kt);break;case 11:d=dD(m,d,d.pendingProps,d.type.render,d.ref,kt);break;case 5:SS(d);default:wD(m,d),d=Nt=K$(d,nl),d=bD(m,d,nl)}c.memoizedProps=c.pendingProps,d===null?j0(c):Nt=d}function Yd(c,d,m,y){Wa=Jc=null,SS(d),Ld=null,dm=0;var E=d.return;try{if(hJ(c,E,d,m,kt)){qn=1,L0(c,Oi(m,c.current)),Nt=null;return}}catch(I){if(E!==null)throw Nt=E,I;qn=1,L0(c,Oi(m,c.current)),Nt=null;return}d.flags&32768?(Pt||y===1?c=!0:qd||(kt&536870912)!==0?c=!1:(lu=c=!0,(y===2||y===9||y===3||y===6)&&(y=mi.current,y!==null&&y.tag===13&&(y.flags|=16384))),JD(d,c)):j0(d)}function j0(c){var d=c;do{if((d.flags&32768)!==0){JD(d,lu);return}c=d.return;var m=pJ(d.alternate,d,nl);if(m!==null){Nt=m;return}if(d=d.sibling,d!==null){Nt=d;return}Nt=d=c}while(d!==null);qn===0&&(qn=5)}function JD(c,d){do{var m=mJ(c.alternate,c);if(m!==null){m.flags&=32767,Nt=m;return}if(m=c.return,m!==null&&(m.flags|=32768,m.subtreeFlags=0,m.deletions=null),!d&&(c=c.sibling,c!==null)){Nt=c;return}Nt=c=m}while(c!==null);qn=6,Nt=null}function jD(c,d,m,y,E,I,L,G,ee){c.cancelPendingCommit=null;do Q0();while(Is!==0);if((en&6)!==0)throw Error(s(327));if(d!==null){if(d===c.current)throw Error(s(177));if(I=d.lanes|d.childLanes,I|=Jx,Ux(c,m,I,L,G,ee),c===Tn&&(Nt=Tn=null,kt=0),Kd=d,hu=c,sl=m,r_=I,i_=E,BD=y,(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?(c.callbackNode=null,c.callbackPriority=0,CJ(Xs,function(){return nM(),null})):(c.callbackNode=null,c.callbackPriority=0),y=(d.flags&13878)!==0,(d.subtreeFlags&13878)!==0||y){y=X.T,X.T=null,E=Q.p,Q.p=2,L=en,en|=4;try{gJ(c,d,m)}finally{en=L,Q.p=E,X.T=y}}Is=1,QD(),ZD(),eM()}}function QD(){if(Is===1){Is=0;var c=hu,d=Kd,m=(d.flags&13878)!==0;if((d.subtreeFlags&13878)!==0||m){m=X.T,X.T=null;var y=Q.p;Q.p=2;var E=en;en|=4;try{RD(d,c);var I=w_,L=L$(c.containerInfo),G=I.focusedElem,ee=I.selectionRange;if(L!==G&&G&&G.ownerDocument&&F$(G.ownerDocument.documentElement,G)){if(ee!==null&&qx(G)){var ye=ee.start,Ce=ee.end;if(Ce===void 0&&(Ce=ye),"selectionStart"in G)G.selectionStart=ye,G.selectionEnd=Math.min(Ce,G.value.length);else{var $e=G.ownerDocument||document,ve=$e&&$e.defaultView||window;if(ve.getSelection){var Se=ve.getSelection(),Xe=G.textContent.length,st=Math.min(ee.start,Xe),yn=ee.end===void 0?st:Math.min(ee.end,Xe);!Se.extend&&st>yn&&(L=yn,yn=st,st=L);var de=P$(G,st),oe=P$(G,yn);if(de&&oe&&(Se.rangeCount!==1||Se.anchorNode!==de.node||Se.anchorOffset!==de.offset||Se.focusNode!==oe.node||Se.focusOffset!==oe.offset)){var me=$e.createRange();me.setStart(de.node,de.offset),Se.removeAllRanges(),st>yn?(Se.addRange(me),Se.extend(oe.node,oe.offset)):(me.setEnd(oe.node,oe.offset),Se.addRange(me))}}}}for($e=[],Se=G;Se=Se.parentNode;)Se.nodeType===1&&$e.push({element:Se,left:Se.scrollLeft,top:Se.scrollTop});for(typeof G.focus=="function"&&G.focus(),G=0;G<$e.length;G++){var Ne=$e[G];Ne.element.scrollLeft=Ne.left,Ne.element.scrollTop=Ne.top}}c1=!!v_,w_=v_=null}finally{en=E,Q.p=y,X.T=m}}c.current=d,Is=2}}function ZD(){if(Is===2){Is=0;var c=hu,d=Kd,m=(d.flags&8772)!==0;if((d.subtreeFlags&8772)!==0||m){m=X.T,X.T=null;var y=Q.p;Q.p=2;var E=en;en|=4;try{CD(c,d.alternate,d)}finally{en=E,Q.p=y,X.T=m}}Is=3}}function eM(){if(Is===4||Is===3){Is=0,Ai();var c=hu,d=Kd,m=sl,y=BD;(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?Is=5:(Is=0,Kd=hu=null,tM(c,c.pendingLanes));var E=c.pendingLanes;if(E===0&&(cu=null),Ba(m),d=d.stateNode,Es&&typeof Es.onCommitFiberRoot=="function")try{Es.onCommitFiberRoot(ur,d,void 0,(d.current.flags&128)===128)}catch{}if(y!==null){d=X.T,E=Q.p,Q.p=2,X.T=null;try{for(var I=c.onRecoverableError,L=0;L<y.length;L++){var G=y[L];I(G.value,{componentStack:G.stack})}}finally{X.T=d,Q.p=E}}(sl&3)!==0&&Q0(),oa(c),E=c.pendingLanes,(m&261930)!==0&&(E&42)!==0?c===o_?Am++:(Am=0,o_=c):Am=0,km(0)}}function tM(c,d){(c.pooledCacheLanes&=d)===0&&(d=c.pooledCache,d!=null&&(c.pooledCache=null,cm(d)))}function Q0(){return QD(),ZD(),eM(),nM()}function nM(){if(Is!==5)return!1;var c=hu,d=r_;r_=0;var m=Ba(sl),y=X.T,E=Q.p;try{Q.p=32>m?32:m,X.T=null,m=i_,i_=null;var I=hu,L=sl;if(Is=0,Kd=hu=null,sl=0,(en&6)!==0)throw Error(s(331));var G=en;if(en|=4,FD(I.current),MD(I,I.current,L,m),en=G,km(0,!1),Es&&typeof Es.onPostCommitFiberRoot=="function")try{Es.onPostCommitFiberRoot(ur,I)}catch{}return!0}finally{Q.p=E,X.T=y,tM(c,d)}}function sM(c,d,m){d=Oi(m,d),d=LS(c.stateNode,d,2),c=ru(c,d,2),c!==null&&(Dc(c,2),oa(c))}function cn(c,d,m){if(c.tag===3)sM(c,c,m);else for(;d!==null;){if(d.tag===3){sM(d,c,m);break}else if(d.tag===1){var y=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof y.componentDidCatch=="function"&&(cu===null||!cu.has(y))){c=Oi(m,c),m=rD(2),y=ru(d,m,2),y!==null&&(iD(m,y,d,c),Dc(y,2),oa(y));break}}d=d.return}}function u_(c,d,m){var y=c.pingCache;if(y===null){y=c.pingCache=new vJ;var E=new Set;y.set(d,E)}else E=y.get(d),E===void 0&&(E=new Set,y.set(d,E));E.has(m)||(t_=!0,E.add(m),c=_J.bind(null,c,d,m),d.then(c,c))}function _J(c,d,m){var y=c.pingCache;y!==null&&y.delete(d),c.pingedLanes|=c.suspendedLanes&m,c.warmLanes&=~m,Tn===c&&(kt&m)===m&&(qn===4||qn===3&&(kt&62914560)===kt&&300>wn()-W0?(en&2)===0&&Xd(c,0):n_|=m,Wd===kt&&(Wd=0)),oa(c)}function rM(c,d){d===0&&(d=Xb()),c=Kc(c,d),c!==null&&(Dc(c,d),oa(c))}function EJ(c){var d=c.memoizedState,m=0;d!==null&&(m=d.retryLane),rM(c,m)}function IJ(c,d){var m=0;switch(c.tag){case 31:case 13:var y=c.stateNode,E=c.memoizedState;E!==null&&(m=E.retryLane);break;case 19:y=c.stateNode;break;case 22:y=c.stateNode._retryCache;break;default:throw Error(s(314))}y!==null&&y.delete(d),rM(c,m)}function CJ(c,d){return Et(c,d)}var Z0=null,Jd=null,c_=!1,e1=!1,h_=!1,fu=0;function oa(c){c!==Jd&&c.next===null&&(Jd===null?Z0=Jd=c:Jd=Jd.next=c),e1=!0,c_||(c_=!0,AJ())}function km(c,d){if(!h_&&e1){h_=!0;do for(var m=!1,y=Z0;y!==null;){if(c!==0){var E=y.pendingLanes;if(E===0)var I=0;else{var L=y.suspendedLanes,G=y.pingedLanes;I=(1<<31-Qn(42|c)+1)-1,I&=E&~(L&~G),I=I&201326741?I&201326741|1:I?I|2:0}I!==0&&(m=!0,lM(y,I))}else I=kt,I=zo(y,y===Tn?I:0,y.cancelPendingCommit!==null||y.timeoutHandle!==-1),(I&3)===0||io(y,I)||(m=!0,lM(y,I));y=y.next}while(m);h_=!1}}function NJ(){iM()}function iM(){e1=c_=!1;var c=0;fu!==0&&VJ()&&(c=fu);for(var d=wn(),m=null,y=Z0;y!==null;){var E=y.next,I=oM(y,d);I===0?(y.next=null,m===null?Z0=E:m.next=E,E===null&&(Jd=m)):(m=y,(c!==0||(I&3)!==0)&&(e1=!0)),y=E}Is!==0&&Is!==5||km(c),fu!==0&&(fu=0)}function oM(c,d){for(var m=c.suspendedLanes,y=c.pingedLanes,E=c.expirationTimes,I=c.pendingLanes&-62914561;0<I;){var L=31-Qn(I),G=1<<L,ee=E[L];ee===-1?((G&m)===0||(G&y)!==0)&&(E[L]=Bx(G,d)):ee<=d&&(c.expiredLanes|=G),I&=~G}if(d=Tn,m=kt,m=zo(c,c===d?m:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),y=c.callbackNode,m===0||c===d&&(un===2||un===9)||c.cancelPendingCommit!==null)return y!==null&&y!==null&&qs(y),c.callbackNode=null,c.callbackPriority=0;if((m&3)===0||io(c,m)){if(d=m&-m,d===c.callbackPriority)return d;switch(y!==null&&qs(y),Ba(m)){case 2:case 8:m=zr;break;case 32:m=Xs;break;case 268435456:m=Ul;break;default:m=Xs}return y=aM.bind(null,c),m=Et(m,y),c.callbackPriority=d,c.callbackNode=m,d}return y!==null&&y!==null&&qs(y),c.callbackPriority=2,c.callbackNode=null,2}function aM(c,d){if(Is!==0&&Is!==5)return c.callbackNode=null,c.callbackPriority=0,null;var m=c.callbackNode;if(Q0()&&c.callbackNode!==m)return null;var y=kt;return y=zo(c,c===Tn?y:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),y===0?null:(zD(c,y,d),oM(c,wn()),c.callbackNode!=null&&c.callbackNode===m?aM.bind(null,c):null)}function lM(c,d){if(Q0())return null;zD(c,d,!0)}function AJ(){UJ(function(){(en&6)!==0?Et(Ur,NJ):iM()})}function d_(){if(fu===0){var c=Od;c===0&&(c=Bo,Bo<<=1,(Bo&261888)===0&&(Bo=256)),fu=c}return fu}function uM(c){return c==null||typeof c=="symbol"||typeof c=="boolean"?null:typeof c=="function"?c:wd(""+c)}function cM(c,d){var m=d.ownerDocument.createElement("input");return m.name=d.name,m.value=d.value,c.id&&m.setAttribute("form",c.id),d.parentNode.insertBefore(m,d),c=new FormData(c),m.parentNode.removeChild(m),c}function kJ(c,d,m,y,E){if(d==="submit"&&m&&m.stateNode===E){var I=uM((E[Ms]||null).action),L=y.submitter;L&&(d=(d=L[Ms]||null)?uM(d.formAction):L.getAttribute("formAction"),d!==null&&(I=d,L=null));var G=new Zo("action","action",null,y,E);c.push({event:G,listeners:[{instance:null,listener:function(){if(y.defaultPrevented){if(fu!==0){var ee=L?cM(E,L):new FormData(E);RS(m,{pending:!0,data:ee,method:E.method,action:I},null,ee)}}else typeof I=="function"&&(G.preventDefault(),ee=L?cM(E,L):new FormData(E),RS(m,{pending:!0,data:ee,method:E.method,action:I},I,ee))},currentTarget:E}]})}}for(var f_=0;f_<Yx.length;f_++){var p_=Yx[f_],$J=p_.toLowerCase(),RJ=p_[0].toUpperCase()+p_.slice(1);po($J,"on"+RJ)}po(U$,"onAnimationEnd"),po(z$,"onAnimationIteration"),po(G$,"onAnimationStart"),po("dblclick","onDoubleClick"),po("focusin","onFocus"),po("focusout","onBlur"),po(XY,"onTransitionRun"),po(YY,"onTransitionStart"),po(JY,"onTransitionCancel"),po(H$,"onTransitionEnd"),Yo("onMouseEnter",["mouseout","mouseover"]),Yo("onMouseLeave",["mouseout","mouseover"]),Yo("onPointerEnter",["pointerout","pointerover"]),Yo("onPointerLeave",["pointerout","pointerover"]),Xo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Xo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Xo("onBeforeInput",["compositionend","keypress","textInput","paste"]),Xo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Xo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Xo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $m="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),DJ=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat($m));function hM(c,d){d=(d&4)!==0;for(var m=0;m<c.length;m++){var y=c[m],E=y.event;y=y.listeners;e:{var I=void 0;if(d)for(var L=y.length-1;0<=L;L--){var G=y[L],ee=G.instance,ye=G.currentTarget;if(G=G.listener,ee!==I&&E.isPropagationStopped())break e;I=G,E.currentTarget=ye;try{I(E)}catch(Ce){m0(Ce)}E.currentTarget=null,I=ee}else for(L=0;L<y.length;L++){if(G=y[L],ee=G.instance,ye=G.currentTarget,G=G.listener,ee!==I&&E.isPropagationStopped())break e;I=G,E.currentTarget=ye;try{I(E)}catch(Ce){m0(Ce)}E.currentTarget=null,I=ee}}}}function At(c,d){var m=d[md];m===void 0&&(m=d[md]=new Set);var y=c+"__bubble";m.has(y)||(dM(d,c,2,!1),m.add(y))}function m_(c,d,m){var y=0;d&&(y|=4),dM(m,c,y,d)}var t1="_reactListening"+Math.random().toString(36).slice(2);function g_(c){if(!c[t1]){c[t1]=!0,Gp.forEach(function(m){m!=="selectionchange"&&(DJ.has(m)||m_(m,!1,c),m_(m,!0,c))});var d=c.nodeType===9?c:c.ownerDocument;d===null||d[t1]||(d[t1]=!0,m_("selectionchange",!1,d))}}function dM(c,d,m,y){switch(UM(d)){case 2:var E=aj;break;case 8:E=lj;break;default:E=$_}m=E.bind(null,d,m,c),E=void 0,!Vc||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(E=!0),y?E!==void 0?c.addEventListener(d,m,{capture:!0,passive:E}):c.addEventListener(d,m,!0):E!==void 0?c.addEventListener(d,m,{passive:E}):c.addEventListener(d,m,!1)}function y_(c,d,m,y,E){var I=y;if((d&1)===0&&(d&2)===0&&y!==null)e:for(;;){if(y===null)return;var L=y.tag;if(L===3||L===4){var G=y.stateNode.containerInfo;if(G===E)break;if(L===4)for(L=y.return;L!==null;){var ee=L.tag;if((ee===3||ee===4)&&L.stateNode.containerInfo===E)return;L=L.return}for(;G!==null;){if(L=Wo(G),L===null)return;if(ee=L.tag,ee===5||ee===6||ee===26||ee===27){y=I=L;continue e}G=G.parentNode}}y=y.return}Xl(function(){var ye=I,Ce=$i(m),$e=[];e:{var ve=q$.get(c);if(ve!==void 0){var Se=Zo,Xe=c;switch(c){case"keypress":if(Uc(m)===0)break e;case"keydown":case"keyup":Se=d0;break;case"focusin":Xe="focus",Se=Gc;break;case"focusout":Xe="blur",Se=Gc;break;case"beforeblur":case"afterblur":Se=Gc;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Se=nm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Se=s0;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Se=R;break;case U$:case z$:case G$:Se=i0;break;case H$:Se=K;break;case"scroll":case"scrollend":Se=tm;break;case"wheel":Se=xe;break;case"copy":case"cut":case"paste":Se=o0;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Se=Ga;break;case"toggle":case"beforetoggle":Se=gt}var st=(d&4)!==0,yn=!st&&(c==="scroll"||c==="scrollend"),de=st?ve!==null?ve+"Capture":null:ve;st=[];for(var oe=ye,me;oe!==null;){var Ne=oe;if(me=Ne.stateNode,Ne=Ne.tag,Ne!==5&&Ne!==26&&Ne!==27||me===null||de===null||(Ne=uo(oe,de),Ne!=null&&st.push(Rm(oe,Ne,me))),yn)break;oe=oe.return}0<st.length&&(ve=new Se(ve,Xe,null,m,Ce),$e.push({event:ve,listeners:st}))}}if((d&7)===0){e:{if(ve=c==="mouseover"||c==="pointerover",Se=c==="mouseout"||c==="pointerout",ve&&m!==Qp&&(Xe=m.relatedTarget||m.fromElement)&&(Wo(Xe)||Xe[Ho]))break e;if((Se||ve)&&(ve=Ce.window===Ce?Ce:(ve=Ce.ownerDocument)?ve.defaultView||ve.parentWindow:window,Se?(Xe=m.relatedTarget||m.toElement,Se=ye,Xe=Xe?Wo(Xe):null,Xe!==null&&(yn=i(Xe),st=Xe.tag,Xe!==yn||st!==5&&st!==27&&st!==6)&&(Xe=null)):(Se=null,Xe=ye),Se!==Xe)){if(st=nm,Ne="onMouseLeave",de="onMouseEnter",oe="mouse",(c==="pointerout"||c==="pointerover")&&(st=Ga,Ne="onPointerLeave",de="onPointerEnter",oe="pointer"),yn=Se==null?ve:hi(Se),me=Xe==null?ve:hi(Xe),ve=new st(Ne,oe+"leave",Se,m,Ce),ve.target=yn,ve.relatedTarget=me,Ne=null,Wo(Ce)===ye&&(st=new st(de,oe+"enter",Xe,m,Ce),st.target=me,st.relatedTarget=yn,Ne=st),yn=Ne,Se&&Xe)t:{for(st=MJ,de=Se,oe=Xe,me=0,Ne=de;Ne;Ne=st(Ne))me++;Ne=0;for(var et=oe;et;et=st(et))Ne++;for(;0<me-Ne;)de=st(de),me--;for(;0<Ne-me;)oe=st(oe),Ne--;for(;me--;){if(de===oe||oe!==null&&de===oe.alternate){st=de;break t}de=st(de),oe=st(oe)}st=null}else st=null;Se!==null&&fM($e,ve,Se,st,!1),Xe!==null&&yn!==null&&fM($e,yn,Xe,st,!0)}}e:{if(ve=ye?hi(ye):window,Se=ve.nodeName&&ve.nodeName.toLowerCase(),Se==="select"||Se==="input"&&ve.type==="file")var Wt=k$;else if(N$(ve))if($$)Wt=qY;else{Wt=GY;var je=zY}else Se=ve.nodeName,!Se||Se.toLowerCase()!=="input"||ve.type!=="checkbox"&&ve.type!=="radio"?ye&&vd(ye.elementType)&&(Wt=k$):Wt=HY;if(Wt&&(Wt=Wt(c,ye))){A$($e,Wt,m,Ce);break e}je&&je(c,ve,ye),c==="focusout"&&ye&&ve.type==="number"&&ye.memoizedProps.value!=null&&Yp(ve,"number",ve.value)}switch(je=ye?hi(ye):window,c){case"focusin":(N$(je)||je.contentEditable==="true")&&(Cd=je,Wx=ye,am=null);break;case"focusout":am=Wx=Cd=null;break;case"mousedown":Kx=!0;break;case"contextmenu":case"mouseup":case"dragend":Kx=!1,V$($e,m,Ce);break;case"selectionchange":if(KY)break;case"keydown":case"keyup":V$($e,m,Ce)}var vt;if(Zt)e:{switch(c){case"compositionstart":var $t="onCompositionStart";break e;case"compositionend":$t="onCompositionEnd";break e;case"compositionupdate":$t="onCompositionUpdate";break e}$t=void 0}else Id?Hc(c,m)&&($t="onCompositionEnd"):c==="keydown"&&m.keyCode===229&&($t="onCompositionStart");$t&&(na&&m.locale!=="ko"&&(Id||$t!=="onCompositionStart"?$t==="onCompositionEnd"&&Id&&(vt=em()):(Qo=Ce,Zp="value"in Qo?Qo.value:Qo.textContent,Id=!0)),je=n1(ye,$t),0<je.length&&($t=new ta($t,c,null,m,Ce),$e.push({event:$t,listeners:je}),vt?$t.data=vt:(vt=Ed(m),vt!==null&&($t.data=vt)))),(vt=Di?LY(c,m):VY(c,m))&&($t=n1(ye,"onBeforeInput"),0<$t.length&&(je=new ta("onBeforeInput","beforeinput",null,m,Ce),$e.push({event:je,listeners:$t}),je.data=vt)),kJ($e,c,ye,m,Ce)}hM($e,d)})}function Rm(c,d,m){return{instance:c,listener:d,currentTarget:m}}function n1(c,d){for(var m=d+"Capture",y=[];c!==null;){var E=c,I=E.stateNode;if(E=E.tag,E!==5&&E!==26&&E!==27||I===null||(E=uo(c,m),E!=null&&y.unshift(Rm(c,E,I)),E=uo(c,d),E!=null&&y.push(Rm(c,E,I))),c.tag===3)return y;c=c.return}return[]}function MJ(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5&&c.tag!==27);return c||null}function fM(c,d,m,y,E){for(var I=d._reactName,L=[];m!==null&&m!==y;){var G=m,ee=G.alternate,ye=G.stateNode;if(G=G.tag,ee!==null&&ee===y)break;G!==5&&G!==26&&G!==27||ye===null||(ee=ye,E?(ye=uo(m,I),ye!=null&&L.unshift(Rm(m,ye,ee))):E||(ye=uo(m,I),ye!=null&&L.push(Rm(m,ye,ee)))),m=m.return}L.length!==0&&c.push({event:d,listeners:L})}var OJ=/\r\n?/g,PJ=/\u0000|\uFFFD/g;function pM(c){return(typeof c=="string"?c:""+c).replace(OJ,`
`).replace(PJ,"")}function mM(c,d){return d=pM(d),pM(c)===d}function gn(c,d,m,y,E,I){switch(m){case"children":typeof y=="string"?d==="body"||d==="textarea"&&y===""||qr(c,y):(typeof y=="number"||typeof y=="bigint")&&d!=="body"&&qr(c,""+y);break;case"className":di(c,"class",y);break;case"tabIndex":di(c,"tabindex",y);break;case"dir":case"role":case"viewBox":case"width":case"height":di(c,m,y);break;case"style":jp(c,y,I);break;case"data":if(d!=="object"){di(c,"data",y);break}case"src":case"href":if(y===""&&(d!=="a"||m!=="href")){c.removeAttribute(m);break}if(y==null||typeof y=="function"||typeof y=="symbol"||typeof y=="boolean"){c.removeAttribute(m);break}y=wd(""+y),c.setAttribute(m,y);break;case"action":case"formAction":if(typeof y=="function"){c.setAttribute(m,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof I=="function"&&(m==="formAction"?(d!=="input"&&gn(c,d,"name",E.name,E,null),gn(c,d,"formEncType",E.formEncType,E,null),gn(c,d,"formMethod",E.formMethod,E,null),gn(c,d,"formTarget",E.formTarget,E,null)):(gn(c,d,"encType",E.encType,E,null),gn(c,d,"method",E.method,E,null),gn(c,d,"target",E.target,E,null)));if(y==null||typeof y=="symbol"||typeof y=="boolean"){c.removeAttribute(m);break}y=wd(""+y),c.setAttribute(m,y);break;case"onClick":y!=null&&(c.onclick=lo);break;case"onScroll":y!=null&&At("scroll",c);break;case"onScrollEnd":y!=null&&At("scrollend",c);break;case"dangerouslySetInnerHTML":if(y!=null){if(typeof y!="object"||!("__html"in y))throw Error(s(61));if(m=y.__html,m!=null){if(E.children!=null)throw Error(s(60));c.innerHTML=m}}break;case"multiple":c.multiple=y&&typeof y!="function"&&typeof y!="symbol";break;case"muted":c.muted=y&&typeof y!="function"&&typeof y!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(y==null||typeof y=="function"||typeof y=="boolean"||typeof y=="symbol"){c.removeAttribute("xlink:href");break}m=wd(""+y),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",m);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":y!=null&&typeof y!="function"&&typeof y!="symbol"?c.setAttribute(m,""+y):c.removeAttribute(m);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":y&&typeof y!="function"&&typeof y!="symbol"?c.setAttribute(m,""):c.removeAttribute(m);break;case"capture":case"download":y===!0?c.setAttribute(m,""):y!==!1&&y!=null&&typeof y!="function"&&typeof y!="symbol"?c.setAttribute(m,y):c.removeAttribute(m);break;case"cols":case"rows":case"size":case"span":y!=null&&typeof y!="function"&&typeof y!="symbol"&&!isNaN(y)&&1<=y?c.setAttribute(m,y):c.removeAttribute(m);break;case"rowSpan":case"start":y==null||typeof y=="function"||typeof y=="symbol"||isNaN(y)?c.removeAttribute(m):c.setAttribute(m,y);break;case"popover":At("beforetoggle",c),At("toggle",c),yd(c,"popover",y);break;case"xlinkActuate":cs(c,"http://www.w3.org/1999/xlink","xlink:actuate",y);break;case"xlinkArcrole":cs(c,"http://www.w3.org/1999/xlink","xlink:arcrole",y);break;case"xlinkRole":cs(c,"http://www.w3.org/1999/xlink","xlink:role",y);break;case"xlinkShow":cs(c,"http://www.w3.org/1999/xlink","xlink:show",y);break;case"xlinkTitle":cs(c,"http://www.w3.org/1999/xlink","xlink:title",y);break;case"xlinkType":cs(c,"http://www.w3.org/1999/xlink","xlink:type",y);break;case"xmlBase":cs(c,"http://www.w3.org/XML/1998/namespace","xml:base",y);break;case"xmlLang":cs(c,"http://www.w3.org/XML/1998/namespace","xml:lang",y);break;case"xmlSpace":cs(c,"http://www.w3.org/XML/1998/namespace","xml:space",y);break;case"is":yd(c,"is",y);break;case"innerText":case"textContent":break;default:(!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(m=n0.get(m)||m,yd(c,m,y))}}function b_(c,d,m,y,E,I){switch(m){case"style":jp(c,y,I);break;case"dangerouslySetInnerHTML":if(y!=null){if(typeof y!="object"||!("__html"in y))throw Error(s(61));if(m=y.__html,m!=null){if(E.children!=null)throw Error(s(60));c.innerHTML=m}}break;case"children":typeof y=="string"?qr(c,y):(typeof y=="number"||typeof y=="bigint")&&qr(c,""+y);break;case"onScroll":y!=null&&At("scroll",c);break;case"onScrollEnd":y!=null&&At("scrollend",c);break;case"onClick":y!=null&&(c.onclick=lo);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Hp.hasOwnProperty(m))e:{if(m[0]==="o"&&m[1]==="n"&&(E=m.endsWith("Capture"),d=m.slice(2,E?m.length-7:void 0),I=c[Ms]||null,I=I!=null?I[m]:null,typeof I=="function"&&c.removeEventListener(d,I,E),typeof y=="function")){typeof I!="function"&&I!==null&&(m in c?c[m]=null:c.hasAttribute(m)&&c.removeAttribute(m)),c.addEventListener(d,y,E);break e}m in c?c[m]=y:y===!0?c.setAttribute(m,""):yd(c,m,y)}}}function Zs(c,d,m){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":At("error",c),At("load",c);var y=!1,E=!1,I;for(I in m)if(m.hasOwnProperty(I)){var L=m[I];if(L!=null)switch(I){case"src":y=!0;break;case"srcSet":E=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,d));default:gn(c,d,I,L,m,null)}}E&&gn(c,d,"srcSet",m.srcSet,m,null),y&&gn(c,d,"src",m.src,m,null);return;case"input":At("invalid",c);var G=I=L=E=null,ee=null,ye=null;for(y in m)if(m.hasOwnProperty(y)){var Ce=m[y];if(Ce!=null)switch(y){case"name":E=Ce;break;case"type":L=Ce;break;case"checked":ee=Ce;break;case"defaultChecked":ye=Ce;break;case"value":I=Ce;break;case"defaultValue":G=Ce;break;case"children":case"dangerouslySetInnerHTML":if(Ce!=null)throw Error(s(137,d));break;default:gn(c,d,y,Ce,m,null)}}Zb(c,I,G,ee,ye,L,E,!1);return;case"select":At("invalid",c),y=L=I=null;for(E in m)if(m.hasOwnProperty(E)&&(G=m[E],G!=null))switch(E){case"value":I=G;break;case"defaultValue":L=G;break;case"multiple":y=G;default:gn(c,d,E,G,m,null)}d=I,m=L,c.multiple=!!y,d!=null?Hl(c,!!y,d,!1):m!=null&&Hl(c,!!y,m,!0);return;case"textarea":At("invalid",c),I=E=y=null;for(L in m)if(m.hasOwnProperty(L)&&(G=m[L],G!=null))switch(L){case"value":y=G;break;case"defaultValue":E=G;break;case"children":I=G;break;case"dangerouslySetInnerHTML":if(G!=null)throw Error(s(91));break;default:gn(c,d,L,G,m,null)}ql(c,y,E,I);return;case"option":for(ee in m)if(m.hasOwnProperty(ee)&&(y=m[ee],y!=null))switch(ee){case"selected":c.selected=y&&typeof y!="function"&&typeof y!="symbol";break;default:gn(c,d,ee,y,m,null)}return;case"dialog":At("beforetoggle",c),At("toggle",c),At("cancel",c),At("close",c);break;case"iframe":case"object":At("load",c);break;case"video":case"audio":for(y=0;y<$m.length;y++)At($m[y],c);break;case"image":At("error",c),At("load",c);break;case"details":At("toggle",c);break;case"embed":case"source":case"link":At("error",c),At("load",c);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ye in m)if(m.hasOwnProperty(ye)&&(y=m[ye],y!=null))switch(ye){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,d));default:gn(c,d,ye,y,m,null)}return;default:if(vd(d)){for(Ce in m)m.hasOwnProperty(Ce)&&(y=m[Ce],y!==void 0&&b_(c,d,Ce,y,m,void 0));return}}for(G in m)m.hasOwnProperty(G)&&(y=m[G],y!=null&&gn(c,d,G,y,m,null))}function FJ(c,d,m,y){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var E=null,I=null,L=null,G=null,ee=null,ye=null,Ce=null;for(Se in m){var $e=m[Se];if(m.hasOwnProperty(Se)&&$e!=null)switch(Se){case"checked":break;case"value":break;case"defaultValue":ee=$e;default:y.hasOwnProperty(Se)||gn(c,d,Se,null,y,$e)}}for(var ve in y){var Se=y[ve];if($e=m[ve],y.hasOwnProperty(ve)&&(Se!=null||$e!=null))switch(ve){case"type":I=Se;break;case"name":E=Se;break;case"checked":ye=Se;break;case"defaultChecked":Ce=Se;break;case"value":L=Se;break;case"defaultValue":G=Se;break;case"children":case"dangerouslySetInnerHTML":if(Se!=null)throw Error(s(137,d));break;default:Se!==$e&&gn(c,d,ve,Se,y,$e)}}bd(c,L,G,ee,ye,Ce,I,E);return;case"select":Se=L=G=ve=null;for(I in m)if(ee=m[I],m.hasOwnProperty(I)&&ee!=null)switch(I){case"value":break;case"multiple":Se=ee;default:y.hasOwnProperty(I)||gn(c,d,I,null,y,ee)}for(E in y)if(I=y[E],ee=m[E],y.hasOwnProperty(E)&&(I!=null||ee!=null))switch(E){case"value":ve=I;break;case"defaultValue":G=I;break;case"multiple":L=I;default:I!==ee&&gn(c,d,E,I,y,ee)}d=G,m=L,y=Se,ve!=null?Hl(c,!!m,ve,!1):!!y!=!!m&&(d!=null?Hl(c,!!m,d,!0):Hl(c,!!m,m?[]:"",!1));return;case"textarea":Se=ve=null;for(G in m)if(E=m[G],m.hasOwnProperty(G)&&E!=null&&!y.hasOwnProperty(G))switch(G){case"value":break;case"children":break;default:gn(c,d,G,null,y,E)}for(L in y)if(E=y[L],I=m[L],y.hasOwnProperty(L)&&(E!=null||I!=null))switch(L){case"value":ve=E;break;case"defaultValue":Se=E;break;case"children":break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(s(91));break;default:E!==I&&gn(c,d,L,E,y,I)}e0(c,ve,Se);return;case"option":for(var Xe in m)if(ve=m[Xe],m.hasOwnProperty(Xe)&&ve!=null&&!y.hasOwnProperty(Xe))switch(Xe){case"selected":c.selected=!1;break;default:gn(c,d,Xe,null,y,ve)}for(ee in y)if(ve=y[ee],Se=m[ee],y.hasOwnProperty(ee)&&ve!==Se&&(ve!=null||Se!=null))switch(ee){case"selected":c.selected=ve&&typeof ve!="function"&&typeof ve!="symbol";break;default:gn(c,d,ee,ve,y,Se)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var st in m)ve=m[st],m.hasOwnProperty(st)&&ve!=null&&!y.hasOwnProperty(st)&&gn(c,d,st,null,y,ve);for(ye in y)if(ve=y[ye],Se=m[ye],y.hasOwnProperty(ye)&&ve!==Se&&(ve!=null||Se!=null))switch(ye){case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(s(137,d));break;default:gn(c,d,ye,ve,y,Se)}return;default:if(vd(d)){for(var yn in m)ve=m[yn],m.hasOwnProperty(yn)&&ve!==void 0&&!y.hasOwnProperty(yn)&&b_(c,d,yn,void 0,y,ve);for(Ce in y)ve=y[Ce],Se=m[Ce],!y.hasOwnProperty(Ce)||ve===Se||ve===void 0&&Se===void 0||b_(c,d,Ce,ve,y,Se);return}}for(var de in m)ve=m[de],m.hasOwnProperty(de)&&ve!=null&&!y.hasOwnProperty(de)&&gn(c,d,de,null,y,ve);for($e in y)ve=y[$e],Se=m[$e],!y.hasOwnProperty($e)||ve===Se||ve==null&&Se==null||gn(c,d,$e,ve,y,Se)}function gM(c){switch(c){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function LJ(){if(typeof performance.getEntriesByType=="function"){for(var c=0,d=0,m=performance.getEntriesByType("resource"),y=0;y<m.length;y++){var E=m[y],I=E.transferSize,L=E.initiatorType,G=E.duration;if(I&&G&&gM(L)){for(L=0,G=E.responseEnd,y+=1;y<m.length;y++){var ee=m[y],ye=ee.startTime;if(ye>G)break;var Ce=ee.transferSize,$e=ee.initiatorType;Ce&&gM($e)&&(ee=ee.responseEnd,L+=Ce*(ee<G?1:(G-ye)/(ee-ye)))}if(--y,d+=8*(I+L)/(E.duration/1e3),c++,10<c)break}}if(0<c)return d/c/1e6}return navigator.connection&&(c=navigator.connection.downlink,typeof c=="number")?c:5}var v_=null,w_=null;function s1(c){return c.nodeType===9?c:c.ownerDocument}function yM(c){switch(c){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function bM(c,d){if(c===0)switch(d){case"svg":return 1;case"math":return 2;default:return 0}return c===1&&d==="foreignObject"?0:c}function T_(c,d){return c==="textarea"||c==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.children=="bigint"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var x_=null;function VJ(){var c=window.event;return c&&c.type==="popstate"?c===x_?!1:(x_=c,!0):(x_=null,!1)}var vM=typeof setTimeout=="function"?setTimeout:void 0,BJ=typeof clearTimeout=="function"?clearTimeout:void 0,wM=typeof Promise=="function"?Promise:void 0,UJ=typeof queueMicrotask=="function"?queueMicrotask:typeof wM<"u"?function(c){return wM.resolve(null).then(c).catch(zJ)}:vM;function zJ(c){setTimeout(function(){throw c})}function pu(c){return c==="head"}function TM(c,d){var m=d,y=0;do{var E=m.nextSibling;if(c.removeChild(m),E&&E.nodeType===8)if(m=E.data,m==="/$"||m==="/&"){if(y===0){c.removeChild(E),ef(d);return}y--}else if(m==="$"||m==="$?"||m==="$~"||m==="$!"||m==="&")y++;else if(m==="html")Dm(c.ownerDocument.documentElement);else if(m==="head"){m=c.ownerDocument.head,Dm(m);for(var I=m.firstChild;I;){var L=I.nextSibling,G=I.nodeName;I[qo]||G==="SCRIPT"||G==="STYLE"||G==="LINK"&&I.rel.toLowerCase()==="stylesheet"||m.removeChild(I),I=L}}else m==="body"&&Dm(c.ownerDocument.body);m=E}while(m);ef(d)}function xM(c,d){var m=c;c=0;do{var y=m.nextSibling;if(m.nodeType===1?d?(m._stashedDisplay=m.style.display,m.style.display="none"):(m.style.display=m._stashedDisplay||"",m.getAttribute("style")===""&&m.removeAttribute("style")):m.nodeType===3&&(d?(m._stashedText=m.nodeValue,m.nodeValue=""):m.nodeValue=m._stashedText||""),y&&y.nodeType===8)if(m=y.data,m==="/$"){if(c===0)break;c--}else m!=="$"&&m!=="$?"&&m!=="$~"&&m!=="$!"||c++;m=y}while(m)}function S_(c){var d=c.firstChild;for(d&&d.nodeType===10&&(d=d.nextSibling);d;){var m=d;switch(d=d.nextSibling,m.nodeName){case"HTML":case"HEAD":case"BODY":S_(m),gd(m);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(m.rel.toLowerCase()==="stylesheet")continue}c.removeChild(m)}}function GJ(c,d,m,y){for(;c.nodeType===1;){var E=m;if(c.nodeName.toLowerCase()!==d.toLowerCase()){if(!y&&(c.nodeName!=="INPUT"||c.type!=="hidden"))break}else if(y){if(!c[qo])switch(d){case"meta":if(!c.hasAttribute("itemprop"))break;return c;case"link":if(I=c.getAttribute("rel"),I==="stylesheet"&&c.hasAttribute("data-precedence"))break;if(I!==E.rel||c.getAttribute("href")!==(E.href==null||E.href===""?null:E.href)||c.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin)||c.getAttribute("title")!==(E.title==null?null:E.title))break;return c;case"style":if(c.hasAttribute("data-precedence"))break;return c;case"script":if(I=c.getAttribute("src"),(I!==(E.src==null?null:E.src)||c.getAttribute("type")!==(E.type==null?null:E.type)||c.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin))&&I&&c.hasAttribute("async")&&!c.hasAttribute("itemprop"))break;return c;default:return c}}else if(d==="input"&&c.type==="hidden"){var I=E.name==null?null:""+E.name;if(E.type==="hidden"&&c.getAttribute("name")===I)return c}else return c;if(c=Bi(c.nextSibling),c===null)break}return null}function HJ(c,d,m){if(d==="")return null;for(;c.nodeType!==3;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!m||(c=Bi(c.nextSibling),c===null))return null;return c}function SM(c,d){for(;c.nodeType!==8;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!d||(c=Bi(c.nextSibling),c===null))return null;return c}function __(c){return c.data==="$?"||c.data==="$~"}function E_(c){return c.data==="$!"||c.data==="$?"&&c.ownerDocument.readyState!=="loading"}function qJ(c,d){var m=c.ownerDocument;if(c.data==="$~")c._reactRetry=d;else if(c.data!=="$?"||m.readyState!=="loading")d();else{var y=function(){d(),m.removeEventListener("DOMContentLoaded",y)};m.addEventListener("DOMContentLoaded",y),c._reactRetry=y}}function Bi(c){for(;c!=null;c=c.nextSibling){var d=c.nodeType;if(d===1||d===3)break;if(d===8){if(d=c.data,d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"||d==="F!"||d==="F")break;if(d==="/$"||d==="/&")return null}}return c}var I_=null;function _M(c){c=c.nextSibling;for(var d=0;c;){if(c.nodeType===8){var m=c.data;if(m==="/$"||m==="/&"){if(d===0)return Bi(c.nextSibling);d--}else m!=="$"&&m!=="$!"&&m!=="$?"&&m!=="$~"&&m!=="&"||d++}c=c.nextSibling}return null}function EM(c){c=c.previousSibling;for(var d=0;c;){if(c.nodeType===8){var m=c.data;if(m==="$"||m==="$!"||m==="$?"||m==="$~"||m==="&"){if(d===0)return c;d--}else m!=="/$"&&m!=="/&"||d++}c=c.previousSibling}return null}function IM(c,d,m){switch(d=s1(m),c){case"html":if(c=d.documentElement,!c)throw Error(s(452));return c;case"head":if(c=d.head,!c)throw Error(s(453));return c;case"body":if(c=d.body,!c)throw Error(s(454));return c;default:throw Error(s(451))}}function Dm(c){for(var d=c.attributes;d.length;)c.removeAttributeNode(d[0]);gd(c)}var Ui=new Map,CM=new Set;function r1(c){return typeof c.getRootNode=="function"?c.getRootNode():c.nodeType===9?c:c.ownerDocument}var rl=Q.d;Q.d={f:WJ,r:KJ,D:XJ,C:YJ,L:JJ,m:jJ,X:ZJ,S:QJ,M:ej};function WJ(){var c=rl.f(),d=Y0();return c||d}function KJ(c){var d=ki(c);d!==null&&d.tag===5&&d.type==="form"?HR(d):rl.r(c)}var jd=typeof document>"u"?null:document;function NM(c,d,m){var y=jd;if(y&&typeof d=="string"&&d){var E=Hr(d);E='link[rel="'+c+'"][href="'+E+'"]',typeof m=="string"&&(E+='[crossorigin="'+m+'"]'),CM.has(E)||(CM.add(E),c={rel:c,crossOrigin:m,href:d},y.querySelector(E)===null&&(d=y.createElement("link"),Zs(d,"link",c),us(d),y.head.appendChild(d)))}}function XJ(c){rl.D(c),NM("dns-prefetch",c,null)}function YJ(c,d){rl.C(c,d),NM("preconnect",c,d)}function JJ(c,d,m){rl.L(c,d,m);var y=jd;if(y&&c&&d){var E='link[rel="preload"][as="'+Hr(d)+'"]';d==="image"&&m&&m.imageSrcSet?(E+='[imagesrcset="'+Hr(m.imageSrcSet)+'"]',typeof m.imageSizes=="string"&&(E+='[imagesizes="'+Hr(m.imageSizes)+'"]')):E+='[href="'+Hr(c)+'"]';var I=E;switch(d){case"style":I=Qd(c);break;case"script":I=Zd(c)}Ui.has(I)||(c=f({rel:"preload",href:d==="image"&&m&&m.imageSrcSet?void 0:c,as:d},m),Ui.set(I,c),y.querySelector(E)!==null||d==="style"&&y.querySelector(Mm(I))||d==="script"&&y.querySelector(Om(I))||(d=y.createElement("link"),Zs(d,"link",c),us(d),y.head.appendChild(d)))}}function jJ(c,d){rl.m(c,d);var m=jd;if(m&&c){var y=d&&typeof d.as=="string"?d.as:"script",E='link[rel="modulepreload"][as="'+Hr(y)+'"][href="'+Hr(c)+'"]',I=E;switch(y){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":I=Zd(c)}if(!Ui.has(I)&&(c=f({rel:"modulepreload",href:c},d),Ui.set(I,c),m.querySelector(E)===null)){switch(y){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(m.querySelector(Om(I)))return}y=m.createElement("link"),Zs(y,"link",c),us(y),m.head.appendChild(y)}}}function QJ(c,d,m){rl.S(c,d,m);var y=jd;if(y&&c){var E=Ko(y).hoistableStyles,I=Qd(c);d=d||"default";var L=E.get(I);if(!L){var G={loading:0,preload:null};if(L=y.querySelector(Mm(I)))G.loading=5;else{c=f({rel:"stylesheet",href:c,"data-precedence":d},m),(m=Ui.get(I))&&C_(c,m);var ee=L=y.createElement("link");us(ee),Zs(ee,"link",c),ee._p=new Promise(function(ye,Ce){ee.onload=ye,ee.onerror=Ce}),ee.addEventListener("load",function(){G.loading|=1}),ee.addEventListener("error",function(){G.loading|=2}),G.loading|=4,i1(L,d,y)}L={type:"stylesheet",instance:L,count:1,state:G},E.set(I,L)}}}function ZJ(c,d){rl.X(c,d);var m=jd;if(m&&c){var y=Ko(m).hoistableScripts,E=Zd(c),I=y.get(E);I||(I=m.querySelector(Om(E)),I||(c=f({src:c,async:!0},d),(d=Ui.get(E))&&N_(c,d),I=m.createElement("script"),us(I),Zs(I,"link",c),m.head.appendChild(I)),I={type:"script",instance:I,count:1,state:null},y.set(E,I))}}function ej(c,d){rl.M(c,d);var m=jd;if(m&&c){var y=Ko(m).hoistableScripts,E=Zd(c),I=y.get(E);I||(I=m.querySelector(Om(E)),I||(c=f({src:c,async:!0,type:"module"},d),(d=Ui.get(E))&&N_(c,d),I=m.createElement("script"),us(I),Zs(I,"link",c),m.head.appendChild(I)),I={type:"script",instance:I,count:1,state:null},y.set(E,I))}}function AM(c,d,m,y){var E=(E=Re.current)?r1(E):null;if(!E)throw Error(s(446));switch(c){case"meta":case"title":return null;case"style":return typeof m.precedence=="string"&&typeof m.href=="string"?(d=Qd(m.href),m=Ko(E).hoistableStyles,y=m.get(d),y||(y={type:"style",instance:null,count:0,state:null},m.set(d,y)),y):{type:"void",instance:null,count:0,state:null};case"link":if(m.rel==="stylesheet"&&typeof m.href=="string"&&typeof m.precedence=="string"){c=Qd(m.href);var I=Ko(E).hoistableStyles,L=I.get(c);if(L||(E=E.ownerDocument||E,L={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},I.set(c,L),(I=E.querySelector(Mm(c)))&&!I._p&&(L.instance=I,L.state.loading=5),Ui.has(c)||(m={rel:"preload",as:"style",href:m.href,crossOrigin:m.crossOrigin,integrity:m.integrity,media:m.media,hrefLang:m.hrefLang,referrerPolicy:m.referrerPolicy},Ui.set(c,m),I||tj(E,c,m,L.state))),d&&y===null)throw Error(s(528,""));return L}if(d&&y!==null)throw Error(s(529,""));return null;case"script":return d=m.async,m=m.src,typeof m=="string"&&d&&typeof d!="function"&&typeof d!="symbol"?(d=Zd(m),m=Ko(E).hoistableScripts,y=m.get(d),y||(y={type:"script",instance:null,count:0,state:null},m.set(d,y)),y):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,c))}}function Qd(c){return'href="'+Hr(c)+'"'}function Mm(c){return'link[rel="stylesheet"]['+c+"]"}function kM(c){return f({},c,{"data-precedence":c.precedence,precedence:null})}function tj(c,d,m,y){c.querySelector('link[rel="preload"][as="style"]['+d+"]")?y.loading=1:(d=c.createElement("link"),y.preload=d,d.addEventListener("load",function(){return y.loading|=1}),d.addEventListener("error",function(){return y.loading|=2}),Zs(d,"link",m),us(d),c.head.appendChild(d))}function Zd(c){return'[src="'+Hr(c)+'"]'}function Om(c){return"script[async]"+c}function $M(c,d,m){if(d.count++,d.instance===null)switch(d.type){case"style":var y=c.querySelector('style[data-href~="'+Hr(m.href)+'"]');if(y)return d.instance=y,us(y),y;var E=f({},m,{"data-href":m.href,"data-precedence":m.precedence,href:null,precedence:null});return y=(c.ownerDocument||c).createElement("style"),us(y),Zs(y,"style",E),i1(y,m.precedence,c),d.instance=y;case"stylesheet":E=Qd(m.href);var I=c.querySelector(Mm(E));if(I)return d.state.loading|=4,d.instance=I,us(I),I;y=kM(m),(E=Ui.get(E))&&C_(y,E),I=(c.ownerDocument||c).createElement("link"),us(I);var L=I;return L._p=new Promise(function(G,ee){L.onload=G,L.onerror=ee}),Zs(I,"link",y),d.state.loading|=4,i1(I,m.precedence,c),d.instance=I;case"script":return I=Zd(m.src),(E=c.querySelector(Om(I)))?(d.instance=E,us(E),E):(y=m,(E=Ui.get(I))&&(y=f({},m),N_(y,E)),c=c.ownerDocument||c,E=c.createElement("script"),us(E),Zs(E,"link",y),c.head.appendChild(E),d.instance=E);case"void":return null;default:throw Error(s(443,d.type))}else d.type==="stylesheet"&&(d.state.loading&4)===0&&(y=d.instance,d.state.loading|=4,i1(y,m.precedence,c));return d.instance}function i1(c,d,m){for(var y=m.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),E=y.length?y[y.length-1]:null,I=E,L=0;L<y.length;L++){var G=y[L];if(G.dataset.precedence===d)I=G;else if(I!==E)break}I?I.parentNode.insertBefore(c,I.nextSibling):(d=m.nodeType===9?m.head:m,d.insertBefore(c,d.firstChild))}function C_(c,d){c.crossOrigin==null&&(c.crossOrigin=d.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=d.referrerPolicy),c.title==null&&(c.title=d.title)}function N_(c,d){c.crossOrigin==null&&(c.crossOrigin=d.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=d.referrerPolicy),c.integrity==null&&(c.integrity=d.integrity)}var o1=null;function RM(c,d,m){if(o1===null){var y=new Map,E=o1=new Map;E.set(m,y)}else E=o1,y=E.get(m),y||(y=new Map,E.set(m,y));if(y.has(c))return y;for(y.set(c,null),m=m.getElementsByTagName(c),E=0;E<m.length;E++){var I=m[E];if(!(I[qo]||I[ls]||c==="link"&&I.getAttribute("rel")==="stylesheet")&&I.namespaceURI!=="http://www.w3.org/2000/svg"){var L=I.getAttribute(d)||"";L=c+L;var G=y.get(L);G?G.push(I):y.set(L,[I])}}return y}function DM(c,d,m){c=c.ownerDocument||c,c.head.insertBefore(m,d==="title"?c.querySelector("head > title"):null)}function nj(c,d,m){if(m===1||d.itemProp!=null)return!1;switch(c){case"meta":case"title":return!0;case"style":if(typeof d.precedence!="string"||typeof d.href!="string"||d.href==="")break;return!0;case"link":if(typeof d.rel!="string"||typeof d.href!="string"||d.href===""||d.onLoad||d.onError)break;switch(d.rel){case"stylesheet":return c=d.disabled,typeof d.precedence=="string"&&c==null;default:return!0}case"script":if(d.async&&typeof d.async!="function"&&typeof d.async!="symbol"&&!d.onLoad&&!d.onError&&d.src&&typeof d.src=="string")return!0}return!1}function MM(c){return!(c.type==="stylesheet"&&(c.state.loading&3)===0)}function sj(c,d,m,y){if(m.type==="stylesheet"&&(typeof y.media!="string"||matchMedia(y.media).matches!==!1)&&(m.state.loading&4)===0){if(m.instance===null){var E=Qd(y.href),I=d.querySelector(Mm(E));if(I){d=I._p,d!==null&&typeof d=="object"&&typeof d.then=="function"&&(c.count++,c=a1.bind(c),d.then(c,c)),m.state.loading|=4,m.instance=I,us(I);return}I=d.ownerDocument||d,y=kM(y),(E=Ui.get(E))&&C_(y,E),I=I.createElement("link"),us(I);var L=I;L._p=new Promise(function(G,ee){L.onload=G,L.onerror=ee}),Zs(I,"link",y),m.instance=I}c.stylesheets===null&&(c.stylesheets=new Map),c.stylesheets.set(m,d),(d=m.state.preload)&&(m.state.loading&3)===0&&(c.count++,m=a1.bind(c),d.addEventListener("load",m),d.addEventListener("error",m))}}var A_=0;function rj(c,d){return c.stylesheets&&c.count===0&&u1(c,c.stylesheets),0<c.count||0<c.imgCount?function(m){var y=setTimeout(function(){if(c.stylesheets&&u1(c,c.stylesheets),c.unsuspend){var I=c.unsuspend;c.unsuspend=null,I()}},6e4+d);0<c.imgBytes&&A_===0&&(A_=62500*LJ());var E=setTimeout(function(){if(c.waitingForImages=!1,c.count===0&&(c.stylesheets&&u1(c,c.stylesheets),c.unsuspend)){var I=c.unsuspend;c.unsuspend=null,I()}},(c.imgBytes>A_?50:800)+d);return c.unsuspend=m,function(){c.unsuspend=null,clearTimeout(y),clearTimeout(E)}}:null}function a1(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)u1(this,this.stylesheets);else if(this.unsuspend){var c=this.unsuspend;this.unsuspend=null,c()}}}var l1=null;function u1(c,d){c.stylesheets=null,c.unsuspend!==null&&(c.count++,l1=new Map,d.forEach(ij,c),l1=null,a1.call(c))}function ij(c,d){if(!(d.state.loading&4)){var m=l1.get(c);if(m)var y=m.get(null);else{m=new Map,l1.set(c,m);for(var E=c.querySelectorAll("link[data-precedence],style[data-precedence]"),I=0;I<E.length;I++){var L=E[I];(L.nodeName==="LINK"||L.getAttribute("media")!=="not all")&&(m.set(L.dataset.precedence,L),y=L)}y&&m.set(null,y)}E=d.instance,L=E.getAttribute("data-precedence"),I=m.get(L)||y,I===y&&m.set(null,E),m.set(L,E),this.count++,y=a1.bind(this),E.addEventListener("load",y),E.addEventListener("error",y),I?I.parentNode.insertBefore(E,I.nextSibling):(c=c.nodeType===9?c.head:c,c.insertBefore(E,c.firstChild)),d.state.loading|=4}}var Pm={$$typeof:N,Provider:null,Consumer:null,_currentValue:re,_currentValue2:re,_threadCount:0};function oj(c,d,m,y,E,I,L,G,ee){this.tag=1,this.containerInfo=c,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Go(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Go(0),this.hiddenUpdates=Go(null),this.identifierPrefix=y,this.onUncaughtError=E,this.onCaughtError=I,this.onRecoverableError=L,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ee,this.incompleteTransitions=new Map}function OM(c,d,m,y,E,I,L,G,ee,ye,Ce,$e){return c=new oj(c,d,m,L,ee,ye,Ce,$e,G),d=1,I===!0&&(d|=24),I=pi(3,null,null,d),c.current=I,I.stateNode=c,d=lS(),d.refCount++,c.pooledCache=d,d.refCount++,I.memoizedState={element:y,isDehydrated:m,cache:d},dS(I),c}function PM(c){return c?(c=kd,c):kd}function FM(c,d,m,y,E,I){E=PM(E),y.context===null?y.context=E:y.pendingContext=E,y=su(d),y.payload={element:m},I=I===void 0?null:I,I!==null&&(y.callback=I),m=ru(c,y,d),m!==null&&(Jr(m,c,d),pm(m,c,d))}function LM(c,d){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var m=c.retryLane;c.retryLane=m!==0&&m<d?m:d}}function k_(c,d){LM(c,d),(c=c.alternate)&&LM(c,d)}function VM(c){if(c.tag===13||c.tag===31){var d=Kc(c,67108864);d!==null&&Jr(d,c,67108864),k_(c,67108864)}}function BM(c){if(c.tag===13||c.tag===31){var d=vi();d=Oc(d);var m=Kc(c,d);m!==null&&Jr(m,c,d),k_(c,d)}}var c1=!0;function aj(c,d,m,y){var E=X.T;X.T=null;var I=Q.p;try{Q.p=2,$_(c,d,m,y)}finally{Q.p=I,X.T=E}}function lj(c,d,m,y){var E=X.T;X.T=null;var I=Q.p;try{Q.p=8,$_(c,d,m,y)}finally{Q.p=I,X.T=E}}function $_(c,d,m,y){if(c1){var E=R_(y);if(E===null)y_(c,d,y,h1,m),zM(c,y);else if(cj(E,c,d,m,y))y.stopPropagation();else if(zM(c,y),d&4&&-1<uj.indexOf(c)){for(;E!==null;){var I=ki(E);if(I!==null)switch(I.tag){case 3:if(I=I.stateNode,I.current.memoizedState.isDehydrated){var L=Uo(I.pendingLanes);if(L!==0){var G=I;for(G.pendingLanes|=2,G.entangledLanes|=2;L;){var ee=1<<31-Qn(L);G.entanglements[1]|=ee,L&=~ee}oa(I),(en&6)===0&&(K0=wn()+500,km(0))}}break;case 31:case 13:G=Kc(I,2),G!==null&&Jr(G,I,2),Y0(),k_(I,2)}if(I=R_(y),I===null&&y_(c,d,y,h1,m),I===E)break;E=I}E!==null&&y.stopPropagation()}else y_(c,d,y,null,m)}}function R_(c){return c=$i(c),D_(c)}var h1=null;function D_(c){if(h1=null,c=Wo(c),c!==null){var d=i(c);if(d===null)c=null;else{var m=d.tag;if(m===13){if(c=o(d),c!==null)return c;c=null}else if(m===31){if(c=a(d),c!==null)return c;c=null}else if(m===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;c=null}else d!==c&&(c=null)}}return h1=c,null}function UM(c){switch(c){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ks()){case Ur:return 2;case zr:return 8;case Xs:case Va:return 32;case Ul:return 268435456;default:return 32}default:return 32}}var M_=!1,mu=null,gu=null,yu=null,Fm=new Map,Lm=new Map,bu=[],uj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function zM(c,d){switch(c){case"focusin":case"focusout":mu=null;break;case"dragenter":case"dragleave":gu=null;break;case"mouseover":case"mouseout":yu=null;break;case"pointerover":case"pointerout":Fm.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lm.delete(d.pointerId)}}function Vm(c,d,m,y,E,I){return c===null||c.nativeEvent!==I?(c={blockedOn:d,domEventName:m,eventSystemFlags:y,nativeEvent:I,targetContainers:[E]},d!==null&&(d=ki(d),d!==null&&VM(d)),c):(c.eventSystemFlags|=y,d=c.targetContainers,E!==null&&d.indexOf(E)===-1&&d.push(E),c)}function cj(c,d,m,y,E){switch(d){case"focusin":return mu=Vm(mu,c,d,m,y,E),!0;case"dragenter":return gu=Vm(gu,c,d,m,y,E),!0;case"mouseover":return yu=Vm(yu,c,d,m,y,E),!0;case"pointerover":var I=E.pointerId;return Fm.set(I,Vm(Fm.get(I)||null,c,d,m,y,E)),!0;case"gotpointercapture":return I=E.pointerId,Lm.set(I,Vm(Lm.get(I)||null,c,d,m,y,E)),!0}return!1}function GM(c){var d=Wo(c.target);if(d!==null){var m=i(d);if(m!==null){if(d=m.tag,d===13){if(d=o(m),d!==null){c.blockedOn=d,oo(c.priority,function(){BM(m)});return}}else if(d===31){if(d=a(m),d!==null){c.blockedOn=d,oo(c.priority,function(){BM(m)});return}}else if(d===3&&m.stateNode.current.memoizedState.isDehydrated){c.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}c.blockedOn=null}function d1(c){if(c.blockedOn!==null)return!1;for(var d=c.targetContainers;0<d.length;){var m=R_(c.nativeEvent);if(m===null){m=c.nativeEvent;var y=new m.constructor(m.type,m);Qp=y,m.target.dispatchEvent(y),Qp=null}else return d=ki(m),d!==null&&VM(d),c.blockedOn=m,!1;d.shift()}return!0}function HM(c,d,m){d1(c)&&m.delete(d)}function hj(){M_=!1,mu!==null&&d1(mu)&&(mu=null),gu!==null&&d1(gu)&&(gu=null),yu!==null&&d1(yu)&&(yu=null),Fm.forEach(HM),Lm.forEach(HM)}function f1(c,d){c.blockedOn===d&&(c.blockedOn=null,M_||(M_=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,hj)))}var p1=null;function qM(c){p1!==c&&(p1=c,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){p1===c&&(p1=null);for(var d=0;d<c.length;d+=3){var m=c[d],y=c[d+1],E=c[d+2];if(typeof y!="function"){if(D_(y||m)===null)continue;break}var I=ki(m);I!==null&&(c.splice(d,3),d-=3,RS(I,{pending:!0,data:E,method:m.method,action:y},y,E))}}))}function ef(c){function d(ee){return f1(ee,c)}mu!==null&&f1(mu,c),gu!==null&&f1(gu,c),yu!==null&&f1(yu,c),Fm.forEach(d),Lm.forEach(d);for(var m=0;m<bu.length;m++){var y=bu[m];y.blockedOn===c&&(y.blockedOn=null)}for(;0<bu.length&&(m=bu[0],m.blockedOn===null);)GM(m),m.blockedOn===null&&bu.shift();if(m=(c.ownerDocument||c).$$reactFormReplay,m!=null)for(y=0;y<m.length;y+=3){var E=m[y],I=m[y+1],L=E[Ms]||null;if(typeof I=="function")L||qM(m);else if(L){var G=null;if(I&&I.hasAttribute("formAction")){if(E=I,L=I[Ms]||null)G=L.formAction;else if(D_(E)!==null)continue}else G=L.action;typeof G=="function"?m[y+1]=G:(m.splice(y,3),y-=3),qM(m)}}}function WM(){function c(I){I.canIntercept&&I.info==="react-transition"&&I.intercept({handler:function(){return new Promise(function(L){return E=L})},focusReset:"manual",scroll:"manual"})}function d(){E!==null&&(E(),E=null),y||setTimeout(m,20)}function m(){if(!y&&!navigation.transition){var I=navigation.currentEntry;I&&I.url!=null&&navigation.navigate(I.url,{state:I.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var y=!1,E=null;return navigation.addEventListener("navigate",c),navigation.addEventListener("navigatesuccess",d),navigation.addEventListener("navigateerror",d),setTimeout(m,100),function(){y=!0,navigation.removeEventListener("navigate",c),navigation.removeEventListener("navigatesuccess",d),navigation.removeEventListener("navigateerror",d),E!==null&&(E(),E=null)}}}function O_(c){this._internalRoot=c}m1.prototype.render=O_.prototype.render=function(c){var d=this._internalRoot;if(d===null)throw Error(s(409));var m=d.current,y=vi();FM(m,y,c,d,null,null)},m1.prototype.unmount=O_.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var d=c.containerInfo;FM(c.current,2,null,c,null,null),Y0(),d[Ho]=null}};function m1(c){this._internalRoot=c}m1.prototype.unstable_scheduleHydration=function(c){if(c){var d=Yb();c={blockedOn:null,target:c,priority:d};for(var m=0;m<bu.length&&d!==0&&d<bu[m].priority;m++);bu.splice(m,0,c),m===0&&GM(c)}};var KM=e.version;if(KM!=="19.2.1")throw Error(s(527,KM,"19.2.1"));Q.findDOMNode=function(c){var d=c._reactInternals;if(d===void 0)throw typeof c.render=="function"?Error(s(188)):(c=Object.keys(c).join(","),Error(s(268,c)));return c=u(d),c=c!==null?h(c):null,c=c===null?null:c.stateNode,c};var dj={bundleType:0,version:"19.2.1",rendererPackageName:"react-dom",currentDispatcherRef:X,reconcilerVersion:"19.2.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var g1=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!g1.isDisabled&&g1.supportsFiber)try{ur=g1.inject(dj),Es=g1}catch{}}return Um.createRoot=function(c,d){if(!r(c))throw Error(s(299));var m=!1,y="",E=eD,I=tD,L=nD;return d!=null&&(d.unstable_strictMode===!0&&(m=!0),d.identifierPrefix!==void 0&&(y=d.identifierPrefix),d.onUncaughtError!==void 0&&(E=d.onUncaughtError),d.onCaughtError!==void 0&&(I=d.onCaughtError),d.onRecoverableError!==void 0&&(L=d.onRecoverableError)),d=OM(c,1,!1,null,null,m,y,null,E,I,L,WM),c[Ho]=d.current,g_(c),new O_(d)},Um.hydrateRoot=function(c,d,m){if(!r(c))throw Error(s(299));var y=!1,E="",I=eD,L=tD,G=nD,ee=null;return m!=null&&(m.unstable_strictMode===!0&&(y=!0),m.identifierPrefix!==void 0&&(E=m.identifierPrefix),m.onUncaughtError!==void 0&&(I=m.onUncaughtError),m.onCaughtError!==void 0&&(L=m.onCaughtError),m.onRecoverableError!==void 0&&(G=m.onRecoverableError),m.formState!==void 0&&(ee=m.formState)),d=OM(c,1,!0,d,m??null,y,E,ee,I,L,G,WM),d.context=PM(null),m=d.current,y=vi(),y=Oc(y),E=su(y),E.callback=null,ru(m,E,y),m=y,d.current.lanes=m,Dc(d,m),oa(d),c[Ho]=d.current,g_(c),new m1(d)},Um.version="19.2.1",Um}var sO;function Ej(){if(sO)return L_.exports;sO=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),L_.exports=_j(),L_.exports}var Ij=Ej();const Cj=EC(Ij),Nj=()=>{};var rO={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xV=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},Aj=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const r=n[t++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=n[t++];e[s++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=n[t++],o=n[t++],a=n[t++],l=((r&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[s++]=String.fromCharCode((r&15)<<12|(i&63)<<6|o&63)}}return e.join("")},SV={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){const i=n[r],o=r+1<n.length,a=o?n[r+1]:0,l=r+2<n.length,u=l?n[r+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let p=(a&15)<<2|u>>6,g=u&63;l||(g=64,o||(p=64)),s.push(t[h],t[f],t[p],t[g])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(xV(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Aj(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<n.length;){const i=t[n.charAt(r++)],a=r<n.length?t[n.charAt(r)]:0;++r;const u=r<n.length?t[n.charAt(r)]:64;++r;const f=r<n.length?t[n.charAt(r)]:64;if(++r,i==null||a==null||u==null||f==null)throw new kj;const p=i<<2|a>>4;if(s.push(p),u!==64){const g=a<<4&240|u>>2;if(s.push(g),f!==64){const b=u<<6&192|f;s.push(b)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class kj extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const $j=function(n){const e=xV(n);return SV.encodeByteArray(e,!0)},cv=function(n){return $j(n).replace(/\./g,"")},_V=function(n){try{return SV.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rj(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dj=()=>Rj().__FIREBASE_DEFAULTS__,Mj=()=>{if(typeof process>"u"||typeof rO>"u")return;const n=rO.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Oj=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&_V(n[1]);return e&&JSON.parse(e)},xw=()=>{try{return Nj()||Dj()||Mj()||Oj()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},EV=n=>{var e,t;return(t=(e=xw())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},Pj=n=>{const e=EV(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},IV=()=>{var n;return(n=xw())==null?void 0:n.config},CV=n=>{var e;return(e=xw())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fj{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lp(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function NV(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lj(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",r=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[cv(JSON.stringify(t)),cv(JSON.stringify(o)),""].join(".")}const ag={};function Vj(){const n={prod:[],emulator:[]};for(const e of Object.keys(ag))ag[e]?n.emulator.push(e):n.prod.push(e);return n}function Bj(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let iO=!1;function AV(n,e){if(typeof window>"u"||typeof document>"u"||!lp(window.location.host)||ag[n]===e||ag[n]||iO)return;ag[n]=e;function t(p){return`__firebase__banner__${p}`}const s="__firebase__banner",i=Vj().prod.length>0;function o(){const p=document.getElementById(s);p&&p.remove()}function a(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function l(p,g){p.setAttribute("width","24"),p.setAttribute("id",g),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function u(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{iO=!0,o()},p}function h(p,g){p.setAttribute("id",g),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function f(){const p=Bj(s),g=t("text"),b=document.getElementById(g)||document.createElement("span"),T=t("learnmore"),w=document.getElementById(T)||document.createElement("a"),_=t("preprendIcon"),C=document.getElementById(_)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const N=p.element;a(N),h(w,T);const A=u();l(C,_),N.append(C,b,w,A),document.body.appendChild(N)}i?(b.innerText="Preview backend disconnected.",C.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(C.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,b.innerText="Preview backend running in this workspace."),b.setAttribute("id",g)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Uj(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Sr())}function zj(){var e;const n=(e=xw())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Gj(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Hj(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function qj(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Wj(){const n=Sr();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Kj(){return!zj()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Xj(){try{return typeof indexedDB=="object"}catch{return!1}}function Yj(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var i;e(((i=r.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jj="FirebaseError";class kl extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=Jj,Object.setPrototypeOf(this,kl.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ny.prototype.create)}}class ny{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],o=i?jj(i,s):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new kl(r,a,s)}}function jj(n,e){return n.replace(Qj,(t,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const Qj=/\{\$([^}]+)}/g;function Zj(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ah(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const r of t){if(!s.includes(r))return!1;const i=n[r],o=e[r];if(oO(i)&&oO(o)){if(!Ah(i,o))return!1}else if(i!==o)return!1}for(const r of s)if(!t.includes(r))return!1;return!0}function oO(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sy(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function eQ(n,e){const t=new tQ(n,e);return t.subscribe.bind(t)}class tQ{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let r;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");nQ(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:s},r.next===void 0&&(r.next=z_),r.error===void 0&&(r.error=z_),r.complete===void 0&&(r.complete=z_);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function nQ(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function z_(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Or(n){return n&&n._delegate?n._delegate:n}class kh{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uh="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sQ{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new Fj;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(iQ(e))try{this.getOrInitializeService({instanceIdentifier:uh})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:r});s.resolve(i)}catch{}}}}clearInstance(e=uh){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=uh){return this.instances.has(e)}getOptions(e=uh){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);s===a&&o.resolve(r)}return r}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(s)??new Set;r.add(e),this.onInitCallbacks.set(s,r);const i=this.instances.get(s);return i&&e(i,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:rQ(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=uh){return this.component?this.component.multipleInstances?e:uh:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function rQ(n){return n===uh?void 0:n}function iQ(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oQ{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new sQ(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Rt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Rt||(Rt={}));const aQ={debug:Rt.DEBUG,verbose:Rt.VERBOSE,info:Rt.INFO,warn:Rt.WARN,error:Rt.ERROR,silent:Rt.SILENT},lQ=Rt.INFO,uQ={[Rt.DEBUG]:"log",[Rt.VERBOSE]:"log",[Rt.INFO]:"info",[Rt.WARN]:"warn",[Rt.ERROR]:"error"},cQ=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),r=uQ[e];if(r)console[r](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let CC=class{constructor(e){this.name=e,this._logLevel=lQ,this._logHandler=cQ,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Rt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?aQ[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Rt.DEBUG,...e),this._logHandler(this,Rt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Rt.VERBOSE,...e),this._logHandler(this,Rt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Rt.INFO,...e),this._logHandler(this,Rt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Rt.WARN,...e),this._logHandler(this,Rt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Rt.ERROR,...e),this._logHandler(this,Rt.ERROR,...e)}};const hQ=(n,e)=>e.some(t=>n instanceof t);let aO,lO;function dQ(){return aO||(aO=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fQ(){return lO||(lO=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const kV=new WeakMap,NE=new WeakMap,$V=new WeakMap,G_=new WeakMap,NC=new WeakMap;function pQ(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Pu(n.result)),r()},o=()=>{s(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&kV.set(t,n)}).catch(()=>{}),NC.set(e,n),e}function mQ(n){if(NE.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});NE.set(n,e)}let AE={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return NE.get(n);if(e==="objectStoreNames")return n.objectStoreNames||$V.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Pu(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function gQ(n){AE=n(AE)}function yQ(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(H_(this),e,...t);return $V.set(s,e.sort?e.sort():[e]),Pu(s)}:fQ().includes(n)?function(...e){return n.apply(H_(this),e),Pu(kV.get(this))}:function(...e){return Pu(n.apply(H_(this),e))}}function bQ(n){return typeof n=="function"?yQ(n):(n instanceof IDBTransaction&&mQ(n),hQ(n,dQ())?new Proxy(n,AE):n)}function Pu(n){if(n instanceof IDBRequest)return pQ(n);if(G_.has(n))return G_.get(n);const e=bQ(n);return e!==n&&(G_.set(n,e),NC.set(e,n)),e}const H_=n=>NC.get(n);function vQ(n,e,{blocked:t,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(n,e),a=Pu(o);return s&&o.addEventListener("upgradeneeded",l=>{s(Pu(o.result),l.oldVersion,l.newVersion,Pu(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),r&&l.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const wQ=["get","getKey","getAll","getAllKeys","count"],TQ=["put","add","delete","clear"],q_=new Map;function uO(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(q_.get(e))return q_.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=TQ.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||wQ.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,r?"readwrite":"readonly");let u=l.store;return s&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),r&&l.done]))[0]};return q_.set(e,i),i}gQ(n=>({...n,get:(e,t,s)=>uO(e,t)||n.get(e,t,s),has:(e,t)=>!!uO(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xQ{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(SQ(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function SQ(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const kE="@firebase/app",cO="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bl=new CC("@firebase/app"),_Q="@firebase/app-compat",EQ="@firebase/analytics-compat",IQ="@firebase/analytics",CQ="@firebase/app-check-compat",NQ="@firebase/app-check",AQ="@firebase/auth",kQ="@firebase/auth-compat",$Q="@firebase/database",RQ="@firebase/data-connect",DQ="@firebase/database-compat",MQ="@firebase/functions",OQ="@firebase/functions-compat",PQ="@firebase/installations",FQ="@firebase/installations-compat",LQ="@firebase/messaging",VQ="@firebase/messaging-compat",BQ="@firebase/performance",UQ="@firebase/performance-compat",zQ="@firebase/remote-config",GQ="@firebase/remote-config-compat",HQ="@firebase/storage",qQ="@firebase/storage-compat",WQ="@firebase/firestore",KQ="@firebase/ai",XQ="@firebase/firestore-compat",YQ="firebase",JQ="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $E="[DEFAULT]",jQ={[kE]:"fire-core",[_Q]:"fire-core-compat",[IQ]:"fire-analytics",[EQ]:"fire-analytics-compat",[NQ]:"fire-app-check",[CQ]:"fire-app-check-compat",[AQ]:"fire-auth",[kQ]:"fire-auth-compat",[$Q]:"fire-rtdb",[RQ]:"fire-data-connect",[DQ]:"fire-rtdb-compat",[MQ]:"fire-fn",[OQ]:"fire-fn-compat",[PQ]:"fire-iid",[FQ]:"fire-iid-compat",[LQ]:"fire-fcm",[VQ]:"fire-fcm-compat",[BQ]:"fire-perf",[UQ]:"fire-perf-compat",[zQ]:"fire-rc",[GQ]:"fire-rc-compat",[HQ]:"fire-gcs",[qQ]:"fire-gcs-compat",[WQ]:"fire-fst",[XQ]:"fire-fst-compat",[KQ]:"fire-vertex","fire-js":"fire-js",[YQ]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hv=new Map,QQ=new Map,RE=new Map;function hO(n,e){try{n.container.addComponent(e)}catch(t){bl.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Of(n){const e=n.name;if(RE.has(e))return bl.debug(`There were multiple attempts to register component ${e}.`),!1;RE.set(e,n);for(const t of hv.values())hO(t,n);for(const t of QQ.values())hO(t,n);return!0}function AC(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function _o(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZQ={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Fu=new ny("app","Firebase",ZQ);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eZ{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new kh("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Fu.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const up=JQ;function RV(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:$E,automaticDataCollectionEnabled:!0,...e},r=s.name;if(typeof r!="string"||!r)throw Fu.create("bad-app-name",{appName:String(r)});if(t||(t=IV()),!t)throw Fu.create("no-options");const i=hv.get(r);if(i){if(Ah(t,i.options)&&Ah(s,i.config))return i;throw Fu.create("duplicate-app",{appName:r})}const o=new oQ(r);for(const l of RE.values())o.addComponent(l);const a=new eZ(t,s,o);return hv.set(r,a),a}function DV(n=$E){const e=hv.get(n);if(!e&&n===$E&&IV())return RV();if(!e)throw Fu.create("no-app",{appName:n});return e}function Lu(n,e,t){let s=jQ[n]??n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),i=e.match(/\s|\//);if(r||i){const o=[`Unable to register library "${s}" with version "${e}":`];r&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),bl.warn(o.join(" "));return}Of(new kh(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tZ="firebase-heartbeat-database",nZ=1,vg="firebase-heartbeat-store";let W_=null;function MV(){return W_||(W_=vQ(tZ,nZ,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(vg)}catch(t){console.warn(t)}}}}).catch(n=>{throw Fu.create("idb-open",{originalErrorMessage:n.message})})),W_}async function sZ(n){try{const t=(await MV()).transaction(vg),s=await t.objectStore(vg).get(OV(n));return await t.done,s}catch(e){if(e instanceof kl)bl.warn(e.message);else{const t=Fu.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});bl.warn(t.message)}}}async function dO(n,e){try{const s=(await MV()).transaction(vg,"readwrite");await s.objectStore(vg).put(e,OV(n)),await s.done}catch(t){if(t instanceof kl)bl.warn(t.message);else{const s=Fu.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});bl.warn(s.message)}}}function OV(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rZ=1024,iZ=30;class oZ{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new lZ(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,t;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=fO();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:r}),this._heartbeatsCache.heartbeats.length>iZ){const o=uZ(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(s){bl.warn(s)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=fO(),{heartbeatsToSend:s,unsentEntries:r}=aZ(this._heartbeatsCache.heartbeats),i=cv(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return bl.warn(t),""}}}function fO(){return new Date().toISOString().substring(0,10)}function aZ(n,e=rZ){const t=[];let s=n.slice();for(const r of n){const i=t.find(o=>o.agent===r.agent);if(i){if(i.dates.push(r.date),pO(t)>e){i.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),pO(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class lZ{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Xj()?Yj().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await sZ(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return dO(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return dO(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function pO(n){return cv(JSON.stringify({version:2,heartbeats:n})).length}function uZ(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cZ(n){Of(new kh("platform-logger",e=>new xQ(e),"PRIVATE")),Of(new kh("heartbeat",e=>new oZ(e),"PRIVATE")),Lu(kE,cO,n),Lu(kE,cO,"esm2020"),Lu("fire-js","")}cZ("");var hZ="firebase",dZ="12.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Lu(hZ,dZ,"app");var mO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Vu,PV;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(D,M){function $(){}$.prototype=M.prototype,D.F=M.prototype,D.prototype=new $,D.prototype.constructor=D,D.D=function(O,k,z){for(var U=Array(arguments.length-2),te=2;te<arguments.length;te++)U[te-2]=arguments[te];return M.prototype[k].apply(O,U)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(s,t),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(D,M,$){$||($=0);const O=Array(16);if(typeof M=="string")for(var k=0;k<16;++k)O[k]=M.charCodeAt($++)|M.charCodeAt($++)<<8|M.charCodeAt($++)<<16|M.charCodeAt($++)<<24;else for(k=0;k<16;++k)O[k]=M[$++]|M[$++]<<8|M[$++]<<16|M[$++]<<24;M=D.g[0],$=D.g[1],k=D.g[2];let z=D.g[3],U;U=M+(z^$&(k^z))+O[0]+3614090360&4294967295,M=$+(U<<7&4294967295|U>>>25),U=z+(k^M&($^k))+O[1]+3905402710&4294967295,z=M+(U<<12&4294967295|U>>>20),U=k+($^z&(M^$))+O[2]+606105819&4294967295,k=z+(U<<17&4294967295|U>>>15),U=$+(M^k&(z^M))+O[3]+3250441966&4294967295,$=k+(U<<22&4294967295|U>>>10),U=M+(z^$&(k^z))+O[4]+4118548399&4294967295,M=$+(U<<7&4294967295|U>>>25),U=z+(k^M&($^k))+O[5]+1200080426&4294967295,z=M+(U<<12&4294967295|U>>>20),U=k+($^z&(M^$))+O[6]+2821735955&4294967295,k=z+(U<<17&4294967295|U>>>15),U=$+(M^k&(z^M))+O[7]+4249261313&4294967295,$=k+(U<<22&4294967295|U>>>10),U=M+(z^$&(k^z))+O[8]+1770035416&4294967295,M=$+(U<<7&4294967295|U>>>25),U=z+(k^M&($^k))+O[9]+2336552879&4294967295,z=M+(U<<12&4294967295|U>>>20),U=k+($^z&(M^$))+O[10]+4294925233&4294967295,k=z+(U<<17&4294967295|U>>>15),U=$+(M^k&(z^M))+O[11]+2304563134&4294967295,$=k+(U<<22&4294967295|U>>>10),U=M+(z^$&(k^z))+O[12]+1804603682&4294967295,M=$+(U<<7&4294967295|U>>>25),U=z+(k^M&($^k))+O[13]+4254626195&4294967295,z=M+(U<<12&4294967295|U>>>20),U=k+($^z&(M^$))+O[14]+2792965006&4294967295,k=z+(U<<17&4294967295|U>>>15),U=$+(M^k&(z^M))+O[15]+1236535329&4294967295,$=k+(U<<22&4294967295|U>>>10),U=M+(k^z&($^k))+O[1]+4129170786&4294967295,M=$+(U<<5&4294967295|U>>>27),U=z+($^k&(M^$))+O[6]+3225465664&4294967295,z=M+(U<<9&4294967295|U>>>23),U=k+(M^$&(z^M))+O[11]+643717713&4294967295,k=z+(U<<14&4294967295|U>>>18),U=$+(z^M&(k^z))+O[0]+3921069994&4294967295,$=k+(U<<20&4294967295|U>>>12),U=M+(k^z&($^k))+O[5]+3593408605&4294967295,M=$+(U<<5&4294967295|U>>>27),U=z+($^k&(M^$))+O[10]+38016083&4294967295,z=M+(U<<9&4294967295|U>>>23),U=k+(M^$&(z^M))+O[15]+3634488961&4294967295,k=z+(U<<14&4294967295|U>>>18),U=$+(z^M&(k^z))+O[4]+3889429448&4294967295,$=k+(U<<20&4294967295|U>>>12),U=M+(k^z&($^k))+O[9]+568446438&4294967295,M=$+(U<<5&4294967295|U>>>27),U=z+($^k&(M^$))+O[14]+3275163606&4294967295,z=M+(U<<9&4294967295|U>>>23),U=k+(M^$&(z^M))+O[3]+4107603335&4294967295,k=z+(U<<14&4294967295|U>>>18),U=$+(z^M&(k^z))+O[8]+1163531501&4294967295,$=k+(U<<20&4294967295|U>>>12),U=M+(k^z&($^k))+O[13]+2850285829&4294967295,M=$+(U<<5&4294967295|U>>>27),U=z+($^k&(M^$))+O[2]+4243563512&4294967295,z=M+(U<<9&4294967295|U>>>23),U=k+(M^$&(z^M))+O[7]+1735328473&4294967295,k=z+(U<<14&4294967295|U>>>18),U=$+(z^M&(k^z))+O[12]+2368359562&4294967295,$=k+(U<<20&4294967295|U>>>12),U=M+($^k^z)+O[5]+4294588738&4294967295,M=$+(U<<4&4294967295|U>>>28),U=z+(M^$^k)+O[8]+2272392833&4294967295,z=M+(U<<11&4294967295|U>>>21),U=k+(z^M^$)+O[11]+1839030562&4294967295,k=z+(U<<16&4294967295|U>>>16),U=$+(k^z^M)+O[14]+4259657740&4294967295,$=k+(U<<23&4294967295|U>>>9),U=M+($^k^z)+O[1]+2763975236&4294967295,M=$+(U<<4&4294967295|U>>>28),U=z+(M^$^k)+O[4]+1272893353&4294967295,z=M+(U<<11&4294967295|U>>>21),U=k+(z^M^$)+O[7]+4139469664&4294967295,k=z+(U<<16&4294967295|U>>>16),U=$+(k^z^M)+O[10]+3200236656&4294967295,$=k+(U<<23&4294967295|U>>>9),U=M+($^k^z)+O[13]+681279174&4294967295,M=$+(U<<4&4294967295|U>>>28),U=z+(M^$^k)+O[0]+3936430074&4294967295,z=M+(U<<11&4294967295|U>>>21),U=k+(z^M^$)+O[3]+3572445317&4294967295,k=z+(U<<16&4294967295|U>>>16),U=$+(k^z^M)+O[6]+76029189&4294967295,$=k+(U<<23&4294967295|U>>>9),U=M+($^k^z)+O[9]+3654602809&4294967295,M=$+(U<<4&4294967295|U>>>28),U=z+(M^$^k)+O[12]+3873151461&4294967295,z=M+(U<<11&4294967295|U>>>21),U=k+(z^M^$)+O[15]+530742520&4294967295,k=z+(U<<16&4294967295|U>>>16),U=$+(k^z^M)+O[2]+3299628645&4294967295,$=k+(U<<23&4294967295|U>>>9),U=M+(k^($|~z))+O[0]+4096336452&4294967295,M=$+(U<<6&4294967295|U>>>26),U=z+($^(M|~k))+O[7]+1126891415&4294967295,z=M+(U<<10&4294967295|U>>>22),U=k+(M^(z|~$))+O[14]+2878612391&4294967295,k=z+(U<<15&4294967295|U>>>17),U=$+(z^(k|~M))+O[5]+4237533241&4294967295,$=k+(U<<21&4294967295|U>>>11),U=M+(k^($|~z))+O[12]+1700485571&4294967295,M=$+(U<<6&4294967295|U>>>26),U=z+($^(M|~k))+O[3]+2399980690&4294967295,z=M+(U<<10&4294967295|U>>>22),U=k+(M^(z|~$))+O[10]+4293915773&4294967295,k=z+(U<<15&4294967295|U>>>17),U=$+(z^(k|~M))+O[1]+2240044497&4294967295,$=k+(U<<21&4294967295|U>>>11),U=M+(k^($|~z))+O[8]+1873313359&4294967295,M=$+(U<<6&4294967295|U>>>26),U=z+($^(M|~k))+O[15]+4264355552&4294967295,z=M+(U<<10&4294967295|U>>>22),U=k+(M^(z|~$))+O[6]+2734768916&4294967295,k=z+(U<<15&4294967295|U>>>17),U=$+(z^(k|~M))+O[13]+1309151649&4294967295,$=k+(U<<21&4294967295|U>>>11),U=M+(k^($|~z))+O[4]+4149444226&4294967295,M=$+(U<<6&4294967295|U>>>26),U=z+($^(M|~k))+O[11]+3174756917&4294967295,z=M+(U<<10&4294967295|U>>>22),U=k+(M^(z|~$))+O[2]+718787259&4294967295,k=z+(U<<15&4294967295|U>>>17),U=$+(z^(k|~M))+O[9]+3951481745&4294967295,D.g[0]=D.g[0]+M&4294967295,D.g[1]=D.g[1]+(k+(U<<21&4294967295|U>>>11))&4294967295,D.g[2]=D.g[2]+k&4294967295,D.g[3]=D.g[3]+z&4294967295}s.prototype.v=function(D,M){M===void 0&&(M=D.length);const $=M-this.blockSize,O=this.C;let k=this.h,z=0;for(;z<M;){if(k==0)for(;z<=$;)r(this,D,z),z+=this.blockSize;if(typeof D=="string"){for(;z<M;)if(O[k++]=D.charCodeAt(z++),k==this.blockSize){r(this,O),k=0;break}}else for(;z<M;)if(O[k++]=D[z++],k==this.blockSize){r(this,O),k=0;break}}this.h=k,this.o+=M},s.prototype.A=function(){var D=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);D[0]=128;for(var M=1;M<D.length-8;++M)D[M]=0;M=this.o*8;for(var $=D.length-8;$<D.length;++$)D[$]=M&255,M/=256;for(this.v(D),D=Array(16),M=0,$=0;$<4;++$)for(let O=0;O<32;O+=8)D[M++]=this.g[$]>>>O&255;return D};function i(D,M){var $=a;return Object.prototype.hasOwnProperty.call($,D)?$[D]:$[D]=M(D)}function o(D,M){this.h=M;const $=[];let O=!0;for(let k=D.length-1;k>=0;k--){const z=D[k]|0;O&&z==M||($[k]=z,O=!1)}this.g=$}var a={};function l(D){return-128<=D&&D<128?i(D,function(M){return new o([M|0],M<0?-1:0)}):new o([D|0],D<0?-1:0)}function u(D){if(isNaN(D)||!isFinite(D))return f;if(D<0)return w(u(-D));const M=[];let $=1;for(let O=0;D>=$;O++)M[O]=D/$|0,$*=4294967296;return new o(M,0)}function h(D,M){if(D.length==0)throw Error("number format error: empty string");if(M=M||10,M<2||36<M)throw Error("radix out of range: "+M);if(D.charAt(0)=="-")return w(h(D.substring(1),M));if(D.indexOf("-")>=0)throw Error('number format error: interior "-" character');const $=u(Math.pow(M,8));let O=f;for(let z=0;z<D.length;z+=8){var k=Math.min(8,D.length-z);const U=parseInt(D.substring(z,z+k),M);k<8?(k=u(Math.pow(M,k)),O=O.j(k).add(u(U))):(O=O.j($),O=O.add(u(U)))}return O}var f=l(0),p=l(1),g=l(16777216);n=o.prototype,n.m=function(){if(T(this))return-w(this).m();let D=0,M=1;for(let $=0;$<this.g.length;$++){const O=this.i($);D+=(O>=0?O:4294967296+O)*M,M*=4294967296}return D},n.toString=function(D){if(D=D||10,D<2||36<D)throw Error("radix out of range: "+D);if(b(this))return"0";if(T(this))return"-"+w(this).toString(D);const M=u(Math.pow(D,6));var $=this;let O="";for(;;){const k=A($,M).g;$=_($,k.j(M));let z=(($.g.length>0?$.g[0]:$.h)>>>0).toString(D);if($=k,b($))return z+O;for(;z.length<6;)z="0"+z;O=z+O}},n.i=function(D){return D<0?0:D<this.g.length?this.g[D]:this.h};function b(D){if(D.h!=0)return!1;for(let M=0;M<D.g.length;M++)if(D.g[M]!=0)return!1;return!0}function T(D){return D.h==-1}n.l=function(D){return D=_(this,D),T(D)?-1:b(D)?0:1};function w(D){const M=D.g.length,$=[];for(let O=0;O<M;O++)$[O]=~D.g[O];return new o($,~D.h).add(p)}n.abs=function(){return T(this)?w(this):this},n.add=function(D){const M=Math.max(this.g.length,D.g.length),$=[];let O=0;for(let k=0;k<=M;k++){let z=O+(this.i(k)&65535)+(D.i(k)&65535),U=(z>>>16)+(this.i(k)>>>16)+(D.i(k)>>>16);O=U>>>16,z&=65535,U&=65535,$[k]=U<<16|z}return new o($,$[$.length-1]&-2147483648?-1:0)};function _(D,M){return D.add(w(M))}n.j=function(D){if(b(this)||b(D))return f;if(T(this))return T(D)?w(this).j(w(D)):w(w(this).j(D));if(T(D))return w(this.j(w(D)));if(this.l(g)<0&&D.l(g)<0)return u(this.m()*D.m());const M=this.g.length+D.g.length,$=[];for(var O=0;O<2*M;O++)$[O]=0;for(O=0;O<this.g.length;O++)for(let k=0;k<D.g.length;k++){const z=this.i(O)>>>16,U=this.i(O)&65535,te=D.i(k)>>>16,se=D.i(k)&65535;$[2*O+2*k]+=U*se,C($,2*O+2*k),$[2*O+2*k+1]+=z*se,C($,2*O+2*k+1),$[2*O+2*k+1]+=U*te,C($,2*O+2*k+1),$[2*O+2*k+2]+=z*te,C($,2*O+2*k+2)}for(D=0;D<M;D++)$[D]=$[2*D+1]<<16|$[2*D];for(D=M;D<2*M;D++)$[D]=0;return new o($,0)};function C(D,M){for(;(D[M]&65535)!=D[M];)D[M+1]+=D[M]>>>16,D[M]&=65535,M++}function N(D,M){this.g=D,this.h=M}function A(D,M){if(b(M))throw Error("division by zero");if(b(D))return new N(f,f);if(T(D))return M=A(w(D),M),new N(w(M.g),w(M.h));if(T(M))return M=A(D,w(M)),new N(w(M.g),M.h);if(D.g.length>30){if(T(D)||T(M))throw Error("slowDivide_ only works with positive integers.");for(var $=p,O=M;O.l(D)<=0;)$=P($),O=P(O);var k=V($,1),z=V(O,1);for(O=V(O,2),$=V($,2);!b(O);){var U=z.add(O);U.l(D)<=0&&(k=k.add($),z=U),O=V(O,1),$=V($,1)}return M=_(D,k.j(M)),new N(k,M)}for(k=f;D.l(M)>=0;){for($=Math.max(1,Math.floor(D.m()/M.m())),O=Math.ceil(Math.log($)/Math.LN2),O=O<=48?1:Math.pow(2,O-48),z=u($),U=z.j(M);T(U)||U.l(D)>0;)$-=O,z=u($),U=z.j(M);b(z)&&(z=p),k=k.add(z),D=_(D,U)}return new N(k,D)}n.B=function(D){return A(this,D).h},n.and=function(D){const M=Math.max(this.g.length,D.g.length),$=[];for(let O=0;O<M;O++)$[O]=this.i(O)&D.i(O);return new o($,this.h&D.h)},n.or=function(D){const M=Math.max(this.g.length,D.g.length),$=[];for(let O=0;O<M;O++)$[O]=this.i(O)|D.i(O);return new o($,this.h|D.h)},n.xor=function(D){const M=Math.max(this.g.length,D.g.length),$=[];for(let O=0;O<M;O++)$[O]=this.i(O)^D.i(O);return new o($,this.h^D.h)};function P(D){const M=D.g.length+1,$=[];for(let O=0;O<M;O++)$[O]=D.i(O)<<1|D.i(O-1)>>>31;return new o($,D.h)}function V(D,M){const $=M>>5;M%=32;const O=D.g.length-$,k=[];for(let z=0;z<O;z++)k[z]=M>0?D.i(z+$)>>>M|D.i(z+$+1)<<32-M:D.i(z+$);return new o(k,D.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,PV=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,Vu=o}).apply(typeof mO<"u"?mO:typeof self<"u"?self:typeof window<"u"?window:{});var y1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var FV,Ym,LV,V1,DE,VV,BV,UV;(function(){var n,e=Object.defineProperty;function t(S){S=[typeof globalThis=="object"&&globalThis,S,typeof window=="object"&&window,typeof self=="object"&&self,typeof y1=="object"&&y1];for(var R=0;R<S.length;++R){var B=S[R];if(B&&B.Math==Math)return B}throw Error("Cannot find global object")}var s=t(this);function r(S,R){if(R)e:{var B=s;S=S.split(".");for(var K=0;K<S.length-1;K++){var pe=S[K];if(!(pe in B))break e;B=B[pe]}S=S[S.length-1],K=B[S],R=R(K),R!=K&&R!=null&&e(B,S,{configurable:!0,writable:!0,value:R})}}r("Symbol.dispose",function(S){return S||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(S){return S||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(S){return S||function(R){var B=[],K;for(K in R)Object.prototype.hasOwnProperty.call(R,K)&&B.push([K,R[K]]);return B}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var i=i||{},o=this||self;function a(S){var R=typeof S;return R=="object"&&S!=null||R=="function"}function l(S,R,B){return S.call.apply(S.bind,arguments)}function u(S,R,B){return u=l,u.apply(null,arguments)}function h(S,R){var B=Array.prototype.slice.call(arguments,1);return function(){var K=B.slice();return K.push.apply(K,arguments),S.apply(this,K)}}function f(S,R){function B(){}B.prototype=R.prototype,S.Z=R.prototype,S.prototype=new B,S.prototype.constructor=S,S.Ob=function(K,pe,xe){for(var Le=Array(arguments.length-2),gt=2;gt<arguments.length;gt++)Le[gt-2]=arguments[gt];return R.prototype[pe].apply(K,Le)}}var p=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?S=>S&&AsyncContext.Snapshot.wrap(S):S=>S;function g(S){const R=S.length;if(R>0){const B=Array(R);for(let K=0;K<R;K++)B[K]=S[K];return B}return[]}function b(S,R){for(let K=1;K<arguments.length;K++){const pe=arguments[K];var B=typeof pe;if(B=B!="object"?B:pe?Array.isArray(pe)?"array":B:"null",B=="array"||B=="object"&&typeof pe.length=="number"){B=S.length||0;const xe=pe.length||0;S.length=B+xe;for(let Le=0;Le<xe;Le++)S[B+Le]=pe[Le]}else S.push(pe)}}class T{constructor(R,B){this.i=R,this.j=B,this.h=0,this.g=null}get(){let R;return this.h>0?(this.h--,R=this.g,this.g=R.next,R.next=null):R=this.i(),R}}function w(S){o.setTimeout(()=>{throw S},0)}function _(){var S=D;let R=null;return S.g&&(R=S.g,S.g=S.g.next,S.g||(S.h=null),R.next=null),R}class C{constructor(){this.h=this.g=null}add(R,B){const K=N.get();K.set(R,B),this.h?this.h.next=K:this.g=K,this.h=K}}var N=new T(()=>new A,S=>S.reset());class A{constructor(){this.next=this.g=this.h=null}set(R,B){this.h=R,this.g=B,this.next=null}reset(){this.next=this.g=this.h=null}}let P,V=!1,D=new C,M=()=>{const S=Promise.resolve(void 0);P=()=>{S.then($)}};function $(){for(var S;S=_();){try{S.h.call(S.g)}catch(B){w(B)}var R=N;R.j(S),R.h<100&&(R.h++,S.next=R.g,R.g=S)}V=!1}function O(){this.u=this.u,this.C=this.C}O.prototype.u=!1,O.prototype.dispose=function(){this.u||(this.u=!0,this.N())},O.prototype[Symbol.dispose]=function(){this.dispose()},O.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function k(S,R){this.type=S,this.g=this.target=R,this.defaultPrevented=!1}k.prototype.h=function(){this.defaultPrevented=!0};var z=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var S=!1,R=Object.defineProperty({},"passive",{get:function(){S=!0}});try{const B=()=>{};o.addEventListener("test",B,R),o.removeEventListener("test",B,R)}catch{}return S})();function U(S){return/^[\s\xa0]*$/.test(S)}function te(S,R){k.call(this,S?S.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,S&&this.init(S,R)}f(te,k),te.prototype.init=function(S,R){const B=this.type=S.type,K=S.changedTouches&&S.changedTouches.length?S.changedTouches[0]:null;this.target=S.target||S.srcElement,this.g=R,R=S.relatedTarget,R||(B=="mouseover"?R=S.fromElement:B=="mouseout"&&(R=S.toElement)),this.relatedTarget=R,K?(this.clientX=K.clientX!==void 0?K.clientX:K.pageX,this.clientY=K.clientY!==void 0?K.clientY:K.pageY,this.screenX=K.screenX||0,this.screenY=K.screenY||0):(this.clientX=S.clientX!==void 0?S.clientX:S.pageX,this.clientY=S.clientY!==void 0?S.clientY:S.pageY,this.screenX=S.screenX||0,this.screenY=S.screenY||0),this.button=S.button,this.key=S.key||"",this.ctrlKey=S.ctrlKey,this.altKey=S.altKey,this.shiftKey=S.shiftKey,this.metaKey=S.metaKey,this.pointerId=S.pointerId||0,this.pointerType=S.pointerType,this.state=S.state,this.i=S,S.defaultPrevented&&te.Z.h.call(this)},te.prototype.h=function(){te.Z.h.call(this);const S=this.i;S.preventDefault?S.preventDefault():S.returnValue=!1};var se="closure_listenable_"+(Math.random()*1e6|0),X=0;function Q(S,R,B,K,pe){this.listener=S,this.proxy=null,this.src=R,this.type=B,this.capture=!!K,this.ha=pe,this.key=++X,this.da=this.fa=!1}function re(S){S.da=!0,S.listener=null,S.proxy=null,S.src=null,S.ha=null}function fe(S,R,B){for(const K in S)R.call(B,S[K],K,S)}function be(S,R){for(const B in S)R.call(void 0,S[B],B,S)}function W(S){const R={};for(const B in S)R[B]=S[B];return R}const ne="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ue(S,R){let B,K;for(let pe=1;pe<arguments.length;pe++){K=arguments[pe];for(B in K)S[B]=K[B];for(let xe=0;xe<ne.length;xe++)B=ne[xe],Object.prototype.hasOwnProperty.call(K,B)&&(S[B]=K[B])}}function Te(S){this.src=S,this.g={},this.h=0}Te.prototype.add=function(S,R,B,K,pe){const xe=S.toString();S=this.g[xe],S||(S=this.g[xe]=[],this.h++);const Le=Re(S,R,K,pe);return Le>-1?(R=S[Le],B||(R.fa=!1)):(R=new Q(R,this.src,xe,!!K,pe),R.fa=B,S.push(R)),R};function Ie(S,R){const B=R.type;if(B in S.g){var K=S.g[B],pe=Array.prototype.indexOf.call(K,R,void 0),xe;(xe=pe>=0)&&Array.prototype.splice.call(K,pe,1),xe&&(re(R),S.g[B].length==0&&(delete S.g[B],S.h--))}}function Re(S,R,B,K){for(let pe=0;pe<S.length;++pe){const xe=S[pe];if(!xe.da&&xe.listener==R&&xe.capture==!!B&&xe.ha==K)return pe}return-1}var Fe="closure_lm_"+(Math.random()*1e6|0),We={};function Be(S,R,B,K,pe){if(Array.isArray(R)){for(let xe=0;xe<R.length;xe++)Be(S,R[xe],B,K,pe);return null}return B=Qt(B),S&&S[se]?S.J(R,B,a(K)?!!K.capture:!1,pe):it(S,R,B,!1,K,pe)}function it(S,R,B,K,pe,xe){if(!R)throw Error("Invalid event type");const Le=a(pe)?!!pe.capture:!!pe;let gt=Ct(S);if(gt||(S[Fe]=gt=new Te(S)),B=gt.add(R,B,K,Le,xe),B.proxy)return B;if(K=ct(),B.proxy=K,K.src=S,K.listener=B,S.addEventListener)z||(pe=Le),pe===void 0&&(pe=!1),S.addEventListener(R.toString(),K,pe);else if(S.attachEvent)S.attachEvent(Ut(R.toString()),K);else if(S.addListener&&S.removeListener)S.addListener(K);else throw Error("addEventListener and attachEvent are unavailable.");return B}function ct(){function S(B){return R.call(S.src,S.listener,B)}const R=Ht;return S}function It(S,R,B,K,pe){if(Array.isArray(R))for(var xe=0;xe<R.length;xe++)It(S,R[xe],B,K,pe);else K=a(K)?!!K.capture:!!K,B=Qt(B),S&&S[se]?(S=S.i,xe=String(R).toString(),xe in S.g&&(R=S.g[xe],B=Re(R,B,K,pe),B>-1&&(re(R[B]),Array.prototype.splice.call(R,B,1),R.length==0&&(delete S.g[xe],S.h--)))):S&&(S=Ct(S))&&(R=S.g[R.toString()],S=-1,R&&(S=Re(R,B,K,pe)),(B=S>-1?R[S]:null)&&Bt(B))}function Bt(S){if(typeof S!="number"&&S&&!S.da){var R=S.src;if(R&&R[se])Ie(R.i,S);else{var B=S.type,K=S.proxy;R.removeEventListener?R.removeEventListener(B,K,S.capture):R.detachEvent?R.detachEvent(Ut(B),K):R.addListener&&R.removeListener&&R.removeListener(K),(B=Ct(R))?(Ie(B,S),B.h==0&&(B.src=null,R[Fe]=null)):re(S)}}}function Ut(S){return S in We?We[S]:We[S]="on"+S}function Ht(S,R){if(S.da)S=!0;else{R=new te(R,this);const B=S.listener,K=S.ha||S.src;S.fa&&Bt(S),S=B.call(K,R)}return S}function Ct(S){return S=S[Fe],S instanceof Te?S:null}var nn="__closure_events_fn_"+(Math.random()*1e9>>>0);function Qt(S){return typeof S=="function"?S:(S[nn]||(S[nn]=function(R){return S.handleEvent(R)}),S[nn])}function sn(){O.call(this),this.i=new Te(this),this.M=this,this.G=null}f(sn,O),sn.prototype[se]=!0,sn.prototype.removeEventListener=function(S,R,B,K){It(this,S,R,B,K)};function Et(S,R){var B,K=S.G;if(K)for(B=[];K;K=K.G)B.push(K);if(S=S.M,K=R.type||R,typeof R=="string")R=new k(R,S);else if(R instanceof k)R.target=R.target||S;else{var pe=R;R=new k(K,S),ue(R,pe)}pe=!0;let xe,Le;if(B)for(Le=B.length-1;Le>=0;Le--)xe=R.g=B[Le],pe=qs(xe,K,!0,R)&&pe;if(xe=R.g=S,pe=qs(xe,K,!0,R)&&pe,pe=qs(xe,K,!1,R)&&pe,B)for(Le=0;Le<B.length;Le++)xe=R.g=B[Le],pe=qs(xe,K,!1,R)&&pe}sn.prototype.N=function(){if(sn.Z.N.call(this),this.i){var S=this.i;for(const R in S.g){const B=S.g[R];for(let K=0;K<B.length;K++)re(B[K]);delete S.g[R],S.h--}}this.G=null},sn.prototype.J=function(S,R,B,K){return this.i.add(String(S),R,!1,B,K)},sn.prototype.K=function(S,R,B,K){return this.i.add(String(S),R,!0,B,K)};function qs(S,R,B,K){if(R=S.i.g[String(R)],!R)return!0;R=R.concat();let pe=!0;for(let xe=0;xe<R.length;++xe){const Le=R[xe];if(Le&&!Le.da&&Le.capture==B){const gt=Le.listener,Zn=Le.ha||Le.src;Le.fa&&Ie(S.i,Le),pe=gt.call(Zn,K)!==!1&&pe}}return pe&&!K.defaultPrevented}function Ws(S,R){if(typeof S!="function")if(S&&typeof S.handleEvent=="function")S=u(S.handleEvent,S);else throw Error("Invalid listener argument");return Number(R)>2147483647?-1:o.setTimeout(S,R||0)}function Ai(S){S.g=Ws(()=>{S.g=null,S.i&&(S.i=!1,Ai(S))},S.l);const R=S.h;S.h=null,S.m.apply(null,R)}class wn extends O{constructor(R,B){super(),this.m=R,this.l=B,this.h=null,this.i=!1,this.g=null}j(R){this.h=arguments,this.g?this.i=!0:Ai(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ks(S){O.call(this),this.h=S,this.g={}}f(Ks,O);var Ur=[];function zr(S){fe(S.g,function(R,B){this.g.hasOwnProperty(B)&&Bt(R)},S),S.g={}}Ks.prototype.N=function(){Ks.Z.N.call(this),zr(this)},Ks.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Xs=o.JSON.stringify,Va=o.JSON.parse,Ul=class{stringify(S){return o.JSON.stringify(S,void 0)}parse(S){return o.JSON.parse(S,void 0)}};function zl(){}function fd(){}var ur={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Es(){k.call(this,"d")}f(Es,k);function Gr(){k.call(this,"c")}f(Gr,k);var Qn={},Wb=null;function pd(){return Wb=Wb||new sn}Qn.Ia="serverreachability";function Kb(S){k.call(this,Qn.Ia,S)}f(Kb,k);function Bo(S){const R=pd();Et(R,new Kb(R))}Qn.STAT_EVENT="statevent";function Rc(S,R){k.call(this,Qn.STAT_EVENT,S),this.stat=R}f(Rc,k);function as(S){const R=pd();Et(R,new Rc(R,S))}Qn.Ja="timingevent";function Uo(S,R){k.call(this,Qn.Ja,S),this.size=R}f(Uo,k);function zo(S,R){if(typeof S!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){S()},R)}function io(){this.g=!0}io.prototype.ua=function(){this.g=!1};function Bx(S,R,B,K,pe,xe){S.info(function(){if(S.g)if(xe){var Le="",gt=xe.split("&");for(let Zt=0;Zt<gt.length;Zt++){var Zn=gt[Zt].split("=");if(Zn.length>1){const Fn=Zn[0];Zn=Zn[1];const Di=Fn.split("_");Le=Di.length>=2&&Di[1]=="type"?Le+(Fn+"="+Zn+"&"):Le+(Fn+"=redacted&")}}}else Le=null;else Le=xe;return"XMLHTTP REQ ("+K+") [attempt "+pe+"]: "+R+`
`+B+`
`+Le})}function Xb(S,R,B,K,pe,xe,Le){S.info(function(){return"XMLHTTP RESP ("+K+") [ attempt "+pe+"]: "+R+`
`+B+`
`+xe+" "+Le})}function Go(S,R,B,K){S.info(function(){return"XMLHTTP TEXT ("+R+"): "+Ux(S,B)+(K?" "+K:"")})}function Dc(S,R){S.info(function(){return"TIMEOUT: "+R})}io.prototype.info=function(){};function Ux(S,R){if(!S.g)return R;if(!R)return null;try{const xe=JSON.parse(R);if(xe){for(S=0;S<xe.length;S++)if(Array.isArray(xe[S])){var B=xe[S];if(!(B.length<2)){var K=B[1];if(Array.isArray(K)&&!(K.length<1)){var pe=K[0];if(pe!="noop"&&pe!="stop"&&pe!="close")for(let Le=1;Le<K.length;Le++)K[Le]=""}}}}return Xs(xe)}catch{return R}}var Mc={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Up={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},zp;function Oc(){}f(Oc,zl),Oc.prototype.g=function(){return new XMLHttpRequest},zp=new Oc;function Ba(S){return encodeURIComponent(String(S))}function Yb(S){var R=1;S=S.split(":");const B=[];for(;R>0&&S.length;)B.push(S.shift()),R--;return S.length&&B.push(S.join(":")),B}function oo(S,R,B,K){this.j=S,this.i=R,this.l=B,this.S=K||1,this.V=new Ks(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new ao}function ao(){this.i=null,this.g="",this.h=!1}var ls={},Ms={};function Ho(S,R,B){S.M=1,S.A=Pc(cs(R)),S.u=B,S.R=!0,md(S,null)}function md(S,R){S.F=Date.now(),qo(S),S.B=cs(S.A);var B=S.B,K=S.S;Array.isArray(K)||(K=[String(K)]),vd(B.i,"t",K),S.C=0,B=S.j.L,S.h=new ao,S.g=c0(S.j,B?R:null,!S.u),S.P>0&&(S.O=new wn(u(S.Y,S,S.g),S.P)),R=S.V,B=S.g,K=S.ba;var pe="readystatechange";Array.isArray(pe)||(pe&&(Ur[0]=pe.toString()),pe=Ur);for(let xe=0;xe<pe.length;xe++){const Le=Be(B,pe[xe],K||R.handleEvent,!1,R.h||R);if(!Le)break;R.g[Le.key]=Le}R=S.J?W(S.J):{},S.u?(S.v||(S.v="POST"),R["Content-Type"]="application/x-www-form-urlencoded",S.g.ea(S.B,S.v,S.u,R)):(S.v="GET",S.g.ea(S.B,S.v,null,R)),Bo(),Bx(S.i,S.v,S.B,S.l,S.S,S.u)}oo.prototype.ba=function(S){S=S.target;const R=this.O;R&&co(S)==3?R.j():this.Y(S)},oo.prototype.Y=function(S){try{if(S==this.g)e:{const gt=co(this.g),Zn=this.g.ya(),Zt=this.g.ca();if(!(gt<3)&&(gt!=3||this.g&&(this.h.h||this.g.la()||Ys(this.g)))){this.K||gt!=4||Zn==7||(Zn==8||Zt<=0?Bo(3):Bo(2)),Wo(this);var R=this.g.ca();this.X=R;var B=zx(this);if(this.o=R==200,Xb(this.i,this.v,this.B,this.l,this.S,gt,R),this.o){if(this.U&&!this.L){t:{if(this.g){var K,pe=this.g;if((K=pe.g?pe.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(K)){var xe=K;break t}}xe=null}if(S=xe)Go(this.i,this.l,S,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ko(this,S);else{this.o=!1,this.m=3,as(12),hi(this),ki(this);break e}}if(this.R){S=!0;let Fn;for(;!this.K&&this.C<B.length;)if(Fn=jb(this,B),Fn==Ms){gt==4&&(this.m=4,as(14),S=!1),Go(this.i,this.l,null,"[Incomplete Response]");break}else if(Fn==ls){this.m=4,as(15),Go(this.i,this.l,B,"[Invalid Chunk]"),S=!1;break}else Go(this.i,this.l,Fn,null),Ko(this,Fn);if(Jb(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),gt!=4||B.length!=0||this.h.h||(this.m=1,as(16),S=!1),this.o=this.o&&S,!S)Go(this.i,this.l,B,"[Invalid Chunked Response]"),hi(this),ki(this);else if(B.length>0&&!this.W){this.W=!0;var Le=this.j;Le.g==this&&Le.aa&&!Le.P&&(Le.j.info("Great, no buffering proxy detected. Bytes received: "+B.length),sm(Le),Le.P=!0,as(11))}}else Go(this.i,this.l,B,null),Ko(this,B);gt==4&&hi(this),this.o&&!this.K&&(gt==4?o0(this.j,this):(this.o=!1,qo(this)))}else za(this.g),R==400&&B.indexOf("Unknown SID")>0?(this.m=3,as(12)):(this.m=0,as(13)),hi(this),ki(this)}}}catch{}finally{}};function zx(S){if(!Jb(S))return S.g.la();const R=Ys(S.g);if(R==="")return"";let B="";const K=R.length,pe=co(S.g)==4;if(!S.h.i){if(typeof TextDecoder>"u")return hi(S),ki(S),"";S.h.i=new o.TextDecoder}for(let xe=0;xe<K;xe++)S.h.h=!0,B+=S.h.i.decode(R[xe],{stream:!(pe&&xe==K-1)});return R.length=0,S.h.g+=B,S.C=0,S.h.g}function Jb(S){return S.g?S.v=="GET"&&S.M!=2&&S.j.Aa:!1}function jb(S,R){var B=S.C,K=R.indexOf(`
`,B);return K==-1?Ms:(B=Number(R.substring(B,K)),isNaN(B)?ls:(K+=1,K+B>R.length?Ms:(R=R.slice(K,K+B),S.C=K+B,R)))}oo.prototype.cancel=function(){this.K=!0,hi(this)};function qo(S){S.T=Date.now()+S.H,gd(S,S.H)}function gd(S,R){if(S.D!=null)throw Error("WatchDog timer not null");S.D=zo(u(S.aa,S),R)}function Wo(S){S.D&&(o.clearTimeout(S.D),S.D=null)}oo.prototype.aa=function(){this.D=null;const S=Date.now();S-this.T>=0?(Dc(this.i,this.B),this.M!=2&&(Bo(),as(17)),hi(this),this.m=2,ki(this)):gd(this,this.T-S)};function ki(S){S.j.I==0||S.K||o0(S.j,S)}function hi(S){Wo(S);var R=S.O;R&&typeof R.dispose=="function"&&R.dispose(),S.O=null,zr(S.V),S.g&&(R=S.g,S.g=null,R.abort(),R.dispose())}function Ko(S,R){try{var B=S.j;if(B.I!=0&&(B.g==S||Yo(B.h,S))){if(!S.L&&Yo(B.h,S)&&B.I==3){try{var K=B.Ba.g.parse(R)}catch{K=null}if(Array.isArray(K)&&K.length==3){var pe=K;if(pe[0]==0){e:if(!B.v){if(B.g)if(B.g.F+3e3<S.F)_d(B),Jl(B);else break e;Gc(B),as(18)}}else B.xa=pe[1],0<B.xa-B.K&&pe[2]<37500&&B.F&&B.A==0&&!B.C&&(B.C=zo(u(B.Va,B),6e3));Xo(B.h)<=1&&B.ta&&(B.ta=void 0)}else ta(B,11)}else if((S.L||B.g==S)&&_d(B),!U(R))for(pe=B.Ba.g.parse(R),R=0;R<pe.length;R++){let Zt=pe[R];const Fn=Zt[0];if(!(Fn<=B.K))if(B.K=Fn,Zt=Zt[1],B.I==2)if(Zt[0]=="c"){B.M=Zt[1],B.ba=Zt[2];const Di=Zt[3];Di!=null&&(B.ka=Di,B.j.info("VER="+B.ka));const na=Zt[4];na!=null&&(B.za=na,B.j.info("SVER="+B.za));const ho=Zt[5];ho!=null&&typeof ho=="number"&&ho>0&&(K=1.5*ho,B.O=K,B.j.info("backChannelRequestTimeoutMs_="+K)),K=B;const fo=S.g;if(fo){const Hc=fo.g?fo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Hc){var xe=K.h;xe.g||Hc.indexOf("spdy")==-1&&Hc.indexOf("quic")==-1&&Hc.indexOf("h2")==-1||(xe.j=xe.l,xe.g=new Set,xe.h&&(qp(xe,xe.h),xe.h=null))}if(K.G){const Ed=fo.g?fo.g.getResponseHeader("X-HTTP-Session-Id"):null;Ed&&(K.wa=Ed,ln(K.J,K.G,Ed))}}B.I=3,B.l&&B.l.ra(),B.aa&&(B.T=Date.now()-S.F,B.j.info("Handshake RTT: "+B.T+"ms")),K=B;var Le=S;if(K.na=u0(K,K.L?K.ba:null,K.W),Le.L){Wp(K.h,Le);var gt=Le,Zn=K.O;Zn&&(gt.H=Zn),gt.D&&(Wo(gt),qo(gt)),K.g=Le}else r0(K);B.i.length>0&&ea(B)}else Zt[0]!="stop"&&Zt[0]!="close"||ta(B,7);else B.I==3&&(Zt[0]=="stop"||Zt[0]=="close"?Zt[0]=="stop"?ta(B,7):tm(B):Zt[0]!="noop"&&B.l&&B.l.qa(Zt),B.A=0)}}Bo(4)}catch{}}var us=class{constructor(S,R){this.g=S,this.map=R}};function Gp(S){this.l=S||10,o.PerformanceNavigationTiming?(S=o.performance.getEntriesByType("navigation"),S=S.length>0&&(S[0].nextHopProtocol=="hq"||S[0].nextHopProtocol=="h2")):S=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=S?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Hp(S){return S.h?!0:S.g?S.g.size>=S.j:!1}function Xo(S){return S.h?1:S.g?S.g.size:0}function Yo(S,R){return S.h?S.h==R:S.g?S.g.has(R):!1}function qp(S,R){S.g?S.g.add(R):S.h=R}function Wp(S,R){S.h&&S.h==R?S.h=null:S.g&&S.g.has(R)&&S.g.delete(R)}Gp.prototype.cancel=function(){if(this.i=Kp(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const S of this.g.values())S.cancel();this.g.clear()}};function Kp(S){if(S.h!=null)return S.i.concat(S.h.G);if(S.g!=null&&S.g.size!==0){let R=S.i;for(const B of S.g.values())R=R.concat(B.G);return R}return g(S.i)}var Qb=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function yd(S,R){if(S){S=S.split("&");for(let B=0;B<S.length;B++){const K=S[B].indexOf("=");let pe,xe=null;K>=0?(pe=S[B].substring(0,K),xe=S[B].substring(K+1)):pe=S[B],R(pe,xe?decodeURIComponent(xe.replace(/\+/g," ")):"")}}}function di(S){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let R;S instanceof di?(this.l=S.l,Os(this,S.j),this.o=S.o,this.g=S.g,Gl(this,S.u),this.h=S.h,Xp(this,n0(S.i)),this.m=S.m):S&&(R=String(S).match(Qb))?(this.l=!1,Os(this,R[1]||"",!0),this.o=Jo(R[2]||""),this.g=Jo(R[3]||"",!0),Gl(this,R[4]),this.h=Jo(R[5]||"",!0),Xp(this,R[6]||"",!0),this.m=Jo(R[7]||"")):(this.l=!1,this.i=new ql(null,this.l))}di.prototype.toString=function(){const S=[];var R=this.j;R&&S.push(Fc(R,bd,!0),":");var B=this.g;return(B||R=="file")&&(S.push("//"),(R=this.o)&&S.push(Fc(R,bd,!0),"@"),S.push(Ba(B).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),B=this.u,B!=null&&S.push(":",String(B))),(B=this.h)&&(this.g&&B.charAt(0)!="/"&&S.push("/"),S.push(Fc(B,B.charAt(0)=="/"?Yp:Zb,!0))),(B=this.i.toString())&&S.push("?",B),(B=this.m)&&S.push("#",Fc(B,e0)),S.join("")},di.prototype.resolve=function(S){const R=cs(this);let B=!!S.j;B?Os(R,S.j):B=!!S.o,B?R.o=S.o:B=!!S.g,B?R.g=S.g:B=S.u!=null;var K=S.h;if(B)Gl(R,S.u);else if(B=!!S.h){if(K.charAt(0)!="/")if(this.g&&!this.h)K="/"+K;else{var pe=R.h.lastIndexOf("/");pe!=-1&&(K=R.h.slice(0,pe+1)+K)}if(pe=K,pe==".."||pe==".")K="";else if(pe.indexOf("./")!=-1||pe.indexOf("/.")!=-1){K=pe.lastIndexOf("/",0)==0,pe=pe.split("/");const xe=[];for(let Le=0;Le<pe.length;){const gt=pe[Le++];gt=="."?K&&Le==pe.length&&xe.push(""):gt==".."?((xe.length>1||xe.length==1&&xe[0]!="")&&xe.pop(),K&&Le==pe.length&&xe.push("")):(xe.push(gt),K=!0)}K=xe.join("/")}else K=pe}return B?R.h=K:B=S.i.toString()!=="",B?Xp(R,n0(S.i)):B=!!S.m,B&&(R.m=S.m),R};function cs(S){return new di(S)}function Os(S,R,B){S.j=B?Jo(R,!0):R,S.j&&(S.j=S.j.replace(/:$/,""))}function Gl(S,R){if(R){if(R=Number(R),isNaN(R)||R<0)throw Error("Bad port number "+R);S.u=R}else S.u=null}function Xp(S,R,B){R instanceof ql?(S.i=R,wd(S.i,S.l)):(B||(R=Fc(R,Hl)),S.i=new ql(R,S.l))}function ln(S,R,B){S.i.set(R,B)}function Pc(S){return ln(S,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),S}function Jo(S,R){return S?R?decodeURI(S.replace(/%25/g,"%2525")):decodeURIComponent(S):""}function Fc(S,R,B){return typeof S=="string"?(S=encodeURI(S).replace(R,Hr),B&&(S=S.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),S):null}function Hr(S){return S=S.charCodeAt(0),"%"+(S>>4&15).toString(16)+(S&15).toString(16)}var bd=/[#\/\?@]/g,Zb=/[#\?:]/g,Yp=/[#\?]/g,Hl=/[#\?@]/g,e0=/#/g;function ql(S,R){this.h=this.g=null,this.i=S||null,this.j=!!R}function qr(S){S.g||(S.g=new Map,S.h=0,S.i&&yd(S.i,function(R,B){S.add(decodeURIComponent(R.replace(/\+/g," ")),B)}))}n=ql.prototype,n.add=function(S,R){qr(this),this.i=null,S=Wl(this,S);let B=this.g.get(S);return B||this.g.set(S,B=[]),B.push(R),this.h+=1,this};function t0(S,R){qr(S),R=Wl(S,R),S.g.has(R)&&(S.i=null,S.h-=S.g.get(R).length,S.g.delete(R))}function Jp(S,R){return qr(S),R=Wl(S,R),S.g.has(R)}n.forEach=function(S,R){qr(this),this.g.forEach(function(B,K){B.forEach(function(pe){S.call(R,pe,K,this)},this)},this)};function jp(S,R){qr(S);let B=[];if(typeof R=="string")Jp(S,R)&&(B=B.concat(S.g.get(Wl(S,R))));else for(S=Array.from(S.g.values()),R=0;R<S.length;R++)B=B.concat(S[R]);return B}n.set=function(S,R){return qr(this),this.i=null,S=Wl(this,S),Jp(this,S)&&(this.h-=this.g.get(S).length),this.g.set(S,[R]),this.h+=1,this},n.get=function(S,R){return S?(S=jp(this,S),S.length>0?String(S[0]):R):R};function vd(S,R,B){t0(S,R),B.length>0&&(S.i=null,S.g.set(Wl(S,R),g(B)),S.h+=B.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const S=[],R=Array.from(this.g.keys());for(let K=0;K<R.length;K++){var B=R[K];const pe=Ba(B);B=jp(this,B);for(let xe=0;xe<B.length;xe++){let Le=pe;B[xe]!==""&&(Le+="="+Ba(B[xe])),S.push(Le)}}return this.i=S.join("&")};function n0(S){const R=new ql;return R.i=S.i,S.g&&(R.g=new Map(S.g),R.h=S.h),R}function Wl(S,R){return R=String(R),S.j&&(R=R.toLowerCase()),R}function wd(S,R){R&&!S.j&&(qr(S),S.i=null,S.g.forEach(function(B,K){const pe=K.toLowerCase();K!=pe&&(t0(this,K),vd(this,pe,B))},S)),S.j=R}function lo(S,R){const B=new io;if(o.Image){const K=new Image;K.onload=h($i,B,"TestLoadImage: loaded",!0,R,K),K.onerror=h($i,B,"TestLoadImage: error",!1,R,K),K.onabort=h($i,B,"TestLoadImage: abort",!1,R,K),K.ontimeout=h($i,B,"TestLoadImage: timeout",!1,R,K),o.setTimeout(function(){K.ontimeout&&K.ontimeout()},1e4),K.src=S}else R(!1)}function Qp(S,R){const B=new io,K=new AbortController,pe=setTimeout(()=>{K.abort(),$i(B,"TestPingServer: timeout",!1,R)},1e4);fetch(S,{signal:K.signal}).then(xe=>{clearTimeout(pe),xe.ok?$i(B,"TestPingServer: ok",!0,R):$i(B,"TestPingServer: server error",!1,R)}).catch(()=>{clearTimeout(pe),$i(B,"TestPingServer: error",!1,R)})}function $i(S,R,B,K,pe){try{pe&&(pe.onload=null,pe.onerror=null,pe.onabort=null,pe.ontimeout=null),K(B)}catch{}}function Kl(){this.g=new Ul}function jo(S){this.i=S.Sb||null,this.h=S.ab||!1}f(jo,zl),jo.prototype.g=function(){return new Lc(this.i,this.h)};function Lc(S,R){sn.call(this),this.H=S,this.o=R,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}f(Lc,sn),n=Lc.prototype,n.open=function(S,R){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=S,this.D=R,this.readyState=1,uo(this)},n.send=function(S){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const R={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};S&&(R.body=S),(this.H||o).fetch(new Request(this.D,R)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Xl(this)),this.readyState=0},n.Pa=function(S){if(this.g&&(this.l=S,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=S.headers,this.readyState=2,uo(this)),this.g&&(this.readyState=3,uo(this),this.g)))if(this.responseType==="arraybuffer")S.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in S){if(this.j=S.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Td(this)}else S.text().then(this.Oa.bind(this),this.ga.bind(this))};function Td(S){S.j.read().then(S.Ma.bind(S)).catch(S.ga.bind(S))}n.Ma=function(S){if(this.g){if(this.o&&S.value)this.response.push(S.value);else if(!this.o){var R=S.value?S.value:new Uint8Array(0);(R=this.B.decode(R,{stream:!S.done}))&&(this.response=this.responseText+=R)}S.done?Xl(this):uo(this),this.readyState==3&&Td(this)}},n.Oa=function(S){this.g&&(this.response=this.responseText=S,Xl(this))},n.Na=function(S){this.g&&(this.response=S,Xl(this))},n.ga=function(){this.g&&Xl(this)};function Xl(S){S.readyState=4,S.l=null,S.j=null,S.B=null,uo(S)}n.setRequestHeader=function(S,R){this.A.append(S,R)},n.getResponseHeader=function(S){return this.h&&this.h.get(S.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const S=[],R=this.h.entries();for(var B=R.next();!B.done;)B=B.value,S.push(B[0]+": "+B[1]),B=R.next();return S.join(`\r
`)};function uo(S){S.onreadystatechange&&S.onreadystatechange.call(S)}Object.defineProperty(Lc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(S){this.m=S?"include":"same-origin"}});function Ri(S){let R="";return fe(S,function(B,K){R+=K,R+=":",R+=B,R+=`\r
`}),R}function Vc(S,R,B){e:{for(K in B){var K=!1;break e}K=!0}K||(B=Ri(B),typeof S=="string"?B!=null&&Ba(B):ln(S,R,B))}function pn(S){sn.call(this),this.headers=new Map,this.L=S||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}f(pn,sn);var Qo=/^https?$/i,Zp=["POST","PUT"];n=pn.prototype,n.Fa=function(S){this.H=S},n.ea=function(S,R,B,K){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+S);R=R?R.toUpperCase():"GET",this.D=S,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():zp.g(),this.g.onreadystatechange=p(u(this.Ca,this));try{this.B=!0,this.g.open(R,String(S),!0),this.B=!1}catch(xe){Bc(this,xe);return}if(S=B||"",B=new Map(this.headers),K)if(Object.getPrototypeOf(K)===Object.prototype)for(var pe in K)B.set(pe,K[pe]);else if(typeof K.keys=="function"&&typeof K.get=="function")for(const xe of K.keys())B.set(xe,K.get(xe));else throw Error("Unknown input type for opt_headers: "+String(K));K=Array.from(B.keys()).find(xe=>xe.toLowerCase()=="content-type"),pe=o.FormData&&S instanceof o.FormData,!(Array.prototype.indexOf.call(Zp,R,void 0)>=0)||K||pe||B.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[xe,Le]of B)this.g.setRequestHeader(xe,Le);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(S),this.v=!1}catch(xe){Bc(this,xe)}};function Bc(S,R){S.h=!1,S.g&&(S.j=!0,S.g.abort(),S.j=!1),S.l=R,S.o=5,em(S),Ua(S)}function em(S){S.A||(S.A=!0,Et(S,"complete"),Et(S,"error"))}n.abort=function(S){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=S||7,Et(this,"complete"),Et(this,"abort"),Ua(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ua(this,!0)),pn.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Uc(this):this.Xa())},n.Xa=function(){Uc(this)};function Uc(S){if(S.h&&typeof i<"u"){if(S.v&&co(S)==4)setTimeout(S.Ca.bind(S),0);else if(Et(S,"readystatechange"),co(S)==4){S.h=!1;try{const xe=S.ca();e:switch(xe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var R=!0;break e;default:R=!1}var B;if(!(B=R)){var K;if(K=xe===0){let Le=String(S.D).match(Qb)[1]||null;!Le&&o.self&&o.self.location&&(Le=o.self.location.protocol.slice(0,-1)),K=!Qo.test(Le?Le.toLowerCase():"")}B=K}if(B)Et(S,"complete"),Et(S,"success");else{S.o=6;try{var pe=co(S)>2?S.g.statusText:""}catch{pe=""}S.l=pe+" ["+S.ca()+"]",em(S)}}finally{Ua(S)}}}}function Ua(S,R){if(S.g){S.m&&(clearTimeout(S.m),S.m=null);const B=S.g;S.g=null,R||Et(S,"ready");try{B.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function co(S){return S.g?S.g.readyState:0}n.ca=function(){try{return co(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(S){if(this.g){var R=this.g.responseText;return S&&R.indexOf(S)==0&&(R=R.substring(S.length)),Va(R)}};function Ys(S){try{if(!S.g)return null;if("response"in S.g)return S.g.response;switch(S.F){case"":case"text":return S.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in S.g)return S.g.mozResponseArrayBuffer}return null}catch{return null}}function za(S){const R={};S=(S.g&&co(S)>=2&&S.g.getAllResponseHeaders()||"").split(`\r
`);for(let K=0;K<S.length;K++){if(U(S[K]))continue;var B=Yb(S[K]);const pe=B[0];if(B=B[1],typeof B!="string")continue;B=B.trim();const xe=R[pe]||[];R[pe]=xe,xe.push(B)}be(R,function(K){return K.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Zo(S,R,B){return B&&B.internalChannelParams&&B.internalChannelParams[S]||R}function Yl(S){this.za=0,this.i=[],this.j=new io,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Zo("failFast",!1,S),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Zo("baseRetryDelayMs",5e3,S),this.Za=Zo("retryDelaySeedMs",1e4,S),this.Ta=Zo("forwardChannelMaxRetries",2,S),this.va=Zo("forwardChannelRequestTimeoutMs",2e4,S),this.ma=S&&S.xmlHttpFactory||void 0,this.Ua=S&&S.Rb||void 0,this.Aa=S&&S.useFetchStreams||!1,this.O=void 0,this.L=S&&S.supportsCrossDomainXhr||!1,this.M="",this.h=new Gp(S&&S.concurrentRequestLimit),this.Ba=new Kl,this.S=S&&S.fastHandshake||!1,this.R=S&&S.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=S&&S.Pb||!1,S&&S.ua&&this.j.ua(),S&&S.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&S&&S.detectBufferingProxy||!1,this.ia=void 0,S&&S.longPollingTimeout&&S.longPollingTimeout>0&&(this.ia=S.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Yl.prototype,n.ka=8,n.I=1,n.connect=function(S,R,B,K){as(0),this.W=S,this.H=R||{},B&&K!==void 0&&(this.H.OSID=B,this.H.OAID=K),this.F=this.X,this.J=u0(this,null,this.W),ea(this)};function tm(S){if(xd(S),S.I==3){var R=S.V++,B=cs(S.J);if(ln(B,"SID",S.M),ln(B,"RID",R),ln(B,"TYPE","terminate"),zc(S,B),R=new oo(S,S.j,R),R.M=2,R.A=Pc(cs(B)),B=!1,o.navigator&&o.navigator.sendBeacon)try{B=o.navigator.sendBeacon(R.A.toString(),"")}catch{}!B&&o.Image&&(new Image().src=R.A,B=!0),B||(R.g=c0(R.j,null),R.g.ea(R.A)),R.F=Date.now(),qo(R)}l0(S)}function Jl(S){S.g&&(sm(S),S.g.cancel(),S.g=null)}function xd(S){Jl(S),S.v&&(o.clearTimeout(S.v),S.v=null),_d(S),S.h.cancel(),S.m&&(typeof S.m=="number"&&o.clearTimeout(S.m),S.m=null)}function ea(S){if(!Hp(S.h)&&!S.m){S.m=!0;var R=S.Ea;P||M(),V||(P(),V=!0),D.add(R,S),S.D=0}}function Sd(S,R){return Xo(S.h)>=S.h.j-(S.m?1:0)?!1:S.m?(S.i=R.G.concat(S.i),!0):S.I==1||S.I==2||S.D>=(S.Sa?0:S.Ta)?!1:(S.m=zo(u(S.Ea,S,R),a0(S,S.D)),S.D++,!0)}n.Ea=function(S){if(this.m)if(this.m=null,this.I==1){if(!S){this.V=Math.floor(Math.random()*1e5),S=this.V++;const pe=new oo(this,this.j,S);let xe=this.o;if(this.U&&(xe?(xe=W(xe),ue(xe,this.U)):xe=this.U),this.u!==null||this.R||(pe.J=xe,xe=null),this.S)e:{for(var R=0,B=0;B<this.i.length;B++){t:{var K=this.i[B];if("__data__"in K.map&&(K=K.map.__data__,typeof K=="string")){K=K.length;break t}K=void 0}if(K===void 0)break;if(R+=K,R>4096){R=B;break e}if(R===4096||B===this.i.length-1){R=B+1;break e}}R=1e3}else R=1e3;R=s0(this,pe,R),B=cs(this.J),ln(B,"RID",S),ln(B,"CVER",22),this.G&&ln(B,"X-HTTP-Session-Id",this.G),zc(this,B),xe&&(this.R?R="headers="+Ba(Ri(xe))+"&"+R:this.u&&Vc(B,this.u,xe)),qp(this.h,pe),this.Ra&&ln(B,"TYPE","init"),this.S?(ln(B,"$req",R),ln(B,"SID","null"),pe.U=!0,Ho(pe,B,null)):Ho(pe,B,R),this.I=2}}else this.I==3&&(S?nm(this,S):this.i.length==0||Hp(this.h)||nm(this))};function nm(S,R){var B;R?B=R.l:B=S.V++;const K=cs(S.J);ln(K,"SID",S.M),ln(K,"RID",B),ln(K,"AID",S.K),zc(S,K),S.u&&S.o&&Vc(K,S.u,S.o),B=new oo(S,S.j,B,S.D+1),S.u===null&&(B.J=S.o),R&&(S.i=R.G.concat(S.i)),R=s0(S,B,1e3),B.H=Math.round(S.va*.5)+Math.round(S.va*.5*Math.random()),qp(S.h,B),Ho(B,K,R)}function zc(S,R){S.H&&fe(S.H,function(B,K){ln(R,K,B)}),S.l&&fe({},function(B,K){ln(R,K,B)})}function s0(S,R,B){B=Math.min(S.i.length,B);const K=S.l?u(S.l.Ka,S.l,S):null;e:{var pe=S.i;let gt=-1;for(;;){const Zn=["count="+B];gt==-1?B>0?(gt=pe[0].g,Zn.push("ofs="+gt)):gt=0:Zn.push("ofs="+gt);let Zt=!0;for(let Fn=0;Fn<B;Fn++){var xe=pe[Fn].g;const Di=pe[Fn].map;if(xe-=gt,xe<0)gt=Math.max(0,pe[Fn].g-100),Zt=!1;else try{xe="req"+xe+"_"||"";try{var Le=Di instanceof Map?Di:Object.entries(Di);for(const[na,ho]of Le){let fo=ho;a(ho)&&(fo=Xs(ho)),Zn.push(xe+na+"="+encodeURIComponent(fo))}}catch(na){throw Zn.push(xe+"type="+encodeURIComponent("_badmap")),na}}catch{K&&K(Di)}}if(Zt){Le=Zn.join("&");break e}}Le=void 0}return S=S.i.splice(0,B),R.G=S,Le}function r0(S){if(!S.g&&!S.v){S.Y=1;var R=S.Da;P||M(),V||(P(),V=!0),D.add(R,S),S.A=0}}function Gc(S){return S.g||S.v||S.A>=3?!1:(S.Y++,S.v=zo(u(S.Da,S),a0(S,S.A)),S.A++,!0)}n.Da=function(){if(this.v=null,i0(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var S=4*this.T;this.j.info("BP detection timer enabled: "+S),this.B=zo(u(this.Wa,this),S)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,as(10),Jl(this),i0(this))};function sm(S){S.B!=null&&(o.clearTimeout(S.B),S.B=null)}function i0(S){S.g=new oo(S,S.j,"rpc",S.Y),S.u===null&&(S.g.J=S.o),S.g.P=0;var R=cs(S.na);ln(R,"RID","rpc"),ln(R,"SID",S.M),ln(R,"AID",S.K),ln(R,"CI",S.F?"0":"1"),!S.F&&S.ia&&ln(R,"TO",S.ia),ln(R,"TYPE","xmlhttp"),zc(S,R),S.u&&S.o&&Vc(R,S.u,S.o),S.O&&(S.g.H=S.O);var B=S.g;S=S.ba,B.M=1,B.A=Pc(cs(R)),B.u=null,B.R=!0,md(B,S)}n.Va=function(){this.C!=null&&(this.C=null,Jl(this),Gc(this),as(19))};function _d(S){S.C!=null&&(o.clearTimeout(S.C),S.C=null)}function o0(S,R){var B=null;if(S.g==R){_d(S),sm(S),S.g=null;var K=2}else if(Yo(S.h,R))B=R.G,Wp(S.h,R),K=1;else return;if(S.I!=0){if(R.o)if(K==1){B=R.u?R.u.length:0,R=Date.now()-R.F;var pe=S.D;K=pd(),Et(K,new Uo(K,B)),ea(S)}else r0(S);else if(pe=R.m,pe==3||pe==0&&R.X>0||!(K==1&&Sd(S,R)||K==2&&Gc(S)))switch(B&&B.length>0&&(R=S.h,R.i=R.i.concat(B)),pe){case 1:ta(S,5);break;case 4:ta(S,10);break;case 3:ta(S,6);break;default:ta(S,2)}}}function a0(S,R){let B=S.Qa+Math.floor(Math.random()*S.Za);return S.isActive()||(B*=2),B*R}function ta(S,R){if(S.j.info("Error code "+R),R==2){var B=u(S.bb,S),K=S.Ua;const pe=!K;K=new di(K||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||Os(K,"https"),Pc(K),pe?lo(K.toString(),B):Qp(K.toString(),B)}else as(2);S.I=0,S.l&&S.l.pa(R),l0(S),xd(S)}n.bb=function(S){S?(this.j.info("Successfully pinged google.com"),as(2)):(this.j.info("Failed to ping google.com"),as(1))};function l0(S){if(S.I=0,S.ja=[],S.l){const R=Kp(S.h);(R.length!=0||S.i.length!=0)&&(b(S.ja,R),b(S.ja,S.i),S.h.i.length=0,g(S.i),S.i.length=0),S.l.oa()}}function u0(S,R,B){var K=B instanceof di?cs(B):new di(B);if(K.g!="")R&&(K.g=R+"."+K.g),Gl(K,K.u);else{var pe=o.location;K=pe.protocol,R=R?R+"."+pe.hostname:pe.hostname,pe=+pe.port;const xe=new di(null);K&&Os(xe,K),R&&(xe.g=R),pe&&Gl(xe,pe),B&&(xe.h=B),K=xe}return B=S.G,R=S.wa,B&&R&&ln(K,B,R),ln(K,"VER",S.ka),zc(S,K),K}function c0(S,R,B){if(R&&!S.L)throw Error("Can't create secondary domain capable XhrIo object.");return R=S.Aa&&!S.ma?new pn(new jo({ab:B})):new pn(S.ma),R.Fa(S.L),R}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function h0(){}n=h0.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function jl(){}jl.prototype.g=function(S,R){return new Nr(S,R)};function Nr(S,R){sn.call(this),this.g=new Yl(R),this.l=S,this.h=R&&R.messageUrlParams||null,S=R&&R.messageHeaders||null,R&&R.clientProtocolHeaderRequired&&(S?S["X-Client-Protocol"]="webchannel":S={"X-Client-Protocol":"webchannel"}),this.g.o=S,S=R&&R.initMessageHeaders||null,R&&R.messageContentType&&(S?S["X-WebChannel-Content-Type"]=R.messageContentType:S={"X-WebChannel-Content-Type":R.messageContentType}),R&&R.sa&&(S?S["X-WebChannel-Client-Profile"]=R.sa:S={"X-WebChannel-Client-Profile":R.sa}),this.g.U=S,(S=R&&R.Qb)&&!U(S)&&(this.g.u=S),this.A=R&&R.supportsCrossDomainXhr||!1,this.v=R&&R.sendRawJson||!1,(R=R&&R.httpSessionIdParam)&&!U(R)&&(this.g.G=R,S=this.h,S!==null&&R in S&&(S=this.h,R in S&&delete S[R])),this.j=new Ga(this)}f(Nr,sn),Nr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Nr.prototype.close=function(){tm(this.g)},Nr.prototype.o=function(S){var R=this.g;if(typeof S=="string"){var B={};B.__data__=S,S=B}else this.v&&(B={},B.__data__=Xs(S),S=B);R.i.push(new us(R.Ya++,S)),R.I==3&&ea(R)},Nr.prototype.N=function(){this.g.l=null,delete this.j,tm(this.g),delete this.g,Nr.Z.N.call(this)};function d0(S){Es.call(this),S.__headers__&&(this.headers=S.__headers__,this.statusCode=S.__status__,delete S.__headers__,delete S.__status__);var R=S.__sm__;if(R){e:{for(const B in R){S=B;break e}S=void 0}(this.i=S)&&(S=this.i,R=R!==null&&S in R?R[S]:void 0),this.data=R}else this.data=S}f(d0,Es);function f0(){Gr.call(this),this.status=1}f(f0,Gr);function Ga(S){this.g=S}f(Ga,h0),Ga.prototype.ra=function(){Et(this.g,"a")},Ga.prototype.qa=function(S){Et(this.g,new d0(S))},Ga.prototype.pa=function(S){Et(this.g,new f0)},Ga.prototype.oa=function(){Et(this.g,"b")},jl.prototype.createWebChannel=jl.prototype.g,Nr.prototype.send=Nr.prototype.o,Nr.prototype.open=Nr.prototype.m,Nr.prototype.close=Nr.prototype.close,UV=function(){return new jl},BV=function(){return pd()},VV=Qn,DE={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Mc.NO_ERROR=0,Mc.TIMEOUT=8,Mc.HTTP_ERROR=6,V1=Mc,Up.COMPLETE="complete",LV=Up,fd.EventType=ur,ur.OPEN="a",ur.CLOSE="b",ur.ERROR="c",ur.MESSAGE="d",sn.prototype.listen=sn.prototype.J,Ym=fd,pn.prototype.listenOnce=pn.prototype.K,pn.prototype.getLastError=pn.prototype.Ha,pn.prototype.getLastErrorCode=pn.prototype.ya,pn.prototype.getStatus=pn.prototype.ca,pn.prototype.getResponseJson=pn.prototype.La,pn.prototype.getResponseText=pn.prototype.la,pn.prototype.send=pn.prototype.ea,pn.prototype.setWithCredentials=pn.prototype.Fa,FV=pn}).apply(typeof y1<"u"?y1:typeof self<"u"?self:typeof window<"u"?window:{});const gO="@firebase/firestore",yO="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fr{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}fr.UNAUTHENTICATED=new fr(null),fr.GOOGLE_CREDENTIALS=new fr("google-credentials-uid"),fr.FIRST_PARTY=new fr("first-party-uid"),fr.MOCK_USER=new fr("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cp="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $h=new CC("@firebase/firestore");function rf(){return $h.logLevel}function Ke(n,...e){if($h.logLevel<=Rt.DEBUG){const t=e.map(kC);$h.debug(`Firestore (${cp}): ${n}`,...t)}}function vl(n,...e){if($h.logLevel<=Rt.ERROR){const t=e.map(kC);$h.error(`Firestore (${cp}): ${n}`,...t)}}function Pf(n,...e){if($h.logLevel<=Rt.WARN){const t=e.map(kC);$h.warn(`Firestore (${cp}): ${n}`,...t)}}function kC(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lt(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,zV(n,s,t)}function zV(n,e,t){let s=`FIRESTORE (${cp}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw vl(s),new Error(s)}function on(n,e,t,s){let r="Unexpected state";typeof t=="string"?r=t:s=t,n||zV(e,r,s)}function mt(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ae={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class qe extends kl{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pl{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GV{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class fZ{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(fr.UNAUTHENTICATED)))}shutdown(){}}class pZ{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class mZ{constructor(e){this.t=e,this.currentUser=fr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){on(this.o===void 0,42304);let s=this.i;const r=l=>this.i!==s?(s=this.i,t(l)):Promise.resolve();let i=new pl;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new pl,e.enqueueRetryable((()=>r(this.currentUser)))};const o=()=>{const l=i;e.enqueueRetryable((async()=>{await l.promise,await r(this.currentUser)}))},a=l=>{Ke("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((l=>a(l))),setTimeout((()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(Ke("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new pl)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((s=>this.i!==e?(Ke("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(on(typeof s.accessToken=="string",31837,{l:s}),new GV(s.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return on(e===null||typeof e=="string",2055,{h:e}),new fr(e)}}class gZ{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=fr.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class yZ{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new gZ(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(fr.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class bO{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class bZ{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,_o(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){on(this.o===void 0,3512);const s=i=>{i.error!=null&&Ke("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,Ke("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>s(i)))};const r=i=>{Ke("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>r(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?r(i):Ke("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new bO(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(on(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new bO(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vZ(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $C{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const r=vZ(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<t&&(s+=e.charAt(r[i]%62))}return s}}function Dt(n,e){return n<e?-1:n>e?1:0}function ME(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const r=n.charAt(s),i=e.charAt(s);if(r!==i)return K_(r)===K_(i)?Dt(r,i):K_(r)?1:-1}return Dt(n.length,e.length)}const wZ=55296,TZ=57343;function K_(n){const e=n.charCodeAt(0);return e>=wZ&&e<=TZ}function Ff(n,e,t){return n.length===e.length&&n.every(((s,r)=>t(s,e[r])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vO="__name__";class la{constructor(e,t,s){t===void 0?t=0:t>e.length&&lt(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&lt(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return la.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof la?e.forEach((s=>{t.push(s)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const i=la.compareSegments(e.get(r),t.get(r));if(i!==0)return i}return Dt(e.length,t.length)}static compareSegments(e,t){const s=la.isNumericId(e),r=la.isNumericId(t);return s&&!r?-1:!s&&r?1:s&&r?la.extractNumericId(e).compare(la.extractNumericId(t)):ME(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Vu.fromString(e.substring(4,e.length-2))}}class Nn extends la{construct(e,t,s){return new Nn(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new qe(Ae.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter((r=>r.length>0)))}return new Nn(t)}static emptyPath(){return new Nn([])}}const xZ=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class nr extends la{construct(e,t,s){return new nr(e,t,s)}static isValidIdentifier(e){return xZ.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),nr.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===vO}static keyField(){return new nr([vO])}static fromServerFormat(e){const t=[];let s="",r=0;const i=()=>{if(s.length===0)throw new qe(Ae.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let o=!1;for(;r<e.length;){const a=e[r];if(a==="\\"){if(r+1===e.length)throw new qe(Ae.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new qe(Ae.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=l,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(s+=a,r++):(i(),r++)}if(i(),o)throw new qe(Ae.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new nr(t)}static emptyPath(){return new nr([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tt{constructor(e){this.path=e}static fromPath(e){return new tt(Nn.fromString(e))}static fromName(e){return new tt(Nn.fromString(e).popFirst(5))}static empty(){return new tt(Nn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Nn.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Nn.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new tt(new Nn(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HV(n,e,t){if(!t)throw new qe(Ae.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function SZ(n,e,t,s){if(e===!0&&s===!0)throw new qe(Ae.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function wO(n){if(!tt.isDocumentKey(n))throw new qe(Ae.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function TO(n){if(tt.isDocumentKey(n))throw new qe(Ae.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function qV(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Sw(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(s){return s.constructor?s.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":lt(12329,{type:typeof n})}function wl(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new qe(Ae.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Sw(n);throw new qe(Ae.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bs(n,e){const t={typeString:n};return e&&(t.value=e),t}function ry(n,e){if(!qV(n))throw new qe(Ae.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const r=e[s].typeString,i="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const o=n[s];if(r&&typeof o!==r){t=`JSON field '${s}' must be a ${r}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${s}' field to equal '${i.value}'`;break}}if(t)throw new qe(Ae.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xO=-62135596800,SO=1e6;class Mn{static now(){return Mn.fromMillis(Date.now())}static fromDate(e){return Mn.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*SO);return new Mn(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new qe(Ae.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new qe(Ae.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<xO)throw new qe(Ae.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new qe(Ae.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/SO}_compareTo(e){return this.seconds===e.seconds?Dt(this.nanoseconds,e.nanoseconds):Dt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Mn._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ry(e,Mn._jsonSchema))return new Mn(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-xO;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Mn._jsonSchemaVersion="firestore/timestamp/1.0",Mn._jsonSchema={type:bs("string",Mn._jsonSchemaVersion),seconds:bs("number"),nanoseconds:bs("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dt{static fromTimestamp(e){return new dt(e)}static min(){return new dt(new Mn(0,0))}static max(){return new dt(new Mn(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wg=-1;function _Z(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=dt.fromTimestamp(s===1e9?new Mn(t+1,0):new Mn(t,s));return new Xu(r,tt.empty(),e)}function EZ(n){return new Xu(n.readTime,n.key,wg)}class Xu{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new Xu(dt.min(),tt.empty(),wg)}static max(){return new Xu(dt.max(),tt.empty(),wg)}}function IZ(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=tt.comparator(n.documentKey,e.documentKey),t!==0?t:Dt(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CZ="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class NZ{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hp(n){if(n.code!==Ae.FAILED_PRECONDITION||n.message!==CZ)throw n;Ke("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class De{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&lt(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new De(((s,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(s,r)},this.catchCallback=i=>{this.wrapFailure(t,i).next(s,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof De?t:De.resolve(t)}catch(t){return De.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):De.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):De.reject(t)}static resolve(e){return new De(((t,s)=>{t(e)}))}static reject(e){return new De(((t,s)=>{s(e)}))}static waitFor(e){return new De(((t,s)=>{let r=0,i=0,o=!1;e.forEach((a=>{++r,a.next((()=>{++i,o&&i===r&&t()}),(l=>s(l)))})),o=!0,i===r&&t()}))}static or(e){let t=De.resolve(!1);for(const s of e)t=t.next((r=>r?De.resolve(r):s()));return t}static forEach(e,t){const s=[];return e.forEach(((r,i)=>{s.push(t.call(this,r,i))})),this.waitFor(s)}static mapArray(e,t){return new De(((s,r)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next((h=>{o[u]=h,++a,a===i&&s(o)}),(h=>r(h)))}}))}static doWhile(e,t){return new De(((s,r)=>{const i=()=>{e()===!0?t().next((()=>{i()}),r):s()};i()}))}}function AZ(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function dp(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _w{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}_w.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RC=-1;function Ew(n){return n==null}function dv(n){return n===0&&1/n==-1/0}function kZ(n){return typeof n=="number"&&Number.isInteger(n)&&!dv(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WV="";function $Z(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=_O(e)),e=RZ(n.get(t),e);return _O(e)}function RZ(n,e){let t=e;const s=n.length;for(let r=0;r<s;r++){const i=n.charAt(r);switch(i){case"\0":t+="";break;case WV:t+="";break;default:t+=i}}return t}function _O(n){return n+WV+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EO(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function mc(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function KV(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{constructor(e,t){this.comparator=e,this.root=t||er.EMPTY}insert(e,t){return new Gn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,er.BLACK,null,null))}remove(e){return new Gn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,er.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,s)=>(e(t,s),!1)))}toString(){const e=[];return this.inorderTraversal(((t,s)=>(e.push(`${t}:${s}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new b1(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new b1(this.root,e,this.comparator,!1)}getReverseIterator(){return new b1(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new b1(this.root,e,this.comparator,!0)}}class b1{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?s(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class er{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??er.RED,this.left=r??er.EMPTY,this.right=i??er.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,i){return new er(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,s),null):i===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return er.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return er.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,er.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,er.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw lt(43730,{key:this.key,value:this.value});if(this.right.isRed())throw lt(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw lt(27949);return e+(this.isRed()?0:1)}}er.EMPTY=null,er.RED=!0,er.BLACK=!1;er.EMPTY=new class{constructor(){this.size=0}get key(){throw lt(57766)}get value(){throw lt(16141)}get color(){throw lt(16727)}get left(){throw lt(29726)}get right(){throw lt(36894)}copy(e,t,s,r,i){return this}insert(e,t,s){return new er(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rs{constructor(e){this.comparator=e,this.data=new Gn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,s)=>(e(t),!1)))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new IO(this.data.getIterator())}getIteratorFrom(e){return new IO(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((s=>{t=t.add(s)})),t}isEqual(e){if(!(e instanceof Rs)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Rs(this.comparator);return t.data=e,t}}class IO{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ti{constructor(e){this.fields=e,e.sort(nr.comparator)}static empty(){return new Ti([])}unionWith(e){let t=new Rs(nr.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new Ti(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ff(this.fields,e.fields,((t,s)=>t.isEqual(s)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XV extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new XV("Invalid base64 string: "+i):i}})(e);return new rr(t)}static fromUint8Array(e){const t=(function(r){let i="";for(let o=0;o<r.length;++o)i+=String.fromCharCode(r[o]);return i})(e);return new rr(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Dt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}rr.EMPTY_BYTE_STRING=new rr("");const DZ=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Yu(n){if(on(!!n,39018),typeof n=="string"){let e=0;const t=DZ.exec(n);if(on(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:ns(n.seconds),nanos:ns(n.nanos)}}function ns(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ju(n){return typeof n=="string"?rr.fromBase64String(n):rr.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YV="server_timestamp",JV="__type__",jV="__previous_value__",QV="__local_write_time__";function DC(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[JV])==null?void 0:s.stringValue)===YV}function Iw(n){const e=n.mapValue.fields[jV];return DC(e)?Iw(e):e}function Tg(n){const e=Yu(n.mapValue.fields[QV].timestampValue);return new Mn(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MZ{constructor(e,t,s,r,i,o,a,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=h}}const fv="(default)";class xg{constructor(e,t){this.projectId=e,this.database=t||fv}static empty(){return new xg("","")}get isDefaultDatabase(){return this.database===fv}isEqual(e){return e instanceof xg&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZV="__type__",OZ="__max__",v1={mapValue:{}},e4="__vector__",pv="value";function ju(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?DC(n)?4:FZ(n)?9007199254740991:PZ(n)?10:11:lt(28295,{value:n})}function Ca(n,e){if(n===e)return!0;const t=ju(n);if(t!==ju(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Tg(n).isEqual(Tg(e));case 3:return(function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const o=Yu(r.timestampValue),a=Yu(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(r,i){return Ju(r.bytesValue).isEqual(Ju(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(r,i){return ns(r.geoPointValue.latitude)===ns(i.geoPointValue.latitude)&&ns(r.geoPointValue.longitude)===ns(i.geoPointValue.longitude)})(n,e);case 2:return(function(r,i){if("integerValue"in r&&"integerValue"in i)return ns(r.integerValue)===ns(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const o=ns(r.doubleValue),a=ns(i.doubleValue);return o===a?dv(o)===dv(a):isNaN(o)&&isNaN(a)}return!1})(n,e);case 9:return Ff(n.arrayValue.values||[],e.arrayValue.values||[],Ca);case 10:case 11:return(function(r,i){const o=r.mapValue.fields||{},a=i.mapValue.fields||{};if(EO(o)!==EO(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Ca(o[l],a[l])))return!1;return!0})(n,e);default:return lt(52216,{left:n})}}function Sg(n,e){return(n.values||[]).find((t=>Ca(t,e)))!==void 0}function Lf(n,e){if(n===e)return 0;const t=ju(n),s=ju(e);if(t!==s)return Dt(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return Dt(n.booleanValue,e.booleanValue);case 2:return(function(i,o){const a=ns(i.integerValue||i.doubleValue),l=ns(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1})(n,e);case 3:return CO(n.timestampValue,e.timestampValue);case 4:return CO(Tg(n),Tg(e));case 5:return ME(n.stringValue,e.stringValue);case 6:return(function(i,o){const a=Ju(i),l=Ju(o);return a.compareTo(l)})(n.bytesValue,e.bytesValue);case 7:return(function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const h=Dt(a[u],l[u]);if(h!==0)return h}return Dt(a.length,l.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,o){const a=Dt(ns(i.latitude),ns(o.latitude));return a!==0?a:Dt(ns(i.longitude),ns(o.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return NO(n.arrayValue,e.arrayValue);case 10:return(function(i,o){var p,g,b,T;const a=i.fields||{},l=o.fields||{},u=(p=a[pv])==null?void 0:p.arrayValue,h=(g=l[pv])==null?void 0:g.arrayValue,f=Dt(((b=u==null?void 0:u.values)==null?void 0:b.length)||0,((T=h==null?void 0:h.values)==null?void 0:T.length)||0);return f!==0?f:NO(u,h)})(n.mapValue,e.mapValue);case 11:return(function(i,o){if(i===v1.mapValue&&o===v1.mapValue)return 0;if(i===v1.mapValue)return 1;if(o===v1.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const p=ME(l[f],h[f]);if(p!==0)return p;const g=Lf(a[l[f]],u[h[f]]);if(g!==0)return g}return Dt(l.length,h.length)})(n.mapValue,e.mapValue);default:throw lt(23264,{he:t})}}function CO(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Dt(n,e);const t=Yu(n),s=Yu(e),r=Dt(t.seconds,s.seconds);return r!==0?r:Dt(t.nanos,s.nanos)}function NO(n,e){const t=n.values||[],s=e.values||[];for(let r=0;r<t.length&&r<s.length;++r){const i=Lf(t[r],s[r]);if(i)return i}return Dt(t.length,s.length)}function Vf(n){return OE(n)}function OE(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const s=Yu(t);return`time(${s.seconds},${s.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Ju(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return tt.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let s="[",r=!0;for(const i of t.values||[])r?r=!1:s+=",",s+=OE(i);return s+"]"})(n.arrayValue):"mapValue"in n?(function(t){const s=Object.keys(t.fields||{}).sort();let r="{",i=!0;for(const o of s)i?i=!1:r+=",",r+=`${o}:${OE(t.fields[o])}`;return r+"}"})(n.mapValue):lt(61005,{value:n})}function B1(n){switch(ju(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Iw(n);return e?16+B1(e):16;case 5:return 2*n.stringValue.length;case 6:return Ju(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(s){return(s.values||[]).reduce(((r,i)=>r+B1(i)),0)})(n.arrayValue);case 10:case 11:return(function(s){let r=0;return mc(s.fields,((i,o)=>{r+=i.length+B1(o)})),r})(n.mapValue);default:throw lt(13486,{value:n})}}function AO(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function PE(n){return!!n&&"integerValue"in n}function MC(n){return!!n&&"arrayValue"in n}function kO(n){return!!n&&"nullValue"in n}function $O(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function U1(n){return!!n&&"mapValue"in n}function PZ(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[ZV])==null?void 0:s.stringValue)===e4}function lg(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return mc(n.mapValue.fields,((t,s)=>e.mapValue.fields[t]=lg(s))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=lg(n.arrayValue.values[t]);return e}return{...n}}function FZ(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===OZ}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class si{constructor(e){this.value=e}static empty(){return new si({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!U1(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=lg(t)}setAll(e){let t=nr.emptyPath(),s={},r=[];e.forEach(((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,s,r),s={},r=[],t=a.popLast()}o?s[a.lastSegment()]=lg(o):r.push(a.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,s,r)}delete(e){const t=this.field(e.popLast());U1(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ca(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];U1(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){mc(t,((r,i)=>e[r]=i));for(const r of s)delete e[r]}clone(){return new si(lg(this.value))}}function t4(n){const e=[];return mc(n.fields,((t,s)=>{const r=new nr([t]);if(U1(s)){const i=t4(s.mapValue).fields;if(i.length===0)e.push(r);else for(const o of i)e.push(r.child(o))}else e.push(r)})),new Ti(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{constructor(e,t,s,r,i,o,a){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new mr(e,0,dt.min(),dt.min(),dt.min(),si.empty(),0)}static newFoundDocument(e,t,s,r){return new mr(e,1,t,dt.min(),s,r,0)}static newNoDocument(e,t){return new mr(e,2,t,dt.min(),dt.min(),si.empty(),0)}static newUnknownDocument(e,t){return new mr(e,3,t,dt.min(),dt.min(),si.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(dt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=si.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=si.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=dt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof mr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new mr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mv{constructor(e,t){this.position=e,this.inclusive=t}}function RO(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const i=e[r],o=n.position[r];if(i.field.isKeyField()?s=tt.comparator(tt.fromName(o.referenceValue),t.key):s=Lf(o,t.data.field(i.field)),i.dir==="desc"&&(s*=-1),s!==0)break}return s}function DO(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ca(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _g{constructor(e,t="asc"){this.field=e,this.dir=t}}function LZ(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n4{}class ys extends n4{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new BZ(e,t,s):t==="array-contains"?new GZ(e,s):t==="in"?new HZ(e,s):t==="not-in"?new qZ(e,s):t==="array-contains-any"?new WZ(e,s):new ys(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new UZ(e,s):new zZ(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Lf(t,this.value)):t!==null&&ju(this.value)===ju(t)&&this.matchesComparison(Lf(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return lt(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Do extends n4{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Do(e,t)}matches(e){return s4(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function s4(n){return n.op==="and"}function r4(n){return VZ(n)&&s4(n)}function VZ(n){for(const e of n.filters)if(e instanceof Do)return!1;return!0}function FE(n){if(n instanceof ys)return n.field.canonicalString()+n.op.toString()+Vf(n.value);if(r4(n))return n.filters.map((e=>FE(e))).join(",");{const e=n.filters.map((t=>FE(t))).join(",");return`${n.op}(${e})`}}function i4(n,e){return n instanceof ys?(function(s,r){return r instanceof ys&&s.op===r.op&&s.field.isEqual(r.field)&&Ca(s.value,r.value)})(n,e):n instanceof Do?(function(s,r){return r instanceof Do&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce(((i,o,a)=>i&&i4(o,r.filters[a])),!0):!1})(n,e):void lt(19439)}function o4(n){return n instanceof ys?(function(t){return`${t.field.canonicalString()} ${t.op} ${Vf(t.value)}`})(n):n instanceof Do?(function(t){return t.op.toString()+" {"+t.getFilters().map(o4).join(" ,")+"}"})(n):"Filter"}class BZ extends ys{constructor(e,t,s){super(e,t,s),this.key=tt.fromName(s.referenceValue)}matches(e){const t=tt.comparator(e.key,this.key);return this.matchesComparison(t)}}class UZ extends ys{constructor(e,t){super(e,"in",t),this.keys=a4("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class zZ extends ys{constructor(e,t){super(e,"not-in",t),this.keys=a4("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function a4(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map((s=>tt.fromName(s.referenceValue)))}class GZ extends ys{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return MC(t)&&Sg(t.arrayValue,this.value)}}class HZ extends ys{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Sg(this.value.arrayValue,t)}}class qZ extends ys{constructor(e,t){super(e,"not-in",t)}matches(e){if(Sg(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Sg(this.value.arrayValue,t)}}class WZ extends ys{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!MC(t)||!t.arrayValue.values)&&t.arrayValue.values.some((s=>Sg(this.value.arrayValue,s)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KZ{constructor(e,t=null,s=[],r=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function MO(n,e=null,t=[],s=[],r=null,i=null,o=null){return new KZ(n,e,t,s,r,i,o)}function OC(n){const e=mt(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((s=>FE(s))).join(","),t+="|ob:",t+=e.orderBy.map((s=>(function(i){return i.field.canonicalString()+i.dir})(s))).join(","),Ew(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((s=>Vf(s))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((s=>Vf(s))).join(",")),e.Te=t}return e.Te}function PC(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!LZ(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!i4(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!DO(n.startAt,e.startAt)&&DO(n.endAt,e.endAt)}function LE(n){return tt.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fp{constructor(e,t=null,s=[],r=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function XZ(n,e,t,s,r,i,o,a){return new fp(n,e,t,s,r,i,o,a)}function FC(n){return new fp(n)}function OO(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function l4(n){return n.collectionGroup!==null}function ug(n){const e=mt(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Rs(nr.comparator);return o.filters.forEach((l=>{l.getFlattenedFilters().forEach((u=>{u.isInequality()&&(a=a.add(u.field))}))})),a})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new _g(i,s))})),t.has(nr.keyField().canonicalString())||e.Ie.push(new _g(nr.keyField(),s))}return e.Ie}function ma(n){const e=mt(n);return e.Ee||(e.Ee=YZ(e,ug(n))),e.Ee}function YZ(n,e){if(n.limitType==="F")return MO(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((r=>{const i=r.dir==="desc"?"asc":"desc";return new _g(r.field,i)}));const t=n.endAt?new mv(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new mv(n.startAt.position,n.startAt.inclusive):null;return MO(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function VE(n,e){const t=n.filters.concat([e]);return new fp(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function gv(n,e,t){return new fp(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Cw(n,e){return PC(ma(n),ma(e))&&n.limitType===e.limitType}function u4(n){return`${OC(ma(n))}|lt:${n.limitType}`}function of(n){return`Query(target=${(function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map((r=>o4(r))).join(", ")}]`),Ew(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map((r=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(r))).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map((r=>Vf(r))).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map((r=>Vf(r))).join(",")),`Target(${s})`})(ma(n))}; limitType=${n.limitType})`}function Nw(n,e){return e.isFoundDocument()&&(function(s,r){const i=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(i):tt.isDocumentKey(s.path)?s.path.isEqual(i):s.path.isImmediateParentOf(i)})(n,e)&&(function(s,r){for(const i of ug(s))if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(s,r){for(const i of s.filters)if(!i.matches(r))return!1;return!0})(n,e)&&(function(s,r){return!(s.startAt&&!(function(o,a,l){const u=RO(o,a,l);return o.inclusive?u<=0:u<0})(s.startAt,ug(s),r)||s.endAt&&!(function(o,a,l){const u=RO(o,a,l);return o.inclusive?u>=0:u>0})(s.endAt,ug(s),r))})(n,e)}function JZ(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function c4(n){return(e,t)=>{let s=!1;for(const r of ug(n)){const i=jZ(r,e,t);if(i!==0)return i;s=s||r.field.isKeyField()}return 0}}function jZ(n,e,t){const s=n.field.isKeyField()?tt.comparator(e.key,t.key):(function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?Lf(l,u):lt(42886)})(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return lt(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zh{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[r,i]of s)if(this.equalsFn(r,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){mc(this.inner,((t,s)=>{for(const[r,i]of s)e(r,i)}))}isEmpty(){return KV(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QZ=new Gn(tt.comparator);function Tl(){return QZ}const h4=new Gn(tt.comparator);function Jm(...n){let e=h4;for(const t of n)e=e.insert(t.key,t);return e}function d4(n){let e=h4;return n.forEach(((t,s)=>e=e.insert(t,s.overlayedDocument))),e}function bh(){return cg()}function f4(){return cg()}function cg(){return new Zh((n=>n.toString()),((n,e)=>n.isEqual(e)))}const ZZ=new Gn(tt.comparator),eee=new Rs(tt.comparator);function Mt(...n){let e=eee;for(const t of n)e=e.add(t);return e}const tee=new Rs(Dt);function nee(){return tee}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LC(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:dv(e)?"-0":e}}function p4(n){return{integerValue:""+n}}function m4(n,e){return kZ(e)?p4(e):LC(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aw{constructor(){this._=void 0}}function see(n,e,t){return n instanceof yv?(function(r,i){const o={fields:{[JV]:{stringValue:YV},[QV]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&DC(i)&&(i=Iw(i)),i&&(o.fields[jV]=i),{mapValue:o}})(t,e):n instanceof Eg?y4(n,e):n instanceof Ig?b4(n,e):(function(r,i){const o=g4(r,i),a=PO(o)+PO(r.Ae);return PE(o)&&PE(r.Ae)?p4(a):LC(r.serializer,a)})(n,e)}function ree(n,e,t){return n instanceof Eg?y4(n,e):n instanceof Ig?b4(n,e):t}function g4(n,e){return n instanceof Cg?(function(s){return PE(s)||(function(i){return!!i&&"doubleValue"in i})(s)})(e)?e:{integerValue:0}:null}class yv extends Aw{}class Eg extends Aw{constructor(e){super(),this.elements=e}}function y4(n,e){const t=v4(e);for(const s of n.elements)t.some((r=>Ca(r,s)))||t.push(s);return{arrayValue:{values:t}}}class Ig extends Aw{constructor(e){super(),this.elements=e}}function b4(n,e){let t=v4(e);for(const s of n.elements)t=t.filter((r=>!Ca(r,s)));return{arrayValue:{values:t}}}class Cg extends Aw{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function PO(n){return ns(n.integerValue||n.doubleValue)}function v4(n){return MC(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iee{constructor(e,t){this.field=e,this.transform=t}}function oee(n,e){return n.field.isEqual(e.field)&&(function(s,r){return s instanceof Eg&&r instanceof Eg||s instanceof Ig&&r instanceof Ig?Ff(s.elements,r.elements,Ca):s instanceof Cg&&r instanceof Cg?Ca(s.Ae,r.Ae):s instanceof yv&&r instanceof yv})(n.transform,e.transform)}class aee{constructor(e,t){this.version=e,this.transformResults=t}}class ga{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ga}static exists(e){return new ga(void 0,e)}static updateTime(e){return new ga(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function z1(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class kw{}function w4(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new x4(n.key,ga.none()):new iy(n.key,n.data,ga.none());{const t=n.data,s=si.empty();let r=new Rs(nr.comparator);for(let i of e.fields)if(!r.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?s.delete(i):s.set(i,o),r=r.add(i)}return new gc(n.key,s,new Ti(r.toArray()),ga.none())}}function lee(n,e,t){n instanceof iy?(function(r,i,o){const a=r.value.clone(),l=LO(r.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()})(n,e,t):n instanceof gc?(function(r,i,o){if(!z1(r.precondition,i))return void i.convertToUnknownDocument(o.version);const a=LO(r.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(T4(r)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()})(n,e,t):(function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function hg(n,e,t,s){return n instanceof iy?(function(i,o,a,l){if(!z1(i.precondition,o))return a;const u=i.value.clone(),h=VO(i.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null})(n,e,t,s):n instanceof gc?(function(i,o,a,l){if(!z1(i.precondition,o))return a;const u=VO(i.fieldTransforms,l,o),h=o.data;return h.setAll(T4(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((f=>f.field)))})(n,e,t,s):(function(i,o,a){return z1(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a})(n,e,t)}function uee(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),i=g4(s.transform,r||null);i!=null&&(t===null&&(t=si.empty()),t.set(s.field,i))}return t||null}function FO(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&Ff(s,r,((i,o)=>oee(i,o)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class iy extends kw{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class gc extends kw{constructor(e,t,s,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function T4(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}})),e}function LO(n,e,t){const s=new Map;on(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let r=0;r<t.length;r++){const i=n[r],o=i.transform,a=e.data.field(i.field);s.set(i.field,ree(o,a,t[r]))}return s}function VO(n,e,t){const s=new Map;for(const r of n){const i=r.transform,o=t.data.field(r.field);s.set(r.field,see(i,o,e))}return s}class x4 extends kw{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class cee extends kw{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hee{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&lee(i,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=hg(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=hg(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=f4();return this.mutations.forEach((r=>{const i=e.get(r.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(r.key)?null:a;const l=w4(o,a);l!==null&&s.set(r.key,l),o.isValidDocument()||o.convertToNoDocument(dt.min())})),s}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Mt())}isEqual(e){return this.batchId===e.batchId&&Ff(this.mutations,e.mutations,((t,s)=>FO(t,s)))&&Ff(this.baseMutations,e.baseMutations,((t,s)=>FO(t,s)))}}class VC{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){on(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let r=(function(){return ZZ})();const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,s[o].version);return new VC(e,t,s,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dee{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fee{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ms,zt;function pee(n){switch(n){case Ae.OK:return lt(64938);case Ae.CANCELLED:case Ae.UNKNOWN:case Ae.DEADLINE_EXCEEDED:case Ae.RESOURCE_EXHAUSTED:case Ae.INTERNAL:case Ae.UNAVAILABLE:case Ae.UNAUTHENTICATED:return!1;case Ae.INVALID_ARGUMENT:case Ae.NOT_FOUND:case Ae.ALREADY_EXISTS:case Ae.PERMISSION_DENIED:case Ae.FAILED_PRECONDITION:case Ae.ABORTED:case Ae.OUT_OF_RANGE:case Ae.UNIMPLEMENTED:case Ae.DATA_LOSS:return!0;default:return lt(15467,{code:n})}}function S4(n){if(n===void 0)return vl("GRPC error has no .code"),Ae.UNKNOWN;switch(n){case ms.OK:return Ae.OK;case ms.CANCELLED:return Ae.CANCELLED;case ms.UNKNOWN:return Ae.UNKNOWN;case ms.DEADLINE_EXCEEDED:return Ae.DEADLINE_EXCEEDED;case ms.RESOURCE_EXHAUSTED:return Ae.RESOURCE_EXHAUSTED;case ms.INTERNAL:return Ae.INTERNAL;case ms.UNAVAILABLE:return Ae.UNAVAILABLE;case ms.UNAUTHENTICATED:return Ae.UNAUTHENTICATED;case ms.INVALID_ARGUMENT:return Ae.INVALID_ARGUMENT;case ms.NOT_FOUND:return Ae.NOT_FOUND;case ms.ALREADY_EXISTS:return Ae.ALREADY_EXISTS;case ms.PERMISSION_DENIED:return Ae.PERMISSION_DENIED;case ms.FAILED_PRECONDITION:return Ae.FAILED_PRECONDITION;case ms.ABORTED:return Ae.ABORTED;case ms.OUT_OF_RANGE:return Ae.OUT_OF_RANGE;case ms.UNIMPLEMENTED:return Ae.UNIMPLEMENTED;case ms.DATA_LOSS:return Ae.DATA_LOSS;default:return lt(39323,{code:n})}}(zt=ms||(ms={}))[zt.OK=0]="OK",zt[zt.CANCELLED=1]="CANCELLED",zt[zt.UNKNOWN=2]="UNKNOWN",zt[zt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",zt[zt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",zt[zt.NOT_FOUND=5]="NOT_FOUND",zt[zt.ALREADY_EXISTS=6]="ALREADY_EXISTS",zt[zt.PERMISSION_DENIED=7]="PERMISSION_DENIED",zt[zt.UNAUTHENTICATED=16]="UNAUTHENTICATED",zt[zt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",zt[zt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",zt[zt.ABORTED=10]="ABORTED",zt[zt.OUT_OF_RANGE=11]="OUT_OF_RANGE",zt[zt.UNIMPLEMENTED=12]="UNIMPLEMENTED",zt[zt.INTERNAL=13]="INTERNAL",zt[zt.UNAVAILABLE=14]="UNAVAILABLE",zt[zt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mee(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gee=new Vu([4294967295,4294967295],0);function BO(n){const e=mee().encode(n),t=new PV;return t.update(e),new Uint8Array(t.digest())}function UO(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Vu([t,s],0),new Vu([r,i],0)]}class BC{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new jm(`Invalid padding: ${t}`);if(s<0)throw new jm(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new jm(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new jm(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Vu.fromNumber(this.ge)}ye(e,t,s){let r=e.add(t.multiply(Vu.fromNumber(s)));return r.compare(gee)===1&&(r=new Vu([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=BO(e),[s,r]=UO(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);if(!this.we(o))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new BC(i,r,t);return s.forEach((a=>o.insert(a))),o}insert(e){if(this.ge===0)return;const t=BO(e),[s,r]=UO(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class jm extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $w{constructor(e,t,s,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,oy.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new $w(dt.min(),r,new Gn(Dt),Tl(),Mt())}}class oy{constructor(e,t,s,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new oy(s,t,Mt(),Mt(),Mt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G1{constructor(e,t,s,r){this.be=e,this.removedTargetIds=t,this.key=s,this.De=r}}class _4{constructor(e,t){this.targetId=e,this.Ce=t}}class E4{constructor(e,t,s=rr.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class zO{constructor(){this.ve=0,this.Fe=GO(),this.Me=rr.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Mt(),t=Mt(),s=Mt();return this.Fe.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:lt(38017,{changeType:i})}})),new oy(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=GO()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,on(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class yee{constructor(e){this.Ge=e,this.ze=new Map,this.je=Tl(),this.Je=w1(),this.He=w1(),this.Ye=new Gn(Dt)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:lt(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((s,r)=>{this.rt(r)&&t(r)}))}st(e){const t=e.targetId,s=e.Ce.count,r=this.ot(t);if(r){const i=r.target;if(LE(i))if(s===0){const o=new tt(i.path);this.et(t,o,mr.newNoDocument(o,dt.min()))}else on(s===1,20013,{expectedCount:s});else{const o=this._t(t);if(o!==s){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:i=0}=t;let o,a;try{o=Ju(s).toUint8Array()}catch(l){if(l instanceof XV)return Pf("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new BC(o,r,i)}catch(l){return Pf(l instanceof jm?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let r=0;return s.forEach((i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),r++)})),r}Tt(e){const t=new Map;this.ze.forEach(((i,o)=>{const a=this.ot(o);if(a){if(i.current&&LE(a.target)){const l=new tt(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,mr.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}}));let s=Mt();this.He.forEach(((i,o)=>{let a=!0;o.forEachWhile((l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)})),a&&(s=s.add(i))})),this.je.forEach(((i,o)=>o.setReadTime(e)));const r=new $w(e,t,this.Ye,this.je,s);return this.je=Tl(),this.Je=w1(),this.He=w1(),this.Ye=new Gn(Dt),r}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new zO,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Rs(Dt),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Rs(Dt),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Ke("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new zO),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function w1(){return new Gn(tt.comparator)}function GO(){return new Gn(tt.comparator)}const bee={asc:"ASCENDING",desc:"DESCENDING"},vee={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},wee={and:"AND",or:"OR"};class Tee{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function BE(n,e){return n.useProto3Json||Ew(e)?e:{value:e}}function bv(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function I4(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function xee(n,e){return bv(n,e.toTimestamp())}function ya(n){return on(!!n,49232),dt.fromTimestamp((function(t){const s=Yu(t);return new Mn(s.seconds,s.nanos)})(n))}function UC(n,e){return UE(n,e).canonicalString()}function UE(n,e){const t=(function(r){return new Nn(["projects",r.projectId,"databases",r.database])})(n).child("documents");return e===void 0?t:t.child(e)}function C4(n){const e=Nn.fromString(n);return on(R4(e),10190,{key:e.toString()}),e}function zE(n,e){return UC(n.databaseId,e.path)}function X_(n,e){const t=C4(e);if(t.get(1)!==n.databaseId.projectId)throw new qe(Ae.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new qe(Ae.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new tt(A4(t))}function N4(n,e){return UC(n.databaseId,e)}function See(n){const e=C4(n);return e.length===4?Nn.emptyPath():A4(e)}function GE(n){return new Nn(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function A4(n){return on(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function HO(n,e,t){return{name:zE(n,e),fields:t.value.mapValue.fields}}function _ee(n,e){let t;if("targetChange"in e){e.targetChange;const s=(function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:lt(39313,{state:u})})(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=(function(u,h){return u.useProto3Json?(on(h===void 0||typeof h=="string",58123),rr.fromBase64String(h||"")):(on(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),rr.fromUint8Array(h||new Uint8Array))})(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&(function(u){const h=u.code===void 0?Ae.UNKNOWN:S4(u.code);return new qe(h,u.message||"")})(o);t=new E4(s,r,i,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=X_(n,s.document.name),i=ya(s.document.updateTime),o=s.document.createTime?ya(s.document.createTime):dt.min(),a=new si({mapValue:{fields:s.document.fields}}),l=mr.newFoundDocument(r,i,o,a),u=s.targetIds||[],h=s.removedTargetIds||[];t=new G1(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=X_(n,s.document),i=s.readTime?ya(s.readTime):dt.min(),o=mr.newNoDocument(r,i),a=s.removedTargetIds||[];t=new G1([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=X_(n,s.document),i=s.removedTargetIds||[];t=new G1([],i,r,null)}else{if(!("filter"in e))return lt(11601,{Rt:e});{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:i}=s,o=new fee(r,i),a=s.targetId;t=new _4(a,o)}}return t}function Eee(n,e){let t;if(e instanceof iy)t={update:HO(n,e.key,e.value)};else if(e instanceof x4)t={delete:zE(n,e.key)};else if(e instanceof gc)t={update:HO(n,e.key,e.data),updateMask:Mee(e.fieldMask)};else{if(!(e instanceof cee))return lt(16599,{Vt:e.type});t={verify:zE(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((s=>(function(i,o){const a=o.transform;if(a instanceof yv)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Eg)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Ig)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Cg)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw lt(20930,{transform:o.transform})})(0,s)))),e.precondition.isNone||(t.currentDocument=(function(r,i){return i.updateTime!==void 0?{updateTime:xee(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:lt(27497)})(n,e.precondition)),t}function Iee(n,e){return n&&n.length>0?(on(e!==void 0,14353),n.map((t=>(function(r,i){let o=r.updateTime?ya(r.updateTime):ya(i);return o.isEqual(dt.min())&&(o=ya(i)),new aee(o,r.transformResults||[])})(t,e)))):[]}function Cee(n,e){return{documents:[N4(n,e.path)]}}function Nee(n,e){const t={structuredQuery:{}},s=e.path;let r;e.collectionGroup!==null?(r=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=N4(n,r);const i=(function(u){if(u.length!==0)return $4(Do.create(u,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const o=(function(u){if(u.length!==0)return u.map((h=>(function(p){return{field:af(p.field),direction:$ee(p.dir)}})(h)))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=BE(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=(function(u){return{before:u.inclusive,values:u.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(u){return{before:!u.inclusive,values:u.position}})(e.endAt)),{ft:t,parent:r}}function Aee(n){let e=See(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){on(s===1,65062);const h=t.from[0];h.allDescendants?r=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=(function(f){const p=k4(f);return p instanceof Do&&r4(p)?p.getFilters():[p]})(t.where));let o=[];t.orderBy&&(o=(function(f){return f.map((p=>(function(b){return new _g(lf(b.field),(function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(b.direction))})(p)))})(t.orderBy));let a=null;t.limit&&(a=(function(f){let p;return p=typeof f=="object"?f.value:f,Ew(p)?null:p})(t.limit));let l=null;t.startAt&&(l=(function(f){const p=!!f.before,g=f.values||[];return new mv(g,p)})(t.startAt));let u=null;return t.endAt&&(u=(function(f){const p=!f.before,g=f.values||[];return new mv(g,p)})(t.endAt)),XZ(e,r,o,i,a,"F",l,u)}function kee(n,e){const t=(function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return lt(28987,{purpose:r})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function k4(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=lf(t.unaryFilter.field);return ys.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=lf(t.unaryFilter.field);return ys.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=lf(t.unaryFilter.field);return ys.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=lf(t.unaryFilter.field);return ys.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return lt(61313);default:return lt(60726)}})(n):n.fieldFilter!==void 0?(function(t){return ys.create(lf(t.fieldFilter.field),(function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return lt(58110);default:return lt(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Do.create(t.compositeFilter.filters.map((s=>k4(s))),(function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return lt(1026)}})(t.compositeFilter.op))})(n):lt(30097,{filter:n})}function $ee(n){return bee[n]}function Ree(n){return vee[n]}function Dee(n){return wee[n]}function af(n){return{fieldPath:n.canonicalString()}}function lf(n){return nr.fromServerFormat(n.fieldPath)}function $4(n){return n instanceof ys?(function(t){if(t.op==="=="){if($O(t.value))return{unaryFilter:{field:af(t.field),op:"IS_NAN"}};if(kO(t.value))return{unaryFilter:{field:af(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if($O(t.value))return{unaryFilter:{field:af(t.field),op:"IS_NOT_NAN"}};if(kO(t.value))return{unaryFilter:{field:af(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:af(t.field),op:Ree(t.op),value:t.value}}})(n):n instanceof Do?(function(t){const s=t.getFilters().map((r=>$4(r)));return s.length===1?s[0]:{compositeFilter:{op:Dee(t.op),filters:s}}})(n):lt(54877,{filter:n})}function Mee(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function R4(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Au{constructor(e,t,s,r,i=dt.min(),o=dt.min(),a=rr.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Au(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Au(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Au(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Au(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oee{constructor(e){this.yt=e}}function Pee(n){const e=Aee({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?gv(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fee{constructor(){this.Cn=new Lee}addToCollectionParentIndex(e,t){return this.Cn.add(t),De.resolve()}getCollectionParents(e,t){return De.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return De.resolve()}deleteFieldIndex(e,t){return De.resolve()}deleteAllFieldIndexes(e){return De.resolve()}createTargetIndexes(e,t){return De.resolve()}getDocumentsMatchingTarget(e,t){return De.resolve(null)}getIndexType(e,t){return De.resolve(0)}getFieldIndexes(e,t){return De.resolve([])}getNextCollectionGroupToUpdate(e){return De.resolve(null)}getMinOffset(e,t){return De.resolve(Xu.min())}getMinOffsetFromCollectionGroup(e,t){return De.resolve(Xu.min())}updateCollectionGroup(e,t,s){return De.resolve()}updateIndexEntries(e,t){return De.resolve()}}class Lee{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new Rs(Nn.comparator),i=!r.has(s);return this.index[t]=r.add(s),i}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new Rs(Nn.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qO={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},D4=41943040;class ti{static withCacheSize(e){return new ti(e,ti.DEFAULT_COLLECTION_PERCENTILE,ti.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ti.DEFAULT_COLLECTION_PERCENTILE=10,ti.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ti.DEFAULT=new ti(D4,ti.DEFAULT_COLLECTION_PERCENTILE,ti.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ti.DISABLED=new ti(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Bf(0)}static cr(){return new Bf(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WO="LruGarbageCollector",Vee=1048576;function KO([n,e],[t,s]){const r=Dt(n,t);return r===0?Dt(e,s):r}class Bee{constructor(e){this.Ir=e,this.buffer=new Rs(KO),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();KO(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Uee{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ke(WO,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){dp(t)?Ke(WO,"Ignoring IndexedDB error during garbage collection: ",t):await hp(t)}await this.Vr(3e5)}))}}class zee{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((s=>Math.floor(t/100*s)))}nthSequenceNumber(e,t){if(t===0)return De.resolve(_w.ce);const s=new Bee(t);return this.mr.forEachTarget(e,(r=>s.Ar(r.sequenceNumber))).next((()=>this.mr.pr(e,(r=>s.Ar(r))))).next((()=>s.maxValue))}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Ke("LruGarbageCollector","Garbage collection skipped; disabled"),De.resolve(qO)):this.getCacheSize(e).next((s=>s<this.params.cacheSizeCollectionThreshold?(Ke("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),qO):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,r,i,o,a,l,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((f=>(f>this.params.maximumSequenceNumbersToCollect?(Ke("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),r=this.params.maximumSequenceNumbersToCollect):r=f,o=Date.now(),this.nthSequenceNumber(e,r)))).next((f=>(s=f,a=Date.now(),this.removeTargets(e,s,t)))).next((f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,s)))).next((f=>(u=Date.now(),rf()<=Rt.DEBUG&&Ke("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${r} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),De.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:f}))))}}function Gee(n,e){return new zee(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hee{constructor(){this.changes=new Zh((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,mr.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?De.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qee{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wee{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(s=r,this.remoteDocumentCache.getEntry(e,t)))).next((r=>(s!==null&&hg(s.mutation,r,Ti.empty(),Mn.now()),r)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.getLocalViewOfDocuments(e,s,Mt()).next((()=>s))))}getLocalViewOfDocuments(e,t,s=Mt()){const r=bh();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,s).next((i=>{let o=Jm();return i.forEach(((a,l)=>{o=o.insert(a,l.overlayedDocument)})),o}))))}getOverlayedDocuments(e,t){const s=bh();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,Mt())))}populateOverlays(e,t,s){const r=[];return s.forEach((i=>{t.has(i)||r.push(i)})),this.documentOverlayCache.getOverlays(e,r).next((i=>{i.forEach(((o,a)=>{t.set(o,a)}))}))}computeViews(e,t,s,r){let i=Tl();const o=cg(),a=(function(){return cg()})();return t.forEach(((l,u)=>{const h=s.get(u.key);r.has(u.key)&&(h===void 0||h.mutation instanceof gc)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),hg(h.mutation,u,h.mutation.getFieldMask(),Mn.now())):o.set(u.key,Ti.empty())})),this.recalculateAndSaveOverlays(e,i).next((l=>(l.forEach(((u,h)=>o.set(u,h))),t.forEach(((u,h)=>a.set(u,new qee(h,o.get(u)??null)))),a)))}recalculateAndSaveOverlays(e,t){const s=cg();let r=new Gn(((o,a)=>o-a)),i=Mt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((o=>{for(const a of o)a.keys().forEach((l=>{const u=t.get(l);if(u===null)return;let h=s.get(l)||Ti.empty();h=a.applyToLocalView(u,h),s.set(l,h);const f=(r.get(a.batchId)||Mt()).add(l);r=r.insert(a.batchId,f)}))})).next((()=>{const o=[],a=r.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,h=l.value,f=f4();h.forEach((p=>{if(!i.has(p)){const g=w4(t.get(p),s.get(p));g!==null&&f.set(p,g),i=i.add(p)}})),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return De.waitFor(o)})).next((()=>s))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.recalculateAndSaveOverlays(e,s)))}getDocumentsMatchingQuery(e,t,s,r){return(function(o){return tt.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):l4(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r)}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next((i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-i.size):De.resolve(bh());let a=wg,l=i;return o.next((u=>De.forEach(u,((h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?De.resolve():this.remoteDocumentCache.getEntry(e,h).next((p=>{l=l.insert(h,p)}))))).next((()=>this.populateOverlays(e,u,i))).next((()=>this.computeViews(e,l,u,Mt()))).next((h=>({batchId:a,changes:d4(h)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new tt(t)).next((s=>{let r=Jm();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r}))}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const i=t.collectionGroup;let o=Jm();return this.indexManager.getCollectionParents(e,i).next((a=>De.forEach(a,(l=>{const u=(function(f,p){return new fp(p,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)})(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,s,r).next((h=>{h.forEach(((f,p)=>{o=o.insert(f,p)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,s,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next((o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,i,r)))).next((o=>{i.forEach(((l,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,mr.newInvalidDocument(h)))}));let a=Jm();return o.forEach(((l,u)=>{const h=i.get(l);h!==void 0&&hg(h.mutation,u,Ti.empty(),Mn.now()),Nw(t,u)&&(a=a.insert(l,u))})),a}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kee{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return De.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(r){return{id:r.id,version:r.version,createTime:ya(r.createTime)}})(t)),De.resolve()}getNamedQuery(e,t){return De.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(r){return{name:r.name,query:Pee(r.bundledQuery),readTime:ya(r.readTime)}})(t)),De.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xee{constructor(){this.overlays=new Gn(tt.comparator),this.qr=new Map}getOverlay(e,t){return De.resolve(this.overlays.get(t))}getOverlays(e,t){const s=bh();return De.forEach(t,(r=>this.getOverlay(e,r).next((i=>{i!==null&&s.set(r,i)})))).next((()=>s))}saveOverlays(e,t,s){return s.forEach(((r,i)=>{this.St(e,t,i)})),De.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.qr.get(s);return r!==void 0&&(r.forEach((i=>this.overlays=this.overlays.remove(i))),this.qr.delete(s)),De.resolve()}getOverlaysForCollection(e,t,s){const r=bh(),i=t.length+1,o=new tt(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>s&&r.set(l.getKey(),l)}return De.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let i=new Gn(((u,h)=>u-h));const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>s){let h=i.get(u.largestBatchId);h===null&&(h=bh(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=bh(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach(((u,h)=>a.set(u,h))),!(a.size()>=r)););return De.resolve(a)}St(e,t,s){const r=this.overlays.get(s.key);if(r!==null){const o=this.qr.get(r.largestBatchId).delete(s.key);this.qr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new dee(t,s));let i=this.qr.get(t);i===void 0&&(i=Mt(),this.qr.set(t,i)),this.qr.set(t,i.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yee{constructor(){this.sessionToken=rr.EMPTY_BYTE_STRING}getSessionToken(e){return De.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,De.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zC{constructor(){this.Qr=new Rs(Fs.$r),this.Ur=new Rs(Fs.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new Fs(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach((s=>this.addReference(s,t)))}removeReference(e,t){this.Gr(new Fs(e,t))}zr(e,t){e.forEach((s=>this.removeReference(s,t)))}jr(e){const t=new tt(new Nn([])),s=new Fs(t,e),r=new Fs(t,e+1),i=[];return this.Ur.forEachInRange([s,r],(o=>{this.Gr(o),i.push(o.key)})),i}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new tt(new Nn([])),s=new Fs(t,e),r=new Fs(t,e+1);let i=Mt();return this.Ur.forEachInRange([s,r],(o=>{i=i.add(o.key)})),i}containsKey(e){const t=new Fs(e,0),s=this.Qr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class Fs{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return tt.comparator(e.key,t.key)||Dt(e.Yr,t.Yr)}static Kr(e,t){return Dt(e.Yr,t.Yr)||tt.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jee{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Rs(Fs.$r)}checkEmpty(e){return De.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,r){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new hee(i,t,s,r);this.mutationQueue.push(o);for(const a of r)this.Zr=this.Zr.add(new Fs(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return De.resolve(o)}lookupMutationBatch(e,t){return De.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.ei(s),i=r<0?0:r;return De.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return De.resolve(this.mutationQueue.length===0?RC:this.tr-1)}getAllMutationBatches(e){return De.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new Fs(t,0),r=new Fs(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([s,r],(o=>{const a=this.Xr(o.Yr);i.push(a)})),De.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Rs(Dt);return t.forEach((r=>{const i=new Fs(r,0),o=new Fs(r,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],(a=>{s=s.add(a.Yr)}))})),De.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let i=s;tt.isDocumentKey(i)||(i=i.child(""));const o=new Fs(new tt(i),0);let a=new Rs(Dt);return this.Zr.forEachWhile((l=>{const u=l.key.path;return!!s.isPrefixOf(u)&&(u.length===r&&(a=a.add(l.Yr)),!0)}),o),De.resolve(this.ti(a))}ti(e){const t=[];return e.forEach((s=>{const r=this.Xr(s);r!==null&&t.push(r)})),t}removeMutationBatch(e,t){on(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Zr;return De.forEach(t.mutations,(r=>{const i=new Fs(r.key,t.batchId);return s=s.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Zr=s}))}ir(e){}containsKey(e,t){const s=new Fs(t,0),r=this.Zr.firstAfterOrEqual(s);return De.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,De.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jee{constructor(e){this.ri=e,this.docs=(function(){return new Gn(tt.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),i=r?r.size:0,o=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return De.resolve(s?s.document.mutableCopy():mr.newInvalidDocument(t))}getEntries(e,t){let s=Tl();return t.forEach((r=>{const i=this.docs.get(r);s=s.insert(r,i?i.document.mutableCopy():mr.newInvalidDocument(r))})),De.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let i=Tl();const o=t.path,a=new tt(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||IZ(EZ(h),s)<=0||(r.has(h.key)||Nw(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return De.resolve(i)}getAllFromCollectionGroup(e,t,s,r){lt(9500)}ii(e,t){return De.forEach(this.docs,(s=>t(s)))}newChangeBuffer(e){return new Qee(this)}getSize(e){return De.resolve(this.size)}}class Qee extends Hee{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((s,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(s)})),De.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zee{constructor(e){this.persistence=e,this.si=new Zh((t=>OC(t)),PC),this.lastRemoteSnapshotVersion=dt.min(),this.highestTargetId=0,this.oi=0,this._i=new zC,this.targetCount=0,this.ai=Bf.ur()}forEachTarget(e,t){return this.si.forEach(((s,r)=>t(r))),De.resolve()}getLastRemoteSnapshotVersion(e){return De.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return De.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),De.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),De.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Bf(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,De.resolve()}updateTargetData(e,t){return this.Pr(t),De.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,De.resolve()}removeTargets(e,t,s){let r=0;const i=[];return this.si.forEach(((o,a)=>{a.sequenceNumber<=t&&s.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)})),De.waitFor(i).next((()=>r))}getTargetCount(e){return De.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return De.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),De.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((o=>{i.push(r.markPotentiallyOrphaned(e,o))})),De.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),De.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return De.resolve(s)}containsKey(e,t){return De.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M4{constructor(e,t){this.ui={},this.overlays={},this.ci=new _w(0),this.li=!1,this.li=!0,this.hi=new Yee,this.referenceDelegate=e(this),this.Pi=new Zee(this),this.indexManager=new Fee,this.remoteDocumentCache=(function(r){return new jee(r)})((s=>this.referenceDelegate.Ti(s))),this.serializer=new Oee(t),this.Ii=new Kee(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Xee,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new Jee(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){Ke("MemoryPersistence","Starting transaction:",e);const r=new ete(this.ci.next());return this.referenceDelegate.Ei(),s(r).next((i=>this.referenceDelegate.di(r).next((()=>i)))).toPromise().then((i=>(r.raiseOnCommittedEvent(),i)))}Ai(e,t){return De.or(Object.values(this.ui).map((s=>()=>s.containsKey(e,t))))}}class ete extends NZ{constructor(e){super(),this.currentSequenceNumber=e}}class GC{constructor(e){this.persistence=e,this.Ri=new zC,this.Vi=null}static mi(e){return new GC(e)}get fi(){if(this.Vi)return this.Vi;throw lt(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),De.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),De.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),De.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((r=>this.fi.add(r.toString())));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next((r=>{r.forEach((i=>this.fi.add(i.toString())))})).next((()=>s.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return De.forEach(this.fi,(s=>{const r=tt.fromPath(s);return this.gi(e,r).next((i=>{i||t.removeEntry(r,dt.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((s=>{s?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return De.or([()=>De.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class vv{constructor(e,t){this.persistence=e,this.pi=new Zh((s=>$Z(s.path)),((s,r)=>s.isEqual(r))),this.garbageCollector=Gee(this,t)}static mi(e,t){return new vv(e,t)}Ei(){}di(e){return De.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((s=>t.next((r=>s+r))))}wr(e){let t=0;return this.pr(e,(s=>{t++})).next((()=>t))}pr(e,t){return De.forEach(this.pi,((s,r)=>this.br(e,s,r).next((i=>i?De.resolve():t(r)))))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,(o=>this.br(e,o,t).next((a=>{a||(s++,i.removeEntry(o,dt.min()))})))).next((()=>i.apply(e))).next((()=>s))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),De.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),De.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),De.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),De.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=B1(e.data.value)),t}br(e,t,s){return De.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.pi.get(t);return De.resolve(r!==void 0&&r>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HC{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=r}static As(e,t){let s=Mt(),r=Mt();for(const i of t.docChanges)switch(i.type){case 0:s=s.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new HC(e,t.fromCache,s,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tte{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nte{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Kj()?8:AZ(Sr())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,r){const i={result:null};return this.ys(e,t).next((o=>{i.result=o})).next((()=>{if(!i.result)return this.ws(e,t,r,s).next((o=>{i.result=o}))})).next((()=>{if(i.result)return;const o=new tte;return this.Ss(e,t,o).next((a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)}))})).next((()=>i.result))}bs(e,t,s,r){return s.documentReadCount<this.fs?(rf()<=Rt.DEBUG&&Ke("QueryEngine","SDK will not create cache indexes for query:",of(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),De.resolve()):(rf()<=Rt.DEBUG&&Ke("QueryEngine","Query:",of(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.gs*r?(rf()<=Rt.DEBUG&&Ke("QueryEngine","The SDK decides to create cache indexes for query:",of(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ma(t))):De.resolve())}ys(e,t){if(OO(t))return De.resolve(null);let s=ma(t);return this.indexManager.getIndexType(e,s).next((r=>r===0?null:(t.limit!==null&&r===1&&(t=gv(t,null,"F"),s=ma(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next((i=>{const o=Mt(...i);return this.ps.getDocuments(e,o).next((a=>this.indexManager.getMinOffset(e,s).next((l=>{const u=this.Ds(t,a);return this.Cs(t,u,o,l.readTime)?this.ys(e,gv(t,null,"F")):this.vs(e,u,t,l)}))))})))))}ws(e,t,s,r){return OO(t)||r.isEqual(dt.min())?De.resolve(null):this.ps.getDocuments(e,s).next((i=>{const o=this.Ds(t,i);return this.Cs(t,o,s,r)?De.resolve(null):(rf()<=Rt.DEBUG&&Ke("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),of(t)),this.vs(e,o,t,_Z(r,wg)).next((a=>a)))}))}Ds(e,t){let s=new Rs(c4(e));return t.forEach(((r,i)=>{Nw(e,i)&&(s=s.add(i))})),s}Cs(e,t,s,r){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,s){return rf()<=Rt.DEBUG&&Ke("QueryEngine","Using full collection scan to execute query:",of(t)),this.ps.getDocumentsMatchingQuery(e,t,Xu.min(),s)}vs(e,t,s,r){return this.ps.getDocumentsMatchingQuery(e,s,r).next((i=>(t.forEach((o=>{i=i.insert(o.key,o)})),i)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qC="LocalStore",ste=3e8;class rte{constructor(e,t,s,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new Gn(Dt),this.xs=new Zh((i=>OC(i)),PC),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Wee(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function ite(n,e,t,s){return new rte(n,e,t,s)}async function O4(n,e){const t=mt(n);return await t.persistence.runTransaction("Handle user change","readonly",(s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next((i=>(r=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(s)))).next((i=>{const o=[],a=[];let l=Mt();for(const u of r){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of i){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(s,l).next((u=>({Ls:u,removedBatchIds:o,addedBatchIds:a})))}))}))}function ote(n,e){const t=mt(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(s=>{const r=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(a,l,u,h){const f=u.batch,p=f.keys();let g=De.resolve();return p.forEach((b=>{g=g.next((()=>h.getEntry(l,b))).next((T=>{const w=u.docVersions.get(b);on(w!==null,48541),T.version.compareTo(w)<0&&(f.applyToRemoteDocument(T,u),T.isValidDocument()&&(T.setReadTime(u.commitVersion),h.addEntry(T)))}))})),g.next((()=>a.mutationQueue.removeMutationBatch(l,f)))})(t,s,e,i).next((()=>i.apply(s))).next((()=>t.mutationQueue.performConsistencyCheck(s))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,(function(a){let l=Mt();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l})(e)))).next((()=>t.localDocuments.getDocuments(s,r)))}))}function P4(n){const e=mt(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function ate(n,e){const t=mt(n),s=e.snapshotVersion;let r=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});r=t.Ms;const a=[];e.targetChanges.forEach(((h,f)=>{const p=r.get(f);if(!p)return;a.push(t.Pi.removeMatchingKeys(i,h.removedDocuments,f).next((()=>t.Pi.addMatchingKeys(i,h.addedDocuments,f))));let g=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?g=g.withResumeToken(rr.EMPTY_BYTE_STRING,dt.min()).withLastLimboFreeSnapshotVersion(dt.min()):h.resumeToken.approximateByteSize()>0&&(g=g.withResumeToken(h.resumeToken,s)),r=r.insert(f,g),(function(T,w,_){return T.resumeToken.approximateByteSize()===0||w.snapshotVersion.toMicroseconds()-T.snapshotVersion.toMicroseconds()>=ste?!0:_.addedDocuments.size+_.modifiedDocuments.size+_.removedDocuments.size>0})(p,g,h)&&a.push(t.Pi.updateTargetData(i,g))}));let l=Tl(),u=Mt();if(e.documentUpdates.forEach((h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))})),a.push(lte(i,o,e.documentUpdates).next((h=>{l=h.ks,u=h.qs}))),!s.isEqual(dt.min())){const h=t.Pi.getLastRemoteSnapshotVersion(i).next((f=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,s)));a.push(h)}return De.waitFor(a).next((()=>o.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,l,u))).next((()=>l))})).then((i=>(t.Ms=r,i)))}function lte(n,e,t){let s=Mt(),r=Mt();return t.forEach((i=>s=s.add(i))),e.getEntries(n,s).next((i=>{let o=Tl();return t.forEach(((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(r=r.add(a)),l.isNoDocument()&&l.version.isEqual(dt.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):Ke(qC,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)})),{ks:o,qs:r}}))}function ute(n,e){const t=mt(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(s=>(e===void 0&&(e=RC),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e))))}function cte(n,e){const t=mt(n);return t.persistence.runTransaction("Allocate target","readwrite",(s=>{let r;return t.Pi.getTargetData(s,e).next((i=>i?(r=i,De.resolve(r)):t.Pi.allocateTargetId(s).next((o=>(r=new Au(e,o,"TargetPurposeListen",s.currentSequenceNumber),t.Pi.addTargetData(s,r).next((()=>r)))))))})).then((s=>{const r=t.Ms.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(s.targetId,s),t.xs.set(e,s.targetId)),s}))}async function HE(n,e,t){const s=mt(n),r=s.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",i,(o=>s.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!dp(o))throw o;Ke(qC,`Failed to update sequence numbers for target ${e}: ${o}`)}s.Ms=s.Ms.remove(e),s.xs.delete(r.target)}function XO(n,e,t){const s=mt(n);let r=dt.min(),i=Mt();return s.persistence.runTransaction("Execute query","readwrite",(o=>(function(l,u,h){const f=mt(l),p=f.xs.get(h);return p!==void 0?De.resolve(f.Ms.get(p)):f.Pi.getTargetData(u,h)})(s,o,ma(e)).next((a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(o,a.targetId).next((l=>{i=l}))})).next((()=>s.Fs.getDocumentsMatchingQuery(o,e,t?r:dt.min(),t?i:Mt()))).next((a=>(hte(s,JZ(e),a),{documents:a,Qs:i})))))}function hte(n,e,t){let s=n.Os.get(e)||dt.min();t.forEach(((r,i)=>{i.readTime.compareTo(s)>0&&(s=i.readTime)})),n.Os.set(e,s)}class YO{constructor(){this.activeTargetIds=nee()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class dte{constructor(){this.Mo=new YO,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new YO,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fte{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JO="ConnectivityMonitor";class jO{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ke(JO,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ke(JO,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let T1=null;function qE(){return T1===null?T1=(function(){return 268435456+Math.round(2147483648*Math.random())})():T1++,"0x"+T1.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y_="RestConnection",pte={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class mte{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${r}`,this.Wo=this.databaseId.database===fv?`project_id=${s}`:`project_id=${s}&database_id=${r}`}Go(e,t,s,r,i){const o=qE(),a=this.zo(e,t.toUriEncodedString());Ke(Y_,`Sending RPC '${e}' ${o}:`,a,s);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,r,i);const{host:u}=new URL(a),h=lp(u);return this.Jo(e,a,l,s,h).then((f=>(Ke(Y_,`Received RPC '${e}' ${o}: `,f),f)),(f=>{throw Pf(Y_,`RPC '${e}' ${o} failed with error: `,f,"url: ",a,"request:",s),f}))}Ho(e,t,s,r,i,o){return this.Go(e,t,s,r,i)}jo(e,t,s){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+cp})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((r,i)=>e[i]=r)),s&&s.headers.forEach(((r,i)=>e[i]=r))}zo(e,t){const s=pte[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gte{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hr="WebChannelConnection";class yte extends mte{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,r,i){const o=qE();return new Promise(((a,l)=>{const u=new FV;u.setWithCredentials(!0),u.listenOnce(LV.COMPLETE,(()=>{try{switch(u.getLastErrorCode()){case V1.NO_ERROR:const f=u.getResponseJson();Ke(hr,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),a(f);break;case V1.TIMEOUT:Ke(hr,`RPC '${e}' ${o} timed out`),l(new qe(Ae.DEADLINE_EXCEEDED,"Request time out"));break;case V1.HTTP_ERROR:const p=u.getStatus();if(Ke(hr,`RPC '${e}' ${o} failed with status:`,p,"response text:",u.getResponseText()),p>0){let g=u.getResponseJson();Array.isArray(g)&&(g=g[0]);const b=g==null?void 0:g.error;if(b&&b.status&&b.message){const T=(function(_){const C=_.toLowerCase().replace(/_/g,"-");return Object.values(Ae).indexOf(C)>=0?C:Ae.UNKNOWN})(b.status);l(new qe(T,b.message))}else l(new qe(Ae.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new qe(Ae.UNAVAILABLE,"Connection failed."));break;default:lt(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{Ke(hr,`RPC '${e}' ${o} completed.`)}}));const h=JSON.stringify(r);Ke(hr,`RPC '${e}' ${o} sending request:`,r),u.send(t,"POST",h,s,15)}))}T_(e,t,s){const r=qE(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=UV(),a=BV(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,s),l.encodeInitMessageHeaders=!0;const h=i.join("");Ke(hr,`Creating RPC '${e}' stream ${r}: ${h}`,l);const f=o.createWebChannel(h,l);this.I_(f);let p=!1,g=!1;const b=new gte({Yo:w=>{g?Ke(hr,`Not sending because RPC '${e}' stream ${r} is closed:`,w):(p||(Ke(hr,`Opening RPC '${e}' stream ${r} transport.`),f.open(),p=!0),Ke(hr,`RPC '${e}' stream ${r} sending:`,w),f.send(w))},Zo:()=>f.close()}),T=(w,_,C)=>{w.listen(_,(N=>{try{C(N)}catch(A){setTimeout((()=>{throw A}),0)}}))};return T(f,Ym.EventType.OPEN,(()=>{g||(Ke(hr,`RPC '${e}' stream ${r} transport opened.`),b.o_())})),T(f,Ym.EventType.CLOSE,(()=>{g||(g=!0,Ke(hr,`RPC '${e}' stream ${r} transport closed`),b.a_(),this.E_(f))})),T(f,Ym.EventType.ERROR,(w=>{g||(g=!0,Pf(hr,`RPC '${e}' stream ${r} transport errored. Name:`,w.name,"Message:",w.message),b.a_(new qe(Ae.UNAVAILABLE,"The operation could not be completed")))})),T(f,Ym.EventType.MESSAGE,(w=>{var _;if(!g){const C=w.data[0];on(!!C,16349);const N=C,A=(N==null?void 0:N.error)||((_=N[0])==null?void 0:_.error);if(A){Ke(hr,`RPC '${e}' stream ${r} received error:`,A);const P=A.status;let V=(function($){const O=ms[$];if(O!==void 0)return S4(O)})(P),D=A.message;V===void 0&&(V=Ae.INTERNAL,D="Unknown error status: "+P+" with message "+A.message),g=!0,b.a_(new qe(V,D)),f.close()}else Ke(hr,`RPC '${e}' stream ${r} received:`,C),b.u_(C)}})),T(a,VV.STAT_EVENT,(w=>{w.stat===DE.PROXY?Ke(hr,`RPC '${e}' stream ${r} detected buffering proxy`):w.stat===DE.NOPROXY&&Ke(hr,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{b.__()}),0),b}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function J_(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rw(n){return new Tee(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F4{constructor(e,t,s=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-s);r>0&&Ke("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QO="PersistentStream";class L4{constructor(e,t,s,r,i,o,a,l){this.Mi=e,this.S_=s,this.b_=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new F4(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===Ae.RESOURCE_EXHAUSTED?(vl(t.toString()),vl("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===Ae.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([s,r])=>{this.D_===t&&this.G_(s,r)}),(s=>{e((()=>{const r=new qe(Ae.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(r)}))}))}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{s((()=>this.listener.Xo()))})),this.stream.t_((()=>{s((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((r=>{s((()=>this.z_(r)))})),this.stream.onMessage((r=>{s((()=>++this.F_==1?this.J_(r):this.onNext(r)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Ke(QO,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(Ke(QO,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class bte extends L4{constructor(e,t,s,r,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=_ee(this.serializer,e),s=(function(i){if(!("targetChange"in i))return dt.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?dt.min():o.readTime?ya(o.readTime):dt.min()})(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=GE(this.serializer),t.addTarget=(function(i,o){let a;const l=o.target;if(a=LE(l)?{documents:Cee(i,l)}:{query:Nee(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=I4(i,o.resumeToken);const u=BE(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(dt.min())>0){a.readTime=bv(i,o.snapshotVersion.toTimestamp());const u=BE(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a})(this.serializer,e);const s=kee(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=GE(this.serializer),t.removeTarget=e,this.q_(t)}}class vte extends L4{constructor(e,t,s,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return on(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,on(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){on(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=Iee(e.writeResults,e.commitTime),s=ya(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=GE(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((s=>Eee(this.serializer,s)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wte{}class Tte extends wte{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new qe(Ae.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.Go(e,UE(t,s),r,i,o))).catch((i=>{throw i.name==="FirebaseError"?(i.code===Ae.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new qe(Ae.UNKNOWN,i.toString())}))}Ho(e,t,s,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Ho(e,UE(t,s),r,o,a,i))).catch((o=>{throw o.name==="FirebaseError"?(o.code===Ae.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new qe(Ae.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class xte{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(vl(t),this.aa=!1):Ke("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rh="RemoteStore";class Ste{constructor(e,t,s,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((o=>{s.enqueueAndForget((async()=>{ed(this)&&(Ke(Rh,"Restarting streams for network reachability change."),await(async function(l){const u=mt(l);u.Ea.add(4),await ay(u),u.Ra.set("Unknown"),u.Ea.delete(4),await Dw(u)})(this))}))})),this.Ra=new xte(s,r)}}async function Dw(n){if(ed(n))for(const e of n.da)await e(!0)}async function ay(n){for(const e of n.da)await e(!1)}function V4(n,e){const t=mt(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),YC(t)?XC(t):pp(t).O_()&&KC(t,e))}function WC(n,e){const t=mt(n),s=pp(t);t.Ia.delete(e),s.O_()&&B4(t,e),t.Ia.size===0&&(s.O_()?s.L_():ed(t)&&t.Ra.set("Unknown"))}function KC(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(dt.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}pp(n).Y_(e)}function B4(n,e){n.Va.Ue(e),pp(n).Z_(e)}function XC(n){n.Va=new yee({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),pp(n).start(),n.Ra.ua()}function YC(n){return ed(n)&&!pp(n).x_()&&n.Ia.size>0}function ed(n){return mt(n).Ea.size===0}function U4(n){n.Va=void 0}async function _te(n){n.Ra.set("Online")}async function Ete(n){n.Ia.forEach(((e,t)=>{KC(n,e)}))}async function Ite(n,e){U4(n),YC(n)?(n.Ra.ha(e),XC(n)):n.Ra.set("Unknown")}async function Cte(n,e,t){if(n.Ra.set("Online"),e instanceof E4&&e.state===2&&e.cause)try{await(async function(r,i){const o=i.cause;for(const a of i.targetIds)r.Ia.has(a)&&(await r.remoteSyncer.rejectListen(a,o),r.Ia.delete(a),r.Va.removeTarget(a))})(n,e)}catch(s){Ke(Rh,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await wv(n,s)}else if(e instanceof G1?n.Va.Ze(e):e instanceof _4?n.Va.st(e):n.Va.tt(e),!t.isEqual(dt.min()))try{const s=await P4(n.localStore);t.compareTo(s)>=0&&await(function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach(((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.Ia.get(u);h&&i.Ia.set(u,h.withResumeToken(l.resumeToken,o))}})),a.targetMismatches.forEach(((l,u)=>{const h=i.Ia.get(l);if(!h)return;i.Ia.set(l,h.withResumeToken(rr.EMPTY_BYTE_STRING,h.snapshotVersion)),B4(i,l);const f=new Au(h.target,l,u,h.sequenceNumber);KC(i,f)})),i.remoteSyncer.applyRemoteEvent(a)})(n,t)}catch(s){Ke(Rh,"Failed to raise snapshot:",s),await wv(n,s)}}async function wv(n,e,t){if(!dp(e))throw e;n.Ea.add(1),await ay(n),n.Ra.set("Offline"),t||(t=()=>P4(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{Ke(Rh,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Dw(n)}))}function z4(n,e){return e().catch((t=>wv(n,t,e)))}async function Mw(n){const e=mt(n),t=Qu(e);let s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:RC;for(;Nte(e);)try{const r=await ute(e.localStore,s);if(r===null){e.Ta.length===0&&t.L_();break}s=r.batchId,Ate(e,r)}catch(r){await wv(e,r)}G4(e)&&H4(e)}function Nte(n){return ed(n)&&n.Ta.length<10}function Ate(n,e){n.Ta.push(e);const t=Qu(n);t.O_()&&t.X_&&t.ea(e.mutations)}function G4(n){return ed(n)&&!Qu(n).x_()&&n.Ta.length>0}function H4(n){Qu(n).start()}async function kte(n){Qu(n).ra()}async function $te(n){const e=Qu(n);for(const t of n.Ta)e.ea(t.mutations)}async function Rte(n,e,t){const s=n.Ta.shift(),r=VC.from(s,e,t);await z4(n,(()=>n.remoteSyncer.applySuccessfulWrite(r))),await Mw(n)}async function Dte(n,e){e&&Qu(n).X_&&await(async function(s,r){if((function(o){return pee(o)&&o!==Ae.ABORTED})(r.code)){const i=s.Ta.shift();Qu(s).B_(),await z4(s,(()=>s.remoteSyncer.rejectFailedWrite(i.batchId,r))),await Mw(s)}})(n,e),G4(n)&&H4(n)}async function ZO(n,e){const t=mt(n);t.asyncQueue.verifyOperationInProgress(),Ke(Rh,"RemoteStore received new credentials");const s=ed(t);t.Ea.add(3),await ay(t),s&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Dw(t)}async function Mte(n,e){const t=mt(n);e?(t.Ea.delete(2),await Dw(t)):e||(t.Ea.add(2),await ay(t),t.Ra.set("Unknown"))}function pp(n){return n.ma||(n.ma=(function(t,s,r){const i=mt(t);return i.sa(),new bte(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)})(n.datastore,n.asyncQueue,{Xo:_te.bind(null,n),t_:Ete.bind(null,n),r_:Ite.bind(null,n),H_:Cte.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),YC(n)?XC(n):n.Ra.set("Unknown")):(await n.ma.stop(),U4(n))}))),n.ma}function Qu(n){return n.fa||(n.fa=(function(t,s,r){const i=mt(t);return i.sa(),new vte(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:kte.bind(null,n),r_:Dte.bind(null,n),ta:$te.bind(null,n),na:Rte.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await Mw(n)):(await n.fa.stop(),n.Ta.length>0&&(Ke(Rh,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JC{constructor(e,t,s,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new pl,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,i){const o=Date.now()+s,a=new JC(e,t,o,r,i);return a.start(s),a}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new qe(Ae.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function jC(n,e){if(vl("AsyncQueue",`${e}: ${n}`),dp(n))return new qe(Ae.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bf{static emptySet(e){return new bf(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||tt.comparator(t.key,s.key):(t,s)=>tt.comparator(t.key,s.key),this.keyedMap=Jm(),this.sortedSet=new Gn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,s)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof bf)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new bf;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eP{constructor(){this.ga=new Gn(tt.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):lt(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,s)=>{e.push(s)})),e}}class Uf{constructor(e,t,s,r,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,s,r,i){const o=[];return t.forEach((a=>{o.push({type:0,doc:a})})),new Uf(e,t,bf.emptySet(t),o,s,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Cw(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ote{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class Pte{constructor(){this.queries=tP(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const r=mt(t),i=r.queries;r.queries=tP(),i.forEach(((o,a)=>{for(const l of a.Sa)l.onError(s)}))})(this,new qe(Ae.ABORTED,"Firestore shutting down"))}}function tP(){return new Zh((n=>u4(n)),Cw)}async function q4(n,e){const t=mt(n);let s=3;const r=e.query;let i=t.queries.get(r);i?!i.ba()&&e.Da()&&(s=2):(i=new Ote,s=e.Da()?0:1);try{switch(s){case 0:i.wa=await t.onListen(r,!0);break;case 1:i.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(o){const a=jC(o,`Initialization of query '${of(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&QC(t)}async function W4(n,e){const t=mt(n),s=e.query;let r=3;const i=t.queries.get(s);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?r=e.Da()?0:1:!i.ba()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function Fte(n,e){const t=mt(n);let s=!1;for(const r of e){const i=r.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(r)&&(s=!0);o.wa=r}}s&&QC(t)}function Lte(n,e,t){const s=mt(n),r=s.queries.get(e);if(r)for(const i of r.Sa)i.onError(t);s.queries.delete(e)}function QC(n){n.Ca.forEach((e=>{e.next()}))}var WE,nP;(nP=WE||(WE={})).Ma="default",nP.Cache="cache";class K4{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new Uf(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Uf.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==WE.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X4{constructor(e){this.key=e}}class Y4{constructor(e){this.key=e}}class Vte{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Mt(),this.mutatedKeys=Mt(),this.eu=c4(e),this.tu=new bf(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new eP,r=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1;const l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,u=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((h,f)=>{const p=r.get(h),g=Nw(this.query,f)?f:null,b=!!p&&this.mutatedKeys.has(p.key),T=!!g&&(g.hasLocalMutations||this.mutatedKeys.has(g.key)&&g.hasCommittedMutations);let w=!1;p&&g?p.data.isEqual(g.data)?b!==T&&(s.track({type:3,doc:g}),w=!0):this.su(p,g)||(s.track({type:2,doc:g}),w=!0,(l&&this.eu(g,l)>0||u&&this.eu(g,u)<0)&&(a=!0)):!p&&g?(s.track({type:0,doc:g}),w=!0):p&&!g&&(s.track({type:1,doc:p}),w=!0,(l||u)&&(a=!0)),w&&(g?(o=o.add(g),i=T?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))})),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),s.track({type:1,doc:h})}return{tu:o,iu:s,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort(((h,f)=>(function(g,b){const T=w=>{switch(w){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return lt(20277,{Rt:w})}};return T(g)-T(b)})(h.type,f.type)||this.eu(h.doc,f.doc))),this.ou(s),r=r??!1;const a=t&&!r?this._u():[],l=this.Xa.size===0&&this.current&&!r?1:0,u=l!==this.Za;return this.Za=l,o.length!==0||u?{snapshot:new Uf(this.query,e.tu,i,o,e.mutatedKeys,l===0,u,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new eP,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Mt(),this.tu.forEach((s=>{this.uu(s.key)&&(this.Xa=this.Xa.add(s.key))}));const t=[];return e.forEach((s=>{this.Xa.has(s)||t.push(new Y4(s))})),this.Xa.forEach((s=>{e.has(s)||t.push(new X4(s))})),t}cu(e){this.Ya=e.Qs,this.Xa=Mt();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Uf.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const ZC="SyncEngine";class Bte{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class Ute{constructor(e){this.key=e,this.hu=!1}}class zte{constructor(e,t,s,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Zh((a=>u4(a)),Cw),this.Iu=new Map,this.Eu=new Set,this.du=new Gn(tt.comparator),this.Au=new Map,this.Ru=new zC,this.Vu={},this.mu=new Map,this.fu=Bf.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Gte(n,e,t=!0){const s=tB(n);let r;const i=s.Tu.get(e);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.lu()):r=await J4(s,e,t,!0),r}async function Hte(n,e){const t=tB(n);await J4(t,e,!0,!1)}async function J4(n,e,t,s){const r=await cte(n.localStore,ma(e)),i=r.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return s&&(a=await qte(n,e,i,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&V4(n.remoteStore,r),a}async function qte(n,e,t,s,r){n.pu=(f,p,g)=>(async function(T,w,_,C){let N=w.view.ru(_);N.Cs&&(N=await XO(T.localStore,w.query,!1).then((({documents:D})=>w.view.ru(D,N))));const A=C&&C.targetChanges.get(w.targetId),P=C&&C.targetMismatches.get(w.targetId)!=null,V=w.view.applyChanges(N,T.isPrimaryClient,A,P);return rP(T,w.targetId,V.au),V.snapshot})(n,f,p,g);const i=await XO(n.localStore,e,!0),o=new Vte(e,i.Qs),a=o.ru(i.documents),l=oy.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",r),u=o.applyChanges(a,n.isPrimaryClient,l);rP(n,t,u.au);const h=new Bte(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function Wte(n,e,t){const s=mt(n),r=s.Tu.get(e),i=s.Iu.get(r.targetId);if(i.length>1)return s.Iu.set(r.targetId,i.filter((o=>!Cw(o,e)))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await HE(s.localStore,r.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(r.targetId),t&&WC(s.remoteStore,r.targetId),KE(s,r.targetId)})).catch(hp)):(KE(s,r.targetId),await HE(s.localStore,r.targetId,!0))}async function Kte(n,e){const t=mt(n),s=t.Tu.get(e),r=t.Iu.get(s.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),WC(t.remoteStore,s.targetId))}async function Xte(n,e,t){const s=tne(n);try{const r=await(function(o,a){const l=mt(o),u=Mn.now(),h=a.reduce(((g,b)=>g.add(b.key)),Mt());let f,p;return l.persistence.runTransaction("Locally write mutations","readwrite",(g=>{let b=Tl(),T=Mt();return l.Ns.getEntries(g,h).next((w=>{b=w,b.forEach(((_,C)=>{C.isValidDocument()||(T=T.add(_))}))})).next((()=>l.localDocuments.getOverlayedDocuments(g,b))).next((w=>{f=w;const _=[];for(const C of a){const N=uee(C,f.get(C.key).overlayedDocument);N!=null&&_.push(new gc(C.key,N,t4(N.value.mapValue),ga.exists(!0)))}return l.mutationQueue.addMutationBatch(g,u,_,a)})).next((w=>{p=w;const _=w.applyToLocalDocumentSet(f,T);return l.documentOverlayCache.saveOverlays(g,w.batchId,_)}))})).then((()=>({batchId:p.batchId,changes:d4(f)})))})(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),(function(o,a,l){let u=o.Vu[o.currentUser.toKey()];u||(u=new Gn(Dt)),u=u.insert(a,l),o.Vu[o.currentUser.toKey()]=u})(s,r.batchId,t),await ly(s,r.changes),await Mw(s.remoteStore)}catch(r){const i=jC(r,"Failed to persist write");t.reject(i)}}async function j4(n,e){const t=mt(n);try{const s=await ate(t.localStore,e);e.targetChanges.forEach(((r,i)=>{const o=t.Au.get(i);o&&(on(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?o.hu=!0:r.modifiedDocuments.size>0?on(o.hu,14607):r.removedDocuments.size>0&&(on(o.hu,42227),o.hu=!1))})),await ly(t,s,e)}catch(s){await hp(s)}}function sP(n,e,t){const s=mt(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const r=[];s.Tu.forEach(((i,o)=>{const a=o.view.va(e);a.snapshot&&r.push(a.snapshot)})),(function(o,a){const l=mt(o);l.onlineState=a;let u=!1;l.queries.forEach(((h,f)=>{for(const p of f.Sa)p.va(a)&&(u=!0)})),u&&QC(l)})(s.eventManager,e),r.length&&s.Pu.H_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function Yte(n,e,t){const s=mt(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.Au.get(e),i=r&&r.key;if(i){let o=new Gn(tt.comparator);o=o.insert(i,mr.newNoDocument(i,dt.min()));const a=Mt().add(i),l=new $w(dt.min(),new Map,new Gn(Dt),o,a);await j4(s,l),s.du=s.du.remove(i),s.Au.delete(e),eN(s)}else await HE(s.localStore,e,!1).then((()=>KE(s,e,t))).catch(hp)}async function Jte(n,e){const t=mt(n),s=e.batch.batchId;try{const r=await ote(t.localStore,e);Z4(t,s,null),Q4(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await ly(t,r)}catch(r){await hp(r)}}async function jte(n,e,t){const s=mt(n);try{const r=await(function(o,a){const l=mt(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",(u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next((f=>(on(f!==null,37113),h=f.keys(),l.mutationQueue.removeMutationBatch(u,f)))).next((()=>l.mutationQueue.performConsistencyCheck(u))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h))).next((()=>l.localDocuments.getDocuments(u,h)))}))})(s.localStore,e);Z4(s,e,t),Q4(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await ly(s,r)}catch(r){await hp(r)}}function Q4(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function Z4(n,e,t){const s=mt(n);let r=s.Vu[s.currentUser.toKey()];if(r){const i=r.get(e);i&&(t?i.reject(t):i.resolve(),r=r.remove(e)),s.Vu[s.currentUser.toKey()]=r}}function KE(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((s=>{n.Ru.containsKey(s)||eB(n,s)}))}function eB(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(WC(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),eN(n))}function rP(n,e,t){for(const s of t)s instanceof X4?(n.Ru.addReference(s.key,e),Qte(n,s)):s instanceof Y4?(Ke(ZC,"Document no longer in limbo: "+s.key),n.Ru.removeReference(s.key,e),n.Ru.containsKey(s.key)||eB(n,s.key)):lt(19791,{wu:s})}function Qte(n,e){const t=e.key,s=t.path.canonicalString();n.du.get(t)||n.Eu.has(s)||(Ke(ZC,"New document in limbo: "+t),n.Eu.add(s),eN(n))}function eN(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new tt(Nn.fromString(e)),s=n.fu.next();n.Au.set(s,new Ute(t)),n.du=n.du.insert(t,s),V4(n.remoteStore,new Au(ma(FC(t.path)),s,"TargetPurposeLimboResolution",_w.ce))}}async function ly(n,e,t){const s=mt(n),r=[],i=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach(((a,l)=>{o.push(s.pu(l,e,t).then((u=>{var h;if((u||t)&&s.isPrimaryClient){const f=u?!u.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:h.current;s.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(u){r.push(u);const f=HC.As(l.targetId,u);i.push(f)}})))})),await Promise.all(o),s.Pu.H_(r),await(async function(l,u){const h=mt(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",(f=>De.forEach(u,(p=>De.forEach(p.Es,(g=>h.persistence.referenceDelegate.addReference(f,p.targetId,g))).next((()=>De.forEach(p.ds,(g=>h.persistence.referenceDelegate.removeReference(f,p.targetId,g)))))))))}catch(f){if(!dp(f))throw f;Ke(qC,"Failed to update sequence numbers: "+f)}for(const f of u){const p=f.targetId;if(!f.fromCache){const g=h.Ms.get(p),b=g.snapshotVersion,T=g.withLastLimboFreeSnapshotVersion(b);h.Ms=h.Ms.insert(p,T)}}})(s.localStore,i))}async function Zte(n,e){const t=mt(n);if(!t.currentUser.isEqual(e)){Ke(ZC,"User change. New user:",e.toKey());const s=await O4(t.localStore,e);t.currentUser=e,(function(i,o){i.mu.forEach((a=>{a.forEach((l=>{l.reject(new qe(Ae.CANCELLED,o))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await ly(t,s.Ls)}}function ene(n,e){const t=mt(n),s=t.Au.get(e);if(s&&s.hu)return Mt().add(s.key);{let r=Mt();const i=t.Iu.get(e);if(!i)return r;for(const o of i){const a=t.Tu.get(o);r=r.unionWith(a.view.nu)}return r}}function tB(n){const e=mt(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=j4.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ene.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Yte.bind(null,e),e.Pu.H_=Fte.bind(null,e.eventManager),e.Pu.yu=Lte.bind(null,e.eventManager),e}function tne(n){const e=mt(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Jte.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=jte.bind(null,e),e}class Tv{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Rw(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return ite(this.persistence,new nte,e.initialUser,this.serializer)}Cu(e){return new M4(GC.mi,this.serializer)}Du(e){return new dte}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Tv.provider={build:()=>new Tv};class nne extends Tv{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){on(this.persistence.referenceDelegate instanceof vv,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new Uee(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?ti.withCacheSize(this.cacheSizeBytes):ti.DEFAULT;return new M4((s=>vv.mi(s,t)),this.serializer)}}class XE{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>sP(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Zte.bind(null,this.syncEngine),await Mte(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Pte})()}createDatastore(e){const t=Rw(e.databaseInfo.databaseId),s=(function(i){return new yte(i)})(e.databaseInfo);return(function(i,o,a,l){return new Tte(i,o,a,l)})(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return(function(s,r,i,o,a){return new Ste(s,r,i,o,a)})(this.localStore,this.datastore,e.asyncQueue,(t=>sP(this.syncEngine,t,0)),(function(){return jO.v()?new jO:new fte})())}createSyncEngine(e,t){return(function(r,i,o,a,l,u,h){const f=new zte(r,i,o,a,l,u);return h&&(f.gu=!0),f})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(r){const i=mt(r);Ke(Rh,"RemoteStore shutting down."),i.Ea.add(5),await ay(i),i.Aa.shutdown(),i.Ra.set("Unknown")})(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}XE.provider={build:()=>new XE};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nB{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):vl("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zu="FirestoreClient";class sne{constructor(e,t,s,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=r,this.user=fr.UNAUTHENTICATED,this.clientId=$C.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(s,(async o=>{Ke(Zu,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(s,(o=>(Ke(Zu,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new pl;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=jC(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}async function j_(n,e){n.asyncQueue.verifyOperationInProgress(),Ke(Zu,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener((async r=>{s.isEqual(r)||(await O4(e.localStore,r),s=r)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function iP(n,e){n.asyncQueue.verifyOperationInProgress();const t=await rne(n);Ke(Zu,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((s=>ZO(e.remoteStore,s))),n.setAppCheckTokenChangeListener(((s,r)=>ZO(e.remoteStore,r))),n._onlineComponents=e}async function rne(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Ke(Zu,"Using user provided OfflineComponentProvider");try{await j_(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(r){return r.name==="FirebaseError"?r.code===Ae.FAILED_PRECONDITION||r.code===Ae.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11})(t))throw t;Pf("Error using user provided cache. Falling back to memory cache: "+t),await j_(n,new Tv)}}else Ke(Zu,"Using default OfflineComponentProvider"),await j_(n,new nne(void 0));return n._offlineComponents}async function sB(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Ke(Zu,"Using user provided OnlineComponentProvider"),await iP(n,n._uninitializedComponentsProvider._online)):(Ke(Zu,"Using default OnlineComponentProvider"),await iP(n,new XE))),n._onlineComponents}function ine(n){return sB(n).then((e=>e.syncEngine))}async function rB(n){const e=await sB(n),t=e.eventManager;return t.onListen=Gte.bind(null,e.syncEngine),t.onUnlisten=Wte.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Hte.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Kte.bind(null,e.syncEngine),t}function one(n,e,t={}){const s=new pl;return n.asyncQueue.enqueueAndForget((async()=>(function(i,o,a,l,u){const h=new nB({next:p=>{h.Nu(),o.enqueueAndForget((()=>W4(i,f)));const g=p.docs.has(a);!g&&p.fromCache?u.reject(new qe(Ae.UNAVAILABLE,"Failed to get document because the client is offline.")):g&&p.fromCache&&l&&l.source==="server"?u.reject(new qe(Ae.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(p)},error:p=>u.reject(p)}),f=new K4(FC(a.path),h,{includeMetadataChanges:!0,qa:!0});return q4(i,f)})(await rB(n),n.asyncQueue,e,t,s))),s.promise}function ane(n,e,t={}){const s=new pl;return n.asyncQueue.enqueueAndForget((async()=>(function(i,o,a,l,u){const h=new nB({next:p=>{h.Nu(),o.enqueueAndForget((()=>W4(i,f))),p.fromCache&&l.source==="server"?u.reject(new qe(Ae.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(p)},error:p=>u.reject(p)}),f=new K4(a,h,{includeMetadataChanges:!0,qa:!0});return q4(i,f)})(await rB(n),n.asyncQueue,e,t,s))),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iB(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oP=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oB="firestore.googleapis.com",aP=!0;class lP{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new qe(Ae.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=oB,this.ssl=aP}else this.host=e.host,this.ssl=e.ssl??aP;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=D4;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Vee)throw new qe(Ae.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}SZ("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=iB(e.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new qe(Ae.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new qe(Ae.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new qe(Ae.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(s,r){return s.timeoutSeconds===r.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ow{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new lP({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new qe(Ae.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new qe(Ae.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new lP(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new fZ;switch(s.type){case"firstParty":return new yZ(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new qe(Ae.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const s=oP.get(t);s&&(Ke("ComponentProvider","Removing Datastore"),oP.delete(t),s.terminate())})(this),Promise.resolve()}}function lne(n,e,t,s={}){var u;n=wl(n,Ow);const r=lp(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;r&&(NV(`https://${a}`),AV("Firestore",!0)),i.host!==oB&&i.host!==a&&Pf("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:r,emulatorOptions:s};if(!Ah(l,o)&&(n._setSettings(l),s.mockUserToken)){let h,f;if(typeof s.mockUserToken=="string")h=s.mockUserToken,f=fr.MOCK_USER;else{h=Lj(s.mockUserToken,(u=n._app)==null?void 0:u.options.projectId);const p=s.mockUserToken.sub||s.mockUserToken.user_id;if(!p)throw new qe(Ae.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new fr(p)}n._authCredentials=new pZ(new GV(h,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yc{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new yc(this.firestore,e,this._query)}}class rs{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Bu(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new rs(this.firestore,e,this._key)}toJSON(){return{type:rs._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(ry(t,rs._jsonSchema))return new rs(e,s||null,new tt(Nn.fromString(t.referencePath)))}}rs._jsonSchemaVersion="firestore/documentReference/1.0",rs._jsonSchema={type:bs("string",rs._jsonSchemaVersion),referencePath:bs("string")};class Bu extends yc{constructor(e,t,s){super(e,t,FC(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new rs(this.firestore,null,new tt(e))}withConverter(e){return new Bu(this.firestore,e,this._path)}}function une(n,e,...t){if(n=Or(n),HV("collection","path",e),n instanceof Ow){const s=Nn.fromString(e,...t);return TO(s),new Bu(n,null,s)}{if(!(n instanceof rs||n instanceof Bu))throw new qe(Ae.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Nn.fromString(e,...t));return TO(s),new Bu(n.firestore,null,s)}}function zf(n,e,...t){if(n=Or(n),arguments.length===1&&(e=$C.newId()),HV("doc","path",e),n instanceof Ow){const s=Nn.fromString(e,...t);return wO(s),new rs(n,null,new tt(s))}{if(!(n instanceof rs||n instanceof Bu))throw new qe(Ae.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Nn.fromString(e,...t));return wO(s),new rs(n.firestore,n instanceof Bu?n.converter:null,new tt(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uP="AsyncQueue";class cP{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new F4(this,"async_queue_retry"),this._c=()=>{const s=J_();s&&Ke(uP,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=J_();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=J_();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new pl;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!dp(e))throw e;Ke(uP,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((s=>{throw this.nc=s,this.rc=!1,vl("INTERNAL UNHANDLED ERROR: ",hP(s)),s})).then((s=>(this.rc=!1,s))))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=JC.createAndSchedule(this,e,t,s,(i=>this.hc(i)));return this.tc.push(r),r}uc(){this.nc&&lt(47125,{Pc:hP(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,s)=>t.targetTimeMs-s.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function hP(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class uy extends Ow{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new cP,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new cP(e),this._firestoreClient=void 0,await e}}}function cne(n,e){const t=typeof n=="object"?n:DV(),s=typeof n=="string"?n:fv,r=AC(t,"firestore").getImmediate({identifier:s});if(!r._initialized){const i=Pj("firestore");i&&lne(r,...i)}return r}function tN(n){if(n._terminated)throw new qe(Ae.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||hne(n),n._firestoreClient}function hne(n){var s,r,i;const e=n._freezeSettings(),t=(function(a,l,u,h){return new MZ(a,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,iB(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)})(n._databaseId,((s=n._app)==null?void 0:s.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(r=e.localCache)!=null&&r._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new sne(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}})(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Wi(rr.fromBase64String(e))}catch(t){throw new qe(Ae.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Wi(rr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Wi._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ry(e,Wi._jsonSchema))return Wi.fromBase64String(e.bytes)}}Wi._jsonSchemaVersion="firestore/bytes/1.0",Wi._jsonSchema={type:bs("string",Wi._jsonSchemaVersion),bytes:bs("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pw{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new qe(Ae.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new nr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fw{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ba{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new qe(Ae.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new qe(Ae.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Dt(this._lat,e._lat)||Dt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ba._jsonSchemaVersion}}static fromJSON(e){if(ry(e,ba._jsonSchema))return new ba(e.latitude,e.longitude)}}ba._jsonSchemaVersion="firestore/geoPoint/1.0",ba._jsonSchema={type:bs("string",ba._jsonSchemaVersion),latitude:bs("number"),longitude:bs("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(s,r){if(s.length!==r.length)return!1;for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:va._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ry(e,va._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new va(e.vectorValues);throw new qe(Ae.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}va._jsonSchemaVersion="firestore/vectorValue/1.0",va._jsonSchema={type:bs("string",va._jsonSchemaVersion),vectorValues:bs("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dne=/^__.*__$/;class fne{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new gc(e,this.data,this.fieldMask,t,this.fieldTransforms):new iy(e,this.data,t,this.fieldTransforms)}}class aB{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new gc(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function lB(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw lt(40011,{Ac:n})}}class nN{constructor(e,t,s,r,i,o){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new nN({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var r;const t=(r=this.path)==null?void 0:r.child(e),s=this.Vc({path:t,fc:!1});return s.gc(e),s}yc(e){var r;const t=(r=this.path)==null?void 0:r.child(e),s=this.Vc({path:t,fc:!1});return s.Rc(),s}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return xv(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(lB(this.Ac)&&dne.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class pne{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||Rw(e)}Cc(e,t,s,r=!1){return new nN({Ac:e,methodName:t,Dc:s,path:nr.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function sN(n){const e=n._freezeSettings(),t=Rw(n._databaseId);return new pne(n._databaseId,!!e.ignoreUndefinedProperties,t)}function mne(n,e,t,s,r,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,r);iN("Data must be an object, but it was:",o,s);const a=uB(s,o);let l,u;if(i.merge)l=new Ti(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const p=YE(e,f,t);if(!o.contains(p))throw new qe(Ae.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);hB(h,p)||h.push(p)}l=new Ti(h),u=o.fieldTransforms.filter((f=>l.covers(f.field)))}else l=null,u=o.fieldTransforms;return new fne(new si(a),l,u)}class Lw extends Fw{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Lw}}class rN extends Fw{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new Cg(e.serializer,m4(e.serializer,this.Fc));return new iee(e.path,t)}isEqual(e){return e instanceof rN&&this.Fc===e.Fc}}function gne(n,e,t,s){const r=n.Cc(1,e,t);iN("Data must be an object, but it was:",r,s);const i=[],o=si.empty();mc(s,((l,u)=>{const h=oN(e,l,t);u=Or(u);const f=r.yc(h);if(u instanceof Lw)i.push(h);else{const p=cy(u,f);p!=null&&(i.push(h),o.set(h,p))}}));const a=new Ti(i);return new aB(o,a,r.fieldTransforms)}function yne(n,e,t,s,r,i){const o=n.Cc(1,e,t),a=[YE(e,s,t)],l=[r];if(i.length%2!=0)throw new qe(Ae.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)a.push(YE(e,i[p])),l.push(i[p+1]);const u=[],h=si.empty();for(let p=a.length-1;p>=0;--p)if(!hB(u,a[p])){const g=a[p];let b=l[p];b=Or(b);const T=o.yc(g);if(b instanceof Lw)u.push(g);else{const w=cy(b,T);w!=null&&(u.push(g),h.set(g,w))}}const f=new Ti(u);return new aB(h,f,o.fieldTransforms)}function bne(n,e,t,s=!1){return cy(t,n.Cc(s?4:3,e))}function cy(n,e){if(cB(n=Or(n)))return iN("Unsupported field value:",e,n),uB(n,e);if(n instanceof Fw)return(function(s,r){if(!lB(r.Ac))throw r.Sc(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Sc(`${s._methodName}() is not currently supported inside arrays`);const i=s._toFieldTransform(r);i&&r.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(s,r){const i=[];let o=0;for(const a of s){let l=cy(a,r.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}})(n,e)}return(function(s,r){if((s=Or(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return m4(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const i=Mn.fromDate(s);return{timestampValue:bv(r.serializer,i)}}if(s instanceof Mn){const i=new Mn(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:bv(r.serializer,i)}}if(s instanceof ba)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Wi)return{bytesValue:I4(r.serializer,s._byteString)};if(s instanceof rs){const i=r.databaseId,o=s.firestore._databaseId;if(!o.isEqual(i))throw r.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:UC(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof va)return(function(o,a){return{mapValue:{fields:{[ZV]:{stringValue:e4},[pv]:{arrayValue:{values:o.toArray().map((u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return LC(a.serializer,u)}))}}}}}})(s,r);throw r.Sc(`Unsupported field value: ${Sw(s)}`)})(n,e)}function uB(n,e){const t={};return KV(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):mc(n,((s,r)=>{const i=cy(r,e.mc(s));i!=null&&(t[s]=i)})),{mapValue:{fields:t}}}function cB(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Mn||n instanceof ba||n instanceof Wi||n instanceof rs||n instanceof Fw||n instanceof va)}function iN(n,e,t){if(!cB(t)||!qV(t)){const s=Sw(t);throw s==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+s)}}function YE(n,e,t){if((e=Or(e))instanceof Pw)return e._internalPath;if(typeof e=="string")return oN(n,e);throw xv("Field path arguments must be of type string or ",n,!1,void 0,t)}const vne=new RegExp("[~\\*/\\[\\]]");function oN(n,e,t){if(e.search(vne)>=0)throw xv(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Pw(...e.split("."))._internalPath}catch{throw xv(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function xv(n,e,t,s,r){const i=s&&!s.isEmpty(),o=r!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${s}`),o&&(l+=` in document ${r}`),l+=")"),new qe(Ae.INVALID_ARGUMENT,a+n+l)}function hB(n,e){return n.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dB{constructor(e,t,s,r,i){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new rs(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new wne(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(aN("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class wne extends dB{data(){return super.data()}}function aN(n,e){return typeof e=="string"?oN(n,e):e instanceof Pw?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tne(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new qe(Ae.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class lN{}class uN extends lN{}function xne(n,e,...t){let s=[];e instanceof lN&&s.push(e),s=s.concat(t),(function(i){const o=i.filter((l=>l instanceof hN)).length,a=i.filter((l=>l instanceof cN)).length;if(o>1||o>0&&a>0)throw new qe(Ae.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(s);for(const r of s)n=r._apply(n);return n}class cN extends uN{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new cN(e,t,s)}_apply(e){const t=this._parse(e);return fB(e._query,t),new yc(e.firestore,e.converter,VE(e._query,t))}_parse(e){const t=sN(e.firestore);return(function(i,o,a,l,u,h,f){let p;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new qe(Ae.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){fP(f,h);const b=[];for(const T of f)b.push(dP(l,i,T));p={arrayValue:{values:b}}}else p=dP(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||fP(f,h),p=bne(a,o,f,h==="in"||h==="not-in");return ys.create(u,h,p)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class hN extends lN{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new hN(e,t)}_parse(e){const t=this._queryConstraints.map((s=>s._parse(e))).filter((s=>s.getFilters().length>0));return t.length===1?t[0]:Do.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(r,i){let o=r;const a=i.getFlattenedFilters();for(const l of a)fB(o,l),o=VE(o,l)})(e._query,t),new yc(e.firestore,e.converter,VE(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class dN extends uN{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new dN(e,t)}_apply(e){const t=(function(r,i,o){if(r.startAt!==null)throw new qe(Ae.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new qe(Ae.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new _g(i,o)})(e._query,this._field,this._direction);return new yc(e.firestore,e.converter,(function(r,i){const o=r.explicitOrderBy.concat([i]);return new fp(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)})(e._query,t))}}function Sne(n,e="asc"){const t=e,s=aN("orderBy",n);return dN._create(s,t)}class fN extends uN{constructor(e,t,s){super(),this.type=e,this._limit=t,this._limitType=s}static _create(e,t,s){return new fN(e,t,s)}_apply(e){return new yc(e.firestore,e.converter,gv(e._query,this._limit,this._limitType))}}function _ne(n){return fN._create("limit",n,"F")}function dP(n,e,t){if(typeof(t=Or(t))=="string"){if(t==="")throw new qe(Ae.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!l4(e)&&t.indexOf("/")!==-1)throw new qe(Ae.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const s=e.path.child(Nn.fromString(t));if(!tt.isDocumentKey(s))throw new qe(Ae.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return AO(n,new tt(s))}if(t instanceof rs)return AO(n,t._key);throw new qe(Ae.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Sw(t)}.`)}function fP(n,e){if(!Array.isArray(n)||n.length===0)throw new qe(Ae.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function fB(n,e){const t=(function(r,i){for(const o of r)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null})(n.filters,(function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new qe(Ae.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new qe(Ae.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Ene{convertValue(e,t="none"){switch(ju(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ns(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ju(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw lt(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return mc(e,((r,i)=>{s[r]=this.convertValue(i,t)})),s}convertVectorValue(e){var s,r,i;const t=(i=(r=(s=e.fields)==null?void 0:s[pv].arrayValue)==null?void 0:r.values)==null?void 0:i.map((o=>ns(o.doubleValue)));return new va(t)}convertGeoPoint(e){return new ba(ns(e.latitude),ns(e.longitude))}convertArray(e,t){return(e.values||[]).map((s=>this.convertValue(s,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const s=Iw(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(Tg(e));default:return null}}convertTimestamp(e){const t=Yu(e);return new Mn(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=Nn.fromString(e);on(R4(s),9688,{name:e});const r=new xg(s.get(1),s.get(3)),i=new tt(s.popFirst(5));return r.isEqual(t)||vl(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ine(n,e,t){let s;return s=n?n.toFirestore(e):e,s}class Qm{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class xh extends dB{constructor(e,t,s,r,i,o){super(e,t,s,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new H1(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(aN("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new qe(Ae.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=xh._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}xh._jsonSchemaVersion="firestore/documentSnapshot/1.0",xh._jsonSchema={type:bs("string",xh._jsonSchemaVersion),bundleSource:bs("string","DocumentSnapshot"),bundleName:bs("string"),bundle:bs("string")};class H1 extends xh{data(e={}){return super.data(e)}}class vf{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Qm(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((s=>{e.call(t,new H1(this._firestore,this._userDataWriter,s.key,s,new Qm(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new qe(Ae.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(r,i){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map((a=>{const l=new H1(r._firestore,r._userDataWriter,a.doc.key,a.doc,new Qm(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}}))}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter((a=>i||a.type!==3)).map((a=>{const l=new H1(r._firestore,r._userDataWriter,a.doc.key,a.doc,new Qm(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:Cne(a.type),doc:l,oldIndex:u,newIndex:h}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new qe(Ae.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=vf._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=$C.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],r=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),s.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),r.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Cne(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return lt(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pN(n){n=wl(n,rs);const e=wl(n.firestore,uy);return one(tN(e),n._key).then((t=>kne(e,n,t)))}vf._jsonSchemaVersion="firestore/querySnapshot/1.0",vf._jsonSchema={type:bs("string",vf._jsonSchemaVersion),bundleSource:bs("string","QuerySnapshot"),bundleName:bs("string"),bundle:bs("string")};class pB extends Ene{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wi(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new rs(this.firestore,null,t)}}function Nne(n){n=wl(n,yc);const e=wl(n.firestore,uy),t=tN(e),s=new pB(e);return Tne(n._query),ane(t,n._query).then((r=>new vf(e,s,n,r)))}function Ane(n,e,t){n=wl(n,rs);const s=wl(n.firestore,uy),r=Ine(n.converter,e);return gB(s,[mne(sN(s),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,ga.none())])}function mB(n,e,t,...s){n=wl(n,rs);const r=wl(n.firestore,uy),i=sN(r);let o;return o=typeof(e=Or(e))=="string"||e instanceof Pw?yne(i,"updateDoc",n._key,e,t,s):gne(i,"updateDoc",n._key,e),gB(r,[o.toMutation(n._key,ga.exists(!0))])}function gB(n,e){return(function(s,r){const i=new pl;return s.asyncQueue.enqueueAndForget((async()=>Xte(await ine(s),r,i))),i.promise})(tN(n),e)}function kne(n,e,t){const s=t.docs.get(e._key),r=new pB(n);return new xh(n,r,e._key,s,new Qm(t.hasPendingWrites,t.fromCache),e.converter)}function pP(n){return new rN("increment",n)}(function(e,t=!0){(function(r){cp=r})(up),Of(new kh("firestore",((s,{instanceIdentifier:r,options:i})=>{const o=s.getProvider("app").getImmediate(),a=new uy(new mZ(s.getProvider("auth-internal")),new bZ(o,s.getProvider("app-check-internal")),(function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new qe(Ae.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xg(u.options.projectId,h)})(o,r),o);return i={useFetchStreams:t,...i},a._setSettings(i),a}),"PUBLIC").setMultipleInstances(!0)),Lu(gO,yO,e),Lu(gO,yO,"esm2020")})();function yB(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const $ne=yB,bB=new ny("auth","Firebase",yB());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sv=new CC("@firebase/auth");function Rne(n,...e){Sv.logLevel<=Rt.WARN&&Sv.warn(`Auth (${up}): ${n}`,...e)}function q1(n,...e){Sv.logLevel<=Rt.ERROR&&Sv.error(`Auth (${up}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xl(n,...e){throw mN(n,...e)}function wa(n,...e){return mN(n,...e)}function vB(n,e,t){const s={...$ne(),[e]:t};return new ny("auth","Firebase",s).create(e,{appName:n.name})}function Uu(n){return vB(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function mN(n,...e){if(typeof n!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(t,...s)}return bB.create(n,...e)}function ht(n,e,...t){if(!n)throw mN(e,...t)}function hl(n){const e="INTERNAL ASSERTION FAILED: "+n;throw q1(e),new Error(e)}function Sl(n,e){n||hl(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JE(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function Dne(){return mP()==="http:"||mP()==="https:"}function mP(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mne(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Dne()||Hj()||"connection"in navigator)?navigator.onLine:!0}function One(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hy{constructor(e,t){this.shortDelay=e,this.longDelay=t,Sl(t>e,"Short delay should be less than long delay!"),this.isMobile=Uj()||qj()}get(){return Mne()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gN(n,e){Sl(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wB{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;hl("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;hl("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;hl("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pne={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fne=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Lne=new hy(3e4,6e4);function Vw(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function mp(n,e,t,s,r={}){return TB(n,r,async()=>{let i={},o={};s&&(e==="GET"?o=s:i={body:JSON.stringify(s)});const a=sy({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...i};return Gj()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&lp(n.emulatorConfig.host)&&(u.credentials="include"),wB.fetch()(await SB(n,n.config.apiHost,t,a),u)})}async function TB(n,e,t){n._canInitEmulator=!1;const s={...Pne,...e};try{const r=new Vne(n),i=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw x1(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw x1(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw x1(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw x1(n,"user-disabled",o);const h=s[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw vB(n,h,u);xl(n,h)}}catch(r){if(r instanceof kl)throw r;xl(n,"network-request-failed",{message:String(r)})}}async function xB(n,e,t,s,r={}){const i=await mp(n,e,t,s,r);return"mfaPendingCredential"in i&&xl(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function SB(n,e,t,s){const r=`${e}${t}?${s}`,i=n,o=i.config.emulator?gN(n.config,r):`${n.config.apiScheme}://${r}`;return Fne.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}class Vne{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(wa(this.auth,"network-request-failed")),Lne.get())})}}function x1(n,e,t){const s={appName:n.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const r=wa(n,e,s);return r.customData._tokenResponse=t,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bne(n,e){return mp(n,"POST","/v1/accounts:delete",e)}async function _v(n,e){return mp(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dg(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Une(n,e=!1){const t=Or(n),s=await t.getIdToken(e),r=yN(s);ht(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const i=typeof r.firebase=="object"?r.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:r,token:s,authTime:dg(Q_(r.auth_time)),issuedAtTime:dg(Q_(r.iat)),expirationTime:dg(Q_(r.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Q_(n){return Number(n)*1e3}function yN(n){const[e,t,s]=n.split(".");if(e===void 0||t===void 0||s===void 0)return q1("JWT malformed, contained fewer than 3 sections"),null;try{const r=_V(t);return r?JSON.parse(r):(q1("Failed to decode base64 JWT payload"),null)}catch(r){return q1("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function gP(n){const e=yN(n);return ht(e,"internal-error"),ht(typeof e.exp<"u","internal-error"),ht(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ng(n,e,t=!1){if(t)return e;try{return await e}catch(s){throw s instanceof kl&&zne(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function zne({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gne{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jE{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=dg(this.lastLoginAt),this.creationTime=dg(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ev(n){var f;const e=n.auth,t=await n.getIdToken(),s=await Ng(n,_v(e,{idToken:t}));ht(s==null?void 0:s.users.length,e,"internal-error");const r=s.users[0];n._notifyReloadListener(r);const i=(f=r.providerUserInfo)!=null&&f.length?_B(r.providerUserInfo):[],o=qne(n.providerData,i),a=n.isAnonymous,l=!(n.email&&r.passwordHash)&&!(o!=null&&o.length),u=a?l:!1,h={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new jE(r.createdAt,r.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function Hne(n){const e=Or(n);await Ev(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function qne(n,e){return[...n.filter(s=>!e.some(r=>r.providerId===s.providerId)),...e]}function _B(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wne(n,e){const t=await TB(n,{},async()=>{const s=sy({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=n.config,o=await SB(n,r,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:s};return n.emulatorConfig&&lp(n.emulatorConfig.host)&&(l.credentials="include"),wB.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Kne(n,e){return mp(n,"POST","/v2/accounts:revokeToken",Vw(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wf{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ht(e.idToken,"internal-error"),ht(typeof e.idToken<"u","internal-error"),ht(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):gP(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ht(e.length!==0,"internal-error");const t=gP(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ht(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:r,expiresIn:i}=await Wne(e,t);this.updateTokensAndExpiration(s,r,Number(i))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:r,expirationTime:i}=t,o=new wf;return s&&(ht(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),r&&(ht(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),i&&(ht(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new wf,this.toJSON())}_performRefresh(){return hl("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wu(n,e){ht(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Eo{constructor({uid:e,auth:t,stsTokenManager:s,...r}){this.providerId="firebase",this.proactiveRefresh=new Gne(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new jE(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await Ng(this,this.stsTokenManager.getToken(this.auth,e));return ht(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Une(this,e)}reload(){return Hne(this)}_assign(e){this!==e&&(ht(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Eo({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){ht(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await Ev(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(_o(this.auth.app))return Promise.reject(Uu(this.auth));const e=await this.getIdToken();return await Ng(this,Bne(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const s=t.displayName??void 0,r=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:f,emailVerified:p,isAnonymous:g,providerData:b,stsTokenManager:T}=t;ht(f&&T,e,"internal-error");const w=wf.fromJSON(this.name,T);ht(typeof f=="string",e,"internal-error"),wu(s,e.name),wu(r,e.name),ht(typeof p=="boolean",e,"internal-error"),ht(typeof g=="boolean",e,"internal-error"),wu(i,e.name),wu(o,e.name),wu(a,e.name),wu(l,e.name),wu(u,e.name),wu(h,e.name);const _=new Eo({uid:f,auth:e,email:r,emailVerified:p,displayName:s,isAnonymous:g,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:w,createdAt:u,lastLoginAt:h});return b&&Array.isArray(b)&&(_.providerData=b.map(C=>({...C}))),l&&(_._redirectEventId=l),_}static async _fromIdTokenResponse(e,t,s=!1){const r=new wf;r.updateFromServerResponse(t);const i=new Eo({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:s});return await Ev(i),i}static async _fromGetAccountInfoResponse(e,t,s){const r=t.users[0];ht(r.localId!==void 0,"internal-error");const i=r.providerUserInfo!==void 0?_B(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!(i!=null&&i.length),a=new wf;a.updateFromIdToken(s);const l=new Eo({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new jE(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yP=new Map;function dl(n){Sl(n instanceof Function,"Expected a class definition");let e=yP.get(n);return e?(Sl(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,yP.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EB{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}EB.type="NONE";const bP=EB;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W1(n,e,t){return`firebase:${n}:${e}:${t}`}class Tf{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:r,name:i}=this.auth;this.fullUserKey=W1(this.userKey,r.apiKey,i),this.fullPersistenceKey=W1("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await _v(this.auth,{idToken:e}).catch(()=>{});return t?Eo._fromGetAccountInfoResponse(this.auth,t,e):null}return Eo._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,s="authUser"){if(!t.length)return new Tf(dl(bP),e,s);const r=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=r[0]||dl(bP);const o=W1(s,e.config.apiKey,e.name);let a=null;for(const u of t)try{const h=await u._get(o);if(h){let f;if(typeof h=="string"){const p=await _v(e,{idToken:h}).catch(()=>{});if(!p)break;f=await Eo._fromGetAccountInfoResponse(e,p,h)}else f=Eo._fromJSON(e,h);u!==i&&(a=f),i=u;break}}catch{}const l=r.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Tf(i,e,s):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new Tf(i,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vP(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(AB(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(IB(e))return"Firefox";if(e.includes("silk/"))return"Silk";if($B(e))return"Blackberry";if(RB(e))return"Webos";if(CB(e))return"Safari";if((e.includes("chrome/")||NB(e))&&!e.includes("edge/"))return"Chrome";if(kB(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(t);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function IB(n=Sr()){return/firefox\//i.test(n)}function CB(n=Sr()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function NB(n=Sr()){return/crios\//i.test(n)}function AB(n=Sr()){return/iemobile/i.test(n)}function kB(n=Sr()){return/android/i.test(n)}function $B(n=Sr()){return/blackberry/i.test(n)}function RB(n=Sr()){return/webos/i.test(n)}function bN(n=Sr()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Xne(n=Sr()){var e;return bN(n)&&!!((e=window.navigator)!=null&&e.standalone)}function Yne(){return Wj()&&document.documentMode===10}function DB(n=Sr()){return bN(n)||kB(n)||RB(n)||$B(n)||/windows phone/i.test(n)||AB(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MB(n,e=[]){let t;switch(n){case"Browser":t=vP(Sr());break;case"Worker":t=`${vP(Sr())}-${n}`;break;default:t=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${up}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jne{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});s.onAbort=t,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jne(n,e={}){return mp(n,"GET","/v2/passwordPolicy",Vw(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qne=6;class Zne{constructor(e){var s;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Qne,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((s=e.allowedNonAlphanumericCharacters)==null?void 0:s.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let r=0;r<e.length;r++)s=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ese{constructor(e,t,s,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new wP(this),this.idTokenSubscription=new wP(this),this.beforeStateQueue=new Jne(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=bB,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=dl(t)),this._initializationPromise=this.queue(async()=>{var s,r,i;if(!this._deleted&&(this.persistenceManager=await Tf.create(this,e),(s=this._resolvePersistenceManagerAvailable)==null||s.call(this),!this._deleted)){if((r=this._popupRedirectResolver)!=null&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await _v(this,{idToken:e}),s=await Eo._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(_o(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let s=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return ht(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ev(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=One()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(_o(this.app))return Promise.reject(Uu(this));const t=e?Or(e):null;return t&&ht(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ht(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return _o(this.app)?Promise.reject(Uu(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return _o(this.app)?Promise.reject(Uu(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(dl(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await jne(this),t=new Zne(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ny("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),await Kne(this,s)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&dl(e)||this._popupRedirectResolver;ht(t,this,"argument-error"),this.redirectPersistenceManager=await Tf.create(this,[dl(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,s;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((s=this.redirectUser)==null?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,r){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ht(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,s,r);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ht(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=MB(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var r;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((r=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:r.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){var t;if(_o(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&Rne(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Bw(n){return Or(n)}class wP{constructor(e){this.auth=e,this.observer=null,this.addObserver=eQ(t=>this.observer=t)}get next(){return ht(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function tse(n){vN=n}function nse(n){return vN.loadJS(n)}function sse(){return vN.gapiScript}function rse(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ise(n,e){const t=AC(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),i=t.getOptions();if(Ah(i,e??{}))return r;xl(r,"already-initialized")}return t.initialize({options:e})}function ose(n,e){const t=(e==null?void 0:e.persistence)||[],s=(Array.isArray(t)?t:[t]).map(dl);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function ase(n,e,t){const s=Bw(n);ht(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const r=!1,i=OB(e),{host:o,port:a}=lse(e),l=a===null?"":`:${a}`,u={url:`${i}//${o}${l}/`},h=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!s._canInitEmulator){ht(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),ht(Ah(u,s.config.emulator)&&Ah(h,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=u,s.emulatorConfig=h,s.settings.appVerificationDisabledForTesting=!0,lp(o)?(NV(`${i}//${o}${l}`),AV("Auth",!0)):use()}function OB(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function lse(n){const e=OB(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const i=r[1];return{host:i,port:TP(s.substr(i.length+1))}}else{const[i,o]=s.split(":");return{host:i,port:TP(o)}}}function TP(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function use(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PB{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return hl("not implemented")}_getIdTokenResponse(e){return hl("not implemented")}_linkToIdToken(e,t){return hl("not implemented")}_getReauthenticationResolver(e){return hl("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xf(n,e){return xB(n,"POST","/v1/accounts:signInWithIdp",Vw(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cse="http://localhost";class Dh extends PB{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Dh(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):xl("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:r,...i}=t;if(!s||!r)return null;const o=new Dh(s,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return xf(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,xf(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,xf(e,t)}buildRequest(){const e={requestUri:cse,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=sy(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FB{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dy extends FB{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _u extends dy{constructor(){super("facebook.com")}static credential(e){return Dh._fromParams({providerId:_u.PROVIDER_ID,signInMethod:_u.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return _u.credentialFromTaggedObject(e)}static credentialFromError(e){return _u.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return _u.credential(e.oauthAccessToken)}catch{return null}}}_u.FACEBOOK_SIGN_IN_METHOD="facebook.com";_u.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu extends dy{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Dh._fromParams({providerId:Eu.PROVIDER_ID,signInMethod:Eu.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Eu.credentialFromTaggedObject(e)}static credentialFromError(e){return Eu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return Eu.credential(t,s)}catch{return null}}}Eu.GOOGLE_SIGN_IN_METHOD="google.com";Eu.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iu extends dy{constructor(){super("github.com")}static credential(e){return Dh._fromParams({providerId:Iu.PROVIDER_ID,signInMethod:Iu.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Iu.credentialFromTaggedObject(e)}static credentialFromError(e){return Iu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Iu.credential(e.oauthAccessToken)}catch{return null}}}Iu.GITHUB_SIGN_IN_METHOD="github.com";Iu.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cu extends dy{constructor(){super("twitter.com")}static credential(e,t){return Dh._fromParams({providerId:Cu.PROVIDER_ID,signInMethod:Cu.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Cu.credentialFromTaggedObject(e)}static credentialFromError(e){return Cu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return Cu.credential(t,s)}catch{return null}}}Cu.TWITTER_SIGN_IN_METHOD="twitter.com";Cu.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hse(n,e){return xB(n,"POST","/v1/accounts:signUp",Vw(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s,r=!1){const i=await Eo._fromIdTokenResponse(e,s,r),o=xP(s);return new ec({user:i,providerId:o,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const r=xP(s);return new ec({user:e,providerId:r,_tokenResponse:s,operationType:t})}}function xP(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dse(n){var r;if(_o(n.app))return Promise.reject(Uu(n));const e=Bw(n);if(await e._initializationPromise,(r=e.currentUser)!=null&&r.isAnonymous)return new ec({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await hse(e,{returnSecureToken:!0}),s=await ec._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iv extends kl{constructor(e,t,s,r){super(t.code,t.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,Iv.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,r){return new Iv(e,t,s,r)}}function LB(n,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Iv._fromErrorAndOperation(n,i,e,s):i})}async function fse(n,e,t=!1){const s=await Ng(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return ec._forOperation(n,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pse(n,e,t=!1){const{auth:s}=n;if(_o(s.app))return Promise.reject(Uu(s));const r="reauthenticate";try{const i=await Ng(n,LB(s,r,e,n),t);ht(i.idToken,s,"internal-error");const o=yN(i.idToken);ht(o,s,"internal-error");const{sub:a}=o;return ht(n.uid===a,s,"user-mismatch"),ec._forOperation(n,r,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&xl(s,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mse(n,e,t=!1){if(_o(n.app))return Promise.reject(Uu(n));const s="signIn",r=await LB(n,s,e),i=await ec._fromIdTokenResponse(n,s,r);return t||await n._updateCurrentUser(i.user),i}function gse(n,e,t,s){return Or(n).onIdTokenChanged(e,t,s)}function yse(n,e,t){return Or(n).beforeAuthStateChanged(e,t)}const Cv="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VB{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Cv,"1"),this.storage.removeItem(Cv),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bse=1e3,vse=10;class BB extends VB{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=DB(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),r=this.localCache[t];s!==r&&e(t,r,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const s=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const o=this.storage.getItem(s);!t&&this.localCache[s]===o||this.notifyListeners(s,o)},i=this.storage.getItem(s);Yne()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,vse):r()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},bse)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}BB.type="LOCAL";const wse=BB;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UB extends VB{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}UB.type="SESSION";const zB=UB;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tse(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uw{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const s=new Uw(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:r,data:i}=t.data,o=this.handlersMap[r];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await Tse(a);t.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Uw.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wN(n="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xse{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,s=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=wN("",20);r.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},s);o={messageChannel:r,onMessage(f){const p=f;if(p.data.eventId===u)switch(p.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(p.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ta(){return window}function Sse(n){Ta().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GB(){return typeof Ta().WorkerGlobalScope<"u"&&typeof Ta().importScripts=="function"}async function _se(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Ese(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function Ise(){return GB()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HB="firebaseLocalStorageDb",Cse=1,Nv="firebaseLocalStorage",qB="fbase_key";class fy{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function zw(n,e){return n.transaction([Nv],e?"readwrite":"readonly").objectStore(Nv)}function Nse(){const n=indexedDB.deleteDatabase(HB);return new fy(n).toPromise()}function QE(){const n=indexedDB.open(HB,Cse);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(Nv,{keyPath:qB})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(Nv)?e(s):(s.close(),await Nse(),e(await QE()))})})}async function SP(n,e,t){const s=zw(n,!0).put({[qB]:e,value:t});return new fy(s).toPromise()}async function Ase(n,e){const t=zw(n,!1).get(e),s=await new fy(t).toPromise();return s===void 0?null:s.value}function _P(n,e){const t=zw(n,!0).delete(e);return new fy(t).toPromise()}const kse=800,$se=3;class WB{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await QE(),this.db)}async _withRetries(e){let t=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(t++>$se)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return GB()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Uw._getInstance(Ise()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,s;if(this.activeServiceWorker=await _se(),!this.activeServiceWorker)return;this.sender=new xse(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(s=e[0])!=null&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Ese()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await QE();return await SP(e,Cv,"1"),await _P(e,Cv),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>SP(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(s=>Ase(s,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>_P(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const i=zw(r,!1).getAll();return new fy(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:r,value:i}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),kse)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}WB.type="LOCAL";const Rse=WB;new hy(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dse(n,e){return e?dl(e):(ht(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TN extends PB{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return xf(e,this._buildIdpRequest())}_linkToIdToken(e,t){return xf(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return xf(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Mse(n){return mse(n.auth,new TN(n),n.bypassAuthState)}function Ose(n){const{auth:e,user:t}=n;return ht(t,e,"internal-error"),pse(t,new TN(n),n.bypassAuthState)}async function Pse(n){const{auth:e,user:t}=n;return ht(t,e,"internal-error"),fse(t,new TN(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KB{constructor(e,t,s,r,i=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:r,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:s,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Mse;case"linkViaPopup":case"linkViaRedirect":return Pse;case"reauthViaPopup":case"reauthViaRedirect":return Ose;default:xl(this.auth,"internal-error")}}resolve(e){Sl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Sl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fse=new hy(2e3,1e4);class gf extends KB{constructor(e,t,s,r,i){super(e,t,r,i),this.provider=s,this.authWindow=null,this.pollId=null,gf.currentPopupAction&&gf.currentPopupAction.cancel(),gf.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ht(e,this.auth,"internal-error"),e}async onExecution(){Sl(this.filter.length===1,"Popup operations only handle one event");const e=wN();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(wa(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(wa(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,gf.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,s;if((s=(t=this.authWindow)==null?void 0:t.window)!=null&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(wa(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Fse.get())};e()}}gf.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lse="pendingRedirect",K1=new Map;class Vse extends KB{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}async execute(){let e=K1.get(this.auth._key());if(!e){try{const s=await Bse(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}K1.set(this.auth._key(),e)}return this.bypassAuthState||K1.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Bse(n,e){const t=Gse(e),s=zse(n);if(!await s._isAvailable())return!1;const r=await s._get(t)==="true";return await s._remove(t),r}function Use(n,e){K1.set(n._key(),e)}function zse(n){return dl(n._redirectPersistence)}function Gse(n){return W1(Lse,n.config.apiKey,n.name)}async function Hse(n,e,t=!1){if(_o(n.app))return Promise.reject(Uu(n));const s=Bw(n),r=Dse(s,e),o=await new Vse(s,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qse=600*1e3;class Wse{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Kse(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var s;if(e.error&&!XB(e)){const r=((s=e.error.code)==null?void 0:s.split("auth/")[1])||"internal-error";t.onError(wa(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=qse&&this.cachedEventUids.clear(),this.cachedEventUids.has(EP(e))}saveEventToCache(e){this.cachedEventUids.add(EP(e)),this.lastProcessedEventTime=Date.now()}}function EP(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function XB({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function Kse(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return XB(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xse(n,e={}){return mp(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yse=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Jse=/^https?/;async function jse(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Xse(n);for(const t of e)try{if(Qse(t))return}catch{}xl(n,"unauthorized-domain")}function Qse(n){const e=JE(),{protocol:t,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&s===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===s}if(!Jse.test(t))return!1;if(Yse.test(n))return s===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zse=new hy(3e4,6e4);function IP(){const n=Ta().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function ere(n){return new Promise((e,t)=>{var r,i,o;function s(){IP(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{IP(),t(wa(n,"network-request-failed"))},timeout:Zse.get()})}if((i=(r=Ta().gapi)==null?void 0:r.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Ta().gapi)!=null&&o.load)s();else{const a=rse("iframefcb");return Ta()[a]=()=>{gapi.load?s():t(wa(n,"network-request-failed"))},nse(`${sse()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw X1=null,e})}let X1=null;function tre(n){return X1=X1||ere(n),X1}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nre=new hy(5e3,15e3),sre="__/auth/iframe",rre="emulator/auth/iframe",ire={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ore=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function are(n){const e=n.config;ht(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?gN(e,rre):`https://${n.config.authDomain}/${sre}`,s={apiKey:e.apiKey,appName:n.name,v:up},r=ore.get(n.config.apiHost);r&&(s.eid=r);const i=n._getFrameworks();return i.length&&(s.fw=i.join(",")),`${t}?${sy(s).slice(1)}`}async function lre(n){const e=await tre(n),t=Ta().gapi;return ht(t,n,"internal-error"),e.open({where:document.body,url:are(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ire,dontclear:!0},s=>new Promise(async(r,i)=>{await s.restyle({setHideOnLeave:!1});const o=wa(n,"network-request-failed"),a=Ta().setTimeout(()=>{i(o)},nre.get());function l(){Ta().clearTimeout(a),r(s)}s.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ure={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},cre=500,hre=600,dre="_blank",fre="http://localhost";class CP{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function pre(n,e,t,s=cre,r=hre){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const l={...ure,width:s.toString(),height:r.toString(),top:i,left:o},u=Sr().toLowerCase();t&&(a=NB(u)?dre:t),IB(u)&&(e=e||fre,l.scrollbars="yes");const h=Object.entries(l).reduce((p,[g,b])=>`${p}${g}=${b},`,"");if(Xne(u)&&a!=="_self")return mre(e||"",a),new CP(null);const f=window.open(e||"",a,h);ht(f,n,"popup-blocked");try{f.focus()}catch{}return new CP(f)}function mre(n,e){const t=document.createElement("a");t.href=n,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gre="__/auth/handler",yre="emulator/auth/handler",bre=encodeURIComponent("fac");async function NP(n,e,t,s,r,i){ht(n.config.authDomain,n,"auth-domain-config-required"),ht(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:s,v:up,eventId:r};if(e instanceof FB){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Zj(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries({}))o[h]=f}if(e instanceof dy){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),u=l?`#${bre}=${encodeURIComponent(l)}`:"";return`${vre(n)}?${sy(a).slice(1)}${u}`}function vre({config:n}){return n.emulator?gN(n,yre):`https://${n.authDomain}/${gre}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z_="webStorageSupport";class wre{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=zB,this._completeRedirectFn=Hse,this._overrideRedirectResult=Use}async _openPopup(e,t,s,r){var o;Sl((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await NP(e,t,s,JE(),r);return pre(e,i,wN())}async _openRedirect(e,t,s,r){await this._originValidation(e);const i=await NP(e,t,s,JE(),r);return Sse(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:i}=this.eventManagers[t];return r?Promise.resolve(r):(Sl(i,"If manager is not set, promise should be"),i)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await lre(e),s=new Wse(e);return t.register("authEvent",r=>(ht(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:s.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Z_,{type:Z_},r=>{var o;const i=(o=r==null?void 0:r[0])==null?void 0:o[Z_];i!==void 0&&t(!!i),xl(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=jse(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return DB()||CB()||bN()}}const Tre=wre;var AP="@firebase/auth",kP="1.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xre{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ht(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sre(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function _re(n){Of(new kh("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;ht(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:MB(n)},u=new ese(s,r,i,l);return ose(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),Of(new kh("auth-internal",e=>{const t=Bw(e.getProvider("auth").getImmediate());return(s=>new xre(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Lu(AP,kP,Sre(n)),Lu(AP,kP,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ere=300,Ire=CV("authIdTokenMaxAge")||Ere;let $P=null;const Cre=n=>async e=>{const t=e&&await e.getIdTokenResult(),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>Ire)return;const r=t==null?void 0:t.token;$P!==r&&($P=r,await fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function Nre(n=DV()){const e=AC(n,"auth");if(e.isInitialized())return e.getImmediate();const t=ise(n,{popupRedirectResolver:Tre,persistence:[Rse,wse,zB]}),s=CV("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(s,location.origin);if(location.origin===i.origin){const o=Cre(i.toString());yse(t,o,()=>o(t.currentUser)),gse(t,a=>o(a))}}const r=EV("auth");return r&&ase(t,`http://${r}`),t}function Are(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}tse({loadJS(n){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=r=>{const i=wa("internal-error");i.customData=r,t(i)},s.type="text/javascript",s.charset="UTF-8",Are().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});_re("Browser");const kre={apiKey:"AIzaSyC8Ro6nGLkqXgDU0rTL_rKkuL3vEmJEhTw",authDomain:"photoquest-72441.firebaseapp.com",projectId:"photoquest-72441",storageBucket:"photoquest-72441.firebasestorage.app",messagingSenderId:"368649991850",appId:"1:368649991850:web:cb7e782e83239865f0c2d3",measurementId:"G-GM6GWQWSJB"};let Dr=null,ZE=null;try{const n=RV(kre);Dr=cne(n),ZE=Nre(n),console.log("Firebase initialized successfully")}catch(n){console.error("Firebase init failed:",n)}const $l=()=>!!Dr,xN=n=>n.toLowerCase().trim().replace(/[\s\.]/g,"_"),$re=async(n,e)=>{if(!Dr)return null;const t=xN(n);try{const s=await pN(zf(Dr,"users",t));if(s.exists()){const r=s.data();if(r.password&&r.password!==e)throw new Error(" ");return localStorage.setItem("pq_userid",t),{username:r.username,score:r.score,tasksCompleted:r.tasksCompleted,joinedAt:r.joinedAt,currentTask:r.currentTask,skipsUsedToday:r.skipsUsedToday,lastSkipDate:r.lastSkipDate}}else throw new Error("  ")}catch(s){throw console.error("Login check failed:",s),s}},Rre=async(n,e)=>{if(!Dr)throw new Error("   .");if(ZE)try{await dse(ZE)}catch(o){console.warn("Auth failed, trying direct write...",o)}const t=xN(n);if((await pN(zf(Dr,"users",t))).exists())throw new Error("   .     .");const r={username:n,password:e||"",score:0,tasksCompleted:0,joinedAt:new Date().toISOString(),currentTask:null,skipsUsedToday:0,lastSkipDate:new Date().toDateString()};try{await Ane(zf(Dr,"users",t),r)}catch(o){throw console.error("Firestore Write Error:",o),o.code==="permission-denied"?new Error("   ."):o}return localStorage.setItem("pq_userid",t),{username:r.username,score:r.score,tasksCompleted:r.tasksCompleted,joinedAt:r.joinedAt,currentTask:r.currentTask,skipsUsedToday:r.skipsUsedToday,lastSkipDate:r.lastSkipDate}},Dre=async()=>{if(!Dr)return null;const n=localStorage.getItem("pq_userid");if(!n)return null;try{const e=await pN(zf(Dr,"users",n));if(e.exists())return e.data()}catch(e){console.error("Error getting user:",e)}return null},YB=async n=>{if(!Dr)return;const e=xN(n.username);try{const t=JSON.parse(JSON.stringify(n));await mB(zf(Dr,"users",e),t)}catch(t){console.error("Error saving user state:",t)}},Mre=async n=>{if(!Dr)return;const e=localStorage.getItem("pq_userid");if(!e)return;const t=zf(Dr,"users",e);try{await mB(t,{score:pP(n),tasksCompleted:pP(1),currentTask:null,lastActive:new Date().toISOString()})}catch(s){console.error("Error updating score:",s)}},Ore=async n=>{if(!Dr)return[];try{const e=xne(une(Dr,"users"),Sne("score","desc"),_ne(50)),t=await Nne(e),s=localStorage.getItem("pq_userid");return t.docs.map((i,o)=>{const a=i.data();return{rank:o+1,username:a.username,score:a.score,isCurrentUser:i.id===s}})}catch(e){return console.error("Error getting leaderboard:",e),[]}},JB="photoquest_user",RP=3;let Qi=!1;const Gw=()=>{const n=localStorage.getItem(JB);return n?JSON.parse(n):null},zu=n=>{localStorage.setItem(JB,JSON.stringify(n))},Pre=["","","2024","_","_","_","_","_","_","_","","","","77",""],Fre=n=>{const e=Gw(),t=n==="day"?new Date().getHours():new Date().getDate(),s=Pre.map((r,i)=>{const o=(i*17+t)%100;let a=0;return n==="day"?a=50+o*5:n==="week"?a=300+o*20:a=1500+o*50,{rank:0,username:r,score:a,isCurrentUser:!1}});return e&&s.push({rank:0,username:e.username,score:e.score,isCurrentUser:!0}),s.sort((r,i)=>i.score-r.score),s.map((r,i)=>({...r,rank:i+1}))},Lre=()=>Qi||!$l(),Vre=async(n,e)=>{if($l()&&!Qi)try{const s=await $re(n,e);if(s)return zu(s),s}catch(s){if(console.error("Login failed:",s.message),s.message.includes("")||s.message.includes(""))throw s;Qi=!0}const t=Gw();return t&&t.username.toLowerCase()===n.toLowerCase()?t:null},Av=async()=>{if($l()&&!Qi)try{const n=await Dre();if(n)return zu(n),n}catch(n){console.warn("Firebase get user failed, checking local",n)}return Gw()},Bre=async(n,e)=>{const t={username:n,score:0,tasksCompleted:0,joinedAt:new Date().toISOString(),currentTask:null,skipsUsedToday:0,lastSkipDate:new Date().toDateString()};if($l()&&!Qi)try{const s=await Rre(n,e);return zu(s),s}catch(s){if(s.message.includes(""))throw s;return console.error("Firebase registration failed. Switching to Offline Mode.",s),Qi=!0,zu(t),t}return zu(t),t},Ure=async n=>{const e=Gw();if(e&&(e.score+=n,e.tasksCompleted+=1,e.currentTask=null,zu(e)),$l()&&!Qi)try{await Mre(n)}catch(t){console.error("Firebase update failed",t),Qi=!0}},zre=async n=>{const e=await Av();if(e)return e.currentTask=n,zu(e),$l()&&!Qi&&await YB(e),e},Gre=async()=>{const n=await Av();if(!n)return{success:!1,message:"  "};const e=new Date().toDateString();return n.lastSkipDate!==e&&(n.skipsUsedToday=0,n.lastSkipDate=e),(n.skipsUsedToday||0)>=RP?{success:!1,message:`   (${RP}/3).   .`}:(n.skipsUsedToday=(n.skipsUsedToday||0)+1,n.currentTask=null,zu(n),$l()&&!Qi&&await YB(n),{success:!0,user:n})},Hre=async n=>{if($l()&&!Qi)try{return await Ore(n)}catch(e){console.warn("Firebase leaderboard failed",e),Qi=!0}return await new Promise(e=>setTimeout(e,600)),Fre(n)};var bo=(n=>(n.REGISTER="REGISTER",n.GAME="GAME",n.LEADERBOARD="LEADERBOARD",n.PROFILE="PROFILE",n))(bo||{});const SN=({children:n,variant:e="primary",isLoading:t=!1,className:s="",disabled:r,...i})=>{const o="px-6 py-3 rounded-xl font-bold transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",a={primary:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-lg shadow-indigo-500/30",secondary:"bg-slate-700 text-white hover:bg-slate-600",danger:"bg-red-500 text-white hover:bg-red-600",ghost:"bg-transparent text-slate-300 hover:text-white"};return Me.jsx("button",{className:`${o} ${a[e]} ${s}`,disabled:r||t,...i,children:t?Me.jsx("span",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):n})},qre=({onCapture:n,isProcessing:e})=>{const t=Dn.useRef(null),s=Dn.useRef(null),[r,i]=Dn.useState(null),o=Dn.useCallback(async()=>{try{const l=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"},width:{ideal:1280},height:{ideal:720}},audio:!1});t.current&&(t.current.srcObject=l),i(null)}catch(l){console.error("Camera Error:",l),i("     . ,     .")}},[]);Dn.useEffect(()=>(o(),()=>{t.current&&t.current.srcObject&&t.current.srcObject.getTracks().forEach(u=>u.stop())}),[o]);const a=()=>{if(t.current&&s.current){const l=t.current,u=s.current;u.width=l.videoWidth,u.height=l.videoHeight;const h=u.getContext("2d");if(h){h.drawImage(l,0,0,u.width,u.height);const f=u.toDataURL("image/jpeg",.8);n(f)}}};return r?Me.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-6 text-center bg-slate-900",children:[Me.jsx("div",{className:"text-red-400 mb-4 text-4xl",children:""}),Me.jsx("p",{className:"text-slate-300 mb-6",children:r}),Me.jsx(SN,{onClick:()=>window.location.reload(),children:" "})]}):Me.jsxs("div",{className:"relative w-full h-full bg-black overflow-hidden rounded-2xl shadow-2xl",children:[Me.jsx("video",{ref:t,autoPlay:!0,playsInline:!0,muted:!0,className:"absolute inset-0 w-full h-full object-cover"}),Me.jsx("canvas",{ref:s,className:"hidden"}),Me.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center pb-20 md:pb-8",children:Me.jsx("button",{onClick:a,disabled:e,className:`
            w-20 h-20 rounded-full border-4 border-white flex items-center justify-center
            bg-white/20 backdrop-blur-sm transition-transform active:scale-95
            ${e?"opacity-50 cursor-not-allowed":"hover:bg-white/30"}
          `,children:e?Me.jsx("span",{className:"w-8 h-8 border-2 border-white/50 border-t-white rounded-full animate-spin"}):Me.jsx("div",{className:"w-16 h-16 bg-white rounded-full"})})})]})};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Wre,Kre;function Xre(){return{geminiUrl:Wre,vertexUrl:Kre}}function Yre(n,e,t,s){var r,i;if(!(n!=null&&n.baseUrl)){const o=Xre();return e?(r=o.vertexUrl)!==null&&r!==void 0?r:t:(i=o.geminiUrl)!==null&&i!==void 0?i:s}return n.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Rl{}function He(n,e){const t=/\{([^}]+)\}/g;return n.replace(t,(s,r)=>{if(Object.prototype.hasOwnProperty.call(e,r)){const i=e[r];return i!=null?String(i):""}else throw new Error(`Key '${r}' not found in valueMap.`)})}function x(n,e,t){for(let i=0;i<e.length-1;i++){const o=e[i];if(o.endsWith("[]")){const a=o.slice(0,-2);if(!(a in n))if(Array.isArray(t))n[a]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${o}`);if(Array.isArray(n[a])){const l=n[a];if(Array.isArray(t))for(let u=0;u<l.length;u++){const h=l[u];x(h,e.slice(i+1),t[u])}else for(const u of l)x(u,e.slice(i+1),t)}return}else if(o.endsWith("[0]")){const a=o.slice(0,-3);a in n||(n[a]=[{}]);const l=n[a];x(l[0],e.slice(i+1),t);return}(!n[o]||typeof n[o]!="object")&&(n[o]={}),n=n[o]}const s=e[e.length-1],r=n[s];if(r!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===r)return;if(typeof r=="object"&&typeof t=="object"&&r!==null&&t!==null)Object.assign(r,t);else throw new Error(`Cannot set value for an existing key. Key: ${s}`)}else s==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(n,t):n[s]=t}function v(n,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return n;for(let s=0;s<e.length;s++){if(typeof n!="object"||n===null)return t;const r=e[s];if(r.endsWith("[]")){const i=r.slice(0,-2);if(i in n){const o=n[i];return Array.isArray(o)?o.map(a=>v(a,e.slice(s+1),t)):t}else return t}else n=n[r]}return n}catch(s){if(s instanceof TypeError)return t;throw s}}function Jre(n,e){for(const[t,s]of Object.entries(e)){const r=t.split("."),i=s.split("."),o=new Set;let a=-1;for(let l=0;l<r.length;l++)if(r[l]==="*"){a=l;break}if(a!==-1&&i.length>a)for(let l=a;l<i.length;l++){const u=i[l];u!=="*"&&!u.endsWith("[]")&&!u.endsWith("[0]")&&o.add(u)}eI(n,r,i,0,o)}}function eI(n,e,t,s,r){if(s>=e.length||typeof n!="object"||n===null)return;const i=e[s];if(i.endsWith("[]")){const o=i.slice(0,-2),a=n;if(o in a&&Array.isArray(a[o]))for(const l of a[o])eI(l,e,t,s+1,r)}else if(i==="*"){if(typeof n=="object"&&n!==null&&!Array.isArray(n)){const o=n,a=Object.keys(o).filter(u=>!u.startsWith("_")&&!r.has(u)),l={};for(const u of a)l[u]=o[u];for(const[u,h]of Object.entries(l)){const f=[];for(const p of t.slice(s))p==="*"?f.push(u):f.push(p);x(o,f,h)}for(const u of a)delete o[u]}}else{const o=n;i in o&&eI(o[i],e,t,s+1,r)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _N(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function jre(n){const e={},t=v(n,["operationName"]);t!=null&&x(e,["operationName"],t);const s=v(n,["resourceName"]);return s!=null&&x(e,["_url","resourceName"],s),e}function Qre(n){const e={},t=v(n,["name"]);t!=null&&x(e,["name"],t);const s=v(n,["metadata"]);s!=null&&x(e,["metadata"],s);const r=v(n,["done"]);r!=null&&x(e,["done"],r);const i=v(n,["error"]);i!=null&&x(e,["error"],i);const o=v(n,["response","generateVideoResponse"]);return o!=null&&x(e,["response"],eie(o)),e}function Zre(n){const e={},t=v(n,["name"]);t!=null&&x(e,["name"],t);const s=v(n,["metadata"]);s!=null&&x(e,["metadata"],s);const r=v(n,["done"]);r!=null&&x(e,["done"],r);const i=v(n,["error"]);i!=null&&x(e,["error"],i);const o=v(n,["response"]);return o!=null&&x(e,["response"],tie(o)),e}function eie(n){const e={},t=v(n,["generatedSamples"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>nie(o))),x(e,["generatedVideos"],i)}const s=v(n,["raiMediaFilteredCount"]);s!=null&&x(e,["raiMediaFilteredCount"],s);const r=v(n,["raiMediaFilteredReasons"]);return r!=null&&x(e,["raiMediaFilteredReasons"],r),e}function tie(n){const e={},t=v(n,["videos"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>sie(o))),x(e,["generatedVideos"],i)}const s=v(n,["raiMediaFilteredCount"]);s!=null&&x(e,["raiMediaFilteredCount"],s);const r=v(n,["raiMediaFilteredReasons"]);return r!=null&&x(e,["raiMediaFilteredReasons"],r),e}function nie(n){const e={},t=v(n,["video"]);return t!=null&&x(e,["video"],uie(t)),e}function sie(n){const e={},t=v(n,["_self"]);return t!=null&&x(e,["video"],cie(t)),e}function rie(n){const e={},t=v(n,["operationName"]);return t!=null&&x(e,["_url","operationName"],t),e}function iie(n){const e={},t=v(n,["operationName"]);return t!=null&&x(e,["_url","operationName"],t),e}function oie(n){const e={},t=v(n,["name"]);t!=null&&x(e,["name"],t);const s=v(n,["metadata"]);s!=null&&x(e,["metadata"],s);const r=v(n,["done"]);r!=null&&x(e,["done"],r);const i=v(n,["error"]);i!=null&&x(e,["error"],i);const o=v(n,["response"]);return o!=null&&x(e,["response"],aie(o)),e}function aie(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["parent"]);s!=null&&x(e,["parent"],s);const r=v(n,["documentName"]);return r!=null&&x(e,["documentName"],r),e}function jB(n){const e={},t=v(n,["name"]);t!=null&&x(e,["name"],t);const s=v(n,["metadata"]);s!=null&&x(e,["metadata"],s);const r=v(n,["done"]);r!=null&&x(e,["done"],r);const i=v(n,["error"]);i!=null&&x(e,["error"],i);const o=v(n,["response"]);return o!=null&&x(e,["response"],lie(o)),e}function lie(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["parent"]);s!=null&&x(e,["parent"],s);const r=v(n,["documentName"]);return r!=null&&x(e,["documentName"],r),e}function uie(n){const e={},t=v(n,["uri"]);t!=null&&x(e,["uri"],t);const s=v(n,["encodedVideo"]);s!=null&&x(e,["videoBytes"],_N(s));const r=v(n,["encoding"]);return r!=null&&x(e,["mimeType"],r),e}function cie(n){const e={},t=v(n,["gcsUri"]);t!=null&&x(e,["uri"],t);const s=v(n,["bytesBase64Encoded"]);s!=null&&x(e,["videoBytes"],_N(s));const r=v(n,["mimeType"]);return r!=null&&x(e,["mimeType"],r),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var DP;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(DP||(DP={}));var MP;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(MP||(MP={}));var OP;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(OP||(OP={}));var tr;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(tr||(tr={}));var PP;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(PP||(PP={}));var FP;(function(n){n.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",n.SIMPLE_SEARCH="SIMPLE_SEARCH",n.ELASTIC_SEARCH="ELASTIC_SEARCH"})(FP||(FP={}));var LP;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(LP||(LP={}));var VP;(function(n){n.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",n.HTTP_IN_QUERY="HTTP_IN_QUERY",n.HTTP_IN_HEADER="HTTP_IN_HEADER",n.HTTP_IN_PATH="HTTP_IN_PATH",n.HTTP_IN_BODY="HTTP_IN_BODY",n.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(VP||(VP={}));var BP;(function(n){n.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",n.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",n.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",n.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(BP||(BP={}));var UP;(function(n){n.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",n.LOW="LOW",n.HIGH="HIGH"})(UP||(UP={}));var zP;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",n.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",n.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",n.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",n.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(zP||(zP={}));var GP;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(GP||(GP={}));var HP;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(HP||(HP={}));var qP;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",n.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",n.NO_IMAGE="NO_IMAGE"})(qP||(qP={}));var WP;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(WP||(WP={}));var KP;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(KP||(KP={}));var XP;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",n.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",n.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(XP||(XP={}));var YP;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.IMAGE_SAFETY="IMAGE_SAFETY",n.MODEL_ARMOR="MODEL_ARMOR",n.JAILBREAK="JAILBREAK"})(YP||(YP={}));var JP;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(JP||(JP={}));var kv;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(kv||(kv={}));var jP;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(jP||(jP={}));var QP;(function(n){n.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",n.TUNING_MODE_FULL="TUNING_MODE_FULL",n.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(QP||(QP={}));var ZP;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(ZP||(ZP={}));var tI;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(tI||(tI={}));var eF;(function(n){n.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",n.TUNING_TASK_I2V="TUNING_TASK_I2V",n.TUNING_TASK_T2V="TUNING_TASK_T2V",n.TUNING_TASK_R2V="TUNING_TASK_R2V"})(eF||(eF={}));var tF;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(tF||(tF={}));var nF;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(nF||(nF={}));var sF;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(sF||(sF={}));var rF;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(rF||(rF={}));var iF;(function(n){n.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",n.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(iF||(iF={}));var oF;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE",n.VALIDATED="VALIDATED"})(oF||(oF={}));var aF;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(aF||(aF={}));var lF;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(lF||(lF={}));var uF;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi",n.zh="zh",n.pt="pt",n.es="es"})(uF||(uF={}));var cF;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(cF||(cF={}));var hF;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(hF||(hF={}));var dF;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(dF||(dF={}));var fF;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(fF||(fF={}));var pF;(function(n){n.FOREGROUND="FOREGROUND",n.BACKGROUND="BACKGROUND",n.PROMPT="PROMPT",n.SEMANTIC="SEMANTIC",n.INTERACTIVE="INTERACTIVE"})(pF||(pF={}));var mF;(function(n){n.ASSET="ASSET",n.STYLE="STYLE"})(mF||(mF={}));var gF;(function(n){n.INSERT="INSERT",n.REMOVE="REMOVE",n.REMOVE_STATIC="REMOVE_STATIC",n.OUTPAINT="OUTPAINT"})(gF||(gF={}));var yF;(function(n){n.OPTIMIZED="OPTIMIZED",n.LOSSLESS="LOSSLESS"})(yF||(yF={}));var bF;(function(n){n.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",n.PREFERENCE_TUNING="PREFERENCE_TUNING"})(bF||(bF={}));var vF;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.STATE_PENDING="STATE_PENDING",n.STATE_ACTIVE="STATE_ACTIVE",n.STATE_FAILED="STATE_FAILED"})(vF||(vF={}));var wF;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(wF||(wF={}));var TF;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(TF||(TF={}));var xF;(function(n){n.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.RESPONSE_REJECTED="RESPONSE_REJECTED",n.NEED_MORE_INPUT="NEED_MORE_INPUT"})(xF||(xF={}));var SF;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(SF||(SF={}));var _F;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(_F||(_F={}));var EF;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(EF||(EF={}));var IF;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(IF||(IF={}));var CF;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(CF||(CF={}));var NF;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(NF||(NF={}));var AF;(function(n){n.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",n.QUALITY="QUALITY",n.DIVERSITY="DIVERSITY",n.VOCALIZATION="VOCALIZATION"})(AF||(AF={}));var yf;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(yf||(yf={}));class nI{constructor(e){const t={};for(const s of e.headers.entries())t[s[0]]=s[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class zm{get text(){var e,t,s,r,i,o,a,l;if(((r=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let u="",h=!1;const f=[];for(const p of(l=(a=(o=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(const[g,b]of Object.entries(p))g!=="text"&&g!=="thought"&&g!=="thoughtSignature"&&(b!==null||b!==void 0)&&f.push(g);if(typeof p.text=="string"){if(typeof p.thought=="boolean"&&p.thought)continue;h=!0,u+=p.text}}return f.length>0&&console.warn(`there are non-text parts ${f} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),h?u:void 0}get data(){var e,t,s,r,i,o,a,l;if(((r=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let u="";const h=[];for(const f of(l=(a=(o=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(const[p,g]of Object.entries(f))p!=="inlineData"&&(g!==null||g!==void 0)&&h.push(p);f.inlineData&&typeof f.inlineData.data=="string"&&(u+=atob(f.inlineData.data))}return h.length>0&&console.warn(`there are non-data parts ${h} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),u.length>0?btoa(u):void 0}get functionCalls(){var e,t,s,r,i,o,a,l;if(((r=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const u=(l=(a=(o=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(h=>h.functionCall).map(h=>h.functionCall).filter(h=>h!==void 0);if((u==null?void 0:u.length)!==0)return u}get executableCode(){var e,t,s,r,i,o,a,l,u;if(((r=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const h=(l=(a=(o=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(f=>f.executableCode).map(f=>f.executableCode).filter(f=>f!==void 0);if((h==null?void 0:h.length)!==0)return(u=h==null?void 0:h[0])===null||u===void 0?void 0:u.code}get codeExecutionResult(){var e,t,s,r,i,o,a,l,u;if(((r=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const h=(l=(a=(o=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(f=>f.codeExecutionResult).map(f=>f.codeExecutionResult).filter(f=>f!==void 0);if((h==null?void 0:h.length)!==0)return(u=h==null?void 0:h[0])===null||u===void 0?void 0:u.output}}class kF{}class $F{}class hie{}class die{}class fie{}class pie{}class RF{}class DF{}class MF{}class mie{}class $v{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const s=new $v;let r;const i=e;return t?r=Zre(i):r=Qre(i),Object.assign(s,r),s}}class OF{}class PF{}class FF{}class LF{}class gie{}class yie{}class bie{}class EN{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const s=new EN,i=oie(e);return Object.assign(s,i),s}}class vie{}class wie{}class Tie{}class VF{}class xie{get text(){var e,t,s;let r="",i=!1;const o=[];for(const a of(s=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&s!==void 0?s:[]){for(const[l,u]of Object.entries(a))l!=="text"&&l!=="thought"&&u!==null&&o.push(l);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;i=!0,r+=a.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?r:void 0}get data(){var e,t,s;let r="";const i=[];for(const o of(s=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&s!==void 0?s:[]){for(const[a,l]of Object.entries(o))a!=="inlineData"&&l!==null&&i.push(a);o.inlineData&&typeof o.inlineData.data=="string"&&(r+=atob(o.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),r.length>0?btoa(r):void 0}}class Sie{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class IN{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const s=new IN,i=jB(e);return Object.assign(s,i),s}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Jt(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function QB(n,e){const t=Jt(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function ZB(n){return Array.isArray(n)?n.map(e=>Rv(e)):[Rv(n)]}function Rv(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function eU(n){const e=Rv(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function tU(n){const e=Rv(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function BF(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function nU(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>BF(e)):[BF(n)]}function sI(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function UF(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function zF(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function wr(n){if(n==null)throw new Error("ContentUnion is required");return sI(n)?n:{role:"user",parts:nU(n)}}function CN(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const s=wr(t);return s.parts&&s.parts.length>0&&s.parts[0].text!==void 0?[s.parts[0].text]:[]});if(n.isVertexAI()){const t=wr(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>wr(t)):[wr(e)]}function Ji(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(UF(n)||zF(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[wr(n)]}const e=[],t=[],s=sI(n[0]);for(const r of n){const i=sI(r);if(i!=s)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(i)e.push(r);else{if(UF(r)||zF(r))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(r)}}return s||e.push({role:"user",parts:nU(t)}),e}function _ie(n,e){n.includes("null")&&(e.nullable=!0);const t=n.filter(s=>s!=="null");if(t.length===1)e.type=Object.values(tr).includes(t[0].toUpperCase())?t[0].toUpperCase():tr.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const s of t)e.anyOf.push({type:Object.values(tr).includes(s.toUpperCase())?s.toUpperCase():tr.TYPE_UNSPECIFIED})}}function Sf(n){const e={},t=["items"],s=["anyOf"],r=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");const i=n.anyOf;i!=null&&i.length==2&&(i[0].type==="null"?(e.nullable=!0,n=i[1]):i[1].type==="null"&&(e.nullable=!0,n=i[0])),n.type instanceof Array&&_ie(n.type,e);for(const[o,a]of Object.entries(n))if(a!=null)if(o=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;e.type=Object.values(tr).includes(a.toUpperCase())?a.toUpperCase():tr.TYPE_UNSPECIFIED}else if(t.includes(o))e[o]=Sf(a);else if(s.includes(o)){const l=[];for(const u of a){if(u.type=="null"){e.nullable=!0;continue}l.push(Sf(u))}e[o]=l}else if(r.includes(o)){const l={};for(const[u,h]of Object.entries(a))l[u]=Sf(h);e[o]=l}else{if(o==="additionalProperties")continue;e[o]=a}return e}function NN(n){return Sf(n)}function AN(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function kN(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function gp(n){if(n.functionDeclarations)for(const e of n.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Sf(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Sf(e.response));return n}function yp(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of n)e.push(t);return e}function Eie(n,e,t,s=1){const r=!e.startsWith(`${t}/`)&&e.split("/").length===s;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:r?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:r?`${t}/${e}`:e}function Dl(n,e){if(typeof e!="string")throw new Error("name must be a string");return Eie(n,e,"cachedContents")}function sU(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function bc(n){return _N(n)}function Iie(n){return n!=null&&typeof n=="object"&&"name"in n}function Cie(n){return n!=null&&typeof n=="object"&&"video"in n}function Nie(n){return n!=null&&typeof n=="object"&&"uri"in n}function rU(n){var e;let t;if(Iie(n)&&(t=n.name),!(Nie(n)&&(t=n.uri,t===void 0))&&!(Cie(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const r=t.split("files/")[1].match(/[a-z0-9]+/);if(r===null)throw new Error(`Could not extract file name from URI ${t}`);t=r[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function iU(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function oU(n){for(const e of["models","tunedModels","publisherModels"])if(Aie(n,e))return n[e];return[]}function Aie(n,e){return n!==null&&typeof n=="object"&&e in n}function kie(n,e={}){const t=n,s={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(s.responseJsonSchema=t.outputSchema),e.behavior&&(s.behavior=e.behavior),{functionDeclarations:[s]}}function $ie(n,e={}){const t=[],s=new Set;for(const r of n){const i=r.name;if(s.has(i))throw new Error(`Duplicate function name ${i} found in MCP tools. Please ensure function names are unique.`);s.add(i);const o=kie(r,e);o.functionDeclarations&&t.push(...o.functionDeclarations)}return{functionDeclarations:t}}function aU(n,e){let t;if(typeof e=="string")if(n.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(n.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;const s=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,r=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(n.isVertexAI()){if(r>0||s!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(s>0||r!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function Rie(n){if(typeof n!="string")return n;const e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function lU(n){if(typeof n!="object"||n===null)return{};const e=n,t=e.inlinedResponses;if(typeof t!="object"||t===null)return n;const r=t.inlinedResponses;if(!Array.isArray(r)||r.length===0)return n;let i=!1;for(const o of r){if(typeof o!="object"||o===null)continue;const l=o.response;if(typeof l!="object"||l===null)continue;if(l.embedding!==void 0){i=!0;break}}return i&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),n}function bp(n,e){const t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function uU(n){const e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Die(n){const e={},t=v(n,["responsesFile"]);t!=null&&x(e,["fileName"],t);const s=v(n,["inlinedResponses","inlinedResponses"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(o=>foe(o))),x(e,["inlinedResponses"],i)}const r=v(n,["inlinedEmbedContentResponses","inlinedResponses"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>o)),x(e,["inlinedEmbedContentResponses"],i)}return e}function Mie(n){const e={},t=v(n,["predictionsFormat"]);t!=null&&x(e,["format"],t);const s=v(n,["gcsDestination","outputUriPrefix"]);s!=null&&x(e,["gcsUri"],s);const r=v(n,["bigqueryDestination","outputUri"]);return r!=null&&x(e,["bigqueryUri"],r),e}function Oie(n){const e={},t=v(n,["format"]);t!=null&&x(e,["predictionsFormat"],t);const s=v(n,["gcsUri"]);s!=null&&x(e,["gcsDestination","outputUriPrefix"],s);const r=v(n,["bigqueryUri"]);if(r!=null&&x(e,["bigqueryDestination","outputUri"],r),v(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(v(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(v(n,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Y1(n){const e={},t=v(n,["name"]);t!=null&&x(e,["name"],t);const s=v(n,["metadata","displayName"]);s!=null&&x(e,["displayName"],s);const r=v(n,["metadata","state"]);r!=null&&x(e,["state"],uU(r));const i=v(n,["metadata","createTime"]);i!=null&&x(e,["createTime"],i);const o=v(n,["metadata","endTime"]);o!=null&&x(e,["endTime"],o);const a=v(n,["metadata","updateTime"]);a!=null&&x(e,["updateTime"],a);const l=v(n,["metadata","model"]);l!=null&&x(e,["model"],l);const u=v(n,["metadata","output"]);return u!=null&&x(e,["dest"],Die(lU(u))),e}function rI(n){const e={},t=v(n,["name"]);t!=null&&x(e,["name"],t);const s=v(n,["displayName"]);s!=null&&x(e,["displayName"],s);const r=v(n,["state"]);r!=null&&x(e,["state"],uU(r));const i=v(n,["error"]);i!=null&&x(e,["error"],i);const o=v(n,["createTime"]);o!=null&&x(e,["createTime"],o);const a=v(n,["startTime"]);a!=null&&x(e,["startTime"],a);const l=v(n,["endTime"]);l!=null&&x(e,["endTime"],l);const u=v(n,["updateTime"]);u!=null&&x(e,["updateTime"],u);const h=v(n,["model"]);h!=null&&x(e,["model"],h);const f=v(n,["inputConfig"]);f!=null&&x(e,["src"],Pie(f));const p=v(n,["outputConfig"]);p!=null&&x(e,["dest"],Mie(lU(p)));const g=v(n,["completionStats"]);return g!=null&&x(e,["completionStats"],g),e}function Pie(n){const e={},t=v(n,["instancesFormat"]);t!=null&&x(e,["format"],t);const s=v(n,["gcsSource","uris"]);s!=null&&x(e,["gcsUri"],s);const r=v(n,["bigquerySource","inputUri"]);return r!=null&&x(e,["bigqueryUri"],r),e}function Fie(n,e){const t={};if(v(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(v(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(v(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const s=v(e,["fileName"]);s!=null&&x(t,["fileName"],s);const r=v(e,["inlinedRequests"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>doe(n,o))),x(t,["requests","requests"],i)}return t}function Lie(n){const e={},t=v(n,["format"]);t!=null&&x(e,["instancesFormat"],t);const s=v(n,["gcsUri"]);s!=null&&x(e,["gcsSource","uris"],s);const r=v(n,["bigqueryUri"]);if(r!=null&&x(e,["bigquerySource","inputUri"],r),v(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(v(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function Vie(n){const e={},t=v(n,["data"]);if(t!=null&&x(e,["data"],t),v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=v(n,["mimeType"]);return s!=null&&x(e,["mimeType"],s),e}function Bie(n,e){const t={},s=v(e,["name"]);return s!=null&&x(t,["_url","name"],bp(n,s)),t}function Uie(n,e){const t={},s=v(e,["name"]);return s!=null&&x(t,["_url","name"],bp(n,s)),t}function zie(n){const e={},t=v(n,["content"]);t!=null&&x(e,["content"],t);const s=v(n,["citationMetadata"]);s!=null&&x(e,["citationMetadata"],Gie(s));const r=v(n,["tokenCount"]);r!=null&&x(e,["tokenCount"],r);const i=v(n,["finishReason"]);i!=null&&x(e,["finishReason"],i);const o=v(n,["avgLogprobs"]);o!=null&&x(e,["avgLogprobs"],o);const a=v(n,["groundingMetadata"]);a!=null&&x(e,["groundingMetadata"],a);const l=v(n,["index"]);l!=null&&x(e,["index"],l);const u=v(n,["logprobsResult"]);u!=null&&x(e,["logprobsResult"],u);const h=v(n,["safetyRatings"]);if(h!=null){let p=h;Array.isArray(p)&&(p=p.map(g=>g)),x(e,["safetyRatings"],p)}const f=v(n,["urlContextMetadata"]);return f!=null&&x(e,["urlContextMetadata"],f),e}function Gie(n){const e={},t=v(n,["citationSources"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>r)),x(e,["citations"],s)}return e}function cU(n){const e={},t=v(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>woe(i))),x(e,["parts"],r)}const s=v(n,["role"]);return s!=null&&x(e,["role"],s),e}function Hie(n,e){const t={},s=v(n,["displayName"]);if(e!==void 0&&s!=null&&x(e,["batch","displayName"],s),v(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function qie(n,e){const t={},s=v(n,["displayName"]);e!==void 0&&s!=null&&x(e,["displayName"],s);const r=v(n,["dest"]);return e!==void 0&&r!=null&&x(e,["outputConfig"],Oie(Rie(r))),t}function GF(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","model"],Jt(n,s));const r=v(e,["src"]);r!=null&&x(t,["batch","inputConfig"],Fie(n,aU(n,r)));const i=v(e,["config"]);return i!=null&&Hie(i,t),t}function Wie(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["model"],Jt(n,s));const r=v(e,["src"]);r!=null&&x(t,["inputConfig"],Lie(aU(n,r)));const i=v(e,["config"]);return i!=null&&qie(i,t),t}function Kie(n,e){const t={},s=v(n,["displayName"]);return e!==void 0&&s!=null&&x(e,["batch","displayName"],s),t}function Xie(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","model"],Jt(n,s));const r=v(e,["src"]);r!=null&&x(t,["batch","inputConfig"],toe(n,r));const i=v(e,["config"]);return i!=null&&Kie(i,t),t}function Yie(n,e){const t={},s=v(e,["name"]);return s!=null&&x(t,["_url","name"],bp(n,s)),t}function Jie(n,e){const t={},s=v(e,["name"]);return s!=null&&x(t,["_url","name"],bp(n,s)),t}function jie(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["name"]);s!=null&&x(e,["name"],s);const r=v(n,["done"]);r!=null&&x(e,["done"],r);const i=v(n,["error"]);return i!=null&&x(e,["error"],i),e}function Qie(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["name"]);s!=null&&x(e,["name"],s);const r=v(n,["done"]);r!=null&&x(e,["done"],r);const i=v(n,["error"]);return i!=null&&x(e,["error"],i),e}function Zie(n,e){const t={},s=v(e,["contents"]);if(s!=null){let i=CN(n,s);Array.isArray(i)&&(i=i.map(o=>o)),x(t,["requests[]","request","content"],i)}const r=v(e,["config"]);return r!=null&&(x(t,["_self"],eoe(r,t)),Jre(t,{"requests[].*":"requests[].request.*"})),t}function eoe(n,e){const t={},s=v(n,["taskType"]);e!==void 0&&s!=null&&x(e,["requests[]","taskType"],s);const r=v(n,["title"]);e!==void 0&&r!=null&&x(e,["requests[]","title"],r);const i=v(n,["outputDimensionality"]);if(e!==void 0&&i!=null&&x(e,["requests[]","outputDimensionality"],i),v(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(v(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function toe(n,e){const t={},s=v(e,["fileName"]);s!=null&&x(t,["file_name"],s);const r=v(e,["inlinedRequests"]);return r!=null&&x(t,["requests"],Zie(n,r)),t}function noe(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["fileUri"]);t!=null&&x(e,["fileUri"],t);const s=v(n,["mimeType"]);return s!=null&&x(e,["mimeType"],s),e}function soe(n){const e={},t=v(n,["id"]);t!=null&&x(e,["id"],t);const s=v(n,["args"]);s!=null&&x(e,["args"],s);const r=v(n,["name"]);if(r!=null&&x(e,["name"],r),v(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function roe(n){const e={},t=v(n,["mode"]);t!=null&&x(e,["mode"],t);const s=v(n,["allowedFunctionNames"]);if(s!=null&&x(e,["allowedFunctionNames"],s),v(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function ioe(n,e,t){const s={},r=v(e,["systemInstruction"]);t!==void 0&&r!=null&&x(t,["systemInstruction"],cU(wr(r)));const i=v(e,["temperature"]);i!=null&&x(s,["temperature"],i);const o=v(e,["topP"]);o!=null&&x(s,["topP"],o);const a=v(e,["topK"]);a!=null&&x(s,["topK"],a);const l=v(e,["candidateCount"]);l!=null&&x(s,["candidateCount"],l);const u=v(e,["maxOutputTokens"]);u!=null&&x(s,["maxOutputTokens"],u);const h=v(e,["stopSequences"]);h!=null&&x(s,["stopSequences"],h);const f=v(e,["responseLogprobs"]);f!=null&&x(s,["responseLogprobs"],f);const p=v(e,["logprobs"]);p!=null&&x(s,["logprobs"],p);const g=v(e,["presencePenalty"]);g!=null&&x(s,["presencePenalty"],g);const b=v(e,["frequencyPenalty"]);b!=null&&x(s,["frequencyPenalty"],b);const T=v(e,["seed"]);T!=null&&x(s,["seed"],T);const w=v(e,["responseMimeType"]);w!=null&&x(s,["responseMimeType"],w);const _=v(e,["responseSchema"]);_!=null&&x(s,["responseSchema"],NN(_));const C=v(e,["responseJsonSchema"]);if(C!=null&&x(s,["responseJsonSchema"],C),v(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(v(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const N=v(e,["safetySettings"]);if(t!==void 0&&N!=null){let U=N;Array.isArray(U)&&(U=U.map(te=>Toe(te))),x(t,["safetySettings"],U)}const A=v(e,["tools"]);if(t!==void 0&&A!=null){let U=yp(A);Array.isArray(U)&&(U=U.map(te=>Soe(gp(te)))),x(t,["tools"],U)}const P=v(e,["toolConfig"]);if(t!==void 0&&P!=null&&x(t,["toolConfig"],xoe(P)),v(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const V=v(e,["cachedContent"]);t!==void 0&&V!=null&&x(t,["cachedContent"],Dl(n,V));const D=v(e,["responseModalities"]);D!=null&&x(s,["responseModalities"],D);const M=v(e,["mediaResolution"]);M!=null&&x(s,["mediaResolution"],M);const $=v(e,["speechConfig"]);if($!=null&&x(s,["speechConfig"],AN($)),v(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const O=v(e,["thinkingConfig"]);O!=null&&x(s,["thinkingConfig"],O);const k=v(e,["imageConfig"]);k!=null&&x(s,["imageConfig"],hoe(k));const z=v(e,["enableEnhancedCivicAnswers"]);return z!=null&&x(s,["enableEnhancedCivicAnswers"],z),s}function ooe(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["candidates"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(u=>zie(u))),x(e,["candidates"],l)}const r=v(n,["modelVersion"]);r!=null&&x(e,["modelVersion"],r);const i=v(n,["promptFeedback"]);i!=null&&x(e,["promptFeedback"],i);const o=v(n,["responseId"]);o!=null&&x(e,["responseId"],o);const a=v(n,["usageMetadata"]);return a!=null&&x(e,["usageMetadata"],a),e}function aoe(n,e){const t={},s=v(e,["name"]);return s!=null&&x(t,["_url","name"],bp(n,s)),t}function loe(n,e){const t={},s=v(e,["name"]);return s!=null&&x(t,["_url","name"],bp(n,s)),t}function uoe(n){const e={};if(v(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=v(n,["enableWidget"]);return t!=null&&x(e,["enableWidget"],t),e}function coe(n){const e={};if(v(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=v(n,["timeRangeFilter"]);return t!=null&&x(e,["timeRangeFilter"],t),e}function hoe(n){const e={},t=v(n,["aspectRatio"]);t!=null&&x(e,["aspectRatio"],t);const s=v(n,["imageSize"]);if(s!=null&&x(e,["imageSize"],s),v(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(v(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function doe(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["request","model"],Jt(n,s));const r=v(e,["contents"]);if(r!=null){let a=Ji(r);Array.isArray(a)&&(a=a.map(l=>cU(l))),x(t,["request","contents"],a)}const i=v(e,["metadata"]);i!=null&&x(t,["metadata"],i);const o=v(e,["config"]);return o!=null&&x(t,["request","generationConfig"],ioe(n,o,v(t,["request"],{}))),t}function foe(n){const e={},t=v(n,["response"]);t!=null&&x(e,["response"],ooe(t));const s=v(n,["error"]);return s!=null&&x(e,["error"],s),e}function poe(n,e){const t={},s=v(n,["pageSize"]);e!==void 0&&s!=null&&x(e,["_query","pageSize"],s);const r=v(n,["pageToken"]);if(e!==void 0&&r!=null&&x(e,["_query","pageToken"],r),v(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function moe(n,e){const t={},s=v(n,["pageSize"]);e!==void 0&&s!=null&&x(e,["_query","pageSize"],s);const r=v(n,["pageToken"]);e!==void 0&&r!=null&&x(e,["_query","pageToken"],r);const i=v(n,["filter"]);return e!==void 0&&i!=null&&x(e,["_query","filter"],i),t}function goe(n){const e={},t=v(n,["config"]);return t!=null&&poe(t,e),e}function yoe(n){const e={},t=v(n,["config"]);return t!=null&&moe(t,e),e}function boe(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["nextPageToken"]);s!=null&&x(e,["nextPageToken"],s);const r=v(n,["operations"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>Y1(o))),x(e,["batchJobs"],i)}return e}function voe(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["nextPageToken"]);s!=null&&x(e,["nextPageToken"],s);const r=v(n,["batchPredictionJobs"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>rI(o))),x(e,["batchJobs"],i)}return e}function woe(n){const e={},t=v(n,["mediaResolution"]);t!=null&&x(e,["mediaResolution"],t);const s=v(n,["codeExecutionResult"]);s!=null&&x(e,["codeExecutionResult"],s);const r=v(n,["executableCode"]);r!=null&&x(e,["executableCode"],r);const i=v(n,["fileData"]);i!=null&&x(e,["fileData"],noe(i));const o=v(n,["functionCall"]);o!=null&&x(e,["functionCall"],soe(o));const a=v(n,["functionResponse"]);a!=null&&x(e,["functionResponse"],a);const l=v(n,["inlineData"]);l!=null&&x(e,["inlineData"],Vie(l));const u=v(n,["text"]);u!=null&&x(e,["text"],u);const h=v(n,["thought"]);h!=null&&x(e,["thought"],h);const f=v(n,["thoughtSignature"]);f!=null&&x(e,["thoughtSignature"],f);const p=v(n,["videoMetadata"]);return p!=null&&x(e,["videoMetadata"],p),e}function Toe(n){const e={},t=v(n,["category"]);if(t!=null&&x(e,["category"],t),v(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=v(n,["threshold"]);return s!=null&&x(e,["threshold"],s),e}function xoe(n){const e={},t=v(n,["functionCallingConfig"]);t!=null&&x(e,["functionCallingConfig"],roe(t));const s=v(n,["retrievalConfig"]);return s!=null&&x(e,["retrievalConfig"],s),e}function Soe(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(f=>f)),x(e,["functionDeclarations"],h)}if(v(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=v(n,["googleSearchRetrieval"]);s!=null&&x(e,["googleSearchRetrieval"],s);const r=v(n,["computerUse"]);r!=null&&x(e,["computerUse"],r);const i=v(n,["fileSearch"]);i!=null&&x(e,["fileSearch"],i);const o=v(n,["codeExecution"]);if(o!=null&&x(e,["codeExecution"],o),v(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=v(n,["googleMaps"]);a!=null&&x(e,["googleMaps"],uoe(a));const l=v(n,["googleSearch"]);l!=null&&x(e,["googleSearch"],coe(l));const u=v(n,["urlContext"]);return u!=null&&x(e,["urlContext"],u),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var _l;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents",n.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",n.PAGED_ITEM_DOCUMENTS="documents"})(_l||(_l={}));class td{constructor(e,t,s,r){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,s,r)}init(e,t,s){var r,i;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t==null?void 0:t.sdkHttpResponse,this.idxInternal=0;let o={config:{}};!s||Object.keys(s).length===0?o={config:{}}:typeof s=="object"?o=Object.assign({},s):o=s,o.config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=(i=(r=o.config)===null||r===void 0?void 0:r.pageSize)!==null&&i!==void 0?i:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _oe extends Rl{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new td(_l.PAGED_ITEM_BATCH_JOBS,s=>this.listInternal(s),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){const t=GF(this.apiClient,e),s=t._url,r=He("{model}:batchGenerateContent",s),a=t.batch.inputConfig.requests,l=a.requests,u=[];for(const h of l){const f=Object.assign({},h);if(f.systemInstruction){const p=f.systemInstruction;delete f.systemInstruction;const g=f.request;g.systemInstruction=p,f.request=g}u.push(f)}return a.requests=u,delete t.config,delete t._url,delete t._query,{path:r,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){const s=t?Object.assign({},t):{},r=Date.now().toString();if(s.displayName||(s.displayName=`genaiBatchJob_${r}`),s.dest===void 0){const i=this.getGcsUri(e),o=this.getBigqueryUri(e);if(i)i.endsWith(".jsonl")?s.dest=`${i.slice(0,-6)}/dest`:s.dest=`${i}_dest_${r}`;else if(o)s.dest=`${o}_dest_${r}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return s}async createInternal(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=Wie(this.apiClient,e);return a=He("batchPredictionJobs",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>rI(h))}else{const u=GF(this.apiClient,e);return a=He("{model}:batchGenerateContent",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>Y1(h))}}async createEmbeddingsInternal(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Xie(this.apiClient,e);return i=He("{model}:asyncBatchEmbedContent",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),r.then(l=>Y1(l))}}async get(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=loe(this.apiClient,e);return a=He("batchPredictionJobs/{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>rI(h))}else{const u=aoe(this.apiClient,e);return a=He("batches/{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>Y1(h))}}async cancel(e){var t,s,r,i;let o="",a={};if(this.apiClient.isVertexAI()){const l=Uie(this.apiClient,e);o=He("batchPredictionJobs/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}else{const l=Bie(this.apiClient,e);o=He("batches/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=yoe(e);return a=He("batchPredictionJobs",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=voe(h),p=new VF;return Object.assign(p,f),p})}else{const u=goe(e);return a=He("batches",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=boe(h),p=new VF;return Object.assign(p,f),p})}}async delete(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=Jie(this.apiClient,e);return a=He("batchPredictionJobs/{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>Qie(h))}else{const u=Yie(this.apiClient,e);return a=He("batches/{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>jie(h))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Eoe(n){const e={},t=v(n,["data"]);if(t!=null&&x(e,["data"],t),v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=v(n,["mimeType"]);return s!=null&&x(e,["mimeType"],s),e}function HF(n){const e={},t=v(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>Xoe(i))),x(e,["parts"],r)}const s=v(n,["role"]);return s!=null&&x(e,["role"],s),e}function Ioe(n,e){const t={},s=v(n,["ttl"]);e!==void 0&&s!=null&&x(e,["ttl"],s);const r=v(n,["expireTime"]);e!==void 0&&r!=null&&x(e,["expireTime"],r);const i=v(n,["displayName"]);e!==void 0&&i!=null&&x(e,["displayName"],i);const o=v(n,["contents"]);if(e!==void 0&&o!=null){let h=Ji(o);Array.isArray(h)&&(h=h.map(f=>HF(f))),x(e,["contents"],h)}const a=v(n,["systemInstruction"]);e!==void 0&&a!=null&&x(e,["systemInstruction"],HF(wr(a)));const l=v(n,["tools"]);if(e!==void 0&&l!=null){let h=l;Array.isArray(h)&&(h=h.map(f=>Joe(f))),x(e,["tools"],h)}const u=v(n,["toolConfig"]);if(e!==void 0&&u!=null&&x(e,["toolConfig"],Yoe(u)),v(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function Coe(n,e){const t={},s=v(n,["ttl"]);e!==void 0&&s!=null&&x(e,["ttl"],s);const r=v(n,["expireTime"]);e!==void 0&&r!=null&&x(e,["expireTime"],r);const i=v(n,["displayName"]);e!==void 0&&i!=null&&x(e,["displayName"],i);const o=v(n,["contents"]);if(e!==void 0&&o!=null){let f=Ji(o);Array.isArray(f)&&(f=f.map(p=>p)),x(e,["contents"],f)}const a=v(n,["systemInstruction"]);e!==void 0&&a!=null&&x(e,["systemInstruction"],wr(a));const l=v(n,["tools"]);if(e!==void 0&&l!=null){let f=l;Array.isArray(f)&&(f=f.map(p=>joe(p))),x(e,["tools"],f)}const u=v(n,["toolConfig"]);e!==void 0&&u!=null&&x(e,["toolConfig"],u);const h=v(n,["kmsKeyName"]);return e!==void 0&&h!=null&&x(e,["encryption_spec","kmsKeyName"],h),t}function Noe(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["model"],QB(n,s));const r=v(e,["config"]);return r!=null&&Ioe(r,t),t}function Aoe(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["model"],QB(n,s));const r=v(e,["config"]);return r!=null&&Coe(r,t),t}function koe(n,e){const t={},s=v(e,["name"]);return s!=null&&x(t,["_url","name"],Dl(n,s)),t}function $oe(n,e){const t={},s=v(e,["name"]);return s!=null&&x(t,["_url","name"],Dl(n,s)),t}function Roe(n){const e={},t=v(n,["sdkHttpResponse"]);return t!=null&&x(e,["sdkHttpResponse"],t),e}function Doe(n){const e={},t=v(n,["sdkHttpResponse"]);return t!=null&&x(e,["sdkHttpResponse"],t),e}function Moe(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["fileUri"]);t!=null&&x(e,["fileUri"],t);const s=v(n,["mimeType"]);return s!=null&&x(e,["mimeType"],s),e}function Ooe(n){const e={},t=v(n,["id"]);t!=null&&x(e,["id"],t);const s=v(n,["args"]);s!=null&&x(e,["args"],s);const r=v(n,["name"]);if(r!=null&&x(e,["name"],r),v(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Poe(n){const e={},t=v(n,["mode"]);t!=null&&x(e,["mode"],t);const s=v(n,["allowedFunctionNames"]);if(s!=null&&x(e,["allowedFunctionNames"],s),v(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function Foe(n){const e={};if(v(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=v(n,["description"]);t!=null&&x(e,["description"],t);const s=v(n,["name"]);s!=null&&x(e,["name"],s);const r=v(n,["parameters"]);r!=null&&x(e,["parameters"],r);const i=v(n,["parametersJsonSchema"]);i!=null&&x(e,["parametersJsonSchema"],i);const o=v(n,["response"]);o!=null&&x(e,["response"],o);const a=v(n,["responseJsonSchema"]);return a!=null&&x(e,["responseJsonSchema"],a),e}function Loe(n,e){const t={},s=v(e,["name"]);return s!=null&&x(t,["_url","name"],Dl(n,s)),t}function Voe(n,e){const t={},s=v(e,["name"]);return s!=null&&x(t,["_url","name"],Dl(n,s)),t}function Boe(n){const e={};if(v(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=v(n,["enableWidget"]);return t!=null&&x(e,["enableWidget"],t),e}function Uoe(n){const e={};if(v(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=v(n,["timeRangeFilter"]);return t!=null&&x(e,["timeRangeFilter"],t),e}function zoe(n,e){const t={},s=v(n,["pageSize"]);e!==void 0&&s!=null&&x(e,["_query","pageSize"],s);const r=v(n,["pageToken"]);return e!==void 0&&r!=null&&x(e,["_query","pageToken"],r),t}function Goe(n,e){const t={},s=v(n,["pageSize"]);e!==void 0&&s!=null&&x(e,["_query","pageSize"],s);const r=v(n,["pageToken"]);return e!==void 0&&r!=null&&x(e,["_query","pageToken"],r),t}function Hoe(n){const e={},t=v(n,["config"]);return t!=null&&zoe(t,e),e}function qoe(n){const e={},t=v(n,["config"]);return t!=null&&Goe(t,e),e}function Woe(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["nextPageToken"]);s!=null&&x(e,["nextPageToken"],s);const r=v(n,["cachedContents"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>o)),x(e,["cachedContents"],i)}return e}function Koe(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["nextPageToken"]);s!=null&&x(e,["nextPageToken"],s);const r=v(n,["cachedContents"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>o)),x(e,["cachedContents"],i)}return e}function Xoe(n){const e={},t=v(n,["mediaResolution"]);t!=null&&x(e,["mediaResolution"],t);const s=v(n,["codeExecutionResult"]);s!=null&&x(e,["codeExecutionResult"],s);const r=v(n,["executableCode"]);r!=null&&x(e,["executableCode"],r);const i=v(n,["fileData"]);i!=null&&x(e,["fileData"],Moe(i));const o=v(n,["functionCall"]);o!=null&&x(e,["functionCall"],Ooe(o));const a=v(n,["functionResponse"]);a!=null&&x(e,["functionResponse"],a);const l=v(n,["inlineData"]);l!=null&&x(e,["inlineData"],Eoe(l));const u=v(n,["text"]);u!=null&&x(e,["text"],u);const h=v(n,["thought"]);h!=null&&x(e,["thought"],h);const f=v(n,["thoughtSignature"]);f!=null&&x(e,["thoughtSignature"],f);const p=v(n,["videoMetadata"]);return p!=null&&x(e,["videoMetadata"],p),e}function Yoe(n){const e={},t=v(n,["functionCallingConfig"]);t!=null&&x(e,["functionCallingConfig"],Poe(t));const s=v(n,["retrievalConfig"]);return s!=null&&x(e,["retrievalConfig"],s),e}function Joe(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(f=>f)),x(e,["functionDeclarations"],h)}if(v(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=v(n,["googleSearchRetrieval"]);s!=null&&x(e,["googleSearchRetrieval"],s);const r=v(n,["computerUse"]);r!=null&&x(e,["computerUse"],r);const i=v(n,["fileSearch"]);i!=null&&x(e,["fileSearch"],i);const o=v(n,["codeExecution"]);if(o!=null&&x(e,["codeExecution"],o),v(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=v(n,["googleMaps"]);a!=null&&x(e,["googleMaps"],Boe(a));const l=v(n,["googleSearch"]);l!=null&&x(e,["googleSearch"],Uoe(l));const u=v(n,["urlContext"]);return u!=null&&x(e,["urlContext"],u),e}function joe(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>Foe(p))),x(e,["functionDeclarations"],f)}const s=v(n,["retrieval"]);s!=null&&x(e,["retrieval"],s);const r=v(n,["googleSearchRetrieval"]);r!=null&&x(e,["googleSearchRetrieval"],r);const i=v(n,["computerUse"]);if(i!=null&&x(e,["computerUse"],i),v(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const o=v(n,["codeExecution"]);o!=null&&x(e,["codeExecution"],o);const a=v(n,["enterpriseWebSearch"]);a!=null&&x(e,["enterpriseWebSearch"],a);const l=v(n,["googleMaps"]);l!=null&&x(e,["googleMaps"],l);const u=v(n,["googleSearch"]);u!=null&&x(e,["googleSearch"],u);const h=v(n,["urlContext"]);return h!=null&&x(e,["urlContext"],h),e}function Qoe(n,e){const t={},s=v(n,["ttl"]);e!==void 0&&s!=null&&x(e,["ttl"],s);const r=v(n,["expireTime"]);return e!==void 0&&r!=null&&x(e,["expireTime"],r),t}function Zoe(n,e){const t={},s=v(n,["ttl"]);e!==void 0&&s!=null&&x(e,["ttl"],s);const r=v(n,["expireTime"]);return e!==void 0&&r!=null&&x(e,["expireTime"],r),t}function eae(n,e){const t={},s=v(e,["name"]);s!=null&&x(t,["_url","name"],Dl(n,s));const r=v(e,["config"]);return r!=null&&Qoe(r,t),t}function tae(n,e){const t={},s=v(e,["name"]);s!=null&&x(t,["_url","name"],Dl(n,s));const r=v(e,["config"]);return r!=null&&Zoe(r,t),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nae extends Rl{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new td(_l.PAGED_ITEM_CACHED_CONTENTS,s=>this.listInternal(s),await this.listInternal(t),t)}async create(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=Aoe(this.apiClient,e);return a=He("cachedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>h)}else{const u=Noe(this.apiClient,e);return a=He("cachedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>h)}}async get(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=Voe(this.apiClient,e);return a=He("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>h)}else{const u=Loe(this.apiClient,e);return a=He("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>h)}}async delete(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=$oe(this.apiClient,e);return a=He("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=Doe(h),p=new FF;return Object.assign(p,f),p})}else{const u=koe(this.apiClient,e);return a=He("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=Roe(h),p=new FF;return Object.assign(p,f),p})}}async update(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=tae(this.apiClient,e);return a=He("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>h)}else{const u=eae(this.apiClient,e);return a=He("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>h)}}async listInternal(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=qoe(e);return a=He("cachedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=Koe(h),p=new LF;return Object.assign(p,f),p})}else{const u=Hoe(e);return a=He("cachedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=Woe(h),p=new LF;return Object.assign(p,f),p})}}}function qF(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],s=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Rn(n){return this instanceof Rn?(this.v=n,this):new Rn(n)}function _f(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(n,e||[]),r,i=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),r[Symbol.asyncIterator]=function(){return this},r;function o(g){return function(b){return Promise.resolve(b).then(g,f)}}function a(g,b){s[g]&&(r[g]=function(T){return new Promise(function(w,_){i.push([g,T,w,_])>1||l(g,T)})},b&&(r[g]=b(r[g])))}function l(g,b){try{u(s[g](b))}catch(T){p(i[0][3],T)}}function u(g){g.value instanceof Rn?Promise.resolve(g.value.v).then(h,f):p(i[0][2],g)}function h(g){l("next",g)}function f(g){l("throw",g)}function p(g,b){g(b),i.shift(),i.length&&l(i[0][0],i[0][1])}}function fg(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof qF=="function"?qF(n):n[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(i){t[i]=n[i]&&function(o){return new Promise(function(a,l){o=n[i](o),r(a,l,o.done,o.value)})}}function r(i,o,a,l){Promise.resolve(l).then(function(u){i({value:u,done:a})},o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function sae(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:hU(t)}function hU(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function rae(n){if(n.length!==0){for(const e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function WF(n){if(n===void 0||n.length===0)return[];const e=[],t=n.length;let s=0;for(;s<t;)if(n[s].role==="user")e.push(n[s]),s++;else{const r=[];let i=!0;for(;s<t&&n[s].role==="model";)r.push(n[s]),i&&!hU(n[s])&&(i=!1),s++;i?e.push(...r):e.pop()}return e}class iae{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new oae(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class oae{constructor(e,t,s,r={},i=[]){this.apiClient=e,this.modelsModule=t,this.model=s,this.config=r,this.history=i,this.sendPromise=Promise.resolve(),rae(i)}async sendMessage(e){var t;await this.sendPromise;const s=wr(e.message),r=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(s),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var i,o,a;const l=await r,u=(o=(i=l.candidates)===null||i===void 0?void 0:i[0])===null||o===void 0?void 0:o.content,h=l.automaticFunctionCallingHistory,f=this.getHistory(!0).length;let p=[];h!=null&&(p=(a=h.slice(f))!==null&&a!==void 0?a:[]);const g=u?[u]:[];this.recordHistory(s,g,p)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),r}async sendMessageStream(e){var t;await this.sendPromise;const s=wr(e.message),r=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(s),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=r.then(()=>{}).catch(()=>{});const i=await r;return this.processStreamResponse(i,s)}getHistory(e=!1){const t=e?WF(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return _f(this,arguments,function*(){var r,i,o,a,l,u;const h=[];try{for(var f=!0,p=fg(e),g;g=yield Rn(p.next()),r=g.done,!r;f=!0){a=g.value,f=!1;const b=a;if(sae(b)){const T=(u=(l=b.candidates)===null||l===void 0?void 0:l[0])===null||u===void 0?void 0:u.content;T!==void 0&&h.push(T)}yield yield Rn(b)}}catch(b){i={error:b}}finally{try{!f&&!r&&(o=p.return)&&(yield Rn(o.call(p)))}finally{if(i)throw i.error}}this.recordHistory(t,h)})}recordHistory(e,t,s){let r=[];t.length>0&&t.every(i=>i.role!==void 0)?r=t:r.push({role:"model",parts:[]}),s&&s.length>0?this.history.push(...WF(s)):this.history.push(e),this.history.push(...r)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Hw extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Hw.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function aae(n){const e={},t=v(n,["file"]);return t!=null&&x(e,["file"],t),e}function lae(n){const e={},t=v(n,["sdkHttpResponse"]);return t!=null&&x(e,["sdkHttpResponse"],t),e}function uae(n){const e={},t=v(n,["name"]);return t!=null&&x(e,["_url","file"],rU(t)),e}function cae(n){const e={},t=v(n,["sdkHttpResponse"]);return t!=null&&x(e,["sdkHttpResponse"],t),e}function hae(n){const e={},t=v(n,["name"]);return t!=null&&x(e,["_url","file"],rU(t)),e}function dae(n,e){const t={},s=v(n,["pageSize"]);e!==void 0&&s!=null&&x(e,["_query","pageSize"],s);const r=v(n,["pageToken"]);return e!==void 0&&r!=null&&x(e,["_query","pageToken"],r),t}function fae(n){const e={},t=v(n,["config"]);return t!=null&&dae(t,e),e}function pae(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["nextPageToken"]);s!=null&&x(e,["nextPageToken"],s);const r=v(n,["files"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>o)),x(e,["files"],i)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class mae extends Rl{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new td(_l.PAGED_ITEM_FILES,s=>this.listInternal(s),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=fae(e);return i=He("files",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const h=u;return h.sdkHttpResponse={headers:l.headers},h})),r.then(l=>{const u=pae(l),h=new vie;return Object.assign(h,u),h})}}async createInternal(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=aae(e);return i=He("upload/v1beta/files",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),r.then(l=>{const u=lae(l),h=new wie;return Object.assign(h,u),h})}}async get(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=hae(e);return i=He("files/{file}",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),r.then(l=>l)}}async delete(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=uae(e);return i=He("files/{file}",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const h=u;return h.sdkHttpResponse={headers:l.headers},h})),r.then(l=>{const u=cae(l),h=new Tie;return Object.assign(h,u),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function J1(n){const e={},t=v(n,["data"]);if(t!=null&&x(e,["data"],t),v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=v(n,["mimeType"]);return s!=null&&x(e,["mimeType"],s),e}function gae(n){const e={},t=v(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>Rae(i))),x(e,["parts"],r)}const s=v(n,["role"]);return s!=null&&x(e,["role"],s),e}function yae(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["fileUri"]);t!=null&&x(e,["fileUri"],t);const s=v(n,["mimeType"]);return s!=null&&x(e,["mimeType"],s),e}function bae(n){const e={},t=v(n,["id"]);t!=null&&x(e,["id"],t);const s=v(n,["args"]);s!=null&&x(e,["args"],s);const r=v(n,["name"]);if(r!=null&&x(e,["name"],r),v(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function vae(n){const e={};if(v(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=v(n,["description"]);t!=null&&x(e,["description"],t);const s=v(n,["name"]);s!=null&&x(e,["name"],s);const r=v(n,["parameters"]);r!=null&&x(e,["parameters"],r);const i=v(n,["parametersJsonSchema"]);i!=null&&x(e,["parametersJsonSchema"],i);const o=v(n,["response"]);o!=null&&x(e,["response"],o);const a=v(n,["responseJsonSchema"]);return a!=null&&x(e,["responseJsonSchema"],a),e}function wae(n){const e={},t=v(n,["modelSelectionConfig"]);t!=null&&x(e,["modelConfig"],t);const s=v(n,["responseJsonSchema"]);s!=null&&x(e,["responseJsonSchema"],s);const r=v(n,["audioTimestamp"]);r!=null&&x(e,["audioTimestamp"],r);const i=v(n,["candidateCount"]);i!=null&&x(e,["candidateCount"],i);const o=v(n,["enableAffectiveDialog"]);o!=null&&x(e,["enableAffectiveDialog"],o);const a=v(n,["frequencyPenalty"]);a!=null&&x(e,["frequencyPenalty"],a);const l=v(n,["logprobs"]);l!=null&&x(e,["logprobs"],l);const u=v(n,["maxOutputTokens"]);u!=null&&x(e,["maxOutputTokens"],u);const h=v(n,["mediaResolution"]);h!=null&&x(e,["mediaResolution"],h);const f=v(n,["presencePenalty"]);f!=null&&x(e,["presencePenalty"],f);const p=v(n,["responseLogprobs"]);p!=null&&x(e,["responseLogprobs"],p);const g=v(n,["responseMimeType"]);g!=null&&x(e,["responseMimeType"],g);const b=v(n,["responseModalities"]);b!=null&&x(e,["responseModalities"],b);const T=v(n,["responseSchema"]);T!=null&&x(e,["responseSchema"],T);const w=v(n,["routingConfig"]);w!=null&&x(e,["routingConfig"],w);const _=v(n,["seed"]);_!=null&&x(e,["seed"],_);const C=v(n,["speechConfig"]);C!=null&&x(e,["speechConfig"],dU(C));const N=v(n,["stopSequences"]);N!=null&&x(e,["stopSequences"],N);const A=v(n,["temperature"]);A!=null&&x(e,["temperature"],A);const P=v(n,["thinkingConfig"]);P!=null&&x(e,["thinkingConfig"],P);const V=v(n,["topK"]);V!=null&&x(e,["topK"],V);const D=v(n,["topP"]);if(D!=null&&x(e,["topP"],D),v(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Tae(n){const e={};if(v(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=v(n,["enableWidget"]);return t!=null&&x(e,["enableWidget"],t),e}function xae(n){const e={};if(v(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=v(n,["timeRangeFilter"]);return t!=null&&x(e,["timeRangeFilter"],t),e}function Sae(n,e){const t={},s=v(n,["generationConfig"]);e!==void 0&&s!=null&&x(e,["setup","generationConfig"],s);const r=v(n,["responseModalities"]);e!==void 0&&r!=null&&x(e,["setup","generationConfig","responseModalities"],r);const i=v(n,["temperature"]);e!==void 0&&i!=null&&x(e,["setup","generationConfig","temperature"],i);const o=v(n,["topP"]);e!==void 0&&o!=null&&x(e,["setup","generationConfig","topP"],o);const a=v(n,["topK"]);e!==void 0&&a!=null&&x(e,["setup","generationConfig","topK"],a);const l=v(n,["maxOutputTokens"]);e!==void 0&&l!=null&&x(e,["setup","generationConfig","maxOutputTokens"],l);const u=v(n,["mediaResolution"]);e!==void 0&&u!=null&&x(e,["setup","generationConfig","mediaResolution"],u);const h=v(n,["seed"]);e!==void 0&&h!=null&&x(e,["setup","generationConfig","seed"],h);const f=v(n,["speechConfig"]);e!==void 0&&f!=null&&x(e,["setup","generationConfig","speechConfig"],kN(f));const p=v(n,["thinkingConfig"]);e!==void 0&&p!=null&&x(e,["setup","generationConfig","thinkingConfig"],p);const g=v(n,["enableAffectiveDialog"]);e!==void 0&&g!=null&&x(e,["setup","generationConfig","enableAffectiveDialog"],g);const b=v(n,["systemInstruction"]);e!==void 0&&b!=null&&x(e,["setup","systemInstruction"],gae(wr(b)));const T=v(n,["tools"]);if(e!==void 0&&T!=null){let V=yp(T);Array.isArray(V)&&(V=V.map(D=>Mae(gp(D)))),x(e,["setup","tools"],V)}const w=v(n,["sessionResumption"]);e!==void 0&&w!=null&&x(e,["setup","sessionResumption"],Dae(w));const _=v(n,["inputAudioTranscription"]);e!==void 0&&_!=null&&x(e,["setup","inputAudioTranscription"],_);const C=v(n,["outputAudioTranscription"]);e!==void 0&&C!=null&&x(e,["setup","outputAudioTranscription"],C);const N=v(n,["realtimeInputConfig"]);e!==void 0&&N!=null&&x(e,["setup","realtimeInputConfig"],N);const A=v(n,["contextWindowCompression"]);e!==void 0&&A!=null&&x(e,["setup","contextWindowCompression"],A);const P=v(n,["proactivity"]);return e!==void 0&&P!=null&&x(e,["setup","proactivity"],P),t}function _ae(n,e){const t={},s=v(n,["generationConfig"]);e!==void 0&&s!=null&&x(e,["setup","generationConfig"],wae(s));const r=v(n,["responseModalities"]);e!==void 0&&r!=null&&x(e,["setup","generationConfig","responseModalities"],r);const i=v(n,["temperature"]);e!==void 0&&i!=null&&x(e,["setup","generationConfig","temperature"],i);const o=v(n,["topP"]);e!==void 0&&o!=null&&x(e,["setup","generationConfig","topP"],o);const a=v(n,["topK"]);e!==void 0&&a!=null&&x(e,["setup","generationConfig","topK"],a);const l=v(n,["maxOutputTokens"]);e!==void 0&&l!=null&&x(e,["setup","generationConfig","maxOutputTokens"],l);const u=v(n,["mediaResolution"]);e!==void 0&&u!=null&&x(e,["setup","generationConfig","mediaResolution"],u);const h=v(n,["seed"]);e!==void 0&&h!=null&&x(e,["setup","generationConfig","seed"],h);const f=v(n,["speechConfig"]);e!==void 0&&f!=null&&x(e,["setup","generationConfig","speechConfig"],dU(kN(f)));const p=v(n,["thinkingConfig"]);e!==void 0&&p!=null&&x(e,["setup","generationConfig","thinkingConfig"],p);const g=v(n,["enableAffectiveDialog"]);e!==void 0&&g!=null&&x(e,["setup","generationConfig","enableAffectiveDialog"],g);const b=v(n,["systemInstruction"]);e!==void 0&&b!=null&&x(e,["setup","systemInstruction"],wr(b));const T=v(n,["tools"]);if(e!==void 0&&T!=null){let V=yp(T);Array.isArray(V)&&(V=V.map(D=>Oae(gp(D)))),x(e,["setup","tools"],V)}const w=v(n,["sessionResumption"]);e!==void 0&&w!=null&&x(e,["setup","sessionResumption"],w);const _=v(n,["inputAudioTranscription"]);e!==void 0&&_!=null&&x(e,["setup","inputAudioTranscription"],_);const C=v(n,["outputAudioTranscription"]);e!==void 0&&C!=null&&x(e,["setup","outputAudioTranscription"],C);const N=v(n,["realtimeInputConfig"]);e!==void 0&&N!=null&&x(e,["setup","realtimeInputConfig"],N);const A=v(n,["contextWindowCompression"]);e!==void 0&&A!=null&&x(e,["setup","contextWindowCompression"],A);const P=v(n,["proactivity"]);return e!==void 0&&P!=null&&x(e,["setup","proactivity"],P),t}function Eae(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["setup","model"],Jt(n,s));const r=v(e,["config"]);return r!=null&&x(t,["config"],Sae(r,t)),t}function Iae(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["setup","model"],Jt(n,s));const r=v(e,["config"]);return r!=null&&x(t,["config"],_ae(r,t)),t}function Cae(n){const e={},t=v(n,["musicGenerationConfig"]);return t!=null&&x(e,["musicGenerationConfig"],t),e}function Nae(n){const e={},t=v(n,["weightedPrompts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>r)),x(e,["weightedPrompts"],s)}return e}function Aae(n){const e={},t=v(n,["media"]);if(t!=null){let u=ZB(t);Array.isArray(u)&&(u=u.map(h=>J1(h))),x(e,["mediaChunks"],u)}const s=v(n,["audio"]);s!=null&&x(e,["audio"],J1(tU(s)));const r=v(n,["audioStreamEnd"]);r!=null&&x(e,["audioStreamEnd"],r);const i=v(n,["video"]);i!=null&&x(e,["video"],J1(eU(i)));const o=v(n,["text"]);o!=null&&x(e,["text"],o);const a=v(n,["activityStart"]);a!=null&&x(e,["activityStart"],a);const l=v(n,["activityEnd"]);return l!=null&&x(e,["activityEnd"],l),e}function kae(n){const e={},t=v(n,["media"]);if(t!=null){let u=ZB(t);Array.isArray(u)&&(u=u.map(h=>h)),x(e,["mediaChunks"],u)}const s=v(n,["audio"]);s!=null&&x(e,["audio"],tU(s));const r=v(n,["audioStreamEnd"]);r!=null&&x(e,["audioStreamEnd"],r);const i=v(n,["video"]);i!=null&&x(e,["video"],eU(i));const o=v(n,["text"]);o!=null&&x(e,["text"],o);const a=v(n,["activityStart"]);a!=null&&x(e,["activityStart"],a);const l=v(n,["activityEnd"]);return l!=null&&x(e,["activityEnd"],l),e}function $ae(n){const e={},t=v(n,["setupComplete"]);t!=null&&x(e,["setupComplete"],t);const s=v(n,["serverContent"]);s!=null&&x(e,["serverContent"],s);const r=v(n,["toolCall"]);r!=null&&x(e,["toolCall"],r);const i=v(n,["toolCallCancellation"]);i!=null&&x(e,["toolCallCancellation"],i);const o=v(n,["usageMetadata"]);o!=null&&x(e,["usageMetadata"],Pae(o));const a=v(n,["goAway"]);a!=null&&x(e,["goAway"],a);const l=v(n,["sessionResumptionUpdate"]);return l!=null&&x(e,["sessionResumptionUpdate"],l),e}function Rae(n){const e={},t=v(n,["mediaResolution"]);t!=null&&x(e,["mediaResolution"],t);const s=v(n,["codeExecutionResult"]);s!=null&&x(e,["codeExecutionResult"],s);const r=v(n,["executableCode"]);r!=null&&x(e,["executableCode"],r);const i=v(n,["fileData"]);i!=null&&x(e,["fileData"],yae(i));const o=v(n,["functionCall"]);o!=null&&x(e,["functionCall"],bae(o));const a=v(n,["functionResponse"]);a!=null&&x(e,["functionResponse"],a);const l=v(n,["inlineData"]);l!=null&&x(e,["inlineData"],J1(l));const u=v(n,["text"]);u!=null&&x(e,["text"],u);const h=v(n,["thought"]);h!=null&&x(e,["thought"],h);const f=v(n,["thoughtSignature"]);f!=null&&x(e,["thoughtSignature"],f);const p=v(n,["videoMetadata"]);return p!=null&&x(e,["videoMetadata"],p),e}function Dae(n){const e={},t=v(n,["handle"]);if(t!=null&&x(e,["handle"],t),v(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function dU(n){const e={},t=v(n,["voiceConfig"]);t!=null&&x(e,["voiceConfig"],t);const s=v(n,["languageCode"]);if(s!=null&&x(e,["languageCode"],s),v(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function Mae(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(f=>f)),x(e,["functionDeclarations"],h)}if(v(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=v(n,["googleSearchRetrieval"]);s!=null&&x(e,["googleSearchRetrieval"],s);const r=v(n,["computerUse"]);r!=null&&x(e,["computerUse"],r);const i=v(n,["fileSearch"]);i!=null&&x(e,["fileSearch"],i);const o=v(n,["codeExecution"]);if(o!=null&&x(e,["codeExecution"],o),v(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=v(n,["googleMaps"]);a!=null&&x(e,["googleMaps"],Tae(a));const l=v(n,["googleSearch"]);l!=null&&x(e,["googleSearch"],xae(l));const u=v(n,["urlContext"]);return u!=null&&x(e,["urlContext"],u),e}function Oae(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>vae(p))),x(e,["functionDeclarations"],f)}const s=v(n,["retrieval"]);s!=null&&x(e,["retrieval"],s);const r=v(n,["googleSearchRetrieval"]);r!=null&&x(e,["googleSearchRetrieval"],r);const i=v(n,["computerUse"]);if(i!=null&&x(e,["computerUse"],i),v(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const o=v(n,["codeExecution"]);o!=null&&x(e,["codeExecution"],o);const a=v(n,["enterpriseWebSearch"]);a!=null&&x(e,["enterpriseWebSearch"],a);const l=v(n,["googleMaps"]);l!=null&&x(e,["googleMaps"],l);const u=v(n,["googleSearch"]);u!=null&&x(e,["googleSearch"],u);const h=v(n,["urlContext"]);return h!=null&&x(e,["urlContext"],h),e}function Pae(n){const e={},t=v(n,["promptTokenCount"]);t!=null&&x(e,["promptTokenCount"],t);const s=v(n,["cachedContentTokenCount"]);s!=null&&x(e,["cachedContentTokenCount"],s);const r=v(n,["candidatesTokenCount"]);r!=null&&x(e,["responseTokenCount"],r);const i=v(n,["toolUsePromptTokenCount"]);i!=null&&x(e,["toolUsePromptTokenCount"],i);const o=v(n,["thoughtsTokenCount"]);o!=null&&x(e,["thoughtsTokenCount"],o);const a=v(n,["totalTokenCount"]);a!=null&&x(e,["totalTokenCount"],a);const l=v(n,["promptTokensDetails"]);if(l!=null){let g=l;Array.isArray(g)&&(g=g.map(b=>b)),x(e,["promptTokensDetails"],g)}const u=v(n,["cacheTokensDetails"]);if(u!=null){let g=u;Array.isArray(g)&&(g=g.map(b=>b)),x(e,["cacheTokensDetails"],g)}const h=v(n,["candidatesTokensDetails"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(b=>b)),x(e,["responseTokensDetails"],g)}const f=v(n,["toolUsePromptTokensDetails"]);if(f!=null){let g=f;Array.isArray(g)&&(g=g.map(b=>b)),x(e,["toolUsePromptTokensDetails"],g)}const p=v(n,["trafficType"]);return p!=null&&x(e,["trafficType"],p),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Fae(n){const e={},t=v(n,["data"]);if(t!=null&&x(e,["data"],t),v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=v(n,["mimeType"]);return s!=null&&x(e,["mimeType"],s),e}function Lae(n){const e={},t=v(n,["content"]);t!=null&&x(e,["content"],t);const s=v(n,["citationMetadata"]);s!=null&&x(e,["citationMetadata"],Vae(s));const r=v(n,["tokenCount"]);r!=null&&x(e,["tokenCount"],r);const i=v(n,["finishReason"]);i!=null&&x(e,["finishReason"],i);const o=v(n,["avgLogprobs"]);o!=null&&x(e,["avgLogprobs"],o);const a=v(n,["groundingMetadata"]);a!=null&&x(e,["groundingMetadata"],a);const l=v(n,["index"]);l!=null&&x(e,["index"],l);const u=v(n,["logprobsResult"]);u!=null&&x(e,["logprobsResult"],u);const h=v(n,["safetyRatings"]);if(h!=null){let p=h;Array.isArray(p)&&(p=p.map(g=>g)),x(e,["safetyRatings"],p)}const f=v(n,["urlContextMetadata"]);return f!=null&&x(e,["urlContextMetadata"],f),e}function Vae(n){const e={},t=v(n,["citationSources"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>r)),x(e,["citations"],s)}return e}function Bae(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","model"],Jt(n,s));const r=v(e,["contents"]);if(r!=null){let i=Ji(r);Array.isArray(i)&&(i=i.map(o=>o)),x(t,["contents"],i)}return t}function Uae(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["tokensInfo"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(i=>i)),x(e,["tokensInfo"],r)}return e}function zae(n){const e={},t=v(n,["values"]);t!=null&&x(e,["values"],t);const s=v(n,["statistics"]);return s!=null&&x(e,["statistics"],Gae(s)),e}function Gae(n){const e={},t=v(n,["truncated"]);t!=null&&x(e,["truncated"],t);const s=v(n,["token_count"]);return s!=null&&x(e,["tokenCount"],s),e}function qw(n){const e={},t=v(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>Qle(i))),x(e,["parts"],r)}const s=v(n,["role"]);return s!=null&&x(e,["role"],s),e}function Hae(n){const e={},t=v(n,["controlType"]);t!=null&&x(e,["controlType"],t);const s=v(n,["enableControlImageComputation"]);return s!=null&&x(e,["computeControl"],s),e}function qae(n){const e={};if(v(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(v(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(v(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function Wae(n,e){const t={},s=v(n,["systemInstruction"]);e!==void 0&&s!=null&&x(e,["systemInstruction"],wr(s));const r=v(n,["tools"]);if(e!==void 0&&r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>yU(a))),x(e,["tools"],o)}const i=v(n,["generationConfig"]);return e!==void 0&&i!=null&&x(e,["generationConfig"],Fle(i)),t}function Kae(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","model"],Jt(n,s));const r=v(e,["contents"]);if(r!=null){let o=Ji(r);Array.isArray(o)&&(o=o.map(a=>qw(a))),x(t,["contents"],o)}const i=v(e,["config"]);return i!=null&&qae(i),t}function Xae(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","model"],Jt(n,s));const r=v(e,["contents"]);if(r!=null){let o=Ji(r);Array.isArray(o)&&(o=o.map(a=>a)),x(t,["contents"],o)}const i=v(e,["config"]);return i!=null&&Wae(i,t),t}function Yae(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["totalTokens"]);s!=null&&x(e,["totalTokens"],s);const r=v(n,["cachedContentTokenCount"]);return r!=null&&x(e,["cachedContentTokenCount"],r),e}function Jae(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["totalTokens"]);return s!=null&&x(e,["totalTokens"],s),e}function jae(n,e){const t={},s=v(e,["model"]);return s!=null&&x(t,["_url","name"],Jt(n,s)),t}function Qae(n,e){const t={},s=v(e,["model"]);return s!=null&&x(t,["_url","name"],Jt(n,s)),t}function Zae(n){const e={},t=v(n,["sdkHttpResponse"]);return t!=null&&x(e,["sdkHttpResponse"],t),e}function ele(n){const e={},t=v(n,["sdkHttpResponse"]);return t!=null&&x(e,["sdkHttpResponse"],t),e}function tle(n,e){const t={},s=v(n,["outputGcsUri"]);e!==void 0&&s!=null&&x(e,["parameters","storageUri"],s);const r=v(n,["negativePrompt"]);e!==void 0&&r!=null&&x(e,["parameters","negativePrompt"],r);const i=v(n,["numberOfImages"]);e!==void 0&&i!=null&&x(e,["parameters","sampleCount"],i);const o=v(n,["aspectRatio"]);e!==void 0&&o!=null&&x(e,["parameters","aspectRatio"],o);const a=v(n,["guidanceScale"]);e!==void 0&&a!=null&&x(e,["parameters","guidanceScale"],a);const l=v(n,["seed"]);e!==void 0&&l!=null&&x(e,["parameters","seed"],l);const u=v(n,["safetyFilterLevel"]);e!==void 0&&u!=null&&x(e,["parameters","safetySetting"],u);const h=v(n,["personGeneration"]);e!==void 0&&h!=null&&x(e,["parameters","personGeneration"],h);const f=v(n,["includeSafetyAttributes"]);e!==void 0&&f!=null&&x(e,["parameters","includeSafetyAttributes"],f);const p=v(n,["includeRaiReason"]);e!==void 0&&p!=null&&x(e,["parameters","includeRaiReason"],p);const g=v(n,["language"]);e!==void 0&&g!=null&&x(e,["parameters","language"],g);const b=v(n,["outputMimeType"]);e!==void 0&&b!=null&&x(e,["parameters","outputOptions","mimeType"],b);const T=v(n,["outputCompressionQuality"]);e!==void 0&&T!=null&&x(e,["parameters","outputOptions","compressionQuality"],T);const w=v(n,["addWatermark"]);e!==void 0&&w!=null&&x(e,["parameters","addWatermark"],w);const _=v(n,["labels"]);e!==void 0&&_!=null&&x(e,["labels"],_);const C=v(n,["editMode"]);e!==void 0&&C!=null&&x(e,["parameters","editMode"],C);const N=v(n,["baseSteps"]);return e!==void 0&&N!=null&&x(e,["parameters","editConfig","baseSteps"],N),t}function nle(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","model"],Jt(n,s));const r=v(e,["prompt"]);r!=null&&x(t,["instances[0]","prompt"],r);const i=v(e,["referenceImages"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(l=>rue(l))),x(t,["instances[0]","referenceImages"],a)}const o=v(e,["config"]);return o!=null&&tle(o,t),t}function sle(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["predictions"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(i=>Ww(i))),x(e,["generatedImages"],r)}return e}function rle(n,e){const t={},s=v(n,["taskType"]);e!==void 0&&s!=null&&x(e,["requests[]","taskType"],s);const r=v(n,["title"]);e!==void 0&&r!=null&&x(e,["requests[]","title"],r);const i=v(n,["outputDimensionality"]);if(e!==void 0&&i!=null&&x(e,["requests[]","outputDimensionality"],i),v(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(v(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function ile(n,e){const t={},s=v(n,["taskType"]);e!==void 0&&s!=null&&x(e,["instances[]","task_type"],s);const r=v(n,["title"]);e!==void 0&&r!=null&&x(e,["instances[]","title"],r);const i=v(n,["outputDimensionality"]);e!==void 0&&i!=null&&x(e,["parameters","outputDimensionality"],i);const o=v(n,["mimeType"]);e!==void 0&&o!=null&&x(e,["instances[]","mimeType"],o);const a=v(n,["autoTruncate"]);return e!==void 0&&a!=null&&x(e,["parameters","autoTruncate"],a),t}function ole(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","model"],Jt(n,s));const r=v(e,["contents"]);if(r!=null){let a=CN(n,r);Array.isArray(a)&&(a=a.map(l=>l)),x(t,["requests[]","content"],a)}const i=v(e,["config"]);i!=null&&rle(i,t);const o=v(e,["model"]);return o!==void 0&&x(t,["requests[]","model"],Jt(n,o)),t}function ale(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","model"],Jt(n,s));const r=v(e,["contents"]);if(r!=null){let o=CN(n,r);Array.isArray(o)&&(o=o.map(a=>a)),x(t,["instances[]","content"],o)}const i=v(e,["config"]);return i!=null&&ile(i,t),t}function lle(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["embeddings"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(o=>o)),x(e,["embeddings"],i)}const r=v(n,["metadata"]);return r!=null&&x(e,["metadata"],r),e}function ule(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["predictions[]","embeddings"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(o=>zae(o))),x(e,["embeddings"],i)}const r=v(n,["metadata"]);return r!=null&&x(e,["metadata"],r),e}function cle(n){const e={},t=v(n,["endpoint"]);t!=null&&x(e,["name"],t);const s=v(n,["deployedModelId"]);return s!=null&&x(e,["deployedModelId"],s),e}function hle(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["fileUri"]);t!=null&&x(e,["fileUri"],t);const s=v(n,["mimeType"]);return s!=null&&x(e,["mimeType"],s),e}function dle(n){const e={},t=v(n,["id"]);t!=null&&x(e,["id"],t);const s=v(n,["args"]);s!=null&&x(e,["args"],s);const r=v(n,["name"]);if(r!=null&&x(e,["name"],r),v(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function fle(n){const e={},t=v(n,["mode"]);t!=null&&x(e,["mode"],t);const s=v(n,["allowedFunctionNames"]);if(s!=null&&x(e,["allowedFunctionNames"],s),v(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function ple(n){const e={};if(v(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=v(n,["description"]);t!=null&&x(e,["description"],t);const s=v(n,["name"]);s!=null&&x(e,["name"],s);const r=v(n,["parameters"]);r!=null&&x(e,["parameters"],r);const i=v(n,["parametersJsonSchema"]);i!=null&&x(e,["parametersJsonSchema"],i);const o=v(n,["response"]);o!=null&&x(e,["response"],o);const a=v(n,["responseJsonSchema"]);return a!=null&&x(e,["responseJsonSchema"],a),e}function mle(n,e,t){const s={},r=v(e,["systemInstruction"]);t!==void 0&&r!=null&&x(t,["systemInstruction"],qw(wr(r)));const i=v(e,["temperature"]);i!=null&&x(s,["temperature"],i);const o=v(e,["topP"]);o!=null&&x(s,["topP"],o);const a=v(e,["topK"]);a!=null&&x(s,["topK"],a);const l=v(e,["candidateCount"]);l!=null&&x(s,["candidateCount"],l);const u=v(e,["maxOutputTokens"]);u!=null&&x(s,["maxOutputTokens"],u);const h=v(e,["stopSequences"]);h!=null&&x(s,["stopSequences"],h);const f=v(e,["responseLogprobs"]);f!=null&&x(s,["responseLogprobs"],f);const p=v(e,["logprobs"]);p!=null&&x(s,["logprobs"],p);const g=v(e,["presencePenalty"]);g!=null&&x(s,["presencePenalty"],g);const b=v(e,["frequencyPenalty"]);b!=null&&x(s,["frequencyPenalty"],b);const T=v(e,["seed"]);T!=null&&x(s,["seed"],T);const w=v(e,["responseMimeType"]);w!=null&&x(s,["responseMimeType"],w);const _=v(e,["responseSchema"]);_!=null&&x(s,["responseSchema"],NN(_));const C=v(e,["responseJsonSchema"]);if(C!=null&&x(s,["responseJsonSchema"],C),v(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(v(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const N=v(e,["safetySettings"]);if(t!==void 0&&N!=null){let U=N;Array.isArray(U)&&(U=U.map(te=>iue(te))),x(t,["safetySettings"],U)}const A=v(e,["tools"]);if(t!==void 0&&A!=null){let U=yp(A);Array.isArray(U)&&(U=U.map(te=>due(gp(te)))),x(t,["tools"],U)}const P=v(e,["toolConfig"]);if(t!==void 0&&P!=null&&x(t,["toolConfig"],hue(P)),v(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const V=v(e,["cachedContent"]);t!==void 0&&V!=null&&x(t,["cachedContent"],Dl(n,V));const D=v(e,["responseModalities"]);D!=null&&x(s,["responseModalities"],D);const M=v(e,["mediaResolution"]);M!=null&&x(s,["mediaResolution"],M);const $=v(e,["speechConfig"]);if($!=null&&x(s,["speechConfig"],AN($)),v(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const O=v(e,["thinkingConfig"]);O!=null&&x(s,["thinkingConfig"],O);const k=v(e,["imageConfig"]);k!=null&&x(s,["imageConfig"],zle(k));const z=v(e,["enableEnhancedCivicAnswers"]);return z!=null&&x(s,["enableEnhancedCivicAnswers"],z),s}function gle(n,e,t){const s={},r=v(e,["systemInstruction"]);t!==void 0&&r!=null&&x(t,["systemInstruction"],wr(r));const i=v(e,["temperature"]);i!=null&&x(s,["temperature"],i);const o=v(e,["topP"]);o!=null&&x(s,["topP"],o);const a=v(e,["topK"]);a!=null&&x(s,["topK"],a);const l=v(e,["candidateCount"]);l!=null&&x(s,["candidateCount"],l);const u=v(e,["maxOutputTokens"]);u!=null&&x(s,["maxOutputTokens"],u);const h=v(e,["stopSequences"]);h!=null&&x(s,["stopSequences"],h);const f=v(e,["responseLogprobs"]);f!=null&&x(s,["responseLogprobs"],f);const p=v(e,["logprobs"]);p!=null&&x(s,["logprobs"],p);const g=v(e,["presencePenalty"]);g!=null&&x(s,["presencePenalty"],g);const b=v(e,["frequencyPenalty"]);b!=null&&x(s,["frequencyPenalty"],b);const T=v(e,["seed"]);T!=null&&x(s,["seed"],T);const w=v(e,["responseMimeType"]);w!=null&&x(s,["responseMimeType"],w);const _=v(e,["responseSchema"]);_!=null&&x(s,["responseSchema"],NN(_));const C=v(e,["responseJsonSchema"]);C!=null&&x(s,["responseJsonSchema"],C);const N=v(e,["routingConfig"]);N!=null&&x(s,["routingConfig"],N);const A=v(e,["modelSelectionConfig"]);A!=null&&x(s,["modelConfig"],A);const P=v(e,["safetySettings"]);if(t!==void 0&&P!=null){let X=P;Array.isArray(X)&&(X=X.map(Q=>Q)),x(t,["safetySettings"],X)}const V=v(e,["tools"]);if(t!==void 0&&V!=null){let X=yp(V);Array.isArray(X)&&(X=X.map(Q=>yU(gp(Q)))),x(t,["tools"],X)}const D=v(e,["toolConfig"]);t!==void 0&&D!=null&&x(t,["toolConfig"],D);const M=v(e,["labels"]);t!==void 0&&M!=null&&x(t,["labels"],M);const $=v(e,["cachedContent"]);t!==void 0&&$!=null&&x(t,["cachedContent"],Dl(n,$));const O=v(e,["responseModalities"]);O!=null&&x(s,["responseModalities"],O);const k=v(e,["mediaResolution"]);k!=null&&x(s,["mediaResolution"],k);const z=v(e,["speechConfig"]);z!=null&&x(s,["speechConfig"],gU(AN(z)));const U=v(e,["audioTimestamp"]);U!=null&&x(s,["audioTimestamp"],U);const te=v(e,["thinkingConfig"]);te!=null&&x(s,["thinkingConfig"],te);const se=v(e,["imageConfig"]);if(se!=null&&x(s,["imageConfig"],Gle(se)),v(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return s}function KF(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","model"],Jt(n,s));const r=v(e,["contents"]);if(r!=null){let o=Ji(r);Array.isArray(o)&&(o=o.map(a=>qw(a))),x(t,["contents"],o)}const i=v(e,["config"]);return i!=null&&x(t,["generationConfig"],mle(n,i,t)),t}function XF(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","model"],Jt(n,s));const r=v(e,["contents"]);if(r!=null){let o=Ji(r);Array.isArray(o)&&(o=o.map(a=>a)),x(t,["contents"],o)}const i=v(e,["config"]);return i!=null&&x(t,["generationConfig"],gle(n,i,t)),t}function YF(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["candidates"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(u=>Lae(u))),x(e,["candidates"],l)}const r=v(n,["modelVersion"]);r!=null&&x(e,["modelVersion"],r);const i=v(n,["promptFeedback"]);i!=null&&x(e,["promptFeedback"],i);const o=v(n,["responseId"]);o!=null&&x(e,["responseId"],o);const a=v(n,["usageMetadata"]);return a!=null&&x(e,["usageMetadata"],a),e}function JF(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["candidates"]);if(s!=null){let u=s;Array.isArray(u)&&(u=u.map(h=>h)),x(e,["candidates"],u)}const r=v(n,["createTime"]);r!=null&&x(e,["createTime"],r);const i=v(n,["modelVersion"]);i!=null&&x(e,["modelVersion"],i);const o=v(n,["promptFeedback"]);o!=null&&x(e,["promptFeedback"],o);const a=v(n,["responseId"]);a!=null&&x(e,["responseId"],a);const l=v(n,["usageMetadata"]);return l!=null&&x(e,["usageMetadata"],l),e}function yle(n,e){const t={};if(v(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(v(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const s=v(n,["numberOfImages"]);e!==void 0&&s!=null&&x(e,["parameters","sampleCount"],s);const r=v(n,["aspectRatio"]);e!==void 0&&r!=null&&x(e,["parameters","aspectRatio"],r);const i=v(n,["guidanceScale"]);if(e!==void 0&&i!=null&&x(e,["parameters","guidanceScale"],i),v(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=v(n,["safetyFilterLevel"]);e!==void 0&&o!=null&&x(e,["parameters","safetySetting"],o);const a=v(n,["personGeneration"]);e!==void 0&&a!=null&&x(e,["parameters","personGeneration"],a);const l=v(n,["includeSafetyAttributes"]);e!==void 0&&l!=null&&x(e,["parameters","includeSafetyAttributes"],l);const u=v(n,["includeRaiReason"]);e!==void 0&&u!=null&&x(e,["parameters","includeRaiReason"],u);const h=v(n,["language"]);e!==void 0&&h!=null&&x(e,["parameters","language"],h);const f=v(n,["outputMimeType"]);e!==void 0&&f!=null&&x(e,["parameters","outputOptions","mimeType"],f);const p=v(n,["outputCompressionQuality"]);if(e!==void 0&&p!=null&&x(e,["parameters","outputOptions","compressionQuality"],p),v(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(v(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const g=v(n,["imageSize"]);if(e!==void 0&&g!=null&&x(e,["parameters","sampleImageSize"],g),v(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function ble(n,e){const t={},s=v(n,["outputGcsUri"]);e!==void 0&&s!=null&&x(e,["parameters","storageUri"],s);const r=v(n,["negativePrompt"]);e!==void 0&&r!=null&&x(e,["parameters","negativePrompt"],r);const i=v(n,["numberOfImages"]);e!==void 0&&i!=null&&x(e,["parameters","sampleCount"],i);const o=v(n,["aspectRatio"]);e!==void 0&&o!=null&&x(e,["parameters","aspectRatio"],o);const a=v(n,["guidanceScale"]);e!==void 0&&a!=null&&x(e,["parameters","guidanceScale"],a);const l=v(n,["seed"]);e!==void 0&&l!=null&&x(e,["parameters","seed"],l);const u=v(n,["safetyFilterLevel"]);e!==void 0&&u!=null&&x(e,["parameters","safetySetting"],u);const h=v(n,["personGeneration"]);e!==void 0&&h!=null&&x(e,["parameters","personGeneration"],h);const f=v(n,["includeSafetyAttributes"]);e!==void 0&&f!=null&&x(e,["parameters","includeSafetyAttributes"],f);const p=v(n,["includeRaiReason"]);e!==void 0&&p!=null&&x(e,["parameters","includeRaiReason"],p);const g=v(n,["language"]);e!==void 0&&g!=null&&x(e,["parameters","language"],g);const b=v(n,["outputMimeType"]);e!==void 0&&b!=null&&x(e,["parameters","outputOptions","mimeType"],b);const T=v(n,["outputCompressionQuality"]);e!==void 0&&T!=null&&x(e,["parameters","outputOptions","compressionQuality"],T);const w=v(n,["addWatermark"]);e!==void 0&&w!=null&&x(e,["parameters","addWatermark"],w);const _=v(n,["labels"]);e!==void 0&&_!=null&&x(e,["labels"],_);const C=v(n,["imageSize"]);e!==void 0&&C!=null&&x(e,["parameters","sampleImageSize"],C);const N=v(n,["enhancePrompt"]);return e!==void 0&&N!=null&&x(e,["parameters","enhancePrompt"],N),t}function vle(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","model"],Jt(n,s));const r=v(e,["prompt"]);r!=null&&x(t,["instances[0]","prompt"],r);const i=v(e,["config"]);return i!=null&&yle(i,t),t}function wle(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","model"],Jt(n,s));const r=v(e,["prompt"]);r!=null&&x(t,["instances[0]","prompt"],r);const i=v(e,["config"]);return i!=null&&ble(i,t),t}function Tle(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["predictions"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(o=>Dle(o))),x(e,["generatedImages"],i)}const r=v(n,["positivePromptSafetyAttributes"]);return r!=null&&x(e,["positivePromptSafetyAttributes"],pU(r)),e}function xle(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["predictions"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(o=>Ww(o))),x(e,["generatedImages"],i)}const r=v(n,["positivePromptSafetyAttributes"]);return r!=null&&x(e,["positivePromptSafetyAttributes"],mU(r)),e}function Sle(n,e){const t={},s=v(n,["numberOfVideos"]);if(e!==void 0&&s!=null&&x(e,["parameters","sampleCount"],s),v(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(v(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const r=v(n,["durationSeconds"]);if(e!==void 0&&r!=null&&x(e,["parameters","durationSeconds"],r),v(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const i=v(n,["aspectRatio"]);e!==void 0&&i!=null&&x(e,["parameters","aspectRatio"],i);const o=v(n,["resolution"]);e!==void 0&&o!=null&&x(e,["parameters","resolution"],o);const a=v(n,["personGeneration"]);if(e!==void 0&&a!=null&&x(e,["parameters","personGeneration"],a),v(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const l=v(n,["negativePrompt"]);e!==void 0&&l!=null&&x(e,["parameters","negativePrompt"],l);const u=v(n,["enhancePrompt"]);if(e!==void 0&&u!=null&&x(e,["parameters","enhancePrompt"],u),v(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const h=v(n,["lastFrame"]);e!==void 0&&h!=null&&x(e,["instances[0]","lastFrame"],Kw(h));const f=v(n,["referenceImages"]);if(e!==void 0&&f!=null){let p=f;Array.isArray(p)&&(p=p.map(g=>Eue(g))),x(e,["instances[0]","referenceImages"],p)}if(v(n,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(v(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function _le(n,e){const t={},s=v(n,["numberOfVideos"]);e!==void 0&&s!=null&&x(e,["parameters","sampleCount"],s);const r=v(n,["outputGcsUri"]);e!==void 0&&r!=null&&x(e,["parameters","storageUri"],r);const i=v(n,["fps"]);e!==void 0&&i!=null&&x(e,["parameters","fps"],i);const o=v(n,["durationSeconds"]);e!==void 0&&o!=null&&x(e,["parameters","durationSeconds"],o);const a=v(n,["seed"]);e!==void 0&&a!=null&&x(e,["parameters","seed"],a);const l=v(n,["aspectRatio"]);e!==void 0&&l!=null&&x(e,["parameters","aspectRatio"],l);const u=v(n,["resolution"]);e!==void 0&&u!=null&&x(e,["parameters","resolution"],u);const h=v(n,["personGeneration"]);e!==void 0&&h!=null&&x(e,["parameters","personGeneration"],h);const f=v(n,["pubsubTopic"]);e!==void 0&&f!=null&&x(e,["parameters","pubsubTopic"],f);const p=v(n,["negativePrompt"]);e!==void 0&&p!=null&&x(e,["parameters","negativePrompt"],p);const g=v(n,["enhancePrompt"]);e!==void 0&&g!=null&&x(e,["parameters","enhancePrompt"],g);const b=v(n,["generateAudio"]);e!==void 0&&b!=null&&x(e,["parameters","generateAudio"],b);const T=v(n,["lastFrame"]);e!==void 0&&T!=null&&x(e,["instances[0]","lastFrame"],Lo(T));const w=v(n,["referenceImages"]);if(e!==void 0&&w!=null){let N=w;Array.isArray(N)&&(N=N.map(A=>Iue(A))),x(e,["instances[0]","referenceImages"],N)}const _=v(n,["mask"]);e!==void 0&&_!=null&&x(e,["instances[0]","mask"],_ue(_));const C=v(n,["compressionQuality"]);return e!==void 0&&C!=null&&x(e,["parameters","compressionQuality"],C),t}function Ele(n){const e={},t=v(n,["name"]);t!=null&&x(e,["name"],t);const s=v(n,["metadata"]);s!=null&&x(e,["metadata"],s);const r=v(n,["done"]);r!=null&&x(e,["done"],r);const i=v(n,["error"]);i!=null&&x(e,["error"],i);const o=v(n,["response","generateVideoResponse"]);return o!=null&&x(e,["response"],Ale(o)),e}function Ile(n){const e={},t=v(n,["name"]);t!=null&&x(e,["name"],t);const s=v(n,["metadata"]);s!=null&&x(e,["metadata"],s);const r=v(n,["done"]);r!=null&&x(e,["done"],r);const i=v(n,["error"]);i!=null&&x(e,["error"],i);const o=v(n,["response"]);return o!=null&&x(e,["response"],kle(o)),e}function Cle(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","model"],Jt(n,s));const r=v(e,["prompt"]);r!=null&&x(t,["instances[0]","prompt"],r);const i=v(e,["image"]);i!=null&&x(t,["instances[0]","image"],Kw(i));const o=v(e,["video"]);o!=null&&x(t,["instances[0]","video"],bU(o));const a=v(e,["source"]);a!=null&&$le(a,t);const l=v(e,["config"]);return l!=null&&Sle(l,t),t}function Nle(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","model"],Jt(n,s));const r=v(e,["prompt"]);r!=null&&x(t,["instances[0]","prompt"],r);const i=v(e,["image"]);i!=null&&x(t,["instances[0]","image"],Lo(i));const o=v(e,["video"]);o!=null&&x(t,["instances[0]","video"],vU(o));const a=v(e,["source"]);a!=null&&Rle(a,t);const l=v(e,["config"]);return l!=null&&_le(l,t),t}function Ale(n){const e={},t=v(n,["generatedSamples"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>Ole(o))),x(e,["generatedVideos"],i)}const s=v(n,["raiMediaFilteredCount"]);s!=null&&x(e,["raiMediaFilteredCount"],s);const r=v(n,["raiMediaFilteredReasons"]);return r!=null&&x(e,["raiMediaFilteredReasons"],r),e}function kle(n){const e={},t=v(n,["videos"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>Ple(o))),x(e,["generatedVideos"],i)}const s=v(n,["raiMediaFilteredCount"]);s!=null&&x(e,["raiMediaFilteredCount"],s);const r=v(n,["raiMediaFilteredReasons"]);return r!=null&&x(e,["raiMediaFilteredReasons"],r),e}function $le(n,e){const t={},s=v(n,["prompt"]);e!==void 0&&s!=null&&x(e,["instances[0]","prompt"],s);const r=v(n,["image"]);e!==void 0&&r!=null&&x(e,["instances[0]","image"],Kw(r));const i=v(n,["video"]);return e!==void 0&&i!=null&&x(e,["instances[0]","video"],bU(i)),t}function Rle(n,e){const t={},s=v(n,["prompt"]);e!==void 0&&s!=null&&x(e,["instances[0]","prompt"],s);const r=v(n,["image"]);e!==void 0&&r!=null&&x(e,["instances[0]","image"],Lo(r));const i=v(n,["video"]);return e!==void 0&&i!=null&&x(e,["instances[0]","video"],vU(i)),t}function Dle(n){const e={},t=v(n,["_self"]);t!=null&&x(e,["image"],Hle(t));const s=v(n,["raiFilteredReason"]);s!=null&&x(e,["raiFilteredReason"],s);const r=v(n,["_self"]);return r!=null&&x(e,["safetyAttributes"],pU(r)),e}function Ww(n){const e={},t=v(n,["_self"]);t!=null&&x(e,["image"],fU(t));const s=v(n,["raiFilteredReason"]);s!=null&&x(e,["raiFilteredReason"],s);const r=v(n,["_self"]);r!=null&&x(e,["safetyAttributes"],mU(r));const i=v(n,["prompt"]);return i!=null&&x(e,["enhancedPrompt"],i),e}function Mle(n){const e={},t=v(n,["_self"]);t!=null&&x(e,["mask"],fU(t));const s=v(n,["labels"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(i=>i)),x(e,["labels"],r)}return e}function Ole(n){const e={},t=v(n,["video"]);return t!=null&&x(e,["video"],xue(t)),e}function Ple(n){const e={},t=v(n,["_self"]);return t!=null&&x(e,["video"],Sue(t)),e}function Fle(n){const e={},t=v(n,["modelSelectionConfig"]);t!=null&&x(e,["modelConfig"],t);const s=v(n,["responseJsonSchema"]);s!=null&&x(e,["responseJsonSchema"],s);const r=v(n,["audioTimestamp"]);r!=null&&x(e,["audioTimestamp"],r);const i=v(n,["candidateCount"]);i!=null&&x(e,["candidateCount"],i);const o=v(n,["enableAffectiveDialog"]);o!=null&&x(e,["enableAffectiveDialog"],o);const a=v(n,["frequencyPenalty"]);a!=null&&x(e,["frequencyPenalty"],a);const l=v(n,["logprobs"]);l!=null&&x(e,["logprobs"],l);const u=v(n,["maxOutputTokens"]);u!=null&&x(e,["maxOutputTokens"],u);const h=v(n,["mediaResolution"]);h!=null&&x(e,["mediaResolution"],h);const f=v(n,["presencePenalty"]);f!=null&&x(e,["presencePenalty"],f);const p=v(n,["responseLogprobs"]);p!=null&&x(e,["responseLogprobs"],p);const g=v(n,["responseMimeType"]);g!=null&&x(e,["responseMimeType"],g);const b=v(n,["responseModalities"]);b!=null&&x(e,["responseModalities"],b);const T=v(n,["responseSchema"]);T!=null&&x(e,["responseSchema"],T);const w=v(n,["routingConfig"]);w!=null&&x(e,["routingConfig"],w);const _=v(n,["seed"]);_!=null&&x(e,["seed"],_);const C=v(n,["speechConfig"]);C!=null&&x(e,["speechConfig"],gU(C));const N=v(n,["stopSequences"]);N!=null&&x(e,["stopSequences"],N);const A=v(n,["temperature"]);A!=null&&x(e,["temperature"],A);const P=v(n,["thinkingConfig"]);P!=null&&x(e,["thinkingConfig"],P);const V=v(n,["topK"]);V!=null&&x(e,["topK"],V);const D=v(n,["topP"]);if(D!=null&&x(e,["topP"],D),v(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Lle(n,e){const t={},s=v(e,["model"]);return s!=null&&x(t,["_url","name"],Jt(n,s)),t}function Vle(n,e){const t={},s=v(e,["model"]);return s!=null&&x(t,["_url","name"],Jt(n,s)),t}function Ble(n){const e={};if(v(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=v(n,["enableWidget"]);return t!=null&&x(e,["enableWidget"],t),e}function Ule(n){const e={};if(v(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=v(n,["timeRangeFilter"]);return t!=null&&x(e,["timeRangeFilter"],t),e}function zle(n){const e={},t=v(n,["aspectRatio"]);t!=null&&x(e,["aspectRatio"],t);const s=v(n,["imageSize"]);if(s!=null&&x(e,["imageSize"],s),v(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(v(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function Gle(n){const e={},t=v(n,["aspectRatio"]);t!=null&&x(e,["aspectRatio"],t);const s=v(n,["imageSize"]);s!=null&&x(e,["imageSize"],s);const r=v(n,["outputMimeType"]);r!=null&&x(e,["imageOutputOptions","mimeType"],r);const i=v(n,["outputCompressionQuality"]);return i!=null&&x(e,["imageOutputOptions","compressionQuality"],i),e}function Hle(n){const e={},t=v(n,["bytesBase64Encoded"]);t!=null&&x(e,["imageBytes"],bc(t));const s=v(n,["mimeType"]);return s!=null&&x(e,["mimeType"],s),e}function fU(n){const e={},t=v(n,["gcsUri"]);t!=null&&x(e,["gcsUri"],t);const s=v(n,["bytesBase64Encoded"]);s!=null&&x(e,["imageBytes"],bc(s));const r=v(n,["mimeType"]);return r!=null&&x(e,["mimeType"],r),e}function Kw(n){const e={};if(v(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=v(n,["imageBytes"]);t!=null&&x(e,["bytesBase64Encoded"],bc(t));const s=v(n,["mimeType"]);return s!=null&&x(e,["mimeType"],s),e}function Lo(n){const e={},t=v(n,["gcsUri"]);t!=null&&x(e,["gcsUri"],t);const s=v(n,["imageBytes"]);s!=null&&x(e,["bytesBase64Encoded"],bc(s));const r=v(n,["mimeType"]);return r!=null&&x(e,["mimeType"],r),e}function qle(n,e,t){const s={},r=v(e,["pageSize"]);t!==void 0&&r!=null&&x(t,["_query","pageSize"],r);const i=v(e,["pageToken"]);t!==void 0&&i!=null&&x(t,["_query","pageToken"],i);const o=v(e,["filter"]);t!==void 0&&o!=null&&x(t,["_query","filter"],o);const a=v(e,["queryBase"]);return t!==void 0&&a!=null&&x(t,["_url","models_url"],iU(n,a)),s}function Wle(n,e,t){const s={},r=v(e,["pageSize"]);t!==void 0&&r!=null&&x(t,["_query","pageSize"],r);const i=v(e,["pageToken"]);t!==void 0&&i!=null&&x(t,["_query","pageToken"],i);const o=v(e,["filter"]);t!==void 0&&o!=null&&x(t,["_query","filter"],o);const a=v(e,["queryBase"]);return t!==void 0&&a!=null&&x(t,["_url","models_url"],iU(n,a)),s}function Kle(n,e){const t={},s=v(e,["config"]);return s!=null&&qle(n,s,t),t}function Xle(n,e){const t={},s=v(e,["config"]);return s!=null&&Wle(n,s,t),t}function Yle(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["nextPageToken"]);s!=null&&x(e,["nextPageToken"],s);const r=v(n,["_self"]);if(r!=null){let i=oU(r);Array.isArray(i)&&(i=i.map(o=>iI(o))),x(e,["models"],i)}return e}function Jle(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["nextPageToken"]);s!=null&&x(e,["nextPageToken"],s);const r=v(n,["_self"]);if(r!=null){let i=oU(r);Array.isArray(i)&&(i=i.map(o=>oI(o))),x(e,["models"],i)}return e}function jle(n){const e={},t=v(n,["maskMode"]);t!=null&&x(e,["maskMode"],t);const s=v(n,["segmentationClasses"]);s!=null&&x(e,["maskClasses"],s);const r=v(n,["maskDilation"]);return r!=null&&x(e,["dilation"],r),e}function iI(n){const e={},t=v(n,["name"]);t!=null&&x(e,["name"],t);const s=v(n,["displayName"]);s!=null&&x(e,["displayName"],s);const r=v(n,["description"]);r!=null&&x(e,["description"],r);const i=v(n,["version"]);i!=null&&x(e,["version"],i);const o=v(n,["_self"]);o!=null&&x(e,["tunedModelInfo"],fue(o));const a=v(n,["inputTokenLimit"]);a!=null&&x(e,["inputTokenLimit"],a);const l=v(n,["outputTokenLimit"]);l!=null&&x(e,["outputTokenLimit"],l);const u=v(n,["supportedGenerationMethods"]);u!=null&&x(e,["supportedActions"],u);const h=v(n,["temperature"]);h!=null&&x(e,["temperature"],h);const f=v(n,["maxTemperature"]);f!=null&&x(e,["maxTemperature"],f);const p=v(n,["topP"]);p!=null&&x(e,["topP"],p);const g=v(n,["topK"]);g!=null&&x(e,["topK"],g);const b=v(n,["thinking"]);return b!=null&&x(e,["thinking"],b),e}function oI(n){const e={},t=v(n,["name"]);t!=null&&x(e,["name"],t);const s=v(n,["displayName"]);s!=null&&x(e,["displayName"],s);const r=v(n,["description"]);r!=null&&x(e,["description"],r);const i=v(n,["versionId"]);i!=null&&x(e,["version"],i);const o=v(n,["deployedModels"]);if(o!=null){let f=o;Array.isArray(f)&&(f=f.map(p=>cle(p))),x(e,["endpoints"],f)}const a=v(n,["labels"]);a!=null&&x(e,["labels"],a);const l=v(n,["_self"]);l!=null&&x(e,["tunedModelInfo"],pue(l));const u=v(n,["defaultCheckpointId"]);u!=null&&x(e,["defaultCheckpointId"],u);const h=v(n,["checkpoints"]);if(h!=null){let f=h;Array.isArray(f)&&(f=f.map(p=>p)),x(e,["checkpoints"],f)}return e}function Qle(n){const e={},t=v(n,["mediaResolution"]);t!=null&&x(e,["mediaResolution"],t);const s=v(n,["codeExecutionResult"]);s!=null&&x(e,["codeExecutionResult"],s);const r=v(n,["executableCode"]);r!=null&&x(e,["executableCode"],r);const i=v(n,["fileData"]);i!=null&&x(e,["fileData"],hle(i));const o=v(n,["functionCall"]);o!=null&&x(e,["functionCall"],dle(o));const a=v(n,["functionResponse"]);a!=null&&x(e,["functionResponse"],a);const l=v(n,["inlineData"]);l!=null&&x(e,["inlineData"],Fae(l));const u=v(n,["text"]);u!=null&&x(e,["text"],u);const h=v(n,["thought"]);h!=null&&x(e,["thought"],h);const f=v(n,["thoughtSignature"]);f!=null&&x(e,["thoughtSignature"],f);const p=v(n,["videoMetadata"]);return p!=null&&x(e,["videoMetadata"],p),e}function Zle(n){const e={},t=v(n,["productImage"]);return t!=null&&x(e,["image"],Lo(t)),e}function eue(n,e){const t={},s=v(n,["numberOfImages"]);e!==void 0&&s!=null&&x(e,["parameters","sampleCount"],s);const r=v(n,["baseSteps"]);e!==void 0&&r!=null&&x(e,["parameters","baseSteps"],r);const i=v(n,["outputGcsUri"]);e!==void 0&&i!=null&&x(e,["parameters","storageUri"],i);const o=v(n,["seed"]);e!==void 0&&o!=null&&x(e,["parameters","seed"],o);const a=v(n,["safetyFilterLevel"]);e!==void 0&&a!=null&&x(e,["parameters","safetySetting"],a);const l=v(n,["personGeneration"]);e!==void 0&&l!=null&&x(e,["parameters","personGeneration"],l);const u=v(n,["addWatermark"]);e!==void 0&&u!=null&&x(e,["parameters","addWatermark"],u);const h=v(n,["outputMimeType"]);e!==void 0&&h!=null&&x(e,["parameters","outputOptions","mimeType"],h);const f=v(n,["outputCompressionQuality"]);e!==void 0&&f!=null&&x(e,["parameters","outputOptions","compressionQuality"],f);const p=v(n,["enhancePrompt"]);e!==void 0&&p!=null&&x(e,["parameters","enhancePrompt"],p);const g=v(n,["labels"]);return e!==void 0&&g!=null&&x(e,["labels"],g),t}function tue(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","model"],Jt(n,s));const r=v(e,["source"]);r!=null&&sue(r,t);const i=v(e,["config"]);return i!=null&&eue(i,t),t}function nue(n){const e={},t=v(n,["predictions"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>Ww(r))),x(e,["generatedImages"],s)}return e}function sue(n,e){const t={},s=v(n,["prompt"]);e!==void 0&&s!=null&&x(e,["instances[0]","prompt"],s);const r=v(n,["personImage"]);e!==void 0&&r!=null&&x(e,["instances[0]","personImage","image"],Lo(r));const i=v(n,["productImages"]);if(e!==void 0&&i!=null){let o=i;Array.isArray(o)&&(o=o.map(a=>Zle(a))),x(e,["instances[0]","productImages"],o)}return t}function rue(n){const e={},t=v(n,["referenceImage"]);t!=null&&x(e,["referenceImage"],Lo(t));const s=v(n,["referenceId"]);s!=null&&x(e,["referenceId"],s);const r=v(n,["referenceType"]);r!=null&&x(e,["referenceType"],r);const i=v(n,["maskImageConfig"]);i!=null&&x(e,["maskImageConfig"],jle(i));const o=v(n,["controlImageConfig"]);o!=null&&x(e,["controlImageConfig"],Hae(o));const a=v(n,["styleImageConfig"]);a!=null&&x(e,["styleImageConfig"],a);const l=v(n,["subjectImageConfig"]);return l!=null&&x(e,["subjectImageConfig"],l),e}function pU(n){const e={},t=v(n,["safetyAttributes","categories"]);t!=null&&x(e,["categories"],t);const s=v(n,["safetyAttributes","scores"]);s!=null&&x(e,["scores"],s);const r=v(n,["contentType"]);return r!=null&&x(e,["contentType"],r),e}function mU(n){const e={},t=v(n,["safetyAttributes","categories"]);t!=null&&x(e,["categories"],t);const s=v(n,["safetyAttributes","scores"]);s!=null&&x(e,["scores"],s);const r=v(n,["contentType"]);return r!=null&&x(e,["contentType"],r),e}function iue(n){const e={},t=v(n,["category"]);if(t!=null&&x(e,["category"],t),v(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=v(n,["threshold"]);return s!=null&&x(e,["threshold"],s),e}function oue(n){const e={},t=v(n,["image"]);return t!=null&&x(e,["image"],Lo(t)),e}function aue(n,e){const t={},s=v(n,["mode"]);e!==void 0&&s!=null&&x(e,["parameters","mode"],s);const r=v(n,["maxPredictions"]);e!==void 0&&r!=null&&x(e,["parameters","maxPredictions"],r);const i=v(n,["confidenceThreshold"]);e!==void 0&&i!=null&&x(e,["parameters","confidenceThreshold"],i);const o=v(n,["maskDilation"]);e!==void 0&&o!=null&&x(e,["parameters","maskDilation"],o);const a=v(n,["binaryColorThreshold"]);e!==void 0&&a!=null&&x(e,["parameters","binaryColorThreshold"],a);const l=v(n,["labels"]);return e!==void 0&&l!=null&&x(e,["labels"],l),t}function lue(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","model"],Jt(n,s));const r=v(e,["source"]);r!=null&&cue(r,t);const i=v(e,["config"]);return i!=null&&aue(i,t),t}function uue(n){const e={},t=v(n,["predictions"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>Mle(r))),x(e,["generatedMasks"],s)}return e}function cue(n,e){const t={},s=v(n,["prompt"]);e!==void 0&&s!=null&&x(e,["instances[0]","prompt"],s);const r=v(n,["image"]);e!==void 0&&r!=null&&x(e,["instances[0]","image"],Lo(r));const i=v(n,["scribbleImage"]);return e!==void 0&&i!=null&&x(e,["instances[0]","scribble"],oue(i)),t}function gU(n){const e={},t=v(n,["voiceConfig"]);t!=null&&x(e,["voiceConfig"],t);const s=v(n,["languageCode"]);if(s!=null&&x(e,["languageCode"],s),v(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function hue(n){const e={},t=v(n,["functionCallingConfig"]);t!=null&&x(e,["functionCallingConfig"],fle(t));const s=v(n,["retrievalConfig"]);return s!=null&&x(e,["retrievalConfig"],s),e}function due(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(f=>f)),x(e,["functionDeclarations"],h)}if(v(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=v(n,["googleSearchRetrieval"]);s!=null&&x(e,["googleSearchRetrieval"],s);const r=v(n,["computerUse"]);r!=null&&x(e,["computerUse"],r);const i=v(n,["fileSearch"]);i!=null&&x(e,["fileSearch"],i);const o=v(n,["codeExecution"]);if(o!=null&&x(e,["codeExecution"],o),v(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=v(n,["googleMaps"]);a!=null&&x(e,["googleMaps"],Ble(a));const l=v(n,["googleSearch"]);l!=null&&x(e,["googleSearch"],Ule(l));const u=v(n,["urlContext"]);return u!=null&&x(e,["urlContext"],u),e}function yU(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>ple(p))),x(e,["functionDeclarations"],f)}const s=v(n,["retrieval"]);s!=null&&x(e,["retrieval"],s);const r=v(n,["googleSearchRetrieval"]);r!=null&&x(e,["googleSearchRetrieval"],r);const i=v(n,["computerUse"]);if(i!=null&&x(e,["computerUse"],i),v(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const o=v(n,["codeExecution"]);o!=null&&x(e,["codeExecution"],o);const a=v(n,["enterpriseWebSearch"]);a!=null&&x(e,["enterpriseWebSearch"],a);const l=v(n,["googleMaps"]);l!=null&&x(e,["googleMaps"],l);const u=v(n,["googleSearch"]);u!=null&&x(e,["googleSearch"],u);const h=v(n,["urlContext"]);return h!=null&&x(e,["urlContext"],h),e}function fue(n){const e={},t=v(n,["baseModel"]);t!=null&&x(e,["baseModel"],t);const s=v(n,["createTime"]);s!=null&&x(e,["createTime"],s);const r=v(n,["updateTime"]);return r!=null&&x(e,["updateTime"],r),e}function pue(n){const e={},t=v(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&x(e,["baseModel"],t);const s=v(n,["createTime"]);s!=null&&x(e,["createTime"],s);const r=v(n,["updateTime"]);return r!=null&&x(e,["updateTime"],r),e}function mue(n,e){const t={},s=v(n,["displayName"]);e!==void 0&&s!=null&&x(e,["displayName"],s);const r=v(n,["description"]);e!==void 0&&r!=null&&x(e,["description"],r);const i=v(n,["defaultCheckpointId"]);return e!==void 0&&i!=null&&x(e,["defaultCheckpointId"],i),t}function gue(n,e){const t={},s=v(n,["displayName"]);e!==void 0&&s!=null&&x(e,["displayName"],s);const r=v(n,["description"]);e!==void 0&&r!=null&&x(e,["description"],r);const i=v(n,["defaultCheckpointId"]);return e!==void 0&&i!=null&&x(e,["defaultCheckpointId"],i),t}function yue(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","name"],Jt(n,s));const r=v(e,["config"]);return r!=null&&mue(r,t),t}function bue(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","model"],Jt(n,s));const r=v(e,["config"]);return r!=null&&gue(r,t),t}function vue(n,e){const t={},s=v(n,["outputGcsUri"]);e!==void 0&&s!=null&&x(e,["parameters","storageUri"],s);const r=v(n,["safetyFilterLevel"]);e!==void 0&&r!=null&&x(e,["parameters","safetySetting"],r);const i=v(n,["personGeneration"]);e!==void 0&&i!=null&&x(e,["parameters","personGeneration"],i);const o=v(n,["includeRaiReason"]);e!==void 0&&o!=null&&x(e,["parameters","includeRaiReason"],o);const a=v(n,["outputMimeType"]);e!==void 0&&a!=null&&x(e,["parameters","outputOptions","mimeType"],a);const l=v(n,["outputCompressionQuality"]);e!==void 0&&l!=null&&x(e,["parameters","outputOptions","compressionQuality"],l);const u=v(n,["enhanceInputImage"]);e!==void 0&&u!=null&&x(e,["parameters","upscaleConfig","enhanceInputImage"],u);const h=v(n,["imagePreservationFactor"]);e!==void 0&&h!=null&&x(e,["parameters","upscaleConfig","imagePreservationFactor"],h);const f=v(n,["labels"]);e!==void 0&&f!=null&&x(e,["labels"],f);const p=v(n,["numberOfImages"]);e!==void 0&&p!=null&&x(e,["parameters","sampleCount"],p);const g=v(n,["mode"]);return e!==void 0&&g!=null&&x(e,["parameters","mode"],g),t}function wue(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["_url","model"],Jt(n,s));const r=v(e,["image"]);r!=null&&x(t,["instances[0]","image"],Lo(r));const i=v(e,["upscaleFactor"]);i!=null&&x(t,["parameters","upscaleConfig","upscaleFactor"],i);const o=v(e,["config"]);return o!=null&&vue(o,t),t}function Tue(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["predictions"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(i=>Ww(i))),x(e,["generatedImages"],r)}return e}function xue(n){const e={},t=v(n,["uri"]);t!=null&&x(e,["uri"],t);const s=v(n,["encodedVideo"]);s!=null&&x(e,["videoBytes"],bc(s));const r=v(n,["encoding"]);return r!=null&&x(e,["mimeType"],r),e}function Sue(n){const e={},t=v(n,["gcsUri"]);t!=null&&x(e,["uri"],t);const s=v(n,["bytesBase64Encoded"]);s!=null&&x(e,["videoBytes"],bc(s));const r=v(n,["mimeType"]);return r!=null&&x(e,["mimeType"],r),e}function _ue(n){const e={},t=v(n,["image"]);t!=null&&x(e,["_self"],Lo(t));const s=v(n,["maskMode"]);return s!=null&&x(e,["maskMode"],s),e}function Eue(n){const e={},t=v(n,["image"]);t!=null&&x(e,["image"],Kw(t));const s=v(n,["referenceType"]);return s!=null&&x(e,["referenceType"],s),e}function Iue(n){const e={},t=v(n,["image"]);t!=null&&x(e,["image"],Lo(t));const s=v(n,["referenceType"]);return s!=null&&x(e,["referenceType"],s),e}function bU(n){const e={},t=v(n,["uri"]);t!=null&&x(e,["uri"],t);const s=v(n,["videoBytes"]);s!=null&&x(e,["encodedVideo"],bc(s));const r=v(n,["mimeType"]);return r!=null&&x(e,["encoding"],r),e}function vU(n){const e={},t=v(n,["uri"]);t!=null&&x(e,["gcsUri"],t);const s=v(n,["videoBytes"]);s!=null&&x(e,["bytesBase64Encoded"],bc(s));const r=v(n,["mimeType"]);return r!=null&&x(e,["mimeType"],r),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Cue(n,e){const t={},s=v(n,["displayName"]);return e!==void 0&&s!=null&&x(e,["displayName"],s),t}function Nue(n){const e={},t=v(n,["config"]);return t!=null&&Cue(t,e),e}function Aue(n,e){const t={},s=v(n,["force"]);return e!==void 0&&s!=null&&x(e,["_query","force"],s),t}function kue(n){const e={},t=v(n,["name"]);t!=null&&x(e,["_url","name"],t);const s=v(n,["config"]);return s!=null&&Aue(s,e),e}function $ue(n){const e={},t=v(n,["name"]);return t!=null&&x(e,["_url","name"],t),e}function Rue(n,e){const t={},s=v(n,["customMetadata"]);if(e!==void 0&&s!=null){let i=s;Array.isArray(i)&&(i=i.map(o=>o)),x(e,["customMetadata"],i)}const r=v(n,["chunkingConfig"]);return e!==void 0&&r!=null&&x(e,["chunkingConfig"],r),t}function Due(n){const e={},t=v(n,["name"]);t!=null&&x(e,["name"],t);const s=v(n,["metadata"]);s!=null&&x(e,["metadata"],s);const r=v(n,["done"]);r!=null&&x(e,["done"],r);const i=v(n,["error"]);i!=null&&x(e,["error"],i);const o=v(n,["response"]);return o!=null&&x(e,["response"],Oue(o)),e}function Mue(n){const e={},t=v(n,["fileSearchStoreName"]);t!=null&&x(e,["_url","file_search_store_name"],t);const s=v(n,["fileName"]);s!=null&&x(e,["fileName"],s);const r=v(n,["config"]);return r!=null&&Rue(r,e),e}function Oue(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["parent"]);s!=null&&x(e,["parent"],s);const r=v(n,["documentName"]);return r!=null&&x(e,["documentName"],r),e}function Pue(n,e){const t={},s=v(n,["pageSize"]);e!==void 0&&s!=null&&x(e,["_query","pageSize"],s);const r=v(n,["pageToken"]);return e!==void 0&&r!=null&&x(e,["_query","pageToken"],r),t}function Fue(n){const e={},t=v(n,["config"]);return t!=null&&Pue(t,e),e}function Lue(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["nextPageToken"]);s!=null&&x(e,["nextPageToken"],s);const r=v(n,["fileSearchStores"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>o)),x(e,["fileSearchStores"],i)}return e}function wU(n,e){const t={},s=v(n,["mimeType"]);e!==void 0&&s!=null&&x(e,["mimeType"],s);const r=v(n,["displayName"]);e!==void 0&&r!=null&&x(e,["displayName"],r);const i=v(n,["customMetadata"]);if(e!==void 0&&i!=null){let a=i;Array.isArray(a)&&(a=a.map(l=>l)),x(e,["customMetadata"],a)}const o=v(n,["chunkingConfig"]);return e!==void 0&&o!=null&&x(e,["chunkingConfig"],o),t}function Vue(n){const e={},t=v(n,["fileSearchStoreName"]);t!=null&&x(e,["_url","file_search_store_name"],t);const s=v(n,["config"]);return s!=null&&wU(s,e),e}function Bue(n){const e={},t=v(n,["sdkHttpResponse"]);return t!=null&&x(e,["sdkHttpResponse"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Uue="Content-Type",zue="X-Server-Timeout",Gue="User-Agent",aI="x-goog-api-client",Hue="1.32.0",que=`google-genai-sdk/${Hue}`,Wue="v1beta1",Kue="v1beta";class Xue{constructor(e){var t,s;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const r={};this.clientOptions.vertexai?(r.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:Wue,r.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(r.apiVersion=(s=this.clientOptions.apiVersion)!==null&&s!==void 0?s:Kue,r.baseUrl="https://generativelanguage.googleapis.com/"),r.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=r,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(r,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const s=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&s.push(e.apiVersion),s.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,s){const r=[this.getRequestUrlInternal(t)];return s&&r.push(this.getBaseResourcePath()),e!==""&&r.push(e),new URL(`${r.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,t,s);if(e.queryParams)for(const[o,a]of Object.entries(e.queryParams))r.searchParams.append(o,String(a));let i={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else i.body=e.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,t,r.toString(),e.abortSignal),this.unaryApiCall(r,i,e.httpMethod)}patchHttpOptions(e,t){const s=JSON.parse(JSON.stringify(e));for(const[r,i]of Object.entries(t))typeof i=="object"?s[r]=Object.assign(Object.assign({},s[r]),i):i!==void 0&&(s[r]=i);return s}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,t,s);(!r.searchParams.has("alt")||r.searchParams.get("alt")!=="sse")&&r.searchParams.set("alt","sse");let i={};return i.body=e.body,i=await this.includeExtraHttpOptionsToRequestInit(i,t,r.toString(),e.abortSignal),this.streamApiCall(r,i,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,s,r){if(t&&t.timeout||r){const i=new AbortController,o=i.signal;if(t.timeout&&(t==null?void 0:t.timeout)>0){const a=setTimeout(()=>i.abort(),t.timeout);a&&typeof a.unref=="function"&&a.unref()}r&&r.addEventListener("abort",()=>{i.abort()}),e.signal=o}return t&&t.extraBody!==null&&Yue(e,t.extraBody),e.headers=await this.getHeadersInternal(t,s),e}async unaryApiCall(e,t,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:s})).then(async r=>(await jF(r),new nI(r))).catch(r=>{throw r instanceof Error?r:new Error(JSON.stringify(r))})}async streamApiCall(e,t,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:s})).then(async r=>(await jF(r),this.processStreamResponse(r))).catch(r=>{throw r instanceof Error?r:new Error(JSON.stringify(r))})}processStreamResponse(e){return _f(this,arguments,function*(){var s;const r=(s=e==null?void 0:e.body)===null||s===void 0?void 0:s.getReader(),i=new TextDecoder("utf-8");if(!r)throw new Error("Response body is empty");try{let o="";const a="data:",l=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:u,value:h}=yield Rn(r.read());if(u){if(o.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const f=i.decode(h,{stream:!0});try{const b=JSON.parse(f);if("error"in b){const T=JSON.parse(JSON.stringify(b.error)),w=T.status,_=T.code,C=`got status: ${w}. ${JSON.stringify(b)}`;if(_>=400&&_<600)throw new Hw({message:C,status:_})}}catch(b){if(b.name==="ApiError")throw b}o+=f;let p=-1,g=0;for(;;){p=-1,g=0;for(const w of l){const _=o.indexOf(w);_!==-1&&(p===-1||_<p)&&(p=_,g=w.length)}if(p===-1)break;const b=o.substring(0,p);o=o.substring(p+g);const T=b.trim();if(T.startsWith(a)){const w=T.substring(a.length).trim();try{const _=new Response(w,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield Rn(new nI(_))}catch(_){throw new Error(`exception parsing stream chunk ${w}. ${_}`)}}}}}finally{r.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(s=>{throw new Error(`exception ${s} sending request`)})}getDefaultHeaders(){const e={},t=que+" "+this.clientOptions.userAgentExtra;return e[Gue]=t,e[aI]=t,e[Uue]="application/json",e}async getHeadersInternal(e,t){const s=new Headers;if(e&&e.headers){for(const[r,i]of Object.entries(e.headers))s.append(r,i);e.timeout&&e.timeout>0&&s.append(zue,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(s,t),s}getFileName(e){var t;let s="";return typeof e=="string"&&(s=e.replace(/[/\\]+$/,""),s=(t=s.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),s}async uploadFile(e,t){var s;const r={};t!=null&&(r.mimeType=t.mimeType,r.name=t.name,r.displayName=t.displayName),r.name&&!r.name.startsWith("files/")&&(r.name=`files/${r.name}`);const i=this.clientOptions.uploader,o=await i.stat(e);r.sizeBytes=String(o.size);const a=(s=t==null?void 0:t.mimeType)!==null&&s!==void 0?s:o.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");r.mimeType=a;const l={file:r},u=this.getFileName(e),h=He("upload/v1beta/files",l._url),f=await this.fetchUploadUrl(h,r.sizeBytes,r.mimeType,u,l,t==null?void 0:t.httpOptions);return i.upload(e,f,this)}async uploadFileToFileSearchStore(e,t,s){var r;const i=this.clientOptions.uploader,o=await i.stat(t),a=String(o.size),l=(r=s==null?void 0:s.mimeType)!==null&&r!==void 0?r:o.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const u=`upload/v1beta/${e}:uploadToFileSearchStore`,h=this.getFileName(t),f={};s!=null&&wU(s,f);const p=await this.fetchUploadUrl(u,a,l,h,f,s==null?void 0:s.httpOptions);return i.uploadToFileSearchStore(t,p,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,s,r,i,o){var a;let l={};o?l=o:l={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${s}`},r?{"X-Goog-Upload-File-Name":r}:{})};const u=await this.request({path:e,body:JSON.stringify(i),httpMethod:"POST",httpOptions:l});if(!u||!(u!=null&&u.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const h=(a=u==null?void 0:u.headers)===null||a===void 0?void 0:a["x-goog-upload-url"];if(h===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return h}}async function jF(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){const t=n.status;let s;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?s=await n.json():s={error:{message:await n.text(),code:n.status,status:n.statusText}};const r=JSON.stringify(s);throw t>=400&&t<600?new Hw({message:r,status:t}):new Error(r)}}function Yue(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{const i=JSON.parse(n.body);if(typeof i=="object"&&i!==null&&!Array.isArray(i))t=i;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function s(i,o){const a=Object.assign({},i);for(const l in o)if(Object.prototype.hasOwnProperty.call(o,l)){const u=o[l],h=a[l];u&&typeof u=="object"&&!Array.isArray(u)&&h&&typeof h=="object"&&!Array.isArray(h)?a[l]=s(h,u):(h&&u&&typeof h!=typeof u&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${l}". Original type: ${typeof h}, New type: ${typeof u}. Overwriting.`),a[l]=u)}return a}const r=s(t,e);n.body=JSON.stringify(r)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Jue="mcp_used/unknown";let jue=!1;function TU(n){for(const e of n)if(Que(e)||typeof e=="object"&&"inputSchema"in e)return!0;return jue}function xU(n){var e;const t=(e=n[aI])!==null&&e!==void 0?e:"";n[aI]=(t+` ${Jue}`).trimStart()}function Que(n){return n!==null&&typeof n=="object"&&n instanceof $N}function Zue(n){return _f(this,arguments,function*(t,s=100){let r,i=0;for(;i<s;){const o=yield Rn(t.listTools({cursor:r}));for(const a of o.tools)yield yield Rn(a),i++;if(!o.nextCursor)break;r=o.nextCursor}})}class $N{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new $N(e,t)}async initialize(){var e,t,s,r;if(this.mcpTools.length>0)return;const i={},o=[];for(const h of this.mcpClients)try{for(var a=!0,l=(t=void 0,fg(Zue(h))),u;u=await l.next(),e=u.done,!e;a=!0){r=u.value,a=!1;const f=r;o.push(f);const p=f.name;if(i[p])throw new Error(`Duplicate function name ${p} found in MCP tools. Please ensure function names are unique.`);i[p]=h}}catch(f){t={error:f}}finally{try{!a&&!e&&(s=l.return)&&await s.call(l)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),$ie(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const s of e)if(s.name in this.functionNameToMcpClient){const r=this.functionNameToMcpClient[s.name];let i;this.config.timeout&&(i={timeout:this.config.timeout});const o=await r.callTool({name:s.name,arguments:s.args},void 0,i);t.push({functionResponse:{name:s.name,response:o.isError?{error:o}:o}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function ece(n,e,t){const s=new Sie;let r;t.data instanceof Blob?r=JSON.parse(await t.data.text()):r=JSON.parse(t.data),Object.assign(s,r),e(s)}class tce{constructor(e,t,s){this.apiClient=e,this.auth=t,this.webSocketFactory=s}async connect(e){var t,s;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const r=this.apiClient.getWebsocketBaseUrl(),i=this.apiClient.getApiVersion(),o=rce(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),l=`${r}/ws/google.ai.generativelanguage.${i}.GenerativeService.BidiGenerateMusic?key=${a}`;let u=()=>{};const h=new Promise(N=>{u=N}),f=e.callbacks,p=function(){u({})},g=this.apiClient,b={onopen:p,onmessage:N=>{ece(g,f.onmessage,N)},onerror:(t=f==null?void 0:f.onerror)!==null&&t!==void 0?t:function(N){},onclose:(s=f==null?void 0:f.onclose)!==null&&s!==void 0?s:function(N){}},T=this.webSocketFactory.create(l,sce(o),b);T.connect(),await h;const C={setup:{model:Jt(this.apiClient,e.model)}};return T.send(JSON.stringify(C)),new nce(T,this.apiClient)}}class nce{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=Nae(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=Cae(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){const t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(yf.PLAY)}pause(){this.sendPlaybackControl(yf.PAUSE)}stop(){this.sendPlaybackControl(yf.STOP)}resetContext(){this.sendPlaybackControl(yf.RESET_CONTEXT)}close(){this.conn.close()}}function sce(n){const e={};return n.forEach((t,s)=>{e[s]=t}),e}function rce(n){const e=new Headers;for(const[t,s]of Object.entries(n))e.append(t,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ice="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function oce(n,e,t){const s=new xie;let r;t.data instanceof Blob?r=await t.data.text():t.data instanceof ArrayBuffer?r=new TextDecoder().decode(t.data):r=t.data;const i=JSON.parse(r);if(n.isVertexAI()){const o=$ae(i);Object.assign(s,o)}else Object.assign(s,i);e(s)}class ace{constructor(e,t,s){this.apiClient=e,this.auth=t,this.webSocketFactory=s,this.music=new tce(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,s,r,i,o,a;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const l=this.apiClient.getWebsocketBaseUrl(),u=this.apiClient.getApiVersion();let h;const f=this.apiClient.getHeaders();e.config&&e.config.tools&&TU(e.config.tools)&&xU(f);const p=hce(f);if(this.apiClient.isVertexAI())h=`${l}/ws/google.cloud.aiplatform.${u}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(p,h);else{const $=this.apiClient.getApiKey();let O="BidiGenerateContent",k="key";$!=null&&$.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),u!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),O="BidiGenerateContentConstrained",k="access_token"),h=`${l}/ws/google.ai.generativelanguage.${u}.GenerativeService.${O}?${k}=${$}`}let g=()=>{};const b=new Promise($=>{g=$}),T=e.callbacks,w=function(){var $;($=T==null?void 0:T.onopen)===null||$===void 0||$.call(T),g({})},_=this.apiClient,C={onopen:w,onmessage:$=>{oce(_,T.onmessage,$)},onerror:(t=T==null?void 0:T.onerror)!==null&&t!==void 0?t:function($){},onclose:(s=T==null?void 0:T.onclose)!==null&&s!==void 0?s:function($){}},N=this.webSocketFactory.create(h,cce(p),C);N.connect(),await b;let A=Jt(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&A.startsWith("publishers/")){const $=this.apiClient.getProject(),O=this.apiClient.getLocation();A=`projects/${$}/locations/${O}/`+A}let P={};this.apiClient.isVertexAI()&&((r=e.config)===null||r===void 0?void 0:r.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[kv.AUDIO]}:e.config.responseModalities=[kv.AUDIO]),!((i=e.config)===null||i===void 0)&&i.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const V=(a=(o=e.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[],D=[];for(const $ of V)if(this.isCallableTool($)){const O=$;D.push(await O.tool())}else D.push($);D.length>0&&(e.config.tools=D);const M={model:A,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?P=Iae(this.apiClient,M):P=Eae(this.apiClient,M),delete P.config,N.send(JSON.stringify(P)),new uce(N,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const lce={turnComplete:!0};class uce{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let s=[];try{s=Ji(t.turns),e.isVertexAI()||(s=s.map(r=>qw(r)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:s,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let s=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?s=t.functionResponses:s=[t.functionResponses],s.length===0)throw new Error("functionResponses is required.");for(const i of s){if(typeof i!="object"||i===null||!("name"in i)||!("response"in i))throw new Error(`Could not parse function response, type '${typeof i}'.`);if(!e.isVertexAI()&&!("id"in i))throw new Error(ice)}return{toolResponse:{functionResponses:s}}}sendClientContent(e){e=Object.assign(Object.assign({},lce),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:kae(e)}:t={realtimeInput:Aae(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function cce(n){const e={};return n.forEach((t,s)=>{e[s]=t}),e}function hce(n){const e=new Headers;for(const[t,s]of Object.entries(n))e.append(t,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const QF=10;function ZF(n){var e,t,s;if(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let r=!1;for(const o of(t=n==null?void 0:n.tools)!==null&&t!==void 0?t:[])if(Ef(o)){r=!0;break}if(!r)return!0;const i=(s=n==null?void 0:n.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls;return i&&(i<0||!Number.isInteger(i))||i==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",i),!0):!1}function Ef(n){return"callTool"in n&&typeof n.callTool=="function"}function dce(n){var e,t,s;return(s=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(r=>Ef(r)))!==null&&s!==void 0?s:!1}function e3(n){var e;const t=[];return!((e=n==null?void 0:n.config)===null||e===void 0)&&e.tools&&n.config.tools.forEach((s,r)=>{if(Ef(s))return;const i=s;i.functionDeclarations&&i.functionDeclarations.length>0&&t.push(r)}),t}function t3(n){var e;return!(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class fce extends Rl{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var s,r,i,o,a;const l=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!dce(t)||ZF(t.config))return await this.generateContentInternal(l);const u=e3(t);if(u.length>0){const T=u.map(w=>`tools[${w}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${T}.`)}let h,f;const p=Ji(l.contents),g=(i=(r=(s=l.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&i!==void 0?i:QF;let b=0;for(;b<g&&(h=await this.generateContentInternal(l),!(!h.functionCalls||h.functionCalls.length===0));){const T=h.candidates[0].content,w=[];for(const _ of(a=(o=t.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[])if(Ef(_)){const N=await _.callTool(h.functionCalls);w.push(...N)}b++,f={role:"user",parts:w},l.contents=Ji(l.contents),l.contents.push(T),l.contents.push(f),t3(l.config)&&(p.push(T),p.push(f))}return t3(l.config)&&(h.automaticFunctionCallingHistory=p),h},this.generateContentStream=async t=>{var s,r,i,o,a;if(this.maybeMoveToResponseJsonSchem(t),ZF(t.config)){const f=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(f)}const l=e3(t);if(l.length>0){const f=l.map(p=>`tools[${p}]`).join(", ");throw new Error(`Incompatible tools found at ${f}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const u=(i=(r=(s=t==null?void 0:t.config)===null||s===void 0?void 0:s.toolConfig)===null||r===void 0?void 0:r.functionCallingConfig)===null||i===void 0?void 0:i.streamFunctionCallArguments,h=(a=(o=t==null?void 0:t.config)===null||o===void 0?void 0:o.automaticFunctionCalling)===null||a===void 0?void 0:a.disable;if(u&&!h)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(s=>{var r;let i;const o=[];if(s!=null&&s.generatedImages)for(const l of s.generatedImages)l&&(l!=null&&l.safetyAttributes)&&((r=l==null?void 0:l.safetyAttributes)===null||r===void 0?void 0:r.contentType)==="Positive Prompt"?i=l==null?void 0:l.safetyAttributes:o.push(l);let a;return i?a={generatedImages:o,positivePromptSafetyAttributes:i,sdkHttpResponse:s.sdkHttpResponse}:a={generatedImages:o,sdkHttpResponse:s.sdkHttpResponse},a}),this.list=async t=>{var s;const o={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!o.config.queryBase){if(!((s=o.config)===null||s===void 0)&&s.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");o.config.filter="labels.tune-type:*"}return new td(_l.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(o),o)},this.editImage=async t=>{const s={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(s.referenceImages=t.referenceImages.map(r=>r.toReferenceImageAPI())),await this.editImageInternal(s)},this.upscaleImage=async t=>{let s={numberOfImages:1,mode:"upscale"};t.config&&(s=Object.assign(Object.assign({},s),t.config));const r={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:s};return await this.upscaleImageInternal(r)},this.generateVideos=async t=>{var s,r,i,o,a,l;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((s=t.video)===null||s===void 0)&&s.uri&&(!((r=t.video)===null||r===void 0)&&r.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((o=(i=t.source)===null||i===void 0?void 0:i.video)===null||o===void 0)&&o.uri&&(!((l=(a=t.source)===null||a===void 0?void 0:a.video)===null||l===void 0)&&l.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,s,r;const i=(t=e.config)===null||t===void 0?void 0:t.tools;if(!i)return e;const o=await Promise.all(i.map(async l=>Ef(l)?await l.tool():l)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(a.config.tools=o,e.config&&e.config.tools&&TU(e.config.tools)){const l=(r=(s=e.config.httpOptions)===null||s===void 0?void 0:s.headers)!==null&&r!==void 0?r:{};let u=Object.assign({},l);Object.keys(u).length===0&&(u=this.apiClient.getDefaultHeaders()),xU(u),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:u})}return a}async initAfcToolsMap(e){var t,s,r;const i=new Map;for(const o of(s=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&s!==void 0?s:[])if(Ef(o)){const a=o,l=await a.tool();for(const u of(r=l.functionDeclarations)!==null&&r!==void 0?r:[]){if(!u.name)throw new Error("Function declaration name is required.");if(i.has(u.name))throw new Error(`Duplicate tool declaration name: ${u.name}`);i.set(u.name,a)}}return i}async processAfcStream(e){var t,s,r;const i=(r=(s=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&r!==void 0?r:QF;let o=!1,a=0;const l=await this.initAfcToolsMap(e);return(function(u,h,f){return _f(this,arguments,function*(){for(var p,g,b,T,w,_;a<i;){o&&(a++,o=!1);const P=yield Rn(u.processParamsMaybeAddMcpUsage(f)),V=yield Rn(u.generateContentStreamInternal(P)),D=[],M=[];try{for(var C=!0,N=(g=void 0,fg(V)),A;A=yield Rn(N.next()),p=A.done,!p;C=!0){T=A.value,C=!1;const $=T;if(yield yield Rn($),$.candidates&&(!((w=$.candidates[0])===null||w===void 0)&&w.content)){M.push($.candidates[0].content);for(const O of(_=$.candidates[0].content.parts)!==null&&_!==void 0?_:[])if(a<i&&O.functionCall){if(!O.functionCall.name)throw new Error("Function call name was not returned by the model.");if(h.has(O.functionCall.name)){const k=yield Rn(h.get(O.functionCall.name).callTool([O.functionCall]));D.push(...k)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${h.keys()}, mising tool: ${O.functionCall.name}`)}}}}catch($){g={error:$}}finally{try{!C&&!p&&(b=N.return)&&(yield Rn(b.call(N)))}finally{if(g)throw g.error}}if(D.length>0){o=!0;const $=new zm;$.candidates=[{content:{role:"user",parts:D}}],yield yield Rn($);const O=[];O.push(...M),O.push({role:"user",parts:D});const k=Ji(f.contents).concat(O);f.contents=k}else break}})})(this,l,e)}async generateContentInternal(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=XF(this.apiClient,e);return a=He("{model}:generateContent",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=JF(h),p=new zm;return Object.assign(p,f),p})}else{const u=KF(this.apiClient,e);return a=He("{model}:generateContent",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=YF(h),p=new zm;return Object.assign(p,f),p})}}async generateContentStreamInternal(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=XF(this.apiClient,e);return a=He("{model}:streamGenerateContent?alt=sse",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),o.then(function(f){return _f(this,arguments,function*(){var p,g,b,T;try{for(var w=!0,_=fg(f),C;C=yield Rn(_.next()),p=C.done,!p;w=!0){T=C.value,w=!1;const N=T,A=JF(yield Rn(N.json()));A.sdkHttpResponse={headers:N.headers};const P=new zm;Object.assign(P,A),yield yield Rn(P)}}catch(N){g={error:N}}finally{try{!w&&!p&&(b=_.return)&&(yield Rn(b.call(_)))}finally{if(g)throw g.error}}})})}else{const u=KF(this.apiClient,e);return a=He("{model}:streamGenerateContent?alt=sse",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}),o.then(function(f){return _f(this,arguments,function*(){var p,g,b,T;try{for(var w=!0,_=fg(f),C;C=yield Rn(_.next()),p=C.done,!p;w=!0){T=C.value,w=!1;const N=T,A=YF(yield Rn(N.json()));A.sdkHttpResponse={headers:N.headers};const P=new zm;Object.assign(P,A),yield yield Rn(P)}}catch(N){g={error:N}}finally{try{!w&&!p&&(b=_.return)&&(yield Rn(b.call(_)))}finally{if(g)throw g.error}}})})}}async embedContent(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=ale(this.apiClient,e);return a=He("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=ule(h),p=new kF;return Object.assign(p,f),p})}else{const u=ole(this.apiClient,e);return a=He("{model}:batchEmbedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=lle(h),p=new kF;return Object.assign(p,f),p})}}async generateImagesInternal(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=wle(this.apiClient,e);return a=He("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=xle(h),p=new $F;return Object.assign(p,f),p})}else{const u=vle(this.apiClient,e);return a=He("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=Tle(h),p=new $F;return Object.assign(p,f),p})}}async editImageInternal(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI()){const a=nle(this.apiClient,e);return i=He("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const h=u;return h.sdkHttpResponse={headers:l.headers},h})),r.then(l=>{const u=sle(l),h=new hie;return Object.assign(h,u),h})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI()){const a=wue(this.apiClient,e);return i=He("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const h=u;return h.sdkHttpResponse={headers:l.headers},h})),r.then(l=>{const u=Tue(l),h=new die;return Object.assign(h,u),h})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI()){const a=tue(this.apiClient,e);return i=He("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),r.then(l=>{const u=nue(l),h=new fie;return Object.assign(h,u),h})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI()){const a=lue(this.apiClient,e);return i=He("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),r.then(l=>{const u=uue(l),h=new pie;return Object.assign(h,u),h})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=Vle(this.apiClient,e);return a=He("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>oI(h))}else{const u=Lle(this.apiClient,e);return a=He("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>iI(h))}}async listInternal(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=Xle(this.apiClient,e);return a=He("{models_url}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=Jle(h),p=new RF;return Object.assign(p,f),p})}else{const u=Kle(this.apiClient,e);return a=He("{models_url}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=Yle(h),p=new RF;return Object.assign(p,f),p})}}async update(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=bue(this.apiClient,e);return a=He("{model}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>oI(h))}else{const u=yue(this.apiClient,e);return a=He("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>iI(h))}}async delete(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=Qae(this.apiClient,e);return a=He("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=ele(h),p=new DF;return Object.assign(p,f),p})}else{const u=jae(this.apiClient,e);return a=He("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=Zae(h),p=new DF;return Object.assign(p,f),p})}}async countTokens(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=Xae(this.apiClient,e);return a=He("{model}:countTokens",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=Jae(h),p=new MF;return Object.assign(p,f),p})}else{const u=Kae(this.apiClient,e);return a=He("{model}:countTokens",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=Yae(h),p=new MF;return Object.assign(p,f),p})}}async computeTokens(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI()){const a=Bae(this.apiClient,e);return i=He("{model}:computeTokens",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const h=u;return h.sdkHttpResponse={headers:l.headers},h})),r.then(l=>{const u=Uae(l),h=new mie;return Object.assign(h,u),h})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=Nle(this.apiClient,e);return a=He("{model}:predictLongRunning",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>{const f=Ile(h),p=new $v;return Object.assign(p,f),p})}else{const u=Cle(this.apiClient,e);return a=He("{model}:predictLongRunning",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>{const f=Ele(h),p=new $v;return Object.assign(p,f),p})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class pce extends Rl{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,s=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const r=t.name.split("/operations/")[0];let i;s&&"httpOptions"in s&&(i=s.httpOptions);const o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:r,config:{httpOptions:i}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{const r=await this.getVideosOperationInternal({operationName:t.name,config:s});return t._fromAPIResponse({apiResponse:r,_isVertexAI:!1})}}async get(e){const t=e.operation,s=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const r=t.name.split("/operations/")[0];let i;s&&"httpOptions"in s&&(i=s.httpOptions);const o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:r,config:{httpOptions:i}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{const r=await this.getVideosOperationInternal({operationName:t.name,config:s});return t._fromAPIResponse({apiResponse:r,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=iie(e);return a=He("{operationName}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o}else{const u=rie(e);return a=He("{operationName}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o}}async fetchPredictVideosOperationInternal(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI()){const a=jre(e);return i=He("{resourceName}:fetchPredictOperation",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),r}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function mce(n){const e={},t=v(n,["data"]);if(t!=null&&x(e,["data"],t),v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=v(n,["mimeType"]);return s!=null&&x(e,["mimeType"],s),e}function gce(n){const e={},t=v(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>Ece(i))),x(e,["parts"],r)}const s=v(n,["role"]);return s!=null&&x(e,["role"],s),e}function yce(n,e,t){const s={},r=v(e,["expireTime"]);t!==void 0&&r!=null&&x(t,["expireTime"],r);const i=v(e,["newSessionExpireTime"]);t!==void 0&&i!=null&&x(t,["newSessionExpireTime"],i);const o=v(e,["uses"]);t!==void 0&&o!=null&&x(t,["uses"],o);const a=v(e,["liveConnectConstraints"]);t!==void 0&&a!=null&&x(t,["bidiGenerateContentSetup"],_ce(n,a));const l=v(e,["lockAdditionalFields"]);return t!==void 0&&l!=null&&x(t,["fieldMask"],l),s}function bce(n,e){const t={},s=v(e,["config"]);return s!=null&&x(t,["config"],yce(n,s,t)),t}function vce(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["fileUri"]);t!=null&&x(e,["fileUri"],t);const s=v(n,["mimeType"]);return s!=null&&x(e,["mimeType"],s),e}function wce(n){const e={},t=v(n,["id"]);t!=null&&x(e,["id"],t);const s=v(n,["args"]);s!=null&&x(e,["args"],s);const r=v(n,["name"]);if(r!=null&&x(e,["name"],r),v(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Tce(n){const e={};if(v(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=v(n,["enableWidget"]);return t!=null&&x(e,["enableWidget"],t),e}function xce(n){const e={};if(v(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=v(n,["timeRangeFilter"]);return t!=null&&x(e,["timeRangeFilter"],t),e}function Sce(n,e){const t={},s=v(n,["generationConfig"]);e!==void 0&&s!=null&&x(e,["setup","generationConfig"],s);const r=v(n,["responseModalities"]);e!==void 0&&r!=null&&x(e,["setup","generationConfig","responseModalities"],r);const i=v(n,["temperature"]);e!==void 0&&i!=null&&x(e,["setup","generationConfig","temperature"],i);const o=v(n,["topP"]);e!==void 0&&o!=null&&x(e,["setup","generationConfig","topP"],o);const a=v(n,["topK"]);e!==void 0&&a!=null&&x(e,["setup","generationConfig","topK"],a);const l=v(n,["maxOutputTokens"]);e!==void 0&&l!=null&&x(e,["setup","generationConfig","maxOutputTokens"],l);const u=v(n,["mediaResolution"]);e!==void 0&&u!=null&&x(e,["setup","generationConfig","mediaResolution"],u);const h=v(n,["seed"]);e!==void 0&&h!=null&&x(e,["setup","generationConfig","seed"],h);const f=v(n,["speechConfig"]);e!==void 0&&f!=null&&x(e,["setup","generationConfig","speechConfig"],kN(f));const p=v(n,["thinkingConfig"]);e!==void 0&&p!=null&&x(e,["setup","generationConfig","thinkingConfig"],p);const g=v(n,["enableAffectiveDialog"]);e!==void 0&&g!=null&&x(e,["setup","generationConfig","enableAffectiveDialog"],g);const b=v(n,["systemInstruction"]);e!==void 0&&b!=null&&x(e,["setup","systemInstruction"],gce(wr(b)));const T=v(n,["tools"]);if(e!==void 0&&T!=null){let V=yp(T);Array.isArray(V)&&(V=V.map(D=>Cce(gp(D)))),x(e,["setup","tools"],V)}const w=v(n,["sessionResumption"]);e!==void 0&&w!=null&&x(e,["setup","sessionResumption"],Ice(w));const _=v(n,["inputAudioTranscription"]);e!==void 0&&_!=null&&x(e,["setup","inputAudioTranscription"],_);const C=v(n,["outputAudioTranscription"]);e!==void 0&&C!=null&&x(e,["setup","outputAudioTranscription"],C);const N=v(n,["realtimeInputConfig"]);e!==void 0&&N!=null&&x(e,["setup","realtimeInputConfig"],N);const A=v(n,["contextWindowCompression"]);e!==void 0&&A!=null&&x(e,["setup","contextWindowCompression"],A);const P=v(n,["proactivity"]);return e!==void 0&&P!=null&&x(e,["setup","proactivity"],P),t}function _ce(n,e){const t={},s=v(e,["model"]);s!=null&&x(t,["setup","model"],Jt(n,s));const r=v(e,["config"]);return r!=null&&x(t,["config"],Sce(r,t)),t}function Ece(n){const e={},t=v(n,["mediaResolution"]);t!=null&&x(e,["mediaResolution"],t);const s=v(n,["codeExecutionResult"]);s!=null&&x(e,["codeExecutionResult"],s);const r=v(n,["executableCode"]);r!=null&&x(e,["executableCode"],r);const i=v(n,["fileData"]);i!=null&&x(e,["fileData"],vce(i));const o=v(n,["functionCall"]);o!=null&&x(e,["functionCall"],wce(o));const a=v(n,["functionResponse"]);a!=null&&x(e,["functionResponse"],a);const l=v(n,["inlineData"]);l!=null&&x(e,["inlineData"],mce(l));const u=v(n,["text"]);u!=null&&x(e,["text"],u);const h=v(n,["thought"]);h!=null&&x(e,["thought"],h);const f=v(n,["thoughtSignature"]);f!=null&&x(e,["thoughtSignature"],f);const p=v(n,["videoMetadata"]);return p!=null&&x(e,["videoMetadata"],p),e}function Ice(n){const e={},t=v(n,["handle"]);if(t!=null&&x(e,["handle"],t),v(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Cce(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(f=>f)),x(e,["functionDeclarations"],h)}if(v(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=v(n,["googleSearchRetrieval"]);s!=null&&x(e,["googleSearchRetrieval"],s);const r=v(n,["computerUse"]);r!=null&&x(e,["computerUse"],r);const i=v(n,["fileSearch"]);i!=null&&x(e,["fileSearch"],i);const o=v(n,["codeExecution"]);if(o!=null&&x(e,["codeExecution"],o),v(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=v(n,["googleMaps"]);a!=null&&x(e,["googleMaps"],Tce(a));const l=v(n,["googleSearch"]);l!=null&&x(e,["googleSearch"],xce(l));const u=v(n,["urlContext"]);return u!=null&&x(e,["urlContext"],u),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Nce(n){const e=[];for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const s=n[t];if(typeof s=="object"&&s!=null&&Object.keys(s).length>0){const r=Object.keys(s).map(i=>`${t}.${i}`);e.push(...r)}else e.push(t)}return e.join(",")}function Ace(n,e){let t=null;const s=n.bidiGenerateContentSetup;if(typeof s=="object"&&s!==null&&"setup"in s){const i=s.setup;typeof i=="object"&&i!==null?(n.bidiGenerateContentSetup=i,t=i):delete n.bidiGenerateContentSetup}else s!==void 0&&delete n.bidiGenerateContentSetup;const r=n.fieldMask;if(t){const i=Nce(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)i?n.fieldMask=i:delete n.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&r!==null&&Array.isArray(r)&&r.length>0){const o=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let a=[];r.length>0&&(a=r.map(u=>o.includes(u)?`generationConfig.${u}`:u));const l=[];i&&l.push(i),a.length>0&&l.push(...a),l.length>0?n.fieldMask=l.join(","):delete n.fieldMask}else delete n.fieldMask}else r!==null&&Array.isArray(r)&&r.length>0?n.fieldMask=r.join(","):delete n.fieldMask;return n}class kce extends Rl{constructor(e){super(),this.apiClient=e}async create(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const a=bce(this.apiClient,e);i=He("auth_tokens",a._url),o=a._query,delete a.config,delete a._url,delete a._query;const l=Ace(a,e.config);return r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json()),r.then(u=>u)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function $ce(n,e){const t={},s=v(n,["force"]);return e!==void 0&&s!=null&&x(e,["_query","force"],s),t}function Rce(n){const e={},t=v(n,["name"]);t!=null&&x(e,["_url","name"],t);const s=v(n,["config"]);return s!=null&&$ce(s,e),e}function Dce(n){const e={},t=v(n,["name"]);return t!=null&&x(e,["_url","name"],t),e}function Mce(n,e){const t={},s=v(n,["pageSize"]);e!==void 0&&s!=null&&x(e,["_query","pageSize"],s);const r=v(n,["pageToken"]);return e!==void 0&&r!=null&&x(e,["_query","pageToken"],r),t}function Oce(n){const e={},t=v(n,["parent"]);t!=null&&x(e,["_url","parent"],t);const s=v(n,["config"]);return s!=null&&Mce(s,e),e}function Pce(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&x(e,["sdkHttpResponse"],t);const s=v(n,["nextPageToken"]);s!=null&&x(e,["nextPageToken"],s);const r=v(n,["documents"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>o)),x(e,["documents"],i)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Fce extends Rl{constructor(e){super(),this.apiClient=e,this.list=async t=>new td(_l.PAGED_ITEM_DOCUMENTS,s=>this.listInternal({parent:t.parent,config:s.config}),await this.listInternal(t),t)}async get(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Dce(e);return i=He("{name}",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),r.then(l=>l)}}async delete(e){var t,s;let r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=Rce(e);r=He("{name}",o._url),i=o._query,delete o._url,delete o._query,await this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Oce(e);return i=He("{parent}/documents",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),r.then(l=>{const u=Pce(l),h=new gie;return Object.assign(h,u),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Lce extends Rl{constructor(e,t=new Fce(e)){super(),this.apiClient=e,this.documents=t,this.list=async(s={})=>new td(_l.PAGED_ITEM_FILE_SEARCH_STORES,r=>this.listInternal(r),await this.listInternal(s),s)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Nue(e);return i=He("fileSearchStores",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),r.then(l=>l)}}async get(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=$ue(e);return i=He("{name}",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),r.then(l=>l)}}async delete(e){var t,s;let r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=kue(e);r=He("{name}",o._url),i=o._query,delete o._url,delete o._query,await this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Fue(e);return i=He("fileSearchStores",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),r.then(l=>{const u=Lue(l),h=new yie;return Object.assign(h,u),h})}}async uploadToFileSearchStoreInternal(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Vue(e);return i=He("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),r.then(l=>{const u=Bue(l),h=new bie;return Object.assign(h,u),h})}}async importFile(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Mue(e);return i=He("{file_search_store_name}:importFile",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),r.then(l=>{const u=Due(l),h=new EN;return Object.assign(h,u),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Vce(n,e){const t={},s=v(n,["name"]);return s!=null&&x(t,["_url","name"],s),t}function Bce(n,e){const t={},s=v(n,["name"]);return s!=null&&x(t,["_url","name"],s),t}function Uce(n,e){const t={},s=v(n,["sdkHttpResponse"]);return s!=null&&x(t,["sdkHttpResponse"],s),t}function zce(n,e){const t={},s=v(n,["sdkHttpResponse"]);return s!=null&&x(t,["sdkHttpResponse"],s),t}function Gce(n,e,t){const s={};if(v(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const r=v(n,["tunedModelDisplayName"]);if(e!==void 0&&r!=null&&x(e,["displayName"],r),v(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const i=v(n,["epochCount"]);e!==void 0&&i!=null&&x(e,["tuningTask","hyperparameters","epochCount"],i);const o=v(n,["learningRateMultiplier"]);if(o!=null&&x(s,["tuningTask","hyperparameters","learningRateMultiplier"],o),v(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(v(n,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(v(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const a=v(n,["batchSize"]);e!==void 0&&a!=null&&x(e,["tuningTask","hyperparameters","batchSize"],a);const l=v(n,["learningRate"]);if(e!==void 0&&l!=null&&x(e,["tuningTask","hyperparameters","learningRate"],l),v(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(v(n,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return s}function Hce(n,e,t){const s={};let r=v(t,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){const g=v(n,["validationDataset"]);e!==void 0&&g!=null&&x(e,["supervisedTuningSpec"],n3(g))}else if(r==="PREFERENCE_TUNING"){const g=v(n,["validationDataset"]);e!==void 0&&g!=null&&x(e,["preferenceOptimizationSpec"],n3(g))}const i=v(n,["tunedModelDisplayName"]);e!==void 0&&i!=null&&x(e,["tunedModelDisplayName"],i);const o=v(n,["description"]);e!==void 0&&o!=null&&x(e,["description"],o);let a=v(t,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const g=v(n,["epochCount"]);e!==void 0&&g!=null&&x(e,["supervisedTuningSpec","hyperParameters","epochCount"],g)}else if(a==="PREFERENCE_TUNING"){const g=v(n,["epochCount"]);e!==void 0&&g!=null&&x(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],g)}let l=v(t,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){const g=v(n,["learningRateMultiplier"]);e!==void 0&&g!=null&&x(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],g)}else if(l==="PREFERENCE_TUNING"){const g=v(n,["learningRateMultiplier"]);e!==void 0&&g!=null&&x(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],g)}let u=v(t,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const g=v(n,["exportLastCheckpointOnly"]);e!==void 0&&g!=null&&x(e,["supervisedTuningSpec","exportLastCheckpointOnly"],g)}else if(u==="PREFERENCE_TUNING"){const g=v(n,["exportLastCheckpointOnly"]);e!==void 0&&g!=null&&x(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],g)}let h=v(t,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){const g=v(n,["adapterSize"]);e!==void 0&&g!=null&&x(e,["supervisedTuningSpec","hyperParameters","adapterSize"],g)}else if(h==="PREFERENCE_TUNING"){const g=v(n,["adapterSize"]);e!==void 0&&g!=null&&x(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],g)}if(v(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(v(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const f=v(n,["labels"]);e!==void 0&&f!=null&&x(e,["labels"],f);const p=v(n,["beta"]);return e!==void 0&&p!=null&&x(e,["preferenceOptimizationSpec","hyperParameters","beta"],p),s}function qce(n,e){const t={},s=v(n,["baseModel"]);s!=null&&x(t,["baseModel"],s);const r=v(n,["preTunedModel"]);r!=null&&x(t,["preTunedModel"],r);const i=v(n,["trainingDataset"]);i!=null&&nhe(i);const o=v(n,["config"]);return o!=null&&Gce(o,t),t}function Wce(n,e){const t={},s=v(n,["baseModel"]);s!=null&&x(t,["baseModel"],s);const r=v(n,["preTunedModel"]);r!=null&&x(t,["preTunedModel"],r);const i=v(n,["trainingDataset"]);i!=null&&she(i,t,e);const o=v(n,["config"]);return o!=null&&Hce(o,t,e),t}function Kce(n,e){const t={},s=v(n,["name"]);return s!=null&&x(t,["_url","name"],s),t}function Xce(n,e){const t={},s=v(n,["name"]);return s!=null&&x(t,["_url","name"],s),t}function Yce(n,e,t){const s={},r=v(n,["pageSize"]);e!==void 0&&r!=null&&x(e,["_query","pageSize"],r);const i=v(n,["pageToken"]);e!==void 0&&i!=null&&x(e,["_query","pageToken"],i);const o=v(n,["filter"]);return e!==void 0&&o!=null&&x(e,["_query","filter"],o),s}function Jce(n,e,t){const s={},r=v(n,["pageSize"]);e!==void 0&&r!=null&&x(e,["_query","pageSize"],r);const i=v(n,["pageToken"]);e!==void 0&&i!=null&&x(e,["_query","pageToken"],i);const o=v(n,["filter"]);return e!==void 0&&o!=null&&x(e,["_query","filter"],o),s}function jce(n,e){const t={},s=v(n,["config"]);return s!=null&&Yce(s,t),t}function Qce(n,e){const t={},s=v(n,["config"]);return s!=null&&Jce(s,t),t}function Zce(n,e){const t={},s=v(n,["sdkHttpResponse"]);s!=null&&x(t,["sdkHttpResponse"],s);const r=v(n,["nextPageToken"]);r!=null&&x(t,["nextPageToken"],r);const i=v(n,["tunedModels"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(a=>SU(a))),x(t,["tuningJobs"],o)}return t}function ehe(n,e){const t={},s=v(n,["sdkHttpResponse"]);s!=null&&x(t,["sdkHttpResponse"],s);const r=v(n,["nextPageToken"]);r!=null&&x(t,["nextPageToken"],r);const i=v(n,["tuningJobs"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(a=>lI(a))),x(t,["tuningJobs"],o)}return t}function the(n,e){const t={},s=v(n,["name"]);s!=null&&x(t,["model"],s);const r=v(n,["name"]);return r!=null&&x(t,["endpoint"],r),t}function nhe(n,e){const t={};if(v(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(v(n,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const s=v(n,["examples"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(i=>i)),x(t,["examples","examples"],r)}return t}function she(n,e,t){const s={};let r=v(t,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){const o=v(n,["gcsUri"]);e!==void 0&&o!=null&&x(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(r==="PREFERENCE_TUNING"){const o=v(n,["gcsUri"]);e!==void 0&&o!=null&&x(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}let i=v(t,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const o=v(n,["vertexDatasetResource"]);e!==void 0&&o!=null&&x(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(i==="PREFERENCE_TUNING"){const o=v(n,["vertexDatasetResource"]);e!==void 0&&o!=null&&x(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}if(v(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return s}function SU(n,e){const t={},s=v(n,["sdkHttpResponse"]);s!=null&&x(t,["sdkHttpResponse"],s);const r=v(n,["name"]);r!=null&&x(t,["name"],r);const i=v(n,["state"]);i!=null&&x(t,["state"],sU(i));const o=v(n,["createTime"]);o!=null&&x(t,["createTime"],o);const a=v(n,["tuningTask","startTime"]);a!=null&&x(t,["startTime"],a);const l=v(n,["tuningTask","completeTime"]);l!=null&&x(t,["endTime"],l);const u=v(n,["updateTime"]);u!=null&&x(t,["updateTime"],u);const h=v(n,["description"]);h!=null&&x(t,["description"],h);const f=v(n,["baseModel"]);f!=null&&x(t,["baseModel"],f);const p=v(n,["_self"]);return p!=null&&x(t,["tunedModel"],the(p)),t}function lI(n,e){const t={},s=v(n,["sdkHttpResponse"]);s!=null&&x(t,["sdkHttpResponse"],s);const r=v(n,["name"]);r!=null&&x(t,["name"],r);const i=v(n,["state"]);i!=null&&x(t,["state"],sU(i));const o=v(n,["createTime"]);o!=null&&x(t,["createTime"],o);const a=v(n,["startTime"]);a!=null&&x(t,["startTime"],a);const l=v(n,["endTime"]);l!=null&&x(t,["endTime"],l);const u=v(n,["updateTime"]);u!=null&&x(t,["updateTime"],u);const h=v(n,["error"]);h!=null&&x(t,["error"],h);const f=v(n,["description"]);f!=null&&x(t,["description"],f);const p=v(n,["baseModel"]);p!=null&&x(t,["baseModel"],p);const g=v(n,["tunedModel"]);g!=null&&x(t,["tunedModel"],g);const b=v(n,["preTunedModel"]);b!=null&&x(t,["preTunedModel"],b);const T=v(n,["supervisedTuningSpec"]);T!=null&&x(t,["supervisedTuningSpec"],T);const w=v(n,["preferenceOptimizationSpec"]);w!=null&&x(t,["preferenceOptimizationSpec"],w);const _=v(n,["tuningDataStats"]);_!=null&&x(t,["tuningDataStats"],_);const C=v(n,["encryptionSpec"]);C!=null&&x(t,["encryptionSpec"],C);const N=v(n,["partnerModelTuningSpec"]);N!=null&&x(t,["partnerModelTuningSpec"],N);const A=v(n,["customBaseModel"]);A!=null&&x(t,["customBaseModel"],A);const P=v(n,["experiment"]);P!=null&&x(t,["experiment"],P);const V=v(n,["labels"]);V!=null&&x(t,["labels"],V);const D=v(n,["outputUri"]);D!=null&&x(t,["outputUri"],D);const M=v(n,["pipelineJob"]);M!=null&&x(t,["pipelineJob"],M);const $=v(n,["serviceAccount"]);$!=null&&x(t,["serviceAccount"],$);const O=v(n,["tunedModelDisplayName"]);O!=null&&x(t,["tunedModelDisplayName"],O);const k=v(n,["veoTuningSpec"]);return k!=null&&x(t,["veoTuningSpec"],k),t}function rhe(n,e){const t={},s=v(n,["sdkHttpResponse"]);s!=null&&x(t,["sdkHttpResponse"],s);const r=v(n,["name"]);r!=null&&x(t,["name"],r);const i=v(n,["metadata"]);i!=null&&x(t,["metadata"],i);const o=v(n,["done"]);o!=null&&x(t,["done"],o);const a=v(n,["error"]);return a!=null&&x(t,["error"],a),t}function n3(n,e){const t={},s=v(n,["gcsUri"]);s!=null&&x(t,["validationDatasetUri"],s);const r=v(n,["vertexDatasetResource"]);return r!=null&&x(t,["validationDatasetUri"],r),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ihe extends Rl{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new td(_l.PAGED_ITEM_TUNING_JOBS,s=>this.listInternal(s),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var s;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){const r={tunedModelName:t.baseModel};!((s=t.config)===null||s===void 0)&&s.preTunedModelCheckpointId&&(r.checkpointId=t.config.preTunedModelCheckpointId);const i=Object.assign(Object.assign({},t),{preTunedModel:r});return i.baseModel=void 0,await this.tuneInternal(i)}else{const r=Object.assign({},t);return await this.tuneInternal(r)}else{const r=Object.assign({},t),i=await this.tuneMldevInternal(r);let o="";return i.metadata!==void 0&&i.metadata.tunedModel!==void 0?o=i.metadata.tunedModel:i.name!==void 0&&i.name.includes("/operations/")&&(o=i.name.split("/operations/")[0]),{name:o,state:tI.JOB_STATE_QUEUED}}}}async getInternal(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=Xce(e);return a=He("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>lI(h))}else{const u=Kce(e);return a=He("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>SU(h))}}async listInternal(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=Qce(e);return a=He("tuningJobs",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=ehe(h),p=new OF;return Object.assign(p,f),p})}else{const u=jce(e);return a=He("tunedModels",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=Zce(h),p=new OF;return Object.assign(p,f),p})}}async cancel(e){var t,s,r,i;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=Bce(e);return a=He("{name}:cancel",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=zce(h),p=new PF;return Object.assign(p,f),p})}else{const u=Vce(e);return a=He("{name}:cancel",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:h.headers},p})),o.then(h=>{const f=Uce(h),p=new PF;return Object.assign(p,f),p})}}async tuneInternal(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI()){const a=Wce(e,e);return i=He("tuningJobs",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const h=u;return h.sdkHttpResponse={headers:l.headers},h})),r.then(l=>lI(l))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,s;let r,i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=qce(e);return i=He("tunedModels",a._url),o=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const h=u;return h.sdkHttpResponse={headers:l.headers},h})),r.then(l=>rhe(l))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ohe{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const ahe=1024*1024*8,lhe=3,uhe=1e3,che=2,Dv="x-goog-upload-status";async function hhe(n,e,t){var s;const r=await _U(n,e,t),i=await(r==null?void 0:r.json());if(((s=r==null?void 0:r.headers)===null||s===void 0?void 0:s[Dv])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return i.file}async function dhe(n,e,t){var s;const r=await _U(n,e,t),i=await(r==null?void 0:r.json());if(((s=r==null?void 0:r.headers)===null||s===void 0?void 0:s[Dv])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const o=jB(i),a=new IN;return Object.assign(a,o),a}async function _U(n,e,t){var s,r;let i=0,o=0,a=new nI(new Response),l="upload";for(i=n.size;o<i;){const u=Math.min(ahe,i-o),h=n.slice(o,o+u);o+u>=i&&(l+=", finalize");let f=0,p=uhe;for(;f<lhe&&(a=await t.request({path:"",body:h,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(o),"Content-Length":String(u)}}}),!(!((s=a==null?void 0:a.headers)===null||s===void 0)&&s[Dv]));)f++,await phe(p),p=p*che;if(o+=u,((r=a==null?void 0:a.headers)===null||r===void 0?void 0:r[Dv])!=="active")break;if(i<=o)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function fhe(n){return{size:n.size,type:n.type}}function phe(n){return new Promise(e=>setTimeout(e,n))}class mhe{async upload(e,t,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await hhe(e,t,s)}async uploadToFileSearchStore(e,t,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await dhe(e,t,s)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await fhe(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ghe{create(e,t,s){return new yhe(e,t,s)}}class yhe{constructor(e,t,s){this.url=e,this.headers=t,this.callbacks=s}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const s3="x-goog-api-key";class bhe{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(s3)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(s3,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const vhe="gl-node/";class whe{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const s=Yre(e.httpOptions,e.vertexai,void 0,void 0);s&&(e.httpOptions?e.httpOptions.baseUrl=s:e.httpOptions={baseUrl:s}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const r=new bhe(this.apiKey);this.apiClient=new Xue({auth:r,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:vhe+"web",uploader:new mhe,downloader:new ohe}),this.models=new fce(this.apiClient),this.live=new ace(this.apiClient,r,new ghe),this.batches=new _oe(this.apiClient),this.chats=new iae(this.models,this.apiClient),this.caches=new nae(this.apiClient),this.files=new mae(this.apiClient),this.operations=new pce(this.apiClient),this.authTokens=new kce(this.apiClient),this.tunings=new ihe(this.apiClient),this.fileSearchStores=new Lce(this.apiClient)}}const r3=[{id:"f1",description:" ",difficulty:"easy",points:10},{id:"f2",description:" ",difficulty:"easy",points:15},{id:"f3",description:" ",difficulty:"easy",points:10},{id:"f4",description:"  ",difficulty:"easy",points:15},{id:"f5",description:"  ",difficulty:"easy",points:5},{id:"f6",description:" ",difficulty:"easy",points:10},{id:"f7",description:" ",difficulty:"medium",points:20},{id:"f8",description:"",difficulty:"medium",points:20},{id:"f9",description:'  " "',difficulty:"medium",points:25},{id:"f10",description:" ",difficulty:"easy",points:10},{id:"f11",description:" ",difficulty:"easy",points:10},{id:"f12",description:"  ",difficulty:"medium",points:20},{id:"f13",description:"  ",difficulty:"medium",points:25},{id:"f14",description:"  ",difficulty:"easy",points:15},{id:"f15",description:"  ( )",difficulty:"medium",points:30},{id:"f16",description:"",difficulty:"easy",points:15},{id:"f17",description:" ",difficulty:"hard",points:40},{id:"f18",description:"  ",difficulty:"medium",points:25},{id:"f19",description:"  ",difficulty:"medium",points:20},{id:"f20",description:" ",difficulty:"hard",points:35},{id:"f21",description:"  ",difficulty:"medium",points:30},{id:"f22",description:"",difficulty:"easy",points:10},{id:"f23",description:"",difficulty:"hard",points:50},{id:"f24",description:" ",difficulty:"hard",points:45},{id:"f25",description:" ",difficulty:"medium",points:20}],i3=()=>({...r3[Math.floor(Math.random()*r3.length)],id:Math.random().toString(36).substr(2,9)});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const The=1e-7,xhe=1e-4;let She=class{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}},EU=class{refCount(e){return jr("refCount")}incRef(e){return jr("incRef")}timerAvailable(){return!0}time(e){return jr("time")}read(e){return jr("read")}readSync(e){return jr("readSync")}readToGPU(e,t){return jr("readToGPU")}numDataIds(){return jr("numDataIds")}disposeData(e,t){return jr("disposeData")}write(e,t,s){return jr("write")}move(e,t,s,r,i){return jr("move")}createTensorFromGPUData(e,t,s){return jr("createTensorFromGPUData")}memory(){return jr("memory")}floatPrecision(){return jr("floatPrecision")}epsilon(){return this.floatPrecision()===32?The:xhe}dispose(){return jr("dispose")}};function jr(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IU(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,Mv(n,e,t)}function _he(n,e){if(n.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${n.length}Second array length was ${e.length}`);let t=n.length,s=0;for(;t>0;)s=Math.random()*t|0,t--,Mv(n,t,s),Mv(e,t,s)}function Ag(n,e,t){return Math.max(n,Math.min(e,t))}function Ehe(n){return n%2===0?n:n+1}function Mv(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function Ihe(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function Che(n,e){const t=Math.random();return e*t+(1-t)*n}function Nhe(n,e){let t=0;for(let s=0;s<n.length;s++){const r=Number(n[s])-Number(e[s]);t+=r*r}return t}function Y(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Ir(n,e,t=""){Y(Mo(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function nd(n){Y(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function dn(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function Ahe(n){return n.length===0}function CU(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==null&&e[t]!==null&&n[t]!==e[t])return!1;return!0}function Mo(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Gf(n){return n%1===0}function khe(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;{const e=Math.exp(2*n);return(e-1)/(e+1)}}function $he(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Rhe(n){const e=new Uint32Array(n);for(let t=0;t<n;++t)e[t]=t;return IU(e),e}function pg(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function Dhe(n,e=r=>0,t,s){return new Promise((r,i)=>{let o=0;const a=()=>{if(n()){r();return}o++;const l=e(o);if(t!=null&&o>=t){i();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function Mhe(n,e){let t=1,s=-1;for(let i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(n[i]<0)throw Error(`Shapes can not be < 0. Found ${n[i]} at dim ${i}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function py(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),Y(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),Y(n.every(s=>Gf(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function NU(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||r?null:py(e,n).sort();let o=0;for(let a=0;a<n.length;++a){if(i!=null){if(i[o]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(i[o]==null||i[o]>a)&&n[a]===1&&(t.push(n[a]),s.push(a)),i[o]<=a&&o++}n[a]!==1&&(t.push(n[a]),s.push(a))}return{newShape:t,keptDims:s}}function AU(n,e){return RN(n,e)}function RN(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function kU(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function $U(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function Ohe(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function Ov(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function RU(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function ku(n){return typeof n=="string"||n instanceof String}function DU(n){return typeof n=="boolean"}function MU(n){return typeof n=="number"}function my(n){return Array.isArray(n)?my(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":MU(n)?"float32":ku(n)?"string":DU(n)?"bool":"float32"}function tc(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Pv(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function vp(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function OU(n,e,t,s=!1){const r=new Array;if(e.length===1){const i=e[0]*(s?2:1);for(let o=0;o<i;o++)r[o]=t[n+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,u)=>l*u)*(s?2:1);for(let l=0;l<i;l++)r[l]=OU(n+l*a,o,t,s)}return r}function Sh(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,i)=>r*i)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return OU(0,n,e,t)}function Phe(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function DN(n,e){const t=Xw(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function Xw(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function Fhe(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return Sh(n,new Float32Array(t));if(e==="int32")return Sh(n,new Int32Array(t));if(e==="bool")return Sh(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function ci(n){n.forEach(e=>{Y(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function Lhe(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function Vhe(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function nc(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o3="tfjsflags";let PU=class{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Bhe,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(ut().getBool("IS_TEST")||ut().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];ut().getBool("IS_TEST")||ut().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(nc(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);o3 in e&&e[o3].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=zhe(r,i)})}};function Bhe(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(Uhe(e,s[0],s[1]),s.join("="))),e}function Uhe(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function zhe(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function ut(){return MN}let MN=null;function Ghe(n){MN=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let eE;function FU(){if(eE==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");eE=n}return eE}function Hhe(){const n=FU();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function ON(n,e){const t=Hhe();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const LU="Abs",VU="Acos",BU="Acosh",PN="Add",UU="AddN",zU="All",GU="Any",HU="ArgMax",qU="ArgMin",WU="Asin",KU="Asinh",XU="Atan",YU="Atanh",JU="Atan2",jU="AvgPool",qhe="AvgPoolGrad",QU="AvgPool3D",Whe="AvgPool3DGrad",ZU="BatchMatMul",ez="BatchToSpaceND",tz="Bincount",nz="BitwiseAnd",Khe="BroadcastTo",sz="BroadcastArgs",FN="Cast",rz="Ceil",iz="ClipByValue",oz="Complex",az="ComplexAbs",lz="Concat",uz="Conv2D",cz="Conv2DBackpropFilter",hz="Conv2DBackpropInput",dz="Conv3D",Xhe="Conv3DBackpropFilterV2",fz="Conv3DBackpropInputV2",pz="Cos",mz="Cosh",gz="Cumprod",yz="Cumsum",bz="CropAndResize",vz="DenseBincount",wz="DepthToSpace",Tz="DepthwiseConv2dNative",xz="DepthwiseConv2dNativeBackpropFilter",Sz="DepthwiseConv2dNativeBackpropInput",_z="Diag",Ez="Dilation2D",Yhe="Dilation2DBackpropInput",Jhe="Dilation2DBackpropFilter",LN="Draw",Iz="RealDiv",Cz="Einsum",Nz="Elu",jhe="EluGrad",Az="Erf",kz="Equal",$z="Exp",Rz="ExpandDims",Dz="Expm1",Mz="FFT",Oz="Fill",Pz="FlipLeftRight",Fz="Floor",Lz="FloorDiv",Vz="FusedBatchNorm",Bz="GatherV2",Uz="GatherNd",zz="Greater",Gz="GreaterEqual",VN="Identity",Hz="IFFT",qz="Imag",Wz="IsFinite",Kz="IsInf",Xz="IsNan",Yz="LeakyRelu",Jz="Less",jz="LessEqual",Qz="LinSpace",Zz="Log",eG="Log1p",tG="LogicalAnd",nG="LogicalNot",sG="LogicalOr",Qhe="LogicalXor",Zhe="LogSoftmax",ede="LowerBound",rG="LRN",tde="LRNGrad",nde="MatrixBandPart",iG="Max",oG="Maximum",aG="MaxPool",sde="MaxPoolGrad",lG="MaxPool3D",rde="MaxPool3DGrad",uG="MaxPoolWithArgmax",cG="Mean",hG="Min",dG="Minimum",fG="MirrorPad",pG="Mod",mG="Multinomial",gG="Multiply",yG="Neg",bG="NotEqual",vG="NonMaxSuppressionV3",wG="NonMaxSuppressionV4",TG="NonMaxSuppressionV5",xG="OnesLike",SG="OneHot",_G="Pack",EG="PadV2",ide="Pool",IG="Pow",CG="Prelu",NG="Prod",AG="RaggedGather",kG="RaggedRange",$G="RaggedTensorToTensor",RG="Range",DG="Real",MG="Reciprocal",OG="Relu",PG="Reshape",FG="ResizeNearestNeighbor",ode="ResizeNearestNeighborGrad",LG="ResizeBilinear",ade="ResizeBilinearGrad",VG="Relu6",BG="Reverse",UG="Round",zG="Rsqrt",GG="ScatterNd",HG="TensorScatterUpdate",qG="SearchSorted",WG="Select",KG="Selu",XG="Slice",YG="Sin",JG="Sinh",jG="Sign",QG="Sigmoid",ZG="Softplus",e6="Sqrt",t6="Sum",n6="SpaceToBatchND",s6="SplitV",r6="Softmax",i6="SparseFillEmptyRows",o6="SparseReshape",a6="SparseSegmentMean",l6="SparseSegmentSum",u6="SparseToDense",c6="SquaredDifference",lde="Square",h6="StaticRegexReplace",d6="StridedSlice",f6="StringNGrams",p6="StringSplit",m6="StringToHashBucketFast",g6="Sub",y6="Tan",b6="Tanh",BN="Tile",v6="TopK",w6="Transform",j1="Transpose",T6="Unique",x6="Unpack",S6="UnsortedSegmentSum",ude="UpperBound",_6="ZerosLike",E6="Step",uI="FromPixels",I6="RotateWithOffset",cI="_FusedMatMul",hI="FusedConv2D",dI="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nu(...n){ut().getBool("IS_TEST")||ut().getBool("PROD")||console.warn(...n)}function cde(...n){ut().getBool("IS_TEST")||ut().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hf=ON("kernelRegistry",()=>new Map),kg=ON("gradRegistry",()=>new Map);function $g(n,e){const t=UN(n,e);return Hf.get(t)}function fI(n){return kg.get(n)}function Fv(n){const e=Hf.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[i,o]=r,[a]=i.split("_");a===n&&t.push(o)}return t}function C6(n){const{kernelName:e,backendName:t}=n,s=UN(e,t);Hf.has(s)&&Nu(`The kernel '${e}' for backend '${t}' is already registered`),Hf.set(s,n)}function hde(n){const{kernelName:e}=n;kg.has(e)&&ut().getBool("DEBUG")&&Nu(`Overriding the gradient for '${e}'`),kg.set(e,n)}function dde(n,e){const t=UN(n,e);if(!Hf.has(t))throw new Error(`The kernel '${n}' for backend '${e}' is not registered`);Hf.delete(t)}function fde(n){if(!kg.has(n))throw new Error(`The gradient '${n}' for backend is not registered`);kg.delete(n)}function pde(n,e){Fv(n).forEach(s=>{const r=Object.assign({},s,{backendName:e});C6(r)})}function UN(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N6(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var tE,a3;function mde(){if(a3)return tE;a3=1,tE=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(O,k,z){this.low=O|0,this.high=k|0,this.unsigned=!!z}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(O){return(O&&O.__isLong__)===!0}e.isLong=t;var s={},r={};function i(O,k){var z,U,te;return k?(O>>>=0,(te=0<=O&&O<256)&&(U=r[O],U)?U:(z=a(O,(O|0)<0?-1:0,!0),te&&(r[O]=z),z)):(O|=0,(te=-128<=O&&O<128)&&(U=s[O],U)?U:(z=a(O,O<0?-1:0,!1),te&&(s[O]=z),z))}e.fromInt=i;function o(O,k){if(isNaN(O))return k?C:_;if(k){if(O<0)return C;if(O>=b)return D}else{if(O<=-T)return M;if(O+1>=T)return V}return O<0?o(-O,k).neg():a(O%g|0,O/g|0,k)}e.fromNumber=o;function a(O,k,z){return new e(O,k,z)}e.fromBits=a;var l=Math.pow;function u(O,k,z){if(O.length===0)throw Error("empty string");if(O==="NaN"||O==="Infinity"||O==="+Infinity"||O==="-Infinity")return _;if(typeof k=="number"?(z=k,k=!1):k=!!k,z=z||10,z<2||36<z)throw RangeError("radix");var U;if((U=O.indexOf("-"))>0)throw Error("interior hyphen");if(U===0)return u(O.substring(1),k,z).neg();for(var te=o(l(z,8)),se=_,X=0;X<O.length;X+=8){var Q=Math.min(8,O.length-X),re=parseInt(O.substring(X,X+Q),z);if(Q<8){var fe=o(l(z,Q));se=se.mul(fe).add(o(re))}else se=se.mul(te),se=se.add(o(re))}return se.unsigned=k,se}e.fromString=u;function h(O,k){return typeof O=="number"?o(O,k):typeof O=="string"?u(O,k):a(O.low,O.high,typeof k=="boolean"?k:O.unsigned)}e.fromValue=h;var f=65536,p=1<<24,g=f*f,b=g*g,T=b/2,w=i(p),_=i(0);e.ZERO=_;var C=i(0,!0);e.UZERO=C;var N=i(1);e.ONE=N;var A=i(1,!0);e.UONE=A;var P=i(-1);e.NEG_ONE=P;var V=a(-1,2147483647,!1);e.MAX_VALUE=V;var D=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=D;var M=a(0,-2147483648,!1);e.MIN_VALUE=M;var $=e.prototype;return $.toInt=function(){return this.unsigned?this.low>>>0:this.low},$.toNumber=function(){return this.unsigned?(this.high>>>0)*g+(this.low>>>0):this.high*g+(this.low>>>0)},$.toString=function(k){if(k=k||10,k<2||36<k)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(M)){var z=o(k),U=this.div(z),te=U.mul(z).sub(this);return U.toString(k)+te.toInt().toString(k)}else return"-"+this.neg().toString(k);for(var se=o(l(k,6),this.unsigned),X=this,Q="";;){var re=X.div(se),fe=X.sub(re.mul(se)).toInt()>>>0,be=fe.toString(k);if(X=re,X.isZero())return be+Q;for(;be.length<6;)be="0"+be;Q=""+be+Q}},$.getHighBits=function(){return this.high},$.getHighBitsUnsigned=function(){return this.high>>>0},$.getLowBits=function(){return this.low},$.getLowBitsUnsigned=function(){return this.low>>>0},$.getNumBitsAbs=function(){if(this.isNegative())return this.eq(M)?64:this.neg().getNumBitsAbs();for(var k=this.high!=0?this.high:this.low,z=31;z>0&&(k&1<<z)==0;z--);return this.high!=0?z+33:z+1},$.isZero=function(){return this.high===0&&this.low===0},$.eqz=$.isZero,$.isNegative=function(){return!this.unsigned&&this.high<0},$.isPositive=function(){return this.unsigned||this.high>=0},$.isOdd=function(){return(this.low&1)===1},$.isEven=function(){return(this.low&1)===0},$.equals=function(k){return t(k)||(k=h(k)),this.unsigned!==k.unsigned&&this.high>>>31===1&&k.high>>>31===1?!1:this.high===k.high&&this.low===k.low},$.eq=$.equals,$.notEquals=function(k){return!this.eq(k)},$.neq=$.notEquals,$.ne=$.notEquals,$.lessThan=function(k){return this.comp(k)<0},$.lt=$.lessThan,$.lessThanOrEqual=function(k){return this.comp(k)<=0},$.lte=$.lessThanOrEqual,$.le=$.lessThanOrEqual,$.greaterThan=function(k){return this.comp(k)>0},$.gt=$.greaterThan,$.greaterThanOrEqual=function(k){return this.comp(k)>=0},$.gte=$.greaterThanOrEqual,$.ge=$.greaterThanOrEqual,$.compare=function(k){if(t(k)||(k=h(k)),this.eq(k))return 0;var z=this.isNegative(),U=k.isNegative();return z&&!U?-1:!z&&U?1:this.unsigned?k.high>>>0>this.high>>>0||k.high===this.high&&k.low>>>0>this.low>>>0?-1:1:this.sub(k).isNegative()?-1:1},$.comp=$.compare,$.negate=function(){return!this.unsigned&&this.eq(M)?M:this.not().add(N)},$.neg=$.negate,$.add=function(k){t(k)||(k=h(k));var z=this.high>>>16,U=this.high&65535,te=this.low>>>16,se=this.low&65535,X=k.high>>>16,Q=k.high&65535,re=k.low>>>16,fe=k.low&65535,be=0,W=0,ne=0,ue=0;return ue+=se+fe,ne+=ue>>>16,ue&=65535,ne+=te+re,W+=ne>>>16,ne&=65535,W+=U+Q,be+=W>>>16,W&=65535,be+=z+X,be&=65535,a(ne<<16|ue,be<<16|W,this.unsigned)},$.subtract=function(k){return t(k)||(k=h(k)),this.add(k.neg())},$.sub=$.subtract,$.multiply=function(k){if(this.isZero())return _;if(t(k)||(k=h(k)),n){var z=n.mul(this.low,this.high,k.low,k.high);return a(z,n.get_high(),this.unsigned)}if(k.isZero())return _;if(this.eq(M))return k.isOdd()?M:_;if(k.eq(M))return this.isOdd()?M:_;if(this.isNegative())return k.isNegative()?this.neg().mul(k.neg()):this.neg().mul(k).neg();if(k.isNegative())return this.mul(k.neg()).neg();if(this.lt(w)&&k.lt(w))return o(this.toNumber()*k.toNumber(),this.unsigned);var U=this.high>>>16,te=this.high&65535,se=this.low>>>16,X=this.low&65535,Q=k.high>>>16,re=k.high&65535,fe=k.low>>>16,be=k.low&65535,W=0,ne=0,ue=0,Te=0;return Te+=X*be,ue+=Te>>>16,Te&=65535,ue+=se*be,ne+=ue>>>16,ue&=65535,ue+=X*fe,ne+=ue>>>16,ue&=65535,ne+=te*be,W+=ne>>>16,ne&=65535,ne+=se*fe,W+=ne>>>16,ne&=65535,ne+=X*re,W+=ne>>>16,ne&=65535,W+=U*be+te*fe+se*re+X*Q,W&=65535,a(ue<<16|Te,W<<16|ne,this.unsigned)},$.mul=$.multiply,$.divide=function(k){if(t(k)||(k=h(k)),k.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&k.low===-1&&k.high===-1)return this;var z=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,k.low,k.high);return a(z,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?C:_;var U,te,se;if(this.unsigned){if(k.unsigned||(k=k.toUnsigned()),k.gt(this))return C;if(k.gt(this.shru(1)))return A;se=C}else{if(this.eq(M)){if(k.eq(N)||k.eq(P))return M;if(k.eq(M))return N;var X=this.shr(1);return U=X.div(k).shl(1),U.eq(_)?k.isNegative()?N:P:(te=this.sub(k.mul(U)),se=U.add(te.div(k)),se)}else if(k.eq(M))return this.unsigned?C:_;if(this.isNegative())return k.isNegative()?this.neg().div(k.neg()):this.neg().div(k).neg();if(k.isNegative())return this.div(k.neg()).neg();se=_}for(te=this;te.gte(k);){U=Math.max(1,Math.floor(te.toNumber()/k.toNumber()));for(var Q=Math.ceil(Math.log(U)/Math.LN2),re=Q<=48?1:l(2,Q-48),fe=o(U),be=fe.mul(k);be.isNegative()||be.gt(te);)U-=re,fe=o(U,this.unsigned),be=fe.mul(k);fe.isZero()&&(fe=N),se=se.add(fe),te=te.sub(be)}return se},$.div=$.divide,$.modulo=function(k){if(t(k)||(k=h(k)),n){var z=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,k.low,k.high);return a(z,n.get_high(),this.unsigned)}return this.sub(this.div(k).mul(k))},$.mod=$.modulo,$.rem=$.modulo,$.not=function(){return a(~this.low,~this.high,this.unsigned)},$.and=function(k){return t(k)||(k=h(k)),a(this.low&k.low,this.high&k.high,this.unsigned)},$.or=function(k){return t(k)||(k=h(k)),a(this.low|k.low,this.high|k.high,this.unsigned)},$.xor=function(k){return t(k)||(k=h(k)),a(this.low^k.low,this.high^k.high,this.unsigned)},$.shiftLeft=function(k){return t(k)&&(k=k.toInt()),(k&=63)===0?this:k<32?a(this.low<<k,this.high<<k|this.low>>>32-k,this.unsigned):a(0,this.low<<k-32,this.unsigned)},$.shl=$.shiftLeft,$.shiftRight=function(k){return t(k)&&(k=k.toInt()),(k&=63)===0?this:k<32?a(this.low>>>k|this.high<<32-k,this.high>>k,this.unsigned):a(this.high>>k-32,this.high>=0?0:-1,this.unsigned)},$.shr=$.shiftRight,$.shiftRightUnsigned=function(k){if(t(k)&&(k=k.toInt()),k&=63,k===0)return this;var z=this.high;if(k<32){var U=this.low;return a(U>>>k|z<<32-k,z>>>k,this.unsigned)}else return k===32?a(z,0,this.unsigned):a(z>>>k-32,0,this.unsigned)},$.shru=$.shiftRightUnsigned,$.shr_u=$.shiftRightUnsigned,$.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},$.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},$.toBytes=function(k){return k?this.toBytesLE():this.toBytesBE()},$.toBytesLE=function(){var k=this.high,z=this.low;return[z&255,z>>>8&255,z>>>16&255,z>>>24,k&255,k>>>8&255,k>>>16&255,k>>>24]},$.toBytesBE=function(){var k=this.high,z=this.low;return[k>>>24,k>>>16&255,k>>>8&255,k&255,z>>>24,z>>>16&255,z>>>8&255,z&255]},e.fromBytes=function(k,z,U){return U?e.fromBytesLE(k,z):e.fromBytesBE(k,z)},e.fromBytesLE=function(k,z){return new e(k[0]|k[1]<<8|k[2]<<16|k[3]<<24,k[4]|k[5]<<8|k[6]<<16|k[7]<<24,z)},e.fromBytesBE=function(k,z){return new e(k[4]<<24|k[5]<<16|k[6]<<8|k[7],k[0]<<24|k[1]<<16|k[2]<<8|k[3],z)},tE}var A6=mde();const zN=EC(A6),k6=pj({__proto__:null,default:zN},[A6]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dh=zN||k6;function gy(n){return dh.fromString(n,!0,16)}const $6=gy("c3a5c85c97cb3127"),ch=gy("b492b66fbe98f273"),gr=gy("9ae16a3b2f90404f");function pI(n){return n.xor(n.shru(47))}function R6(n,e,t){const s=n.slice(e,e+t);return dh.fromBytes(Array.from(s),!0,!0)}function xn(n,e){return R6(n,e,8)}function l3(n,e){return R6(n,e,4)}function Cs(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function Gu(n,e,t=gy("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function gde(n,e,t,s,r,i){r=r.add(n),i=Cs(i.add(r).add(s),21);const o=r;return r=r.add(e),r=r.add(t),i=i.add(Cs(r,44)),[r.add(s),i.add(o)]}function S1(n,e,t,s){return gde(xn(n,e),xn(n,e+8),xn(n,e+16),xn(n,e+24),t,s)}function yde(n,e=n.length){if(e>=8){const t=gr.add(e*2),s=xn(n,0).add(gr),r=xn(n,e-8),i=Cs(r,37).mul(t).add(s),o=Cs(s,25).add(r).mul(t);return Gu(i,o,t)}if(e>=4){const t=gr.add(e*2),s=l3(n,0);return Gu(s.shl(3).add(e),l3(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],i=t+(s<<8),o=e+(r<<2);return pI(gr.mul(i).xor($6.mul(o))).mul(gr)}return gr}function bde(n,e=n.length){const t=gr.add(e*2),s=xn(n,0).mul(ch),r=xn(n,8),i=xn(n,e-8).mul(t),o=xn(n,e-16).mul(gr);return Gu(Cs(s.add(r),43).add(Cs(i,30)).add(o),s.add(Cs(r.add(gr),18)).add(i),t)}function vde(n,e=n.length){const t=gr.add(e*2),s=xn(n,0).mul(gr),r=xn(n,8),i=xn(n,e-8).mul(t),o=xn(n,e-16).mul(gr),a=Cs(s.add(r),43).add(Cs(i,30)).add(o),l=Gu(a,s.add(Cs(r.add(gr),18)).add(i),t),u=xn(n,16).mul(t),h=xn(n,24),f=a.add(xn(n,e-32)).mul(t),p=l.add(xn(n,e-24)).mul(t);return Gu(Cs(u.add(h),43).add(Cs(f,30)).add(p),u.add(Cs(h.add(s),18)).add(f),t)}function wde(n,e=n.length){const t=dh.fromNumber(81,!0);if(e<=32)return e<=16?yde(n,e):bde(n,e);if(e<=64)return vde(n,e);let s=t,r=t.mul(ch).add(113),i=pI(r.mul(gr).add(113)).mul(gr),o=[dh.UZERO,dh.UZERO],a=[dh.UZERO,dh.UZERO];s=s.mul(gr).add(xn(n,0));let l=0;const u=(e-1>>6)*64,h=u+(e-1&63)-63;do s=Cs(s.add(r).add(o[0]).add(xn(n,l+8)),37).mul(ch),r=Cs(r.add(o[1]).add(xn(n,l+48)),42).mul(ch),s=s.xor(a[1]),r=r.add(o[0]).add(xn(n,l+40)),i=Cs(i.add(a[0]),33).mul(ch),o=S1(n,l,o[1].mul(ch),s.add(a[0])),a=S1(n,l+32,i.add(a[1]),r.add(xn(n,l+16))),[i,s]=[s,i],l+=64;while(l!==u);const f=ch.add(i.and(255).shl(1));return l=h,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=Cs(s.add(r).add(o[0]).add(xn(n,l+8)),37).mul(f),r=Cs(r.add(o[1]).add(xn(n,l+48)),42).mul(f),s=s.xor(a[1].mul(9)),r=r.add(o[0].mul(9).add(xn(n,l+40))),i=Cs(i.add(a[0]),33).mul(f),o=S1(n,l,o[1].mul(f),s.add(a[0])),a=S1(n,l+32,i.add(a[1]),r.add(xn(n,l+16))),[i,s]=[s,i],Gu(Gu(o[0],a[0],f).add(pI(r).mul($6)).add(i),Gu(o[1],a[1],f).add(s),f)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tde(n,e){return e==="string"?yy(n):Yw([n],e)}function xde(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function Yw(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=sc(n)),ut().getBool("DEBUG")&&kU(n,e),xde(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Rg(){return ut().platform.now()}function Sde(n,e){return ut().platform.fetch(n,e)}function yy(n,e="utf-8"){return e=e||"utf-8",ut().platform.encode(n,e)}function Lv(n,e="utf-8"){return e=e||"utf-8",ut().platform.decode(n,e)}function Ns(n){return ut().platform.isTypedArray!=null?ut().platform.isTypedArray(n):N6(n)}function sc(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||nc(n)||n==null||Ns(n)&&t)e.push(n);else if(Array.isArray(n)||Ns(n))for(let s=0;s<n.length;++s)sc(n[s],e,t);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)sc(n[r],e,t)}return e}const _de=Object.freeze(Object.defineProperty({__proto__:null,arraysEqual:Mo,arraysEqualWithNull:CU,assert:Y,assertNonNegativeIntegerDimensions:ci,assertNonNull:nd,assertShapesMatch:Ir,bytesFromStringArray:RU,bytesPerElement:Ov,checkConversionForErrors:kU,clamp:Ag,computeStrides:vp,convertBackendValuesAndArrayBuffer:Phe,createScalarValue:Tde,createShuffledIndices:Rhe,decodeString:Lv,distSquared:Nhe,encodeString:yy,fetch:Sde,fingerPrint64:wde,flatten:sc,getArrayFromDType:RN,getTypedArrayFromDType:AU,hasEncodingLoss:Ohe,hexToLong:gy,indexToLoc:Vhe,inferDtype:my,inferFromImplicitShape:Mhe,isBoolean:DU,isFunction:tc,isInt:Gf,isNumber:MU,isPromise:nc,isScalarShape:Ahe,isString:ku,isTypedArray:Ns,isValidDtype:$U,locToIndex:Lhe,makeOnesTypedArray:DN,makeZerosNestedTypedArray:Fhe,makeZerosTypedArray:Xw,nearestDivisor:Pv,nearestLargerEven:Ehe,now:Rg,parseAxisParam:py,randUniform:Che,repeatedTry:Dhe,rightPad:pg,shuffle:IU,shuffleCombo:_he,sizeFromShape:dn,sizeToSquarishShape:$he,squeezeShape:NU,sum:Ihe,swap:Mv,tanh:khe,toNestedArray:Sh,toTypedArray:Yw},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Ede=class{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Cde)}profileKernel(e,t,s){let r;const i=()=>{r=s()};let o;const a=Rg();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const u of r)u.dataSync();o=Promise.resolve({kernelMs:Rg()-a})}if(ut().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<r.length;u++){const h=r[u];h.data().then(f=>{Ide(f,h.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:o.then(u=>u.kernelMs),extraInfo:o.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:i,extraInfo:o}=e;s.forEach(a=>{Promise.all([a.data(),r,o]).then(l=>{this.logger.logKernelProfile(t,a,l[0],l[1],i,l[2])})})}};function Ide(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}let Cde=class{logKernelProfile(e,t,s,r,i,o){const a=typeof r=="number"?pg(`${r}ms`,9):r.error,l=pg(e,25),u=t.rank,h=t.size,f=pg(t.shape.toString(),14);let p="";for(const g in i){const b=i[g];if(b!=null){const T=b.shape||t.shape,w=T.length;p+=`${g}: ${w}D ${w>0?T:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${f}	%c${h}	%c${p}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nde(n,e,t){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<n.length;l++){const u=n[l],h=u.inputs;for(const f in h){const p=h[f];let g=!1;for(let b=0;b<e.length;b++)if(s[p.id]){u.outputs.forEach(T=>s[T.id]=!0),g=!0,r[u.id]=!0;break}if(g)break}}const i={};i[t.id]=!0;const o={};for(let l=n.length-1;l>=0;l--){const u=n[l],h=u.inputs;for(let f=0;f<u.outputs.length;f++)if(i[u.outputs[f].id]){for(const p in h)i[h[p].id]=!0,o[u.id]=!0;break}}const a=[];for(let l=0;l<n.length;l++){const u=n[l];if(r[u.id]&&o[u.id]){const h={};for(const p in u.inputs){const g=u.inputs[p];s[g.id]&&(h[p]=g)}const f=Object.assign({},u);f.inputs=h,f.outputs=u.outputs,a.push(f)}}return a}function Ade(n,e,t,s){for(let r=e.length-1;r>=0;r--){const i=e[r],o=[];if(i.outputs.forEach(l=>{const u=n[l.id];u!=null?o.push(u):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=t(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const h=i.inputs[l];if(!Mo(u.shape,h.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${h.shape}'`);if(n[h.id]==null)n[h.id]=u;else{const f=n[h.id];n[h.id]=s(f,u),f.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u3=20,Gm=3,nE=7;function kde(n,e,t,s){const r=vp(e),i=$de(n,e,t,r),o=e.length,a=Q1(n,e,t,r,i),l=["Tensor"];return s&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function $de(n,e,t,s){const r=dn(e),i=s[s.length-1],o=new Array(i).fill(0),a=e.length,l=t==="complex64"?eg(n):n;if(a>1)for(let u=0;u<r/i;u++){const h=u*i;for(let f=0;f<i;f++)o[f]=Math.max(o[f],Zm(l[h+f],0,t).length)}return o}function Zm(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(nE))} + ${parseFloat(n[1].toFixed(nE))}j`:ku(n)?s=`'${n}'`:t==="bool"?s=D6(n):s=parseFloat(n.toFixed(nE)).toString(),pg(s,e)}function D6(n){return n===0?"false":"true"}function Q1(n,e,t,s,r,i=!0){const o=t==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(t==="complex64"){const T=eg(n);return[Zm(T[0],0,t)]}return t==="bool"?[D6(n[0])]:[n[0].toString()]}if(l===1){if(a>u3){const w=Gm*o;let _=Array.from(n.slice(0,w)),C=Array.from(n.slice((a-Gm)*o,a*o));return t==="complex64"&&(_=eg(_),C=eg(C)),["["+_.map((N,A)=>Zm(N,r[A],t)).join(", ")+", ..., "+C.map((N,A)=>Zm(N,r[a-Gm+A],t)).join(", ")+"]"]}return["["+(t==="complex64"?eg(n):Array.from(n)).map((w,_)=>Zm(w,r[_],t)).join(", ")+"]"]}const u=e.slice(1),h=s.slice(1),f=s[0]*o,p=[];if(a>u3){for(let T=0;T<Gm;T++){const w=T*f,_=w+f;p.push(...Q1(n.slice(w,_),u,t,h,r,!1))}p.push("...");for(let T=a-Gm;T<a;T++){const w=T*f,_=w+f;p.push(...Q1(n.slice(w,_),u,t,h,r,T===a-1))}}else for(let T=0;T<a;T++){const w=T*f,_=w+f;p.push(...Q1(n.slice(w,_),u,t,h,r,T===a-1))}const g=l===2?",":"";p[0]="["+(a>0?p[0]+g:"");for(let T=1;T<p.length-1;T++)p[T]=" "+p[T]+g;let b=`,
`;for(let T=2;T<l;T++)b+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(i?"":b),p}function eg(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Vv=class{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=dn(e),s!=null){const r=s.length;Y(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||RN(t,this.size),this.strides=vp(e)}set(e,...t){t.length===0&&(t=[0]),Y(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return To().makeTensor(this.values,this.shape,this.dtype)}},To=null,uf=null;function Rde(n){To=n}function Dde(n){uf=n}let Vn=class{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=dn(e),this.strides=vp(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return uf.buffer(this.shape,this.dtype,e)}bufferSync(){return uf.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Sh(this.shape,e,this.dtype==="complex64")}arraySync(){return Sh(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=To().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>Lv(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),To().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=To().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>Lv(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await To().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),To().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return uf.print(this,e)}clone(){return this.throwIfDisposed(),uf.clone(this)}toString(e=!1){const t=this.dataSync();return kde(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),uf.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),To().makeVariable(this,e,t,s)}};Object.defineProperty(Vn,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function M6(){return ON("Tensor",()=>Vn)}M6();let Dg=class extends Vn{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Mo(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);To().disposeTensor(this),this.dataId=e.dataId,To().incRef(this,null)}dispose(){To().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(Dg,Symbol.hasInstance,{value:n=>n instanceof Vn&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var mI;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(mI||(mI={}));var gI;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(gI||(gI={}));var yI;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(yI||(yI={}));var bI;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(bI||(bI={}));var vI;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(vI||(vI={}));const Mde={float32:bI,int32:gI,bool:yI,complex64:vI};function Jw(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return Mde[n][e]}function Ode(n){return Jw(n,"int32")}function O6(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function P6(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Un(n,e){if(n.dtype===e.dtype)return[n,e];const t=Jw(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function F6(n,e){Y(n.dtype===e.dtype,()=>`The dtypes of the first(${n.dtype}) and second(${e.dtype}) input must match`)}function Pde(n,e){return e.some(t=>t.id===n.id)}function GN(n){const e=[];return L6(n,e,new Set),e}function L6(n,e,t){if(n==null)return;if(n instanceof Vn){e.push(n);return}if(!Fde(n))return;const s=n;for(const r in s){const i=s[r];t.has(i)||(t.add(i),L6(i,e,t))}}function Fde(n){return Array.isArray(n)||typeof n=="object"}const Lde=Object.freeze(Object.defineProperty({__proto__:null,assertTypesMatch:F6,getTensorsInContainer:GN,isTensorInList:Pde,makeTypesMatch:Un},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sE(n){return n.kernelName!=null}let c3=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}},HN=class wI{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new c3}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(Nu(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Ede(this.backendInstance),!0}setupRegisteredKernels(){Fv(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){Fv(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof EU)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,Nu(`Initialization of backend ${e} failed`),Nu(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return Nu(`Initialization of backend ${e} failed`),Nu(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,i=this.readSync(t),o=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,i,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return wI.nextTensorId++}nextVariableId(){return wI.nextVariableId++}clone(e){const t=Z.runKernel(VN,{x:e}),s={x:e},r=o=>({x:()=>{const a="float32",l={x:o},u={dtype:a};return Z.runKernel(FN,l,u)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,i,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!($g(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let i=0;s.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-t-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=sE(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(sE(e)){const{kernelName:b,inputs:T,attrs:w}=e;this.backendName==null&&this.backend;const _=$g(b,this.backendName);Y(_!=null,()=>`Cannot find registered kernel '${b}' for backend '${this.backendName}'`),a=()=>{const C=this.backend.numDataIds();l=_.kernelFunc({inputs:T,attrs:w,backend:this.backend});const N=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(b,C,N);const A=N.map(P=>P.rank!=null?P:this.makeTensorFromTensorInfo(P));if(r){const P=this.getTensorsForGradient(b,T,A);s=this.saveTensorsForBackwardMode(P)}return A}}else{const{forwardFunc:b}=e,T=w=>{r&&(s=w.map(_=>this.keep(this.clone(_))))};a=()=>{const w=this.backend.numDataIds();l=this.tidy(()=>b(this.backend,T));const _=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,w,_),_}}const{inputs:h,attrs:f}=e,p=sE(e)?null:e.backwardsFunc;let g;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(g=this.profiler.profileKernel(u,h,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(g),t=g.outputs)}),r&&this.addTapeNode(u,h,t,p,s,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(h).map(b=>h[b]!=null?h[b].shape:null),outputShapes:t.map(b=>b.shape),kernelTimeMs:g.timeMs,extraInfo:g.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=fI(e);if(r!=null){const i=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(Y(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(u=>t[u])):a=i.map(u=>t[u]);const l=s.filter((u,h)=>o[h]);return a.concat(l)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=e;s==="string"&&ku(e[0])&&(i=e.map(l=>yy(l)));const o=r.write(i,t,s),a=new Vn(t,s,o,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(o),u=RU(i);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,t,s,r){s=s||"float32";const i={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:i}=e,o=new Vn(r,i,s,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const i=new Dg(e,t,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*Ov(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof Dg||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*Ov(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:i},l=fI(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=u=>(u=u.map((h,f)=>{if(h==null){const p=s[f],g=Xw(p.size,p.dtype);return this.makeTensor(g,p.shape,p.dtype)}return h}),r(u.length>1?u:u[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=GN(e),s=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!s.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(e,t,s,r=!1){if(Y(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));Y(i instanceof Vn,()=>"The result y returned by f() must be a tensor.");const o=Nde(this.state.activeTape,t,i);if(!r&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=s??Vde(i.shape),Ade(a,o,u=>this.tidy(u),Bde);const l=t.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const h of u.saved)h.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return Y(tc(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{Y(t.every(a=>a instanceof Vn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((a,l)=>{r[l]=a});const i=(a,l)=>(s=e(...t,l),Y(s.value instanceof Vn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),Y(tc(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,l)=>{const u=s.gradFunc(a,l),h=Array.isArray(u)?u:[u];Y(h.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),Y(h.every(p=>p instanceof Vn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const f={};return h.forEach((p,g)=>{f[g]=()=>p}),f};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Rg(),s=await this.backend.time(e);return s.wallMs=Rg()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new c3;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}};HN.nextTensorId=0;HN.nextVariableId=0;function Vde(n){const e=DN(dn(n),"float32");return Z.makeTensor(e,n,"float32")}function V6(){const n=FU();if(n._tfengine==null){const e=new PU(n);n._tfengine=new HN(e)}return Ghe(n._tfengine.ENV),Rde(()=>n._tfengine),n._tfengine}const Z=V6();function Bde(n,e){const t={a:n,b:e};return Z.runKernel(PN,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ude(){return typeof navigator<"u"&&navigator!=null}let TI;function zde(n){TI=n}function Gde(n){if(TI!==void 0)return TI;if(n||Ude()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function B6(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}const Hde=Object.freeze(Object.defineProperty({__proto__:null,isBrowser:B6,isMobile:Gde,mockIsMobile:zde},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pr=ut();Pr.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Pr.registerFlag("IS_BROWSER",()=>B6());Pr.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Pr.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Pr.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Pr.registerFlag("PROD",()=>!1);Pr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Pr.getBool("DEBUG"));Pr.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Pr.registerFlag("IS_TEST",()=>!1);Pr.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Pr.getBool("DEBUG"));Pr.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Pr.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Pr.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Na(n,e){let t=n;if(Ns(n))return e==="string"?[]:[n.length];if(O6(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(P6(n))return[n.buffer.size/(e==null?4:Ov(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||Ns(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&ut().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&U6(n,s,[]),s}function U6(n,e,t){if(t=t||[],!Array.isArray(n)&&!Ns(n)){Y(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}Y(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),Y(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)U6(n[r],s,t.concat(r))}function h3(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function H(n,e,t,s="numeric"){if(n instanceof M6())return h3(s,n.dtype,e,t),n;let r=my(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),h3(s,r,e,t),n==null||!Ns(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const i=Na(n,r);!Ns(n)&&!Array.isArray(n)&&(n=[n]);const a=r!=="string"?Yw(n,r):sc(n,[],!0);return Z.makeTensor(a,i,r)}function Mg(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,o)=>H(i,`${e}[${o}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qN="__op";function j(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+qN;const r=(...i)=>{Z.startScope(t);try{const o=s(...i);return nc(o)&&console.error("Cannot return a Promise inside of tidy."),Z.endScope(o),o}catch(o){throw Z.endScope(null),o}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qde(n,e){const t=H(n,"real","complex"),s=H(e,"imag","complex");Ir(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return Z.runKernel(oz,r)}const El=j({complex_:qde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vc(n,e,t,s){if(s==null)s=my(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(P6(n)||O6(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return Z.backend.createTensorFromGPUData(n,e||t,s)}if(!Ns(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){ci(e);const r=dn(e),i=dn(t);Y(r===i,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${i}`);for(let o=0;o<t.length;++o){const a=t[o],l=o===t.length-1?a!==dn(e.slice(o)):!0;Y(t[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Ns(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?Yw(n,s):sc(n,[],!0),Z.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function No(n,e,t){const s=Na(n,t);return vc(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mh={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};let Ml=class z6{static join(e){return new z6(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>Ns(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=t+r.byteLength;this.shards.push({buffer:r,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let l=s;l<this.shards.length;l++){const u=this.shards[l],f=e+a-u.start,p=a,b=Math.min(t,u.end)-u.start,T=new Uint8Array(u.buffer,f,b-f);if(o.set(T,p),a+=T.length,t<u.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=Wde(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}};function Wde(n,e){let t=0,s=n.length;for(;t<=s;){const r=Math.floor((s-t)/2)+t,i=e(n[r]);if(i===0)return r;i<0?s=r:t=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kde(){ut().set("PROD",!0)}function Xde(){ut().set("DEBUG",!0)}function Yde(){ut().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Jde(n){ut().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function jde(){Z.disposeVariables()}function Qde(){return Z}function Zde(){return Z.memory()}function efe(n){return Z.profile(n)}function qt(n,e){return Z.tidy(n,e)}function Tr(n){GN(n).forEach(t=>t.dispose())}function Io(n){return Z.keep(n)}function tfe(n){return Z.time(n)}function nfe(n){return Z.setBackend(n)}function sfe(){return Z.ready()}function G6(){return Z.backendName}function rfe(n){Z.removeBackend(n)}function ife(n){return Z.findBackend(n)}function ofe(n){return Z.findBackendFactory(n)}function afe(n,e,t=1){return Z.registerBackend(n,e,t)}function H6(){return Z.backend}function lfe(n,e){ut().setPlatform(n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rc=4;async function ufe(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(o=>o.name):Object.keys(n);for(let o=0;o<r.length;++o){const a=r[o],l=Array.isArray(n)?n[o].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const h=new Promise(async f=>{const p=await l.bytes(),g=p.reduce((w,_)=>w+_.length,0)+rc*p.length,b=new Uint8Array(g);let T=0;for(let w=0;w<p.length;w++){const _=p[w],C=new Uint8Array(new Uint32Array([_.length]).buffer);b.set(C,T),T+=rc,b.set(_,T),T+=_.length}f(b)});s.push(h)}else s.push(l.data());e!=null&&(u.group=e),t.push(u)}const i=await Promise.all(s);return{data:dfe(i),specs:t}}function q6(n,e){const t=new Ml(n),s={};let r=0;for(const i of e){const o=cfe(i,(a,l)=>t.slice(r+a,r+l));s[i.name]=W6(i,t.slice(r,r+o)),r+=o}return s}function cfe(n,e){const t=dn(n.shape);let s;if("quantization"in n){const r=n.quantization;s=Mh[r.dtype]}else if(n.dtype==="string"){let r=0;for(let i=0;i<t;i++)r+=rc+new Uint32Array(e(r,r+rc))[0];return r}else s=Mh[n.dtype];return t*s}async function hfe(n,e){const t=dn(n.shape);let s;if("quantization"in n){const r=n.quantization;s=Mh[r.dtype]}else if(n.dtype==="string"){let r=0;for(let i=0;i<t;i++)r+=rc+new Uint32Array(await e(r,r+rc))[0];return r}else s=Mh[n.dtype];return t*s}function W6(n,e){const t=n.name,s=n.dtype,r=n.shape,i=dn(r);let o,a=0;if("quantization"in n){const l=n.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${n.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${n.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const u=Mh[l.dtype],h=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){o=new Float32Array(h.length);for(let f=0;f<h.length;f++){const p=h[f];o[f]=p*l.scale+l.min}}else if(l.dtype==="float16")o=vfe()(h);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);o=new Int32Array(h.length);for(let f=0;f<h.length;f++){const p=h[f];o[f]=Math.round(p*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=i*u}else if(s==="string"){const l=dn(n.shape);o=[];for(let u=0;u<l;u++){const h=new Uint32Array(e.slice(a,a+rc))[0];a+=rc;const f=new Uint8Array(e.slice(a,a+h));o.push(f),a+=h}}else{const l=Mh[s];if(s==="float32")o=new Float32Array(e);else if(s==="int32")o=new Int32Array(e);else if(s==="bool")o=new Uint8Array(e);else if(s==="complex64"){o=new Float32Array(e);const u=new Float32Array(o.length/2),h=new Float32Array(o.length/2);for(let b=0;b<u.length;b++)u[b]=o[b*2],h[b]=o[b*2+1];const f=No(u,r,"float32"),p=No(h,r,"float32"),g=El(f,p);return f.dispose(),p.dispose(),g}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=i*l}return No(o,r,s)}async function d3(n,e,t){let s=new Uint8Array(e);for(;s.byteLength<t;){const{done:r,value:i}=await n.read();if(r&&i==null){const a=t-s.byteLength;throw new Error(`Reader is done but ${a} bytes are still expected`)}const o=new Uint8Array(s.length+i.byteLength);o.set(s,0),o.set(new Uint8Array(i),s.length),s=o}return s.buffer}async function K6(n,e){const t={},s=n.getReader();let r=new ArrayBuffer(0);for(const i of e){const o=await hfe(i,async(u,h)=>(r=await d3(s,r,h),r.slice(u,h)));r=await d3(s,r,o);const a=r.slice(0,o);r=r.slice(o);const l=W6(i,a);if(t[i.name]=l,G6()==="webgpu"){const u=H6();"uploadToGPU"in u&&dn(l.shape)>=ut().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&u.uploadToGPU(l.dataId)}}return t}function dfe(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(i=>{if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const WN=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function f3(n){return WN?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function ffe(n){if(WN)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function pfe(n){if(WN){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function mfe(n){return Ml.join(n)}function p3(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);const t=n.split("/");return t[t.length-1]}function X6(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function Y6(n,e,t){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=t}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(s.initializerSignature=n.initializerSignature),s}async function KN(n,e){let t,s;return n.weightsManifest!=null&&([t,s]=await e(n.weightsManifest)),Y6(n,t,s)}function by(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:f3(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:f3(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Ml(n.weightData).byteLength}}function xI(n){const e=[];for(const t of n)e.push(...t.weights);return e}function gfe(){const n=t=>{let s=t<<13,r=0;for(;(s&8388608)===0;)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function yfe(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function bfe(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function vfe(){const n=gfe(),e=yfe(),t=bfe();return s=>{const r=new ArrayBuffer(4*s.length),i=new Uint32Array(r);for(let o=0;o<s.length;o++){const a=s[o],l=n[t[a>>10]+(a&1023)]+e[a>>10];i[o]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Ei=class vo{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return vo.instance==null&&(vo.instance=new vo),vo.instance}static registerSaveRouter(e){vo.getInstance().saveRouters.push(e)}static registerLoadRouter(e){vo.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return vo.getHandlers(e,"save")}static getLoadHandlers(e,t){return vo.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?vo.getInstance().loadRouters:vo.getInstance().saveRouters).forEach(o=>{const a=o(e,s);a!==null&&r.push(a)}),r}};const wfe=n=>Ei.registerSaveRouter(n),Tfe=n=>Ei.registerLoadRouter(n),xfe=n=>Ei.getSaveHandlers(n),Sfe=(n,e)=>Ei.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SI="tensorflowjs",_I=1,vh="models_store",$u="model_info_store";function J6(){if(!ut().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function EI(n){const e=n.result;e.createObjectStore(vh,{keyPath:"modelPath"}),e.createObjectStore($u,{keyPath:"modelPath"})}let Oh=class{constructor(e){if(this.indexedDB=J6(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const i=this.indexedDB.open(SI,_I);i.onupgradeneeded=()=>EI(i),i.onsuccess=()=>{const o=i.result;if(t==null){const a=o.transaction(vh,"readonly"),u=a.objectStore(vh).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(u.result.modelArtifacts)},u.onerror=h=>(o.close(),r(u.error)),a.oncomplete=()=>o.close()}else{t.weightData=Ml.join(t.weightData);const a=by(t),l=o.transaction($u,"readwrite");let u=l.objectStore($u),h;try{h=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(p){return r(p)}let f;h.onsuccess=()=>{f=o.transaction(vh,"readwrite");const p=f.objectStore(vh);let g;try{g=p.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(b){return r(b)}g.onsuccess=()=>s({modelArtifactsInfo:a}),g.onerror=b=>{u=l.objectStore($u);const T=u.delete(this.modelPath);T.onsuccess=()=>(o.close(),r(g.error)),T.onerror=w=>(o.close(),r(g.error))}},h.onerror=p=>(o.close(),r(h.error)),l.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},i.onerror=o=>r(i.error)})}};Oh.URL_SCHEME="indexeddb://";const j6=n=>ut().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Oh.URL_SCHEME)?_fe(n.slice(Oh.URL_SCHEME.length)):null;Ei.registerSaveRouter(j6);Ei.registerLoadRouter(j6);function _fe(n){return new Oh(n)}function Efe(n){return n.startsWith(Oh.URL_SCHEME)?n.slice(Oh.URL_SCHEME.length):n}let Ife=class{constructor(){this.indexedDB=J6()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(SI,_I);s.onupgradeneeded=()=>EI(s),s.onsuccess=()=>{const r=s.result,i=r.transaction($u,"readonly"),a=i.objectStore($u).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),t(a.error)),i.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=Efe(e),new Promise((t,s)=>{const r=this.indexedDB.open(SI,_I);r.onupgradeneeded=()=>EI(r),r.onsuccess=()=>{const i=r.result,o=i.transaction($u,"readwrite"),a=o.objectStore($u),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return i.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const h=a.delete(e),f=()=>{u=i.transaction(vh,"readwrite");const g=u.objectStore(vh).delete(e);g.onsuccess=()=>t(l.result.modelArtifactsInfo),g.onerror=b=>s(l.error)};h.onsuccess=f,h.onerror=p=>(f(),i.close(),s(l.error))}},l.onerror=h=>(i.close(),s(l.error)),o.oncomplete=()=>{u==null?i.close():u.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ul="/",cf="tensorflowjs_models",Q6="info",Cfe="model_topology",Nfe="weight_specs",Afe="weight_data",kfe="model_metadata";function Z6(n){return{info:[cf,n,Q6].join(ul),topology:[cf,n,Cfe].join(ul),weightSpecs:[cf,n,Nfe].join(ul),weightData:[cf,n,Afe].join(ul),modelMetadata:[cf,n,kfe].join(ul)}}function eH(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function $fe(n){const e=n.split(ul);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(ul)}function Rfe(n){return n.startsWith(Ph.URL_SCHEME)?n.slice(Ph.URL_SCHEME.length):n}let Ph=class{constructor(e){if(!ut().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Z6(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=by(e),i=Ml.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,ffe(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw eH(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=pfe(o),t}};Ph.URL_SCHEME="localstorage://";const tH=n=>ut().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ph.URL_SCHEME)?Dfe(n.slice(Ph.URL_SCHEME.length)):null;Ei.registerSaveRouter(tH);Ei.registerLoadRouter(tH);function Dfe(n){return new Ph(n)}let Mfe=class{constructor(){Y(ut().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),Y(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=cf+ul,s=ul+Q6;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(t)&&i.endsWith(s)){const o=$fe(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=Rfe(e);const t=Z6(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return eH(t),s}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const If="://";let ic=class xu{constructor(){this.managers={}}static getInstance(){return xu.instance==null&&(xu.instance=new xu),xu.instance}static registerManager(e,t){Y(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(If)&&(e=e.slice(0,e.indexOf(If))),Y(e.length>0,()=>"scheme must not be an empty string.");const s=xu.getInstance();Y(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=xu.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(xu.getInstance().managers)}};function Z1(n){if(n.indexOf(If)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${ic.getSchemes().join(",")}`);return{scheme:n.split(If)[0],path:n.split(If)[1]}}async function nH(n,e,t=!1){Y(n!==e,()=>`Old path and new path are the same: '${n}'`);const s=Ei.getLoadHandlers(n);Y(s.length>0,()=>`Copying failed because no load handler is found for source URL ${n}.`),Y(s.length<2,()=>`Copying failed because more than one (${s.length}) load handlers for source URL ${n}.`);const r=s[0],i=Ei.getSaveHandlers(e);Y(i.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),Y(i.length<2,()=>`Copying failed because more than one (${s.length}) save handlers for destination URL ${e}.`);const o=i[0],a=Z1(n).scheme,l=Z1(n).path,u=a===Z1(n).scheme,h=await r.load();t&&u&&await ic.getManager(a).removeModel(l);const f=await o.save(h);return t&&!u&&await ic.getManager(a).removeModel(l),f.modelArtifactsInfo}async function Ofe(){const n=ic.getSchemes(),e={};for(const t of n){const s=await ic.getManager(t).listModels();for(const r in s){const i=t+If+r;e[i]=s[r]}}return e}async function Pfe(n){const e=Z1(n);return ic.getManager(e.scheme).removeModel(e.path)}async function Ffe(n,e){return nH(n,e,!1)}async function Lfe(n,e){return nH(n,e,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Vfe=class{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!ut().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return N6(e)}};if(ut().get("IS_BROWSER")){ut().setPlatform("browser",new Vfe);try{ic.registerManager(Ph.URL_SCHEME,new Mfe)}catch{}try{ic.registerManager(Oh.URL_SCHEME,new Ife)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bfe={importFetch:()=>require("node-fetch")};let rE,Ufe=class{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return ut().global.fetch!=null?ut().global.fetch(e,t):(rE==null&&(rE=Bfe.importFetch()),rE(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}};ut().get("IS_NODE")&&!ut().get("IS_BROWSER")&&ut().setPlatform("node",new Ufe);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aa(n,e="float32",t){return e=e||"float32",ci(n),new Vv(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zfe(n,e){const t=H(n,"x","cast");if(!$U(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return Z.runKernel(FN,s,r)}const vn=j({cast_:zfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gfe(n){const t={x:H(n,"x","clone","string_or_numeric")};return Z.runKernel(VN,t)}const ml=j({clone_:Gfe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XN(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */V6();const Hfe={buffer:Aa,cast:vn,clone:ml,print:XN};Dde(Hfe);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qfe(n,e){let t=H(n,"a","add"),s=H(e,"b","add");[t,s]=Un(t,s);const r={a:t,b:s};return Z.runKernel(PN,r)}const ot=j({add_:qfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wfe(n,e){let t=H(n,"a","floorDiv"),s=H(e,"b","floorDiv");[t,s]=Un(t,s);const r={a:t,b:s};return Z.runKernel(Lz,r)}const YN=j({floorDiv_:Wfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kfe(n,e){let t=H(n,"a","div"),s=H(e,"b","div");if([t,s]=Un(t,s),t.dtype==="int32"&&s.dtype==="int32")return YN(t,s);const r={a:t,b:s},i={};return Z.runKernel(Iz,r,i)}const In=j({div_:Kfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xfe(n,e){let t=H(n,"a","mul"),s=H(e,"b","mul");[t,s]=Un(t,s);const r={a:t,b:s};return Z.runKernel(gG,r)}const Ue=j({mul_:Xfe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yfe(n){const e=H(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return Z.runKernel(az,t)}else{const t={x:e};return Z.runKernel(LU,t)}}const ni=j({abs_:Yfe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jfe(n){const t={x:H(n,"x","acos")};return Z.runKernel(VU,t)}const sH=j({acos_:Jfe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jfe(n){const t={x:H(n,"x","acosh")};return Z.runKernel(BU,t)}const rH=j({acosh_:jfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qfe(n){Y(Array.isArray(n),()=>"The argument passed to tf.addN() must be a list of tensors"),Y(n.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${n.length}`);const e=n.map((r,i)=>H(r,`tensors${i}`,"addN")),t=e[0];e.forEach(r=>{if(r.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(r=>{if(!Mo(r.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const s=e;return Z.runKernel(UU,s)}const iH=j({addN_:Qfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zfe(n,e=null,t=!1){const r={x:H(n,"x","all","bool")},i={axis:e,keepDims:t};return Z.runKernel(zU,r,i)}const oH=j({all_:Zfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function epe(n,e=null,t=!1){const r={x:H(n,"x","any","bool")},i={axis:e,keepDims:t};return Z.runKernel(GU,r,i)}const aH=j({any_:epe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tpe(n,e=0){const s={x:H(n,"x","argMax")},r={axis:e};return Z.runKernel(HU,s,r)}const lH=j({argMax_:tpe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function npe(n,e=0){const s={x:H(n,"x","argMin")},r={axis:e};return Z.runKernel(qU,s,r)}const uH=j({argMin_:npe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function spe(n){const t={x:H(n,"x","asin")};return Z.runKernel(WU,t)}const cH=j({asin_:spe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rpe(n){const t={x:H(n,"x","asinh")};return Z.runKernel(KU,t)}const hH=j({asinh_:rpe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ipe(n){const t={x:H(n,"x","atan")};return Z.runKernel(XU,t)}const dH=j({atan_:ipe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ope(n,e){let t=H(n,"a","atan2"),s=H(e,"b","atan2");[t,s]=Un(t,s);const r={a:t,b:s};return Z.runKernel(JU,r)}const fH=j({atan2_:ope});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ape(n){const t={x:H(n,"x","atanh")};return Z.runKernel(YU,t)}const pH=j({atanh_:ape});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lpe(n,e,t,s,r="NHWC",i){const o=n[3],a=[...e,o],l=yH(r);return vy(n,a,t,i,s,null,null,l)}function mH(n,e,t,s,r,i,o="channelsLast"){const[a,l]=Og(e);let u;if(o==="channelsLast")u=[a,l,n[3],n[3]];else if(o==="channelsFirst")u=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return vy(n,u,t,s,r,i,!1,o)}function upe(n,e,t,s,r,i,o="NDHWC"){const[a,l,u]=II(e);let h,f;if(o==="NDHWC")f="channelsLast",h=[a,l,u,n[4],n[4]];else if(o==="NCDHW")f="channelsFirst",h=[a,l,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return gH(n,h,t,s,r,!1,f,i)}function vy(n,e,t,s,r,i,o=!1,a="channelsLast"){let[l,u,h,f]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,h,f]=n;else if(a==="channelsFirst")[l,f,u,h]=n;else throw new Error(`Unknown dataFormat ${a}`);const[p,g,,b]=e,[T,w]=Og(t),[_,C]=Og(s),N=Cf(p,_),A=Cf(g,C),{padInfo:P,outHeight:V,outWidth:D}=dpe(r,u,h,T,w,N,A,i,a),M=o?b*f:b;let $;return a==="channelsFirst"?$=[l,M,V,D]:a==="channelsLast"&&($=[l,V,D,M]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:h,inChannels:f,outHeight:V,outWidth:D,outChannels:M,padInfo:P,strideHeight:T,strideWidth:w,filterHeight:p,filterWidth:g,effectiveFilterHeight:N,effectiveFilterWidth:A,dilationHeight:_,dilationWidth:C,inShape:n,outShape:$,filterShape:e}}function gH(n,e,t,s,r,i=!1,o="channelsLast",a){let[l,u,h,f,p]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,u,h,f,p]=n;else if(o==="channelsFirst")[l,p,u,h,f]=n;else throw new Error(`Unknown dataFormat ${o}`);const[g,b,T,,w]=e,[_,C,N]=II(t),[A,P,V]=II(s),D=Cf(g,A),M=Cf(b,P),$=Cf(T,V),{padInfo:O,outDepth:k,outHeight:z,outWidth:U}=fpe(r,u,h,f,_,C,N,D,M,$,a),te=i?w*p:w;let se;return o==="channelsFirst"?se=[l,te,k,z,U]:o==="channelsLast"&&(se=[l,k,z,U,te]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:h,inWidth:f,inChannels:p,outDepth:k,outHeight:z,outWidth:U,outChannels:te,padInfo:O,strideDepth:_,strideHeight:C,strideWidth:N,filterDepth:g,filterHeight:b,filterWidth:T,effectiveFilterDepth:D,effectiveFilterHeight:M,effectiveFilterWidth:$,dilationDepth:A,dilationHeight:P,dilationWidth:V,inShape:n,outShape:se,filterShape:e}}function cpe(n,e,t,s,r){s==null&&(s=JN(n,e,t));const i=n[0],o=n[1],a=Pg((i-e+2*s)/t+1,r),l=Pg((o-e+2*s)/t+1,r);return[a,l]}function hpe(n,e,t,s,r,i){r==null&&(r=JN(n,e[0],s[0]));const o=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*r>=e[a]&&(o[a]=Pg((n[a]-e[a]+2*r)/s[a]+1,i));return o}function JN(n,e,t,s=1){const r=Cf(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function Og(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function II(n){return typeof n=="number"?[n,n,n]:n}function Cf(n,e){return e<=1?n:n+(n-1)*(e-1)}function dpe(n,e,t,s,r,i,o,a,l){let u,h,f;if(typeof n=="number"){u={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const g=cpe([e,t],i,s,n,a);h=g[0],f=g[1]}else if(n==="same"){h=Math.ceil(e/s),f=Math.ceil(t/r);const p=Math.max(0,(h-1)*s+i-e),g=Math.max(0,(f-1)*r+o-t),b=Math.floor(p/2),T=p-b,w=Math.floor(g/2),_=g-w;u={top:b,bottom:T,left:w,right:_,type:"SAME"}}else if(n==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},h=Math.ceil((e-i+1)/s),f=Math.ceil((t-o+1)/r);else if(typeof n=="object"){const p=l==="channelsLast"?n[1][0]:n[2][0],g=l==="channelsLast"?n[1][1]:n[2][1],b=l==="channelsLast"?n[2][0]:n[3][0],T=l==="channelsLast"?n[2][1]:n[3][1];u={top:p,bottom:g,left:b,right:T,type:p===0&&g===0&&b===0&&T===0?"VALID":"EXPLICIT"},h=Pg((e-i+p+g)/s+1,a),f=Pg((t-o+b+T)/r+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:u,outHeight:h,outWidth:f}}function fpe(n,e,t,s,r,i,o,a,l,u,h){let f,p,g,b;if(n==="valid"&&(n=0),typeof n=="number"){f={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const w=hpe([e,t,s,1],[a,l,u],1,[r,i,o],n,h);p=w[0],g=w[1],b=w[2]}else if(n==="same"){p=Math.ceil(e/r),g=Math.ceil(t/i),b=Math.ceil(s/o);const T=(p-1)*r+a-e,w=(g-1)*i+l-t,_=(b-1)*o+u-s,C=Math.floor(T/2),N=T-C,A=Math.floor(w/2),P=w-A,V=Math.floor(_/2),D=_-V;f={top:A,bottom:P,left:V,right:D,front:C,back:N,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:f,outDepth:p,outHeight:g,outWidth:b}}function Pg(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Fg(n){const[e,t,s]=Og(n);return e===1&&t===1&&s===1}function Ol(n,e){return Fg(n)||Fg(e)}function Fh(n){return Og(n).every(e=>e>0)}function yH(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function to(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")Y(Gf(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{Y(Gf(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ppe(n,e){const s={x:H(n,"x","reshape","string_or_numeric")},r={shape:e};return Z.runKernel(PG,s,r)}const ke=j({reshape_:ppe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mpe(n,e,t,s,r){const i=H(n,"x","avgPool","float32"),o=1;Y(Ol(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=ke(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Y(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),to("avgPool",s,r);const u={x:a},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let f=Z.runKernel(jU,u,h);return f=vn(f,i.dtype),l?ke(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const jN=j({avgPool_:mpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gpe(n,e,t,s,r,i="NDHWC"){const o=H(n,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=ke(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Y(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),Y(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Y(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),to("avgPool3d",s,r);const u={x:a},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i};let f=Z.runKernel(QU,u,h);return f=vn(f,a.dtype),l?ke(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const bH=j({avgPool3d_:gpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ype(n,e=0){Y(n.length>=1,()=>"Pass at least one tensor to concat");const t=Mg(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return ml(t[0]);const s=t,r={axis:e};return Z.runKernel(lz,s,r)}const sr=j({concat_:ype});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bpe(n,e,t=!1,s=!1){let r=H(n,"a","matMul"),i=H(e,"b","matMul");[r,i]=Un(r,i);const o={a:r,b:i},a={transposeA:t,transposeB:s};return Z.runKernel(ZU,o,a)}const tn=j({matMul_:bpe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vpe(n){const t={x:H(n,"x","sigmoid","float32")};return Z.runKernel(QG,t)}const _h=j({sigmoid_:vpe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wpe(n,e,t){const s=H(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:e,size:t};return Z.runKernel(XG,r,i)}const hn=j({slice_:wpe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tpe(n){const t={x:H(n,"x","tanh","float32")};return Z.runKernel(b6,t)}const Bv=j({tanh_:Tpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xpe(n,e,t,s,r,i){const o=H(n,"forgetBias","basicLSTMCell"),a=H(e,"lstmKernel","basicLSTMCell"),l=H(t,"lstmBias","basicLSTMCell"),u=H(s,"data","basicLSTMCell"),h=H(r,"c","basicLSTMCell"),f=H(i,"h","basicLSTMCell"),p=sr([u,f],1),g=tn(p,a),b=ot(g,l),T=b.shape[0],w=b.shape[1]/4,_=[T,w],C=hn(b,[0,0],_),N=hn(b,[0,w],_),A=hn(b,[0,w*2],_),P=hn(b,[0,w*3],_),V=ot(Ue(_h(C),Bv(N)),Ue(h,_h(ot(o,A)))),D=Ue(Bv(V),_h(P));return[V,D]}const vH=j({basicLSTMCell_:xpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Spe(n,e,t){const s=H(n,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);Y(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),Y(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),Y(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const i={x:s},o={blockShape:e,crops:t};return Z.runKernel(ez,i,o)}const QN=j({batchToSpaceND_:Spe});function _pe(n){let e;return n.rank===0||n.rank===1?e=ke(n,[1,1,1,n.size]):n.rank===2?e=ke(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ke(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Epe(n,e,t,s,r,i){i==null&&(i=.001);const o=H(n,"x","batchNorm"),a=H(e,"mean","batchNorm"),l=H(t,"variance","batchNorm");let u;r!=null&&(u=H(r,"scale","batchNorm"));let h;s!=null&&(h=H(s,"offset","batchNorm")),Y(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),Y(h==null||a.rank===h.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),Y(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const p={x:_pe(o),scale:u,offset:h,mean:a,variance:l},g={varianceEpsilon:i},b=Z.runKernel(Vz,p,g);return ke(b,o.shape)}const wy=j({batchNorm_:Epe});function Ipe(n,e,t,s,r,i){const o=H(n,"x","batchNorm"),a=H(e,"mean","batchNorm"),l=H(t,"variance","batchNorm");let u;r!=null&&(u=H(r,"scale","batchNorm"));let h;return s!=null&&(h=H(s,"offset","batchNorm")),Y(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),Y(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),Y(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&Y(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),h!=null&&Y(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${h.rank}.`),wy(o,a,l,h,u,i)}const wH=j({batchNorm2d_:Ipe});function Cpe(n,e,t,s,r,i){const o=H(n,"x","batchNorm"),a=H(e,"mean","batchNorm"),l=H(t,"variance","batchNorm");let u;r!=null&&(u=H(r,"scale","batchNorm"));let h;return s!=null&&(h=H(s,"offset","batchNorm")),Y(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),Y(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),Y(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&Y(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),h!=null&&Y(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${h.rank}.`),wy(o,a,l,h,u,i)}const TH=j({batchNorm3d_:Cpe});function Npe(n,e,t,s,r,i){const o=H(n,"x","batchNorm"),a=H(e,"mean","batchNorm"),l=H(t,"variance","batchNorm");let u;r!=null&&(u=H(r,"scale","batchNorm"));let h;return s!=null&&(h=H(s,"offset","batchNorm")),Y(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),Y(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),Y(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&Y(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),h!=null&&Y(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${h.rank}.`),wy(o,a,l,h,u,i)}const xH=j({batchNorm4d_:Npe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ape(n,e,t){const s=H(n,"x","bincount"),r=H(e,"weights","bincount");Y(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),Y(t>=0,()=>`size must be non-negative, but got ${t}.`),Y(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},o={size:t};return Z.runKernel(tz,i,o)}const ZN=j({bincount_:Ape});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kpe(n,e){const t=H(n,"x","bitwiseAnd"),s=H(e,"y","bitwiseAnd");if(!Mo(t.shape,s.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${t.shape}, y: ${s.shape}`);if(t.dtype!=="int32"||s.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${t.dtype} and type of y: ${s.dtype}`);const r={a:t,b:s};return Z.runKernel(nz,r)}const SH=j({bitwiseAnd_:kpe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $pe(n,e){const t=H(n,"s0","broadcastArgs","int32"),s=H(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${t.rank}`);if(s.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${s.rank}`);const r={s0:t,s1:s};return Z.runKernel(sz,r)}const _H=j({broadcastArgs_:$pe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rpe(n,e){let t=H(n,"broadcastTo","x");const s=t.shape;if(ci(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const u=t.shape.slice();for(;u.length<e.length;)u.unshift(1);t=ke(t,u)}const r=t.shape,i=Array.from(e);for(let u=e.length-1;u>=0;u--)if(r[u]===e[u])i[u]=1;else if(t.shape[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(i.map((u,h)=>u>1?h:-1).filter(u=>u>=0).length===0)return ml(t);const a={x:t},l={reps:i};return Z.runKernel(BN,a,l)}const mg=j({broadcastTo_:Rpe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dpe(n){const t={x:H(n,"x","ceil","float32")};return Z.runKernel(rz,t)}const EH=j({ceil_:Dpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wp(n,e,t){ci(n),t=t||my(e);const s={shape:n,value:e,dtype:t};return Z.runKernel(Oz,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mpe(n,e,t){const s=H(n,"x","clipByValue");if(Y(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return wp(s.shape,e,s.dtype);const r={x:s},i={clipValueMin:e,clipValueMax:t};return Z.runKernel(iz,r,i)}const IH=j({clipByValue_:Mpe});function Ope(n){return sr(n,0)}const CH=j({concat1d_:Ope});function Ppe(n,e){return sr(n,e)}const NH=j({concat2d_:Ppe});function Fpe(n,e){return sr(n,e)}const AH=j({concat3d_:Fpe});function Lpe(n,e){return sr(n,e)}const kH=j({concat4d_:Lpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vpe(n,e,t,s,r="NHWC",i=[1,1],o){const a=H(n,"x","conv2d","float32"),l=H(e,"filter","conv2d","float32");let u=a,h=!1;a.rank===3&&(h=!0,u=ke(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Y(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),Y(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),to("conv2d",s,o);const f=r==="NHWC"?u.shape[3]:u.shape[1];Y(f===l.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${l.shape[2]}.`),Y(Ol(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),Y(Fh(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),Y(Fh(t),()=>"Error in conv2D: Strides should be larger than 0.");const p={x:u,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},b=Z.runKernel(uz,p,g);return h?ke(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const Ty=j({conv2d_:Vpe});function Bpe(n,e,t,s,r="NWC",i=1,o){const a=H(n,"x","conv1d"),l=H(e,"filter","conv1d");let u=a,h=!1;a.rank===2&&(h=!0,u=ke(a,[1,a.shape[0],a.shape[1]])),Y(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),Y(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),to("conv1d",s,o),Y(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),Y(Ol(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),Y(Fh(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),Y(Fh(t),()=>"Error in conv1D: Stride should be larger than 0."),Y(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const f=ke(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=ke(u,[u.shape[0],1,u.shape[1],u.shape[2]]),w=Ty(p,f,[1,t],s,"NHWC",[1,i],o);return h?ke(w,[w.shape[2],w.shape[3]]):ke(w,[w.shape[0],w.shape[2],w.shape[3]])}const $H=j({conv1d_:Bpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Upe(n,e,t,s,r,i="NHWC",o){Y(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,l=e,u=!1;e.rank===3&&(u=!0,l=ke(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),Y(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),Y(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),Y(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const h=i==="NHWC"?a[3]:a[1],f=i==="NHWC"?l.shape[3]:l.shape[1];Y(h===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${h}) must match input depth for filter ${t.shape[2]}.`),Y(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),to("conv2dDerInput",r,o);const p={dy:l,filter:t},g={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,inputShape:a},b=Z.runKernel(hz,p,g);return u?ke(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const RH=j({conv2DBackpropInput_:Upe});function zpe(n,e,t,s,r,i){const o=H(n,"x","conv2dTranspose"),a=H(e,"filter","conv2dTranspose");return RH(t,o,a,s,r,"NHWC",i)}const DH=j({conv2dTranspose_:zpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gpe(n,e,t,s,r="NDHWC",i=[1,1,1]){const o=H(n,"x","conv3d"),a=H(e,"filter","conv3d");let l=o,u=!1;o.rank===4&&(u=!0,l=ke(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Y(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),Y(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),Y(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),Y(Ol(t,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),Y(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),Y(Fh(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),Y(Fh(t),()=>"Error in conv3D: Strides should be larger than 0.");const h={x:l,filter:a},f={strides:t,pad:s,dataFormat:r,dilations:i},p=Z.runKernel(dz,h,f);return u?ke(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const MH=j({conv3d_:Gpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hpe(n,e,t,s,r){Y(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,o=e,a=!1;e.rank===4&&(a=!0,o=ke(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);const l=i[4],u=o.shape[4];Y(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),Y(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),Y(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),Y(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),Y(u===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${t.shape[4]}.`);const h={dy:o,filter:t},f={pad:r,strides:s,inputShape:i},p=Z.runKernel(fz,h,f);return a?ke(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const qpe=j({conv3DBackpropInput_:Hpe});function Wpe(n,e,t,s,r){const i=H(n,"x","conv3dTranspose"),o=H(e,"filter","conv3dTranspose");return qpe(t,i,o,s,r)}const OH=j({conv3dTranspose_:Wpe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kpe(n){const t={x:H(n,"x","cos","float32")};return Z.runKernel(pz,t)}const PH=j({cos_:Kpe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xpe(n){const t={x:H(n,"x","cosh","float32")};return Z.runKernel(mz,t)}const FH=j({cosh_:Xpe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ype(n,e=0,t=!1,s=!1){const i={x:H(n,"x","cumprod")},o={axis:e,exclusive:t,reverse:s};return Z.runKernel(gz,i,o)}const LH=j({cumprod_:Ype});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jpe(n,e=0,t=!1,s=!1){const i={x:H(n,"x","cumsum")},o={axis:e,exclusive:t,reverse:s};return Z.runKernel(yz,i,o)}const VH=j({cumsum_:Jpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jpe(n,e,t,s=!1){const r=H(n,"x","denseBincount"),i=H(e,"weights","denseBincount");Y(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),Y(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),Y(t>=0,()=>`size must be non-negative, but got ${t}.`),Y(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},a={size:t,binaryOutput:s};return Z.runKernel(vz,o,a)}const BH=j({denseBincount_:jpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qpe(n,e,t="NHWC"){const s=H(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],i=t==="NHWC"?s.shape[2]:s.shape[3],o=t==="NHWC"?s.shape[3]:s.shape[1];Y(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),Y(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),Y(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${s.shape}`),Y(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:t};return Z.runKernel(wz,a,l)}const UH=j({depthToSpace_:Qpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zpe(n,e,t,s,r="NHWC",i=[1,1],o){const a=H(n,"x","depthwiseConv2d","float32"),l=H(e,"filter","depthwiseConv2d","float32");let u=a,h=!1;a.rank===3&&(h=!0,u=ke(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Y(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),Y(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const f=r==="NHWC"?u.shape[3]:u.shape[1];Y(f===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${l.shape[2]}.`),to("depthwiseConv2d",s,o);const p={x:u,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},b=Z.runKernel(Tz,p,g);return h?ke(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const jw=j({depthwiseConv2d_:Zpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eme(n){const t={x:H(n,"x","diag")};return Z.runKernel(_z,t)}const zH=j({diag_:eme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tme(n,e,t,s,r=[1,1],i="NHWC"){const o=H(n,"x","dilation2d"),a=H(e,"filter","dilation2d");Y(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),Y(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),Y(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,u=!1;o.rank===3&&(l=ke(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0),Y(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const h={x:l,filter:a},f={strides:t,pad:s,dilations:r},p=Z.runKernel(Ez,h,f);return u?ke(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const GH=j({dilation2d_:tme});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HH(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const i=t-1-r,o=n[i]||1;(e[e.length-1-r]||1)>1&&o===1&&s.unshift(i)}return s}function eA(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],i=e.length-s-1,o=e[i];(r==null||r===1&&o>1)&&t.unshift(i)}return t}function is(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let r=0;r<t;r++){let i=n[n.length-r-1];i==null&&(i=1);let o=e[e.length-r-1];if(o==null&&(o=1),i===1)s[t-r-1]=o;else if(o===1)s[t-r-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else s[t-r-1]=i}return s}const nme=Object.freeze(Object.defineProperty({__proto__:null,assertAndGetBroadcastShape:is,getBroadcastDims:HH,getReductionAxes:eA},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sme(n,e){let t=H(n,"a","equal","string_or_numeric"),s=H(e,"b","equal","string_or_numeric");[t,s]=Un(t,s),is(t.shape,s.shape);const r={a:t,b:s};return Z.runKernel(kz,r)}const tA=j({equal_:sme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rme(n,e,t){const s=H(e,"a","where"),r=H(t,"b","where"),i=H(n,"condition","where","bool"),o=is(is(i.shape,s.shape),r.shape),a=mg(i,o),l=mg(s,o),u=mg(r,o),h={condition:a,t:l,e:u};return Z.runKernel(WG,h)}const gl=j({where_:rme});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ime(n){const t={x:H(n,"x","zerosLike")};return Z.runKernel(_6,t)}const oi=j({zerosLike_:ime});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ome(n,e){let t=H(n,"a","div"),s=H(e,"b","div");[t,s]=Un(t,s);const r=In(t,s),i=oi(r),o=tA(s,i);return gl(o,i,r)}const qH=j({divNoNan_:ome});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ame(n,e){const t=H(n,"t1","dot"),s=H(e,"t2","dot");Y((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],i=s.rank===1?s.size:s.shape[0];if(Y(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),t.rank===1&&s.rank===1){const o=ke(t,[1,-1]),a=ke(s,[-1,1]),l=tn(o,a);return ke(l,[])}else if(t.rank===1&&s.rank===2){const o=ke(t,[1,-1]),a=ke(s,[s.shape[0],s.shape[1]]),l=tn(o,a);return ke(l,[l.size])}else if(t.rank===2&&s.rank===1){const o=ke(s,[-1,1]),a=tn(t,o);return ke(a,[a.size])}else{const o=ke(s,[s.shape[0],s.shape[1]]);return tn(t,o)}}const WH=j({dot_:ame});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lme(n,...e){const t=e.map((r,i)=>H(r,`tensors${i}`,"einsum")),s={equation:n};return Z.runKernel(Cz,t,s)}const fh=j({einsum_:lme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ume(n){const t={x:H(n,"x","elu","float32")};return Z.runKernel(Nz,t)}const nA=j({elu_:ume});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cme(n,e){const t=H(n,"x","ensureShape","string_or_numeric");if(!CU(t.shape,e))throw new Error(`EnsureShape: Shape of tensor ${t.shape} is not compatible with expected shape ${e}`);return n}const KH=j({ensureShape_:cme});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hme(n){let e=H(n,"x","erf");Y(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=vn(e,"float32"));const t={x:e};return Z.runKernel(Az,t)}const XH=j({erf_:hme});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sA(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function YH(n,e,t){const s=n.length+e.length,r=[];let i=0,o=0;for(let a=0;a<s;a++)t.indexOf(a)===-1?r.push(n[i++]):r.push(e[o++]);return r}function dme(n,e){const t=[],s=n.length;for(let i=0;i<s;i++)e.indexOf(i)===-1&&t.push(n[i]);const r=e.map(i=>n[i]);return[t,r]}function xy(n,e){const t=e.map(s=>1);return YH(n,t,e)}function fme(n,e,t){Y(sA(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function pme(n,e){if(sA(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function mme(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function gme(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yme(n,e=null,t=!1){const r={x:H(n,"x","max")},i={reductionIndices:e,keepDims:t};return Z.runKernel(iG,r,i)}const Eh=j({max_:yme});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bme(n,e=null,t=!1){const r={x:H(n,"x","min")},i={axis:e,keepDims:t};return Z.runKernel(hG,r,i)}const Uv=j({min_:bme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vme(n,e){let t=H(n,"base","pow"),s=H(e,"exp","pow");[t,s]=Un(t,s);const r={a:t,b:s};return Z.runKernel(IG,r)}const qf=j({pow_:vme});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ot(n,e){if((Ns(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Ns(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return vc(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wme(n){const t={x:H(n,"x","sqrt","float32")};return Z.runKernel(e6,t)}const ka=j({sqrt_:wme});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tme(n){const e=H(n,"x","square"),t={};return Z.runKernel("Square",{x:e},t)}const ji=j({square_:Tme});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xme(n,e=null,t=!1){let s=H(n,"x","sum");s.dtype==="bool"&&(s=vn(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return Z.runKernel(t6,r,i)}const En=j({sum_:xme});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sme(n,e="euclidean",t=null,s=!1){n=H(n,"x","norm");const r=JH(n,e,t);let i=r.shape;if(s){const o=py(t,n.shape);i=xy(r.shape,o)}return ke(r,i)}function JH(n,e,t=null){if(n.rank===0)return ni(n);if(n.rank!==1&&t===null)return JH(ke(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return En(ni(n),t);if(e===1/0)return Eh(ni(n),t);if(e===-1/0)return Uv(ni(n),t);if(e==="euclidean"||e===2)return ka(En(qf(ni(n),Ot(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Eh(En(ni(n),t[0]),t[1]-1);if(e===1/0)return Eh(En(ni(n),t[1]),t[0]);if(e===-1/0)return Uv(En(ni(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return ka(En(ji(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const Sy=j({norm_:Sme});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _me(n,e=null,t=!1){return Sy(n,"euclidean",e,t)}const jH=j({euclideanNorm_:_me});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eme(n){const t={x:H(n,"x","exp")};return Z.runKernel($z,t)}const oc=j({exp_:Eme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ime(n,e=0){const t=H(n,"x","expandDims","string_or_numeric");Y(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return Z.runKernel(Rz,s,r)}const il=j({expandDims_:Ime});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cme(n){const t={x:H(n,"x","expm1")};return Z.runKernel(Dz,t)}const QH=j({expm1_:Cme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nme(n,e){const t=H(n,"x","tile","string_or_numeric");Y(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return Z.runKernel(BN,s,r)}const Nf=j({tile_:Nme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ame(n,e,t,s="float32"){e==null&&(e=n);const r=Aa([n,e],s),i=n<=e?n:e;for(let a=0;a<i;++a)r.set(1,a,a);const o=ke(r.toTensor(),[n,e]);if(t==null)return o;if(t.length===1)return Nf(il(o,0),[t[0],1,1]);if(t.length===2)return Nf(il(il(o,0),0),[t[0],t[1],1,1]);if(t.length===3)return Nf(il(il(il(o,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const rA=j({eye_:Ame});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kme(n){const t={x:H(n,"x","floor","float32")};return Z.runKernel(Fz,t)}const iA=j({floor_:kme});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $me(n,e,t=0,s=0){const r=H(n,"x","gather"),i=H(e,"indices","gather","int32"),o={x:r,indices:i},a={axis:t,batchDims:s};return Z.runKernel(Bz,o,a)}const oA=j({gather_:$me});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rme(n,e){let t=H(n,"a","greater","string_or_numeric"),s=H(e,"b","greater","string_or_numeric");[t,s]=Un(t,s),is(t.shape,s.shape);const r={a:t,b:s};return Z.runKernel(zz,r)}const _y=j({greater_:Rme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dme(n,e){let t=H(n,"a","greaterEqual","string_or_numeric"),s=H(e,"b","greaterEqual","string_or_numeric");[t,s]=Un(t,s),is(t.shape,s.shape);const r={a:t,b:s};return Z.runKernel(Gz,r)}const aA=j({greaterEqual_:Dme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mme(n){const t={input:H(n,"input","imag")};return Z.runKernel(qz,t)}const Ey=j({imag_:Mme});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ome(n){const t={x:H(n,"x","isFinite")};return Z.runKernel(Wz,t)}const ZH=j({isFinite_:Ome});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pme(n){const t={x:H(n,"x","isInf")};return Z.runKernel(Kz,t)}const eq=j({isInf_:Pme});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fme(n){const t={x:H(n,"x","isNaN")};return Z.runKernel(Xz,t)}const tq=j({isNaN_:Fme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lme(n,e=.2){const s={x:H(n,"x","leakyRelu")},r={alpha:e};return Z.runKernel(Yz,s,r)}const lA=j({leakyRelu_:Lme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vme(n,e){let t=H(n,"a","less","string_or_numeric"),s=H(e,"b","less","string_or_numeric");[t,s]=Un(t,s),is(t.shape,s.shape);const r={a:t,b:s};return Z.runKernel(Jz,r)}const zv=j({less_:Vme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bme(n,e){let t=H(n,"a","lessEqual","string_or_numeric"),s=H(e,"b","lessEqual","string_or_numeric");[t,s]=Un(t,s),is(t.shape,s.shape);const r={a:t,b:s};return Z.runKernel(jz,r)}const Qw=j({lessEqual_:Bme});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nq(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");const s={start:n,stop:e,num:t};return Z.runKernel(Qz,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ume(n,e=5,t=1,s=1,r=.5){const i=H(n,"x","localResponseNormalization");Y(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),Y(Gf(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=ke(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},u={depthRadius:e,bias:t,alpha:s,beta:r},h=Z.runKernel(rG,l,u);return a?ke(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const sq=j({localResponseNormalization_:Ume});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zme(n){const t={x:H(n,"x","log","float32")};return Z.runKernel(Zz,t)}const Wf=j({log_:zme});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gme(n){const t={x:H(n,"x","log1p")};return Z.runKernel(eG,t)}const uA=j({log1p_:Gme});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hme(n){return Y(tc(n),()=>"The f passed in grad(f) must be a function"),(e,t)=>{const s=H(e,"x","tf.grad","string_or_numeric"),r=t!=null?H(t,"dy","tf.grad"):null;return Z.tidy(()=>{const{value:i,grads:o}=Z.gradients(()=>n(s),[s],r);return r!=null&&Ir(i.shape,r.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Zw(o),o[0]})}}function qme(n){return Y(tc(n),()=>"The f passed in grads(f) must be a function"),(e,t)=>{Y(Array.isArray(e),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const s=Mg(e,"args","tf.grads","string_or_numeric"),r=t!=null?H(t,"dy","tf.grads"):null;return Z.tidy(()=>{const{value:i,grads:o}=Z.gradients(()=>n(...s),s,r);return r!=null&&Ir(i.shape,r.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Zw(o),o})}}function Wme(n){return Y(tc(n),()=>"The f passed in valueAndGrad(f) must be a function"),(e,t)=>{Y(e instanceof Vn,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),Y(t==null||t instanceof Vn,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:s,value:r}=Z.gradients(()=>n(e),[e],t);return Zw(s),{grad:s[0],value:r}}}function Kme(n){return Y(tc(n),()=>"The f passed in valueAndGrads(f) must be a function"),(e,t)=>{Y(Array.isArray(e)&&e.every(r=>r instanceof Vn),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),Y(t==null||t instanceof Vn,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const s=Z.gradients(()=>n(...e),e,t);return t!=null&&Ir(s.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Zw(s.grads),s}}function rq(n,e){Y(tc(n),()=>"The f passed in variableGrads(f) must be a function"),Y(e==null||Array.isArray(e)&&e.every(u=>u instanceof Dg),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const u in Z.registeredVariables)e.push(Z.registeredVariables[u])}const s=t?e.filter(u=>!u.trainable):null,r=e.length;e=e.filter(u=>u.trainable),Y(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:o,grads:a}=Z.gradients(n,e,null,i);Y(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),Y(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((u,h)=>{a[h]!=null&&(l[u.name]=a[h])}),s!=null&&s.forEach(u=>l[u.name]=null),{value:o,grads:l}}function $a(n){return Z.customGrad(n)}function Zw(n){if(n.filter(t=>t==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xme(n){const t={x:H(n,"x","neg")};return Z.runKernel(yG,t)}const Ao=j({neg_:Xme});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yme(n){const t={x:H(n,"x","softplus")};return Z.runKernel(ZG,t)}const cA=j({softplus_:Yme});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jme(n){const e=H(n,"x","logSigmoid");return $a(s=>({value:Ao(cA(Ao(s))),gradFunc:o=>Ue(o,_h(Ao(s)))}))(e)}const iq=j({logSigmoid_:Jme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jme(n,e){let t=H(n,"a","sub"),s=H(e,"b","sub");[t,s]=Un(t,s);const r={a:t,b:s};return Z.runKernel(g6,r)}const wt=j({sub_:jme});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qme(n,e=-1){const t=H(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return $a((r,i)=>{const a=Eh(r,e,!0),l=wt(r,a),u=wt(vn(l,"float32"),Wf(En(oc(l),e,!0)));return i([u]),{value:u,gradFunc:(f,p)=>{const[g]=p,b=!0,T=oc(g);return wt(f,Ue(En(f,e,b),T))}}})(t)}const oq=j({logSoftmax_:Qme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zme(n,e=null,t=!1){const s=H(n,"x","logSumExp"),r=py(e,s.shape),i=Eh(s,r,!0),o=wt(s,i),a=oc(o),l=En(a,r),u=Wf(l),h=ot(ke(i,u.shape),u);if(t){const f=xy(h.shape,r);return ke(h,f)}return h}const hA=j({logSumExp_:Zme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ege(n,e){const t=H(n,"a","logicalAnd","bool"),s=H(e,"b","logicalAnd","bool");is(t.shape,s.shape);const r={a:t,b:s};return Z.runKernel(tG,r)}const Lg=j({logicalAnd_:ege});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tge(n){const t={x:H(n,"x","logicalNot","bool")};return Z.runKernel(nG,t)}const dA=j({logicalNot_:tge});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nge(n,e){const t=H(n,"a","logicalOr","bool"),s=H(e,"b","logicalOr","bool");is(t.shape,s.shape);const r={a:t,b:s};return Z.runKernel(sG,r)}const fA=j({logicalOr_:nge});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sge(n,e){const t=H(n,"a","logicalXor","bool"),s=H(e,"b","logicalXor","bool");return is(t.shape,s.shape),Lg(fA(n,e),dA(Lg(n,e)))}const aq=j({logicalXor_:sge});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _1=2147483648;function rge(n,e,t="left"){const s=H(n,"sortedSequence","searchSorted"),r=H(e,"values","searchSorted"),i=s.shape[s.shape.length-1],o=r.shape[r.shape.length-1],a=ke(s,[-1,i]),l=ke(r,[-1,o]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(dn(l.shape)>=_1)throw new Error(`values tensor size must less than ${_1}`);if(a.shape[1]>=_1)throw new Error(`trailing dim_size must less than ${_1} for int32 output type, was ${a.shape[1]}`);const u={sortedSequence:a,values:l},h={side:t};return Z.runKernel(qG,u,h)}const eT=j({searchSorted_:rge});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lq(n,e){return eT(n,e,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ige(n,e,t,s,r){const i=H(n,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=ke(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Y(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),Y(Ol(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),to("maxPool",s,r);const u={x:a},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r},f=Z.runKernel(aG,u,h);return l?ke(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const pA=j({maxPool_:ige});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oge(n,e=[1,1,1],t,s,r,i="NDHWC"){const o=H(n,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=ke(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Y(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),Y(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),to("maxPool3d",s,r);const u={x:a},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i},f=Z.runKernel(lG,u,h);return l?ke(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const uq=j({maxPool3d_:oge});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function age(n,e,t,s,r=!1){const o={x:H(n,"x","maxPoolWithArgmax")},a={filterSize:e,strides:t,pad:s,includeBatchInIndex:r},l=Z.runKernel(uG,o,a);return{result:l[0],indexes:l[1]}}const cq=j({maxPoolWithArgmax_:age});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lge(n,e){let t=H(n,"a","maximum"),s=H(e,"b","maximum");[t,s]=Un(t,s),t.dtype==="bool"&&(t=vn(t,"int32"),s=vn(s,"int32")),is(t.shape,s.shape);const r={a:t,b:s};return Z.runKernel(oG,r)}const mA=j({maximum_:lge});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uge(n,e=null,t=!1){const r={x:H(n,"x","mean")},i={axis:e,keepDims:t};return Z.runKernel(cG,r,i)}const Vg=j({mean_:uge});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ac(n,e="float32"){if(ci(n),e==="complex64"){const s=ac(n,"float32"),r=ac(n,"float32");return El(s,r)}const t=Xw(dn(n),e);return Z.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ru(n,e="float32"){if(ci(n),e==="complex64"){const s=Ru(n,"float32"),r=ac(n,"float32");return El(s,r)}const t=DN(dn(n),e);return Z.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hq(n,e,{indexing:t="xy"}={}){if(t!=="xy"&&t!=="ij")throw new TypeError(`${t} is not a valid third argument to meshgrid`);if(n===void 0)return[];let s=H(n,"x","meshgrid",n instanceof Vn?n.dtype:"float32");if(e===void 0)return[s];let r=H(e,"y","meshgrid",e instanceof Vn?e.dtype:"float32");const i=dn(s.shape),o=dn(r.shape);return t==="xy"?(s=ke(s,[1,-1]),r=ke(r,[-1,1]),[tn(Ru([o,1],s.dtype),s),tn(r,Ru([1,i],r.dtype))]):(s=ke(s,[-1,1]),r=ke(r,[1,-1]),[tn(s,Ru([1,o],s.dtype)),tn(Ru([i,1],r.dtype),r)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cge(n,e){let t=H(n,"a","minimum"),s=H(e,"b","minimum");[t,s]=Un(t,s),t.dtype==="bool"&&(t=vn(t,"int32"),s=vn(s,"int32")),is(t.shape,s.shape);const r={a:t,b:s};return Z.runKernel(dG,r)}const Bg=j({minimum_:cge});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hge(n,e,t){Y(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=H(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");Y(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let a=0;a<s.rank;a++)Y(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Y(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:e,mode:t},o={x:s};return Z.runKernel(fG,o,i)}const dq=j({mirrorPad_:hge});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dge(n,e){let t=H(n,"a","mod"),s=H(e,"b","mod");[t,s]=Un(t,s);const r={a:t,b:s};return Z.runKernel(pG,r)}const fq=j({mod_:dge});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fge(n,e=null,t=!1){n=H(n,"x","moments");const s=py(e,n.shape),r=Vg(n,s,t);let i=r.shape;t||(i=xy(r.shape,s));const o=ji(wt(vn(n,"float32"),ke(r,i))),a=Vg(o,s,t);return{mean:r,variance:a}}const pq=j({moments_:fge});function pge(n,e,t,s){const r=H(e,"data","multiRNNCell"),i=Mg(t,"c","multiRNNCell"),o=Mg(s,"h","multiRNNCell");let a=r;const l=[];for(let f=0;f<n.length;f++){const p=n[f](a,i[f],o[f]);l.push(p[0]),l.push(p[1]),a=p[1]}const u=[],h=[];for(let f=0;f<l.length;f+=2)u.push(l[f]),h.push(l[f+1]);return[u,h]}const mq=j({multiRNNCell_:pge});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mge(n,e,t,s=!1){const r=H(n,"logits","multinomial"),i=r.size,o=r.rank;if(i<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${i}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);t=t||Math.random();const l={logits:o===1?ke(r,[1,-1]):r},u={numSamples:e,seed:t,normalized:s},h=Z.runKernel(mG,l,u);return o===1?ke(h,[h.size]):h}const gq=j({multinomial_:mge});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gge(n,e){let t=H(n,"a","notEqual","string_or_numeric"),s=H(e,"b","notEqual","string_or_numeric");[t,s]=Un(t,s),is(t.shape,s.shape);const r={a:t,b:s};return Z.runKernel(bG,r)}const gA=j({notEqual_:gge});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yge(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:H(n,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:t,offValue:s};return Z.runKernel(SG,o,a)}const Gv=j({oneHot_:yge});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bge(n){const t={x:H(n,"x","onesLike")};return Z.runKernel(xG,t)}const yq=j({onesLike_:bge});function vge(n,e){const t=H(n,"v1","outerProduct"),s=H(e,"v2","outerProduct");Y(t.rank===1&&s.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${t.rank} and ${s.rank}.`);const r=ke(t,[-1,1]),i=ke(s,[1,-1]);return tn(r,i)}const bq=j({outerProduct_:vge});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wge(n,e,t=0){const s=H(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},i={x:s};return Z.runKernel(EG,i,r)}const Tp=j({pad_:wge});function Tge(n,e,t=0){return Y(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),Tp(n,[e],t)}const vq=j({pad1d_:Tge});function xge(n,e,t=0){return Y(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Tp(n,e,t)}const wq=j({pad2d_:xge});function Sge(n,e,t=0){return Y(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Tp(n,e,t)}const Tq=j({pad3d_:Sge});function _ge(n,e,t=0){return Y(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Tp(n,e,t)}const xq=j({pad4d_:_ge});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ege(n,e,t){const s=H(n,"x","spaceToBatchND");Y(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),Y(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),Y(s.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+t[l-1][0]+t[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},i={blockShape:e,paddings:t};return Z.runKernel(n6,r,i)}const yA=j({spaceToBatchND_:Ege});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ige(n,e,t,s,r,i,o){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const a=H(n,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=ke(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Y(Ol(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const h=mH(l.shape,e,i,r,s),f=[h.dilationHeight,h.dilationWidth];let p;s==="same"?p=Nge([h.filterHeight,h.filterWidth],f):p=[[0,0],[0,0]];const g=f[0]===1&&f[1]===1,[b,T]=Cge([h.inHeight,h.inWidth],f,p),w=g?s:"valid",_=g?l:yA(l,f,b),N=(t==="avg"?()=>jN(_,e,i,w,o):()=>pA(_,e,i,w,o))(),A=g?N:QN(N,f,T);return u?ke(A,[A.shape[1],A.shape[2],A.shape[3]]):A}function Cge(n,e,t){const s=t.map(h=>h[0]),r=t.map(h=>h[1]),i=n.concat(s,r),o=e.map((h,f)=>(h-i[f]%h)%h),a=r.map((h,f)=>h+o[f]),l=e.map((h,f)=>[s[f],a[f]]),u=e.map((h,f)=>[0,o[f]]);return[l,u]}function Nge(n,e){const s=n.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),r=s.map(o=>Math.floor(o/2)),i=s.map((o,a)=>o-r[a]);return s.map((o,a)=>[r[a],i[a]])}const Sq=j({pool_:Ige});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Age(n,e){const t=H(n,"x","prelu"),s=H(e,"alpha","prelu"),r={x:t,alpha:s};return Z.runKernel(CG,r)}const bA=j({prelu_:Age});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kge(n,e=null,t=!1){let s=H(n,"x","prod");s.dtype==="bool"&&(s=vn(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return Z.runKernel(NG,r,i)}const _q=j({prod_:kge});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ge(n,e,t,s){const r=n.map((h,f)=>H(h,`tensors${f}`,"raggedGather","int32")),i=H(e,"paramsDenseValues","raggedGather"),o=H(t,"indices","raggedGather","int32"),a={paramsNestedSplits:r,paramsDenseValues:i,indices:o},l={outputRaggedRank:s},u=Z.runKernel(AG,a,l);return{outputNestedSplits:u.slice(0,u.length-1),outputDenseValues:u[u.length-1]}}const Eq=j({raggedGather_:$ge});/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rge(n,e,t){const s=H(n,"starts","raggedRange"),r=H(e,"limits","raggedRange",s.dtype),i=H(t,"deltas","raggedRange",s.dtype),o={starts:s,limits:r,deltas:i},a=Z.runKernel(kG,o);return{rtNestedSplits:a[0],rtDenseValues:a[1]}}const Iq=j({raggedRange_:Rge});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dge(n,e,t,s,r){const i=H(n,"shape","raggedTensorToTensor","int32"),o=H(e,"values","raggedTensorToTensor"),a=H(t,"defaultValue","raggedTensorToTensor",o.dtype),l=s.map((f,p)=>H(f,`tensors${p}`,"raggedTensorToTensor","int32")),u={shape:i,values:o,defaultValue:a,rowPartitionTensors:l},h={rowPartitionTypes:r};return Z.runKernel($G,u,h)}const Cq=j({raggedTensorToTensor_:Dge});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mge(n,e,t){ci(n);const s=dn(n);let r=null;if(t==null||t==="float32")r=new Float32Array(s);else if(t==="int32")r=new Int32Array(s);else if(t==="bool")r=new Uint8Array(s);else throw new Error(`Unknown data type ${t}`);for(let i=0;i<s;i++)r[i]=e();return Z.makeTensor(r,n,t)}const Nq=j({rand_:Mge});var ev={exports:{}},Oge=ev.exports,m3;function Pge(){return m3||(m3=1,(function(n){(function(e,t,s){function r(l){var u=this,h=a();u.next=function(){var f=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=f-(u.c=f|0)},u.c=1,u.s0=h(" "),u.s1=h(" "),u.s2=h(" "),u.s0-=h(l),u.s0<0&&(u.s0+=1),u.s1-=h(l),u.s1<0&&(u.s1+=1),u.s2-=h(l),u.s2<0&&(u.s2+=1),h=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var h=new r(l),f=u&&u.state,p=h.next;return p.int32=function(){return h.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,f&&(typeof f=="object"&&i(f,h),p.state=function(){return i(h,{})}),p}function a(){var l=4022871197,u=function(h){h=String(h);for(var f=0;f<h.length;f++){l+=h.charCodeAt(f);var p=.02519603282416938*l;l=p>>>0,p-=l,p*=l,l=p>>>0,p-=l,l+=p*4294967296}return(l>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=o:this.alea=o})(Oge,n)})(ev)),ev.exports}var tv={exports:{}},Fge=tv.exports,g3;function Lge(){return g3||(g3=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var f=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^f^f>>>8},a===(a|0)?l.x=a:u+=a;for(var h=0;h<u.length+64;h++)l.x^=u.charCodeAt(h)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new r(a),h=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,b=(p+g)/(1<<21);while(b===0);return b},f.int32=u.next,f.quick=f,h&&(typeof h=="object"&&i(h,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xor128=o})(Fge,n)})(tv)),tv.exports}var nv={exports:{}},Vge=nv.exports,y3;function Bge(){return y3||(y3=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.next=function(){var f=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(f^f<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var h=0;h<u.length+64;h++)l.x^=u.charCodeAt(h)|0,h==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new r(a),h=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,b=(p+g)/(1<<21);while(b===0);return b},f.int32=u.next,f.quick=f,h&&(typeof h=="object"&&i(h,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xorwow=o})(Vge,n)})(nv)),nv.exports}var sv={exports:{}},Uge=sv.exports,b3;function zge(){return b3||(b3=1,(function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var h=l.x,f=l.i,p,g;return p=h[f],p^=p>>>7,g=p^p<<24,p=h[f+1&7],g^=p^p>>>10,p=h[f+3&7],g^=p^p>>>3,p=h[f+4&7],g^=p^p<<7,p=h[f+7&7],p=p^p<<13,g^=p^p<<9,h[f]=g,l.i=f+1&7,g};function u(h,f){var p,g=[];if(f===(f|0))g[0]=f;else for(f=""+f,p=0;p<f.length;++p)g[p&7]=g[p&7]<<15^f.charCodeAt(p)+g[p+1&7]<<13;for(;g.length<8;)g.push(0);for(p=0;p<8&&g[p]===0;++p);for(p==8?g[7]=-1:g[p],h.x=g,h.i=0,p=256;p>0;--p)h.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),h=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,b=(p+g)/(1<<21);while(b===0);return b},f.int32=u.next,f.quick=f,h&&(h.x&&i(h,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xorshift7=o})(Uge,n)})(sv)),sv.exports}var rv={exports:{}},Gge=rv.exports,v3;function Hge(){return v3||(v3=1,(function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var h=l.w,f=l.X,p=l.i,g,b;return l.w=h=h+1640531527|0,b=f[p+34&127],g=f[p=p+1&127],b^=b<<13,g^=g<<17,b^=b>>>15,g^=g>>>12,b=f[p]=b^g,l.i=p,b+(h^h>>>16)|0};function u(h,f){var p,g,b,T,w,_=[],C=128;for(f===(f|0)?(g=f,f=null):(f=f+"\0",g=0,C=Math.max(C,f.length)),b=0,T=-32;T<C;++T)f&&(g^=f.charCodeAt((T+32)%f.length)),T===0&&(w=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,T>=0&&(w=w+1640531527|0,p=_[T&127]^=g+w,b=p==0?b+1:0);for(b>=128&&(_[(f&&f.length||0)&127]=-1),b=127,T=512;T>0;--T)g=_[b+34&127],p=_[b=b+1&127],g^=g<<13,p^=p<<17,g^=g>>>15,p^=p>>>12,_[b]=g^p;h.w=w,h.X=_,h.i=b}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),h=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,b=(p+g)/(1<<21);while(b===0);return b},f.int32=u.next,f.quick=f,h&&(h.X&&i(h,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xor4096=o})(Gge,n)})(rv)),rv.exports}var iv={exports:{}},qge=iv.exports,w3;function Wge(){return w3||(w3=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.next=function(){var f=l.b,p=l.c,g=l.d,b=l.a;return f=f<<25^f>>>7^p,p=p-g|0,g=g<<24^g>>>8^b,b=b-f|0,l.b=f=f<<20^f>>>12^p,l.c=p=p-g|0,l.d=g<<16^p>>>16^b,l.a=b-f|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var h=0;h<u.length+20;h++)l.b^=u.charCodeAt(h)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new r(a),h=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,b=(p+g)/(1<<21);while(b===0);return b},f.int32=u.next,f.quick=f,h&&(typeof h=="object"&&i(h,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.tychei=o})(qge,n)})(iv)),iv.exports}var ov={exports:{}};const Kge={},Xge=Object.freeze(Object.defineProperty({__proto__:null,default:Kge},Symbol.toStringTag,{value:"Module"})),Yge=mj(Xge);var Jge=ov.exports,T3;function jge(){return T3||(T3=1,(function(n){(function(e,t,s){var r=256,i=6,o=52,a="random",l=s.pow(r,i),u=s.pow(2,o),h=u*2,f=r-1,p;function g(A,P,V){var D=[];P=P==!0?{entropy:!0}:P||{};var M=_(w(P.entropy?[A,N(t)]:A??C(),3),D),$=new b(D),O=function(){for(var k=$.g(i),z=l,U=0;k<u;)k=(k+U)*r,z*=r,U=$.g(1);for(;k>=h;)k/=2,z/=2,U>>>=1;return(k+U)/z};return O.int32=function(){return $.g(4)|0},O.quick=function(){return $.g(4)/4294967296},O.double=O,_(N($.S),t),(P.pass||V||function(k,z,U,te){return te&&(te.S&&T(te,$),k.state=function(){return T($,{})}),U?(s[a]=k,z):k})(O,M,"global"in P?P.global:this==s,P.state)}function b(A){var P,V=A.length,D=this,M=0,$=D.i=D.j=0,O=D.S=[];for(V||(A=[V++]);M<r;)O[M]=M++;for(M=0;M<r;M++)O[M]=O[$=f&$+A[M%V]+(P=O[M])],O[$]=P;(D.g=function(k){for(var z,U=0,te=D.i,se=D.j,X=D.S;k--;)z=X[te=f&te+1],U=U*r+X[f&(X[te]=X[se=f&se+z])+(X[se]=z)];return D.i=te,D.j=se,U})(r)}function T(A,P){return P.i=A.i,P.j=A.j,P.S=A.S.slice(),P}function w(A,P){var V=[],D=typeof A,M;if(P&&D=="object")for(M in A)try{V.push(w(A[M],P-1))}catch{}return V.length?V:D=="string"?A:A+"\0"}function _(A,P){for(var V=A+"",D,M=0;M<V.length;)P[f&M]=f&(D^=P[f&M]*19)+V.charCodeAt(M++);return N(P)}function C(){try{var A;return p&&(A=p.randomBytes)?A=A(r):(A=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(A)),N(A)}catch{var P=e.navigator,V=P&&P.plugins;return[+new Date,e,V,e.screen,N(t)]}}function N(A){return String.fromCharCode.apply(0,A)}if(_(s.random(),t),n.exports){n.exports=g;try{p=Yge}catch{}}else s["seed"+a]=g})(typeof self<"u"?self:Jge,[],Math)})(ov)),ov.exports}var iE,x3;function Qge(){if(x3)return iE;x3=1;var n=Pge(),e=Lge(),t=Bge(),s=zge(),r=Hge(),i=Wge(),o=jge();return o.alea=n,o.xor128=e,o.xorwow=t,o.xorshift7=s,o.xor4096=r,o.tychei=i,iE=o,iE}var xp=Qge();/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zge=.001,Aq=.1;function eye(n,e,t){return t==null&&(t=vA()),CI(n,e,(s,r)=>wA(s,r,t))}function vA(){return Z.backend.floatPrecision()===32?Zge:Aq}function CI(n,e,t){let s=!0;if((Ns(n)||Ns(e))&&(s=!1),Ns(n)&&Ns(e)&&(s=!0),s){const o=n.constructor.name,a=e.constructor.name;if(o!==a)throw new Error(`Arrays are of different type. Actual: ${o}. Expected: ${a}`)}if(Array.isArray(n)&&Array.isArray(e)){const o=Na(n),a=Na(e);if(!Mo(o,a))throw new Error(`Arrays have different shapes. Actual: [${o}]. Expected: [${a}]`)}const r=Ns(n)?n:sc(n),i=Ns(e)?e:sc(e);if(r.length!==i.length)throw new Error(`Arrays have different lengths actual: ${r.length} vs expected: ${i.length}.
Actual:   ${r}.
Expected: ${i}.`);for(let o=0;o<i.length;++o){const a=r[o],l=i[o];if(!t(a,l))throw new Error(`Arrays differ: actual[${o}] = ${a}, expected[${o}] = ${l}.
Actual:   ${r}.
Expected: ${i}.`)}typeof expect<"u"&&expect().nothing()}function tye(n,e){n().then(()=>e.fail(),()=>e()),typeof expect<"u"&&expect().nothing()}function nye(n,e){const t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return ku(n)||ku(n[0])||ku(e)||ku(e[0])?CI(n,t,(s,r)=>s==r):CI(n,e,(s,r)=>wA(s,r,0))}function sye(n,e,t){if(t==null&&(t=vA()),!wA(n,e,t))throw new Error(`Numbers differ: actual === ${n}, expected === ${e}`);typeof expect<"u"&&expect().nothing()}function wA(n,e,t){return!isFinite(n)&&!isFinite(e)?!0:!(isNaN(n)||isNaN(e)||Math.abs(n-e)>t)}function rye(n,e,t){for(let s=0;s<n.length;s++)if(n[s]<e||n[s]>t)throw new Error(`Value out of range:${n[s]} low: ${e}, high: ${t}`)}function iye(n,e){const t=new Float32Array(n),s=new Float32Array(e);if(t.length!==s.length)throw new Error(`Expected ArrayBuffer to be of length ${s.length}, but it was ${t.length}`);for(let r=0;r<s.length;r++)if(t[r]!==s[r])throw new Error(`Expected ArrayBuffer value at ${r} to be ${s[r]} but got ${t[r]} instead`)}function kq(n){for(let e=0;e<n.length;e++){const t=n[e];Array.isArray(t)?kq(t):n[e]=yy(t)}return n}function oye(n){const e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(n),new Promise(t=>{e.addEventListener("loadeddata",s=>t(e)),e.load()})}async function aye(n){await n.play(),"requestVideoFrameCallback"in n&&await new Promise(e=>{n.requestVideoFrameCallback(e)})}const lye=Object.freeze(Object.defineProperty({__proto__:null,TEST_EPSILON_FLOAT16:Aq,createVideoElement:oye,encodeStrings:kq,expectArrayBuffersEqual:iye,expectArraysClose:eye,expectArraysEqual:nye,expectNumbersClose:sye,expectPromiseToFail:tye,expectValuesInRange:rye,play:aye,testEpsilon:vA},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let TA=class{constructor(e,t,s,r,i){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=xp.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,i,o;do r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*r*a,t=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}};class uye{constructor(e,t,s,r){this.alpha=e,this.beta=1/t,this.dtype=s;const i=r||Math.random();this.randu=xp.alea(i.toString()),this.randn=new TA(0,1,s,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,s,r,i,o;for(;;){do r=this.randn.nextValue(),o=1+this.c*r;while(o<=0);if(o*=o*o,e=r*r,t=1-.331*e*e,s=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<s)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}}let cye=class{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=xp.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hye(n,e,t=1,s="float32",r){if(ci(n),t==null&&(t=1),s==null&&(s="float32"),s!=="float32"&&s!=="int32")throw new Error(`Unsupported data type ${s}`);const i=new uye(e,t,s,r),o=Aa(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const $q=j({randomGamma_:hye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dye(n,e=0,t=1,s,r){if(ci(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new TA(e,t,s,!1,r),o=Aa(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const xA=j({randomNormal_:dye});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fye(n,e,t){if(e!=null&&e==="bool")throw new Error(`Unsupported data type ${e}`);return xA(n,0,1,e,t)}const Rq=j({randomStandardNormal_:fye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pye(n,e=0,t=1,s="float32",r){ci(n);const i=Aa(n,s),o=new cye(e,t,null,r);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const tT=j({randomUniform_:pye});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mye(n,e,t,s){return tT(n,e,t,"int32",s)}const Dq=j({randomUniformInt_:mye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kf(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return Z.runKernel(RG,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gye(n){const t={input:H(n,"input","real")};return Z.runKernel(DG,t)}const Xf=j({real_:gye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yye(n){const t={x:H(n,"x","reciprocal")};return Z.runKernel(MG,t)}const Mq=j({reciprocal_:yye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bye(n){const t={x:H(n,"x","relu")};return Z.runKernel(OG,t)}const Iy=j({relu_:bye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vye(n){const t={x:H(n,"x","relu6")};return Z.runKernel(VG,t)}const SA=j({relu6_:vye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wye(n,e){const s={x:H(n,"x","reverse")},r={dims:e};return Z.runKernel(BG,s,r)}const lc=j({reverse_:wye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tye(n){const e=H(n,"x","reverse");return Y(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),lc(e,0)}const Oq=j({reverse1d_:Tye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xye(n,e){const t=H(n,"x","reverse");return Y(t.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${t.rank}.`),lc(t,e)}const Pq=j({reverse2d_:xye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sye(n,e){const t=H(n,"x","reverse");return Y(t.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${t.rank}.`),lc(t,e)}const Fq=j({reverse3d_:Sye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ye(n,e){const t=H(n,"x","reverse");return Y(t.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${t.rank}.`),lc(t,e)}const Lq=j({reverse4d_:_ye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eye(n){const t={x:H(n,"x","round")};return Z.runKernel(UG,t)}const _A=j({round_:Eye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iye(n){const t={x:H(n,"x","rsqrt","float32")};return Z.runKernel(zG,t)}const Vq=j({rsqrt_:Iye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cye(n){const t={x:H(n,"x","selu")};return Z.runKernel(KG,t)}const Bq=j({selu_:Cye});function Nye(n,e,t,s,r,i=[1,1],o="NHWC"){const a=H(n,"x","separableConv2d"),l=H(e,"depthwiseFilter","separableConv2d"),u=H(t,"pointwiseFilter","separableConv2d");let h=a,f=!1;if(a.rank===3&&(f=!0,h=ke(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Y(h.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${h.rank}.`),Y(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),Y(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),Y(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),Y(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const p=l.shape[2],g=l.shape[3];Y(u.shape[2]===p*g,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*g}, but got ${u.shape[2]}.`);const b=jw(h,l,s,r,o,i),w=Ty(b,u,1,"valid",o);return f?ke(w,[w.shape[1],w.shape[2],w.shape[3]]):w}const Uq=j({separableConv2d_:Nye});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Aye(n,e){const t=H(n,"x","setdiff1d"),s=H(e,"y","setdiff1d");Y(t.dtype===s.dtype,()=>`x and y should have the same dtype, but got x (${t.dtype}) and y (${s.dtype}).`),Y(t.rank===1,()=>`x should be 1D tensor, but got x (${t.shape}).`),Y(s.rank===1,()=>`y should be 1D tensor, but got y (${s.shape}).`);const r=await t.data(),i=await s.data(),o=new Set(i);let a=0;for(let h=0;h<r.length;h++)o.has(r[h])||a++;const l=new Vv([a],t.dtype),u=new Vv([a],"int32");for(let h=0,f=0;h<r.length;h++)o.has(r[h])||(l.values[f]=r[h],u.values[f]=h,f++);return[l.toTensor(),u.toTensor()]}const zq=Aye;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kye(n){const t={x:H(n,"x","sign")};return Z.runKernel(jG,t)}const Gq=j({sign_:kye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ye(n){const t={x:H(n,"x","sin","float32")};return Z.runKernel(YG,t)}const Hq=j({sin_:$ye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rye(n){const t={x:H(n,"x","sinh")};return Z.runKernel(JG,t)}const qq=j({sinh_:Rye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dye(n,e,t){const s=H(n,"x","slice1d");return Y(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),hn(s,[e],[t])}const Wq=j({slice1d_:Dye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mye(n,e,t){const s=H(n,"x","slice2d");return Y(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),hn(s,e,t)}const Kq=j({slice2d_:Mye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oye(n,e,t){const s=H(n,"x","slice3d");return Y(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),hn(s,e,t)}const Xq=j({slice3d_:Oye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pye(n,e,t){const s=H(n,"x","slice4d");return Y(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),hn(s,e,t)}const Yq=j({slice4d_:Pye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fye(n,e=-1){const t=H(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return Z.runKernel(r6,s,r)}const EA=j({softmax_:Fye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lye(n){Y(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return Z.runKernel(Mz,e)}const nT=j({fft_:Lye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vye(n){Y(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return Z.runKernel(Hz,e)}const Ug=j({ifft_:Vye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bye(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=ke(n,[t,e]);s=Ug(r)}else{const r=[t,2*(e-1)],i=ke(Xf(n),[t,e]),o=ke(Ey(n),[t,e]),a=lc(hn(i,[0,1],[t,e-2]),1),l=Ue(lc(hn(o,[0,1],[t,e-2]),1),Ot(-1)),u=sr([i,a],1),h=sr([o,l],1),f=ke(El(u,h),[r[0],r[1]]);s=Ug(f)}if(s=Xf(s),n.rank===3&&n.shape[0]!==0){const r=s,i=n.shape[0];s=ke(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const IA=j({irfft_:Bye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uye(n,e,t=0){const r={x:H(n,"x","split")},i={numOrSizeSplits:e,axis:t};return Z.runKernel(s6,r,i)}const Yf=j({split_:Uye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zye(n,e){Y(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const b=n.shape.map(w=>0),T=n.shape.map(w=>w);T[n.shape.length-1]=e,r=hn(n,b,T),t=e}else if(e!=null&&e>t){const b=n.shape.map(T=>T);b[n.shape.length-1]=e-t,r=sr([n,ac(b)],n.shape.length-1),t=e}else r=n;const i=oi(r),o=ke(El(r,i),[s,t]),a=nT(o),l=Math.floor(t/2)+1,u=Xf(a),h=Ey(a),f=Yf(u,[l,t-l],u.shape.length-1),p=Yf(h,[l,t-l],h.shape.length-1),g=r.shape.slice();return g[r.shape.length-1]=l,ke(El(f[0],p[0]),g)}const sT=j({rfft_:zye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gye(n,e){let t=H(n,"a","squaredDifference"),s=H(e,"b","squaredDifference");[t,s]=Un(t,s),is(t.shape,s.shape);const r={a:t,b:s},i={};return Z.runKernel(c6,r,i)}const CA=j({squaredDifference_:Gye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hye(n,e){const t=H(n,"x","squeeze","string_or_numeric");return ke(t,NU(t.shape,e).newShape)}const Cy=j({squeeze_:Hye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qye(n,e=0){const t=Mg(n,"tensors","stack","string_or_numeric");Y(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&Y(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return Z.runKernel(_G,s,r)}const Ra=j({stack_:qye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wye(n,e=0){const s={x:H(n,"x","step")},r={alpha:e};return Z.runKernel(E6,s,r)}const NA=j({step_:Wye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kye(n,e,t,s,r=0,i=0,o=0,a=0,l=0){const h={x:H(n,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:s,beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return Z.runKernel(d6,h,f)}const Jq=j({stridedSlice_:Kye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xye(n){const t={x:H(n,"x","tan","float32")};return Z.runKernel(y6,t)}const jq=j({tan_:Xye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xi(n,e){nd(n);const t=Na(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return vc(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Af(n,e,t){if(nd(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=Na(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return vc(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AA(n,e,t){if(nd(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=Na(n,t);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return vc(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qq(n,e,t){if(nd(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const s=Na(n,t);if(s.length!==4&&s.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return vc(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zq(n,e,t){if(nd(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const s=Na(n,t);if(s.length!==5&&s.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return vc(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eW(n,e,t){if(nd(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const s=Na(n,t);if(s.length!==6&&s.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||s,vc(n,e,s,t)}function kA(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(i+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(i+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(i+` update.rank != ${r+n.length-s}`);for(let o=0;o<r;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-r;++o)if(t.shape[o+r]!==n[o+s])throw new Error(i+` updates.shape[${o+r}] (${t.shape[o+r]}) != shape[${o+r}] (${n[o+r]})`)}function rT(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}kA(t,e,n)}function tW(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,i=t.length;let o=1;for(let f=r;f<i;++f)o*=t[f];const a=r<1?1:r,l=dn(e.shape)/a,u=[...vp(t.slice(0,r)),1],h=dn(t);return{sliceRank:r,numUpdates:l,sliceSize:o,strides:u,outputSize:h}}const Yye=Object.freeze(Object.defineProperty({__proto__:null,calculateShapes:tW,validateInput:rT,validateUpdateShape:kA},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jye(n,e,t){const s=H(n,"tensor","tensorScatterupdate"),r=H(e,"indices","tensorScatterupdate","int32"),i=H(t,"updates","tensorScatterupdate");if(rT(i,r,s.shape),s.dtype!==i.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${s.dtype} and ${i.dtype}.`);const o={tensor:s,indices:r,updates:i},a={};return Z.runKernel(HG,o,a)}const nW=j({tensorScatterUpdate_:Jye});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jye(n,e=1,t=!0){const s=H(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const i={x:s},o={k:e,sorted:t},[a,l]=Z.runKernel(v6,i,o);return{values:a,indices:l}}const sW=j({topk_:jye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qye(n,e=0,t=1,s,r){if(ci(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new TA(e,t,s,!0,r),o=Aa(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const rW=j({truncatedNormal_:Qye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zye(n,e=0){const t=H(n,"x","unique","string_or_numeric");Y(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[i,o]=Z.runKernel(T6,s,r);return{values:i,indices:o}}const iW=j({unique_:Zye});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ebe(n,e,t){const s=H(n,"x","unsortedSegmentSum"),r=H(e,"segmentIds","unsortedSegmentSum","int32");Y(Gf(t),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},o={numSegments:t};return Z.runKernel(S6,i,o)}const oW=j({unsortedSegmentSum_:ebe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tbe(n,e=0){const t=H(n,"x","unstack","string_or_numeric");Y(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return Z.runKernel(x6,s,r)}const wc=j({unstack_:tbe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aW(n,e){return eT(n,e,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lW(n,e=!0,t,s){return Z.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uW(n,e){const t=[];for(let i=0;i<e.length;i++)e[i]&&t.push(i);const s=Aa(n,"int32"),r=Aa([t.length,n.length],"int32");for(let i=0;i<t.length;i++){const o=s.indexToLoc(t[i]),a=i*n.length;r.values.set(o,a)}return r.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function nbe(n){const e=H(n,"condition","whereAsync","bool"),t=await e.data(),s=uW(e.shape,t);return n!==e&&e.dispose(),s}const $A=nbe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function sbe(n,e,t){const s=H(n,"tensor","boolMask"),r=H(e,"mask","boolMask","bool"),i=t??0,o=r.rank,a=s.shape;Y(o>0,()=>"mask cannot be scalar"),Ir(a.slice(i,i+o),r.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let T=i;T<i+o;T++)l*=a[T];const u=a.slice(0,i).concat([l],a.slice(i+o)),h=ke(s,u),f=ke(r,[-1]),p=await $A(f),g=Cy(p,[1]),b=oA(h,g,i);return n!==s&&s.dispose(),e!==r&&r.dispose(),g.dispose(),h.dispose(),f.dispose(),p.dispose(),b}const cW=sbe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rbe(n,e,t){const s=H(n,"x","transpose");if(e==null&&(e=s.shape.map((o,a)=>a).reverse()),Y(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(o=>{Y(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:e};return s.dtype==="complex64"?qt(()=>{let o=Xf(s),a=Ey(s);return o=Z.runKernel(j1,{x:o},i),a=Z.runKernel(j1,{x:a},i),t&&(a=Ao(a)),El(o,a)}):Z.runKernel(j1,r,i)}const zg=j({transpose_:rbe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ibe(n,e,t,s,r=!0){const i=H(n,"v","movingAverage"),o=H(e,"x","movingAverage"),a=H(t,"decay","movingAverage");F6(i,o),Y(Mo(i.shape,o.shape),()=>"Shape mismatch in v and x");const l=Ot(1),u=wt(l,a);let h=Ue(wt(o,i),u);if(r){Y(s!=null,()=>"When using zeroDebias: true, step is required.");const f=H(s,"step","movingAverage");h=In(h,wt(l,qf(a,f)))}return ot(i,h)}const hW=j({movingAverage_:ibe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function obe(n,e,t){ci(t);const s=H(n,"indices","scatterND","int32"),r=H(e,"updates","scatterND");rT(r,s,t);const i={indices:s,updates:r},o={shape:t};return Z.runKernel(GG,i,o)}const dW=j({scatterND_:obe});function abe(n,e,t,s){if(n.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${n.dtype}.`);if(n.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${n.shape}.`);const r=n.rank>0?n.shape[0]:1,i=n.rank>1?n.shape[1]:1;if(t.length!==i)throw new Error(`outputShape has incorrect number of elements:, ${t.length}, should be: ${i}.`);const o=e.size;if(!(e.rank===0||e.rank===1&&o===r))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${r}]`);if(e.dtype!==s.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lbe(n,e,t,s=0){ci(t);const r=H(n,"sparseIndices","sparseToDense","int32"),i=H(e,"sparseValues","sparseToDense","string_or_numeric"),o=H(s,"defaultValue","sparseToDense",i.dtype);abe(r,i,t,o);const a={sparseIndices:r,sparseValues:i,defaultValue:o},l={outputShape:t};return Z.runKernel(u6,a,l)}const fW=j({sparseToDense_:lbe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ube(n,e){const t=H(e,"indices","gatherND","int32"),r={params:H(n,"x","gatherND","string_or_numeric"),indices:t};return Z.runKernel(Uz,r)}const pW=j({gatherND_:ube});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cbe(n,e){if(e==null)return n.shape.slice();if(Mo(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hbe(n,e,t,s){const r=H(n,"x","dropout");if(Y(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),Y(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof Vn?r.clone():r;const i=cbe(r,t),o=1-e,a=In(iA(ot(tT(i,0,1,"float32",s),o)),o);return Ue(r,a)}const mW=j({dropout_:hbe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RA(n){return Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))))}function iT(n,e,t){const s=1-n%2,r=new Float32Array(n);for(let i=0;i<n;++i){const o=2*Math.PI*i/(n+s-1);r[i]=e-t*Math.cos(o)}return xi(r,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function dbe(n,e,t=1){const s=H(n,"predictions","inTopK"),r=H(e,"targets","inTopK");Y(s.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${s.rank}`),Y(s.rank-1===r.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${s.rank} and targets rank ${r.rank}`),Ir(s.shape.slice(0,s.shape.length-1),r.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const i=s.shape[s.shape.length-1];Y(t>0&&t<=i,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${i}), but got ${t}`);const o=await s.data(),a=await r.data(),[l,u]=[o.length/i,i],h=AU("bool",l);for(let f=0;f<l;f++){const p=f*u,g=o.subarray(p,p+u),b=[];for(let T=0;T<g.length;T++)b.push({value:g[T],index:T});b.sort((T,w)=>w.value-T.value),h[f]=0;for(let T=0;T<t;T++)if(b[T].index===a[f]){h[f]=1;break}}return n!==s&&s.dispose(),e!==r&&r.dispose(),No(h,r.shape,"bool")}const gW=dbe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fbe(n,e,t,s,r,i="NHWC",o){let a=n;n.rank===3&&(a=ke(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ke(e,[1,e.shape[0],e.shape[1],e.shape[2]])),Y(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),Y(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),Y(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const u=i==="NHWC"?a.shape[3]:a.shape[1],h=i==="NHWC"?l.shape[3]:l.shape[1];Y(u===t[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${t[2]}.`),Y(h===t[3],()=>`Error in conv2dDerFilter: depth of dy (${h}) must match output depth for filter (${t[3]}).`),to("conv2dDerFilter",r,o);const f={x:a,dy:l},p={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,filterShape:t};return Z.runKernel(cz,f,p)}const pbe=j({conv2DBackpropFilter_:fbe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oT(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return Ue(n,NA(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function aT(n,e){let t=e;const s=eA(n.shape,e.shape);return s.length>0&&(t=En(t,s)),ke(t,n.shape)}function lT(n,e,t,s){if(e==="linear")return n;if(e==="relu")return Iy(n);if(e==="elu")return nA(n);if(e==="relu6")return SA(n);if(e==="prelu")return bA(n,t);if(e==="leakyrelu")return lA(n,s);if(e==="sigmoid")return _h(n);throw new Error(`Unknown fused activation ${e}.`)}const uT=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mbe({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:h}){if(l=l||"linear",uT(Z.state.gradientDepth,l)===!1){Y(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let V=Ty(n,e,t,s,r,i,o);return a!=null&&(V=ot(V,a)),lT(V,l,u,h)}const f=H(n,"x","conv2d","float32"),p=H(e,"filter","conv2d","float32");let g=f,b=!1;f.rank===3&&(b=!0,g=ke(f,[1,f.shape[0],f.shape[1],f.shape[2]])),Y(g.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${g.rank}.`),Y(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),to("fused conv2d",s,o);const T=r==="NHWC"?g.shape[3]:g.shape[1];Y(p.shape[2]===T,()=>`Error in conv2d: depth of input (${T}) must match input depth for filter ${p.shape[2]}.`),Y(Ol(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);const w=vy(g.shape,p.shape,t,i,s,o);let _;a!=null&&(_=H(a,"bias","fused conv2d"),[_]=Un(_,f),r==="NHWC"?is(w.outShape,_.shape):(Y(_.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${_.shape.length}.`),Y(_.shape.length===0||_.shape[0]===w.outChannels||_.shape[0]===1,()=>`Error in fused conv2d: bias shape (${_.shape}) is not compatible with the number of output channels (${w.outChannels})`)));let C;if(u!=null){const V=u.shape;if(Y(V.length<=1||V.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${V.length}.`),V.length===1)Y(V[0]===1||V[0]===w.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${V}) is not compatible with the number of output channels (${w.outChannels}).`);else if(V.length===3)try{is(V,w.outShape)}catch{const M=`Error in fused conv2d: PReLU activation weights (${V}) is not compatible with the output shape of the conv2d (${w.outShape}).`;throw Error(M)}C=H(u,"prelu weights","fused conv2d")}const N=(V,D)=>{Y(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[M,$,O,k]=D,z=oT(V,O,l);Y(Fg(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const U=RH($.shape,z,M,t,s),te=pbe($,z,M.shape,t,s),se=[U,te];if(k!=null){const X=aT(k,z);se.push(X)}return se},A={x:g,filter:p,bias:_,preluActivationWeights:C},P={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:h};return a==null?$a((D,M,$)=>{let O=Z.runKernel(hI,A,P);return $([M,D,O]),b&&(O=ke(O,[O.shape[1],O.shape[2],O.shape[3]])),{value:O,gradFunc:N}})(g,p):$a((D,M,$,O)=>{let k=Z.runKernel(hI,A,P);return O([M,D,k,$]),b&&(k=ke(k,[k.shape[1],k.shape[2],k.shape[3]])),{value:k,gradFunc:N}})(g,p,_)}const gbe=j({fusedConv2d_:mbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ybe(n,e,t,s,r,i=[1,1],o){let a=n;n.rank===3&&(a=ke(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ke(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},h={strides:s,pad:r,dimRoundingMode:o,dilations:i,filterShape:t};return Z.runKernel(xz,u,h)}const bbe=j({depthwiseConv2dNativeBackpropFilter_:ybe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vbe(n,e,t,s,r,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=ke(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:t},h={strides:s,pad:r,dimRoundingMode:o,dilations:i,inputShape:n},f=Z.runKernel(Sz,u,h);return l?ke(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const wbe=j({depthwiseConv2dNativeBackpropInput_:vbe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tbe({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:h}){if(uT(Z.state.gradientDepth,l)===!1){let P=jw(n,e,t,s,r,i,o);return a!=null&&(P=ot(P,a)),lT(P,l,u,h)}const f=H(n,"x","depthwiseConv2d","float32"),p=H(e,"filter","depthwiseConv2d","float32");let g=f,b=!1;f.rank===3&&(b=!0,g=ke(f,[1,f.shape[0],f.shape[1],f.shape[2]])),Y(g.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${g.rank}.`),Y(p.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`),Y(g.shape[3]===p.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${g.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`),i==null&&(i=[1,1]),Y(Ol(t,i),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),to("fused depthwiseConv2d",s,o);const T=vy(g.shape,p.shape,t,i,s,o,!0);let w;a!=null&&(w=H(a,"bias","fused conv2d"),[w]=Un(w,f),is(T.outShape,w.shape));let _;u!=null&&(_=H(u,"prelu weights","fused depthwiseConv2d"));const C=(P,V)=>{Y(Fg(i),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);const[D,M,$,O]=V,k=oT(P,$,l),z=wbe(M.shape,k,D,t,s,i,o),U=bbe(M,k,D.shape,t,s,i,o);if(O!=null){const te=aT(w,k);return[z,U,te]}return[z,U]},N={x:g,filter:p,bias:w,preluActivationWeights:_},A={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:h};return a==null?$a((V,D,M)=>{let $=Z.runKernel(dI,N,A);return M([D,V,$]),b&&($=ke($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:C}})(g,p):$a((V,D,M,$)=>{let O=Z.runKernel(dI,N,A);return $([D,V,O,M]),b&&(O=ke(O,[O.shape[1],O.shape[2],O.shape[3]])),{value:O,gradFunc:C}})(g,p,w)}const xbe=j({fusedDepthwiseConv2d_:Tbe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sbe({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(uT(Z.state.gradientDepth,i)===!1){let k=tn(n,e,t,s);return r!=null&&(k=ot(k,r)),lT(k,i,o,a)}let l=H(n,"a","fused matMul"),u=H(e,"b","fused matMul");[l,u]=Un(l,u);const h=t?l.shape[l.rank-2]:l.shape[l.rank-1],f=s?u.shape[u.rank-1]:u.shape[u.rank-2],p=t?l.shape[l.rank-1]:l.shape[l.rank-2],g=s?u.shape[u.rank-2]:u.shape[u.rank-1],b=l.shape.slice(0,-2),T=u.shape.slice(0,-2),w=dn(b),_=dn(T);Y(h===f,()=>`Error in fused matMul: inner shapes (${h}) and (${f}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${t} and transposeB=${s} must match.`);const N=is(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([p,g]),A=t?ke(l,[w,h,p]):ke(l,[w,p,h]),P=s?ke(u,[_,g,f]):ke(u,[_,f,g]);let V;r!=null&&(V=H(r,"bias","fused matMul"),[V]=Un(V,l),is(N,V.shape));let D;o!=null&&(D=H(o,"prelu weights","fused matMul"));const M=(k,z)=>{const[U,te,se,X]=z,Q=oT(ke(k,se.shape),se,i);let re,fe;if(!t&&!s?(re=tn(Q,te,!1,!0),fe=tn(U,Q,!0,!1)):!t&&s?(re=tn(Q,te,!1,!1),fe=tn(Q,U,!0,!1)):t&&!s?(re=tn(te,Q,!1,!0),fe=tn(U,Q,!1,!1)):(re=tn(te,Q,!0,!0),fe=tn(Q,U,!0,!0)),r!=null){const be=aT(X,Q);return[re,fe,be]}else return[re,fe]},$={a:A,b:P,bias:V,preluActivationWeights:D},O={transposeA:t,transposeB:s,activation:i,leakyreluAlpha:a};return r==null?$a((z,U,te)=>{const se=Z.runKernel(cI,$,O);return te([z,U,se]),{value:ke(se,N),gradFunc:M}})(A,P):$a((z,U,te,se)=>{const X=Z.runKernel(cI,$,O);return se([z,U,X,te]),{value:ke(X,N),gradFunc:M}})(A,P,V)}const _be=j({fusedMatMul_:Sbe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yW=Object.freeze(Object.defineProperty({__proto__:null,conv2d:gbe,depthwiseConv2d:xbe,matMul:_be},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ebe(n){return iT(n,.54,.46)}const Ibe=j({hammingWindow_:Ebe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cbe(n){return iT(n,.5,.5)}const bW=j({hannWindow_:Cbe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nbe(n,e,t,s=!1,r=0){let i=0;const o=[];for(;i+e<=n.size;)o.push(hn(n,i,e)),i+=t;if(s)for(;i<n.size;){const a=i+e-n.size,l=sr([hn(n,i,e-a),wp([a],r)]);o.push(l),i+=t}return o.length===0?Af([],[0,e]):ke(sr(o),[o.length,e])}const vW=j({frame_:Nbe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Abe(n,e,t,s,r=bW){s==null&&(s=RA(e));const i=vW(n,e,t),o=Ue(i,r(e));return sT(o,s)}const kbe=j({stft_:Abe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $be(n,e,t,s,r="bilinear",i=0){const o=H(n,"image","cropAndResize"),a=H(e,"boxes","cropAndResize","float32"),l=H(t,"boxInd","cropAndResize","int32"),u=a.shape[0];Y(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),Y(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),Y(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),Y(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),Y(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),Y(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const h={image:o,boxes:a,boxInd:l},f={method:r,extrapolationValue:i,cropSize:s};return Z.runKernel(bz,h,f)}const Rbe=j({cropAndResize_:$be});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dbe(n){const e=H(n,"image","flipLeftRight","float32");Y(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return Z.runKernel(Pz,t,{})}const Mbe=j({flipLeftRight_:Dbe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Obe(n){const e=H(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];Y(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),Y(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,Nf(e,r)}const Pbe=j({grayscaleToRGB_:Obe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fbe(n){const e=H(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];Y(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),Y(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,i=vn(e,"float32"),o=xi([.2989,.587,.114]);let a;switch(e.rank){case 2:a=fh("ij,j->i",i,o);break;case 3:a=fh("ijk,k->ij",i,o);break;case 4:a=fh("ijkl,l->ijk",i,o);break;case 5:a=fh("ijklm,m->ijkl",i,o);break;case 6:a=fh("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=il(a,-1),vn(a,r)}const Lbe=j({rgbToGrayscale_:Fbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vbe(n,e,t=0,s=.5){const r=H(n,"image","rotateWithOffset","float32");Y(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},o={radians:e,fillValue:t,center:s};return Z.runKernel(I6,i,o)}const Bbe=j({rotateWithOffset_:Vbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sp(n,e,t,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=n.shape[0];return t=Math.min(t,o),Y(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),Y(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),Y(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),Y(e.rank===1,()=>"scores must be a 1D tensor"),Y(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),Y(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ube(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=H(n,"boxes","nonMaxSuppression","float32"),o=H(e,"scores","nonMaxSuppression","float32"),a=Sp(i,o,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return Z.runKernel(vG,{boxes:i,scores:o},l)}const zbe=j({nonMaxSuppression_:Ube});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gbe(n,e,t){const s=Hbe(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function Hbe(n,e,t){return Wbe(n,e,t||qbe)}function qbe(n,e){return n>e?1:n<e?-1:0}function Wbe(n,e,t){let s=0,r=n.length,i=0,o=!1;for(;s<r;){i=s+(r-s>>>1);const a=t(e,n[i]);a>0?s=i+1:(r=i,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wW(n,e,t,s,r){return DA(n,e,t,s,r,0)}function TW(n,e,t,s,r,i){return DA(n,e,t,s,r,0,!1,i,!0)}function xW(n,e,t,s,r,i){return DA(n,e,t,s,r,i,!0)}function DA(n,e,t,s,r,i,o=!1,a=!1,l=!1){const u=[];for(let w=0;w<e.length;w++)e[w]>r&&u.push({score:e[w],boxIndex:w,suppressBeginIndex:0});u.sort(S3);const h=i>0?-.5/i:0,f=[],p=[];for(;f.length<t&&u.length>0;){const w=u.pop(),{score:_,boxIndex:C,suppressBeginIndex:N}=w;if(_<r)break;let A=!1;for(let P=f.length-1;P>=N;--P){const V=Kbe(n,C,f[P]);if(V>=s){A=!0;break}if(w.score=w.score*Xbe(s,h,V),w.score<=r)break}w.suppressBeginIndex=f.length,A||(w.score===_?(f.push(C),p.push(w.score)):w.score>r&&Gbe(u,w,S3))}const g=f.length,b=t-g;a&&b>0&&(f.push(...new Array(b).fill(0)),p.push(...new Array(b).fill(0)));const T={selectedIndices:f};return o&&(T.selectedScores=p),l&&(T.validOutputs=g),T}function Kbe(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),i=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),u=Math.min(r[0],r[2]),h=Math.min(r[1],r[3]),f=Math.max(r[0],r[2]),p=Math.max(r[1],r[3]),g=(a-i)*(l-o),b=(f-u)*(p-h);if(g<=0||b<=0)return 0;const T=Math.max(i,u),w=Math.max(o,h),_=Math.min(a,f),C=Math.min(l,p),N=Math.max(_-T,0)*Math.max(C-w,0);return N/(g+b-N)}function Xbe(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function S3(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Ybe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=H(n,"boxes","nonMaxSuppressionAsync"),o=H(e,"scores","nonMaxSuppressionAsync"),a=Sp(i,o,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),u=l[0],h=l[1],{selectedIndices:f}=wW(u,h,t,s,r);return i!==n&&i.dispose(),o!==e&&o.dispose(),xi(f,"int32")}const Jbe=Ybe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jbe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=H(n,"boxes","nonMaxSuppression"),a=H(e,"scores","nonMaxSuppression"),l=Sp(o,a,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u={boxes:o,scores:a},h={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},f=Z.runKernel(TG,u,h);return{selectedIndices:f[0],selectedScores:f[1]}}const Qbe=j({nonMaxSuppressionWithScore_:jbe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Zbe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=H(n,"boxes","nonMaxSuppressionAsync"),a=H(e,"scores","nonMaxSuppressionAsync"),l=Sp(o,a,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u=await Promise.all([o.data(),a.data()]),h=u[0],f=u[1],{selectedIndices:p,selectedScores:g}=xW(h,f,t,s,r,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:xi(p,"int32"),selectedScores:xi(g)}}const e0e=Zbe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t0e(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=H(n,"boxes","nonMaxSuppression"),a=H(e,"scores","nonMaxSuppression"),l=Sp(o,a,t,s,r,null),u=l.maxOutputSize,h=l.iouThreshold,f=l.scoreThreshold,p={boxes:o,scores:a},g={maxOutputSize:u,iouThreshold:h,scoreThreshold:f,padToMaxOutputSize:i},b=Z.runKernel(wG,p,g);return{selectedIndices:b[0],validOutputs:b[1]}}const n0e=j({nonMaxSuppressionPadded_:t0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function s0e(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=H(n,"boxes","nonMaxSuppressionAsync"),a=H(e,"scores","nonMaxSuppressionAsync"),l=Sp(o,a,t,s,r,null),u=l.maxOutputSize,h=l.iouThreshold,f=l.scoreThreshold,[p,g]=await Promise.all([o.data(),a.data()]),{selectedIndices:b,validOutputs:T}=TW(p,g,u,h,f,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:xi(b,"int32"),validOutputs:Ot(T,"int32")}}const r0e=s0e;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i0e(n,e,t=!1,s=!1){const r=H(n,"images","resizeBilinear");Y(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),Y(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),Y(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=ke(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},u=Z.runKernel(LG,a,l);return o?ke(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const o0e=j({resizeBilinear_:i0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a0e(n,e,t=!1,s=!1){const r=H(n,"images","resizeNearestNeighbor");Y(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),Y(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),Y(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),Y(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=ke(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},u=Z.runKernel(FG,a,l);return o?ke(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const l0e=j({resizeNearestNeighbor_:a0e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u0e(n,e="binary",t=!1,s=.5){const r=H(n,"image","threshold"),i=.2989,o=.587,a=.114,l=r.shape[0]*r.shape[1];let u=Ue(xi([s]),255),h,f,p,g;if(Y(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),Y(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),Y(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),Y(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[h,f,p]=Yf(r,[1,1,1],-1);const w=Ue(h,i),_=Ue(f,o),C=Ue(p,a);g=ot(ot(w,_),C)}else g=n;if(e==="otsu"){const w=ZN(vn(_A(g),"int32"),No([]),256);u=c0e(w,l)}const b=t?Qw(g,u):_y(g,u);return vn(Ue(b,255),"int32")}function c0e(n,e){let t=xi([-1]),s=xi([0]),r=xi([0]),i,o,a,l,u,h;for(let f=0;f<n.size-1;f++){i=hn(n,0,f+1),o=hn(n,f+1),u=In(En(i),e),h=In(En(o),e);const p=En(Ue(i,Kf(0,i.size)));a=In(p,En(i));const g=wp(o.shape,i.size),b=ot(Kf(0,o.size),g),T=Ue(o,b);l=In(En(T),En(o));const w=wt(a,l),_=wt(a,l),C=Ue(u,h);r=Ue(Ue(C,w),_);const N=_y(r,s);s=gl(N,r,s),t=gl(N,xi([f]),t)}return t}const h0e=j({threshold_:u0e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d0e(n,e,t="nearest",s="constant",r=0,i){const o=H(n,"image","transform","float32"),a=H(e,"transforms","transform","float32");Y(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),Y(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),Y(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},u={interpolation:t,fillMode:s,fillValue:r,outputShape:i};return Z.runKernel(w6,l,u)}const f0e=j({transform_:d0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p0e(n,e,t){const s=H(n,"a","bandPart");Y(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,o]=s.shape.slice(-2);let a,l;typeof e=="number"?(Y(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),Y(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=H(e<0?i:e,"numLower","bandPart")):(Y(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=gl(zv(e,0),i,Bg(e,i))),typeof t=="number"?(Y(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),Y(t<=o,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${o}).`),l=H(t<0?o:t,"numUpper","bandPart")):(Y(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=gl(zv(t,0),o,Bg(t,o)));const u=ke(Kf(0,i,1,"int32"),[-1,1]),h=Kf(0,o,1,"int32"),f=wt(u,h),p=Lg(Qw(f,a),aA(f,Ao(l))),g=ac([i,o],s.dtype);return ke(Ra(wc(ke(s,[-1,i,o])).map(b=>gl(p,b,g))),r)}const m0e=j({bandPart_:p0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g0e(n){let e;if(Array.isArray(n)){e=!1,Y(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let i=1;i<n.length;++i)Y(n[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[i].shape[0]} vs. ${r})`)}else e=!0,n=Yf(n,n.shape[0],0).map(r=>Cy(r,[0]));Y(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(Z.tidy(()=>{let i=s[r];if(r>0)for(let o=0;o<r;++o){const a=Ue(En(Ue(t[o],i)),t[o]);i=wt(i,a)}return In(i,Sy(i,"euclidean"))}));return e?Ra(t,0):t}const y0e=j({gramSchmidt_:g0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b0e(n,e=!1){if(Y(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return _3(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,u)=>l*u),s=wc(ke(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],i=[];s.forEach(l=>{const[u,h]=_3(l,e);r.push(u),i.push(h)});const o=ke(Ra(r,0),n.shape),a=ke(Ra(i,0),n.shape);return[o,a]}}function _3(n,e=!1){return Z.tidy(()=>{Y(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=rA(t),i=ml(n);const o=Af([[1]],[1,1]);let a=ml(o);const l=t>=s?s:t;for(let u=0;u<l;++u){const h=i,f=a,p=r;[a,i,r]=Z.tidy(()=>{const g=hn(i,[u,u],[t-u,1]),b=Sy(g),T=hn(i,[u,u],[1,1]),w=gl(_y(T,0),Af([[-1]]),Af([[1]])),_=wt(T,Ue(w,b)),C=In(g,_);C.shape[0]===1?a=ml(o):a=sr([o,hn(C,[1,0],[C.shape[0]-1,C.shape[1]])],0);const N=Ao(In(tn(w,_),b)),A=hn(i,[u,0],[t-u,s]),P=Ue(N,a),V=zg(a);if(u===0)i=wt(A,tn(P,tn(V,A)));else{const $=wt(A,tn(P,tn(V,A)));i=sr([hn(i,[0,0],[u,s]),$],0)}const D=zg(P),M=hn(r,[0,u],[t,r.shape[1]-u]);if(u===0)r=wt(M,tn(tn(M,a),D));else{const $=wt(M,tn(tn(M,a),D));r=sr([hn(r,[0,0],[t,u]),$],1)}return[a,i,r]}),Tr([h,f,p])}return!e&&t>s&&(r=hn(r,[0,0],[t,s]),i=hn(i,[0,0],[s,s])),[r,i]})}const v0e=j({qr_:b0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var br;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(br||(br={}));function w0e(n,e,t=br.SUM_BY_NONZERO_WEIGHTS){const s=H(n,"losses","computeWeightedLoss");let r=null;e!=null&&(r=H(e,"weights","computeWeightedLoss"));const i=r==null?s:Ue(s,r);if(t===br.NONE)return i;if(t===br.SUM)return En(i);if(t===br.MEAN){if(r==null)return Vg(i);{const o=s.size/r.size,a=In(En(i),En(r));return o>1?In(a,Ot(o)):a}}if(t===br.SUM_BY_NONZERO_WEIGHTS){if(r==null)return In(En(i),Ot(s.size));{const o=Ue(r,Ru(s.shape)),a=vn(En(gA(o,Ot(0))),"float32");return In(En(i),a)}}throw Error(`Unknown reduction: ${t}`)}const Pl=j({computeWeightedLoss_:w0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T0e(n,e,t,s=br.SUM_BY_NONZERO_WEIGHTS){const r=H(n,"labels","absoluteDifference"),i=H(e,"predictions","absoluteDifference");let o=null;t!=null&&(o=H(t,"weights","absoluteDifference")),Ir(r.shape,i.shape,"Error in absoluteDifference: ");const a=ni(wt(r,i));return Pl(a,o,s)}const x0e=j({absoluteDifference_:T0e});function S0e(n,e,t,s,r=br.SUM_BY_NONZERO_WEIGHTS){const i=H(n,"labels","cosineDistance"),o=H(e,"predictions","cosineDistance");let a=null;s!=null&&(a=H(s,"weights","cosineDistance")),Ir(i.shape,o.shape,"Error in cosineDistance: ");const l=Ot(1),u=wt(l,En(Ue(i,o),t,!0));return Pl(u,a,r)}const _0e=j({cosineDistance_:S0e});function E0e(n,e,t,s=br.SUM_BY_NONZERO_WEIGHTS){let r=H(n,"labels","hingeLoss");const i=H(e,"predictions","hingeLoss");let o=null;t!=null&&(o=H(t,"weights","hingeLoss")),Ir(r.shape,i.shape,"Error in hingeLoss: ");const a=Ot(1);r=wt(Ue(Ot(2),r),a);const l=Iy(wt(a,Ue(r,i)));return Pl(l,o,s)}const I0e=j({hingeLoss_:E0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C0e(n,e,t,s=1,r=br.SUM_BY_NONZERO_WEIGHTS){const i=H(n,"labels","huberLoss"),o=H(e,"predictions","huberLoss");let a=null;t!=null&&(a=H(t,"weights","huberLoss")),Ir(i.shape,o.shape,"Error in huberLoss: ");const l=Ot(s),u=ni(wt(o,i)),h=Bg(u,l),f=wt(u,h),p=ot(Ue(Ot(.5),ji(h)),Ue(l,f));return Pl(p,a,r)}const N0e=j({huberLoss_:C0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A0e(n,e,t,s=1e-7,r=br.SUM_BY_NONZERO_WEIGHTS){const i=H(n,"labels","logLoss"),o=H(e,"predictions","logLoss");let a=null;t!=null&&(a=H(t,"weights","logLoss")),Ir(i.shape,o.shape,"Error in logLoss: ");const l=Ot(1),u=Ot(s),h=Ao(Ue(i,Wf(ot(o,u)))),f=Ue(wt(l,i),Wf(ot(wt(l,o),u))),p=wt(h,f);return Pl(p,a,r)}const k0e=j({logLoss_:A0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $0e(n,e,t,s=br.SUM_BY_NONZERO_WEIGHTS){const r=H(n,"labels","meanSquaredError"),i=H(e,"predictions","meanSquaredError");let o=null;t!=null&&(o=H(t,"weights","meanSquaredError")),Ir(r.shape,i.shape,"Error in meanSquaredError: ");const a=CA(r,i);return Pl(a,o,s)}const R0e=j({meanSquaredError_:$0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D0e(n,e){const t=H(n,"labels","sigmoidCrossEntropyWithLogits"),s=H(e,"logits","sigmoidCrossEntropyWithLogits");Ir(t.shape,s.shape,"Error in sigmoidCrossEntropyWithLogits: ");const r=Iy(s),i=Ue(s,t),o=uA(oc(Ao(ni(s))));return ot(wt(r,i),o)}function M0e(n,e,t,s=0,r=br.SUM_BY_NONZERO_WEIGHTS){let i=H(n,"multiClassLabels","sigmoidCrossEntropy");const o=H(e,"logits","sigmoidCrossEntropy");let a=null;if(t!=null&&(a=H(t,"weights","sigmoidCrossEntropy")),Ir(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),s>0){const u=Ot(s),h=Ot(1),f=Ot(.5);i=ot(Ue(i,wt(h,u)),Ue(f,u))}const l=D0e(i,o);return Pl(l,a,r)}const O0e=j({sigmoidCrossEntropy_:M0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P0e(n,e,t=-1){if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${t}`);return $a((r,i,o)=>{const l=hA(i,[t],!0),u=wt(vn(i,"float32"),l);o([r,u]);const h=Ao(Ue(u,r));return{value:En(h,[t]),gradFunc:(g,b)=>{const[T,w]=b,_=xy(g.shape,[t]);return[Ue(ke(g,_),wt(vn(T,"float32"),oc(w))),Ue(ke(g,_),wt(oc(w),vn(T,"float32")))]}}})(n,e)}function F0e(n,e,t,s=0,r=br.SUM_BY_NONZERO_WEIGHTS){let i=H(n,"onehotLabels","softmaxCrossEntropy");const o=H(e,"logits","softmaxCrossEntropy");let a=null;if(t!=null&&(a=H(t,"weights","softmaxCrossEntropy")),Ir(i.shape,o.shape,"Error in softmaxCrossEntropy: "),s>0){const u=Ot(s),h=Ot(1),f=Ot(i.shape[1]);i=ot(Ue(i,wt(h,u)),In(u,f))}const l=P0e(i,o);return Pl(l,a,r)}const L0e=j({softmaxCrossEntropy_:F0e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V0e(n,e,t,s){const r=H(n,"indices","sparseFillEmptyRows","int32"),i=H(e,"values","sparseFillEmptyRows"),o=H(t,"denseShape","sparseFillEmptyRows","int32"),a=H(s,"defaultValue","sparseFillEmptyRows",i.dtype);if(r.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${r.shape}`);if(i.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${i.shape}`);if(o.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(a.rank!==0)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const l={indices:r,values:i,denseShape:o,defaultValue:a},u=Z.runKernel(i6,l);return{outputIndices:u[0],outputValues:u[1],emptyRowIndicator:u[2],reverseIndexMap:u[3]}}const B0e=j({sparseFillEmptyRows_:V0e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U0e(n,e,t){const s=H(n,"inputIndices","sparseReshape","int32"),r=H(e,"inputShape","sparseReshape","int32"),i=H(t,"newShape","sparseReshape","int32");if(s.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${s.shape}`);if(r.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${r.shape}`);if(i.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${i.shape}`);const o={inputIndices:s,inputShape:r,newShape:i},a=Z.runKernel(o6,o);return{outputIndices:a[0],outputShape:a[1]}}const z0e=j({sparseReshape_:U0e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G0e(n,e,t){const s=H(n,"data","sparseSegmentMean"),r=H(e,"indices","sparseSegmentMean","int32"),i=H(t,"segmentIds","sparseSegmentMean","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${r.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${i.shape}`);const o={data:s,indices:r,segmentIds:i};return Z.runKernel(a6,o)}const H0e=j({sparseSegmentMean_:G0e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q0e(n,e,t){const s=H(n,"data","sparseSegmentSum"),r=H(e,"indices","sparseSegmentSum","int32"),i=H(t,"segmentIds","sparseSegmentSum","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${r.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${i.shape}`);const o={data:s,indices:r,segmentIds:i};return Z.runKernel(l6,o)}const W0e=j({sparseSegmentSum_:q0e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K0e(n,e,t,s,r,i,o,a){const l=H(n,"data","stringNGrams","string");if(l.dtype!=="string")throw new Error("Data must be of datatype string");if(l.shape.length!==1)throw new Error(`Data must be a vector, saw: ${l.shape}`);const u=H(e,"dataSplits","stringNGrams");if(u.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const h={separator:t,nGramWidths:s,leftPad:r,rightPad:i,padWidth:o,preserveShortSequences:a},f={data:l,dataSplits:u},p=Z.runKernel(f6,f,h);return{nGrams:p[0],nGramsSplits:p[1]}}const X0e=j({stringNGrams_:K0e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y0e(n,e,t=!0){const s=H(n,"input","stringSplit","string"),r=H(e,"delimiter","stringSplit","string");if(s.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${s.shape}`);if(r.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${r.shape}`);const i={skipEmpty:t},o={input:s,delimiter:r},a=Z.runKernel(p6,o,i);return{indices:a[0],values:a[1],shape:a[2]}}const J0e=j({stringSplit_:Y0e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j0e(n,e){const t=H(n,"input","stringToHashBucketFast","string"),s={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const r={input:t};return Z.runKernel(m6,r,s)}const Q0e=j({stringToHashBucketFast_:j0e});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z0e(n,e,t,s=!0){const r=H(n,"input","staticRegexReplace","string"),i={pattern:e,rewrite:t,replaceGlobal:s};return Z.runKernel(h6,{x:r},i)}const e1e=j({staticRegexReplace_:Z0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SW={fft:nT,ifft:Ug,rfft:sT,irfft:IA},_W={hammingWindow:Ibe,hannWindow:bW,frame:vW,stft:kbe},MA={flipLeftRight:Mbe,grayscaleToRGB:Pbe,resizeNearestNeighbor:l0e,resizeBilinear:o0e,rgbToGrayscale:Lbe,rotateWithOffset:Bbe,cropAndResize:Rbe,nonMaxSuppression:zbe,nonMaxSuppressionAsync:Jbe,nonMaxSuppressionWithScore:Qbe,nonMaxSuppressionWithScoreAsync:e0e,nonMaxSuppressionPadded:n0e,nonMaxSuppressionPaddedAsync:r0e,threshold:h0e,transform:f0e},EW={bandPart:m0e,gramSchmidt:y0e,qr:v0e},IW={absoluteDifference:x0e,computeWeightedLoss:Pl,cosineDistance:_0e,hingeLoss:I0e,huberLoss:N0e,logLoss:k0e,meanSquaredError:R0e,sigmoidCrossEntropy:O0e,softmaxCrossEntropy:L0e},CW={sparseFillEmptyRows:B0e,sparseReshape:z0e,sparseSegmentMean:H0e,sparseSegmentSum:W0e},NW={stringNGrams:X0e,stringSplit:J0e,stringToHashBucketFast:Q0e,staticRegexReplace:e1e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t1e=new Map,NI=new Map;let AW=class{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}},kW=class hf{constructor(){this.classNameMap={}}static getMap(){return hf.instance==null&&(hf.instance=new hf),hf.instance}static register(e){hf.getMap().classNameMap[e.className]=[e,e.fromConfig]}};function $W(n,e,t){Y(n.className!=null,()=>"Class being registered does not have the static className property defined."),Y(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),Y(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,r=e+">"+s;return kW.register(n),t1e.set(r,n),NI.set(n,r),n}function n1e(n){return NI.has(n)?NI.get(n):n.className}const s1e=Object.freeze(Object.defineProperty({__proto__:null,Serializable:AW,SerializationMap:kW,getRegisteredName:n1e,registerClass:$W},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Tc=class extends AW{minimize(e,t=!1,s){const{value:r,grads:i}=this.computeGradients(e,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return Tr(i),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return rq(e,t)}dispose(){this.iterations_!=null&&Tr(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Ot(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}};Object.defineProperty(Tc,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let OA=class extends Tc{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=Z.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Z.registeredVariables[s],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:qt(()=>oi(i).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:qt(()=>oi(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,u=this.accumulatedUpdates[r].variable;qt(()=>{const h=ot(Ue(l,this.rho),Ue(ji(a),1-this.rho)),f=Ue(In(ka(ot(u,this.epsilon)),ka(ot(l,this.epsilon))),a),p=ot(Ue(u,this.rho),Ue(ji(f),1-this.rho));l.assign(h),u.assign(p);const g=ot(Ue(f,-this.learningRate),i);i.assign(g)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Tr(this.accumulatedGrads.map(e=>e.variable)),Tr(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let PA=class extends Tc{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Z.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:qt(()=>wp(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const a=this.accumulatedGrads[r].variable;qt(()=>{const l=ot(a,ji(o));a.assign(l);const u=ot(Ue(In(o,ka(ot(l,Z.backend.epsilon()))),-this.learningRate),i);i.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Tr(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let FA=class extends Tc{static get className(){return"Adam"}constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],qt(()=>{this.accBeta1=Ot(t).variable(),this.accBeta2=Ot(s).variable()}),r==null&&(this.epsilon=Z.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);qt(()=>{const s=wt(1,this.accBeta1),r=wt(1,this.accBeta2);t.forEach((i,o)=>{const a=Z.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:qt(()=>oi(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:qt(()=>oi(a).variable(l))});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const h=this.accumulatedFirstMoment[o].variable,f=this.accumulatedSecondMoment[o].variable,p=ot(Ue(h,this.beta1),Ue(u,1-this.beta1)),g=ot(Ue(f,this.beta2),Ue(ji(u),1-this.beta2)),b=In(p,s),T=In(g,r);h.assign(p),f.assign(g);const w=ot(Ue(In(b,ot(ka(T),this.epsilon)),-this.learningRate),a);a.assign(w)}),this.accBeta1.assign(Ue(this.accBeta1,this.beta1)),this.accBeta2.assign(Ue(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Tr(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Tr(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),qt(()=>{this.accBeta1.assign(qf(this.beta1,this.iterations_+1)),this.accBeta2.assign(qf(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let LA=class extends Tc{static get className(){return"Adamax"}constructor(e,t,s,r=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],qt(()=>{this.iteration=Ot(0).variable(),this.accBeta1=Ot(t).variable()}),r==null&&(this.epsilon=Z.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);qt(()=>{const s=wt(1,this.accBeta1),r=In(-this.learningRate,ot(Ue(this.iteration,this.decay),1));t.forEach((i,o)=>{const a=Z.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:oi(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:oi(a).variable(l)});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const h=this.accumulatedFirstMoment[o].variable,f=this.accumulatedWeightedInfNorm[o].variable,p=ot(Ue(h,this.beta1),Ue(u,1-this.beta1)),g=Ue(f,this.beta2),b=ni(u),T=mA(g,b);h.assign(p),f.assign(T);const w=ot(Ue(In(r,s),In(p,ot(T,this.epsilon))),a);a.assign(w)}),this.iteration.assign(ot(this.iteration,1)),this.accBeta1.assign(Ue(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Tr(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Tr(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let cT=class extends Tc{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const o=Z.registeredVariables[s];qt(()=>{const a=ot(Ue(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Io(Ot(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let VA=class extends cT{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=Ot(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Z.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:qt(()=>oi(i).variable(!1))});const o=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&qt(()=>{let l;const u=ot(Ue(this.m,o),a);this.useNesterov?l=ot(Ue(this.c,ot(a,Ue(u,this.m))),i):l=ot(Ue(this.c,u),i),o.assign(u),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Tr(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let BA=class extends Tc{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=Z.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Z.registeredVariables[s],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:qt(()=>oi(i).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:qt(()=>oi(i).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:qt(()=>oi(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,u=this.accumulatedMoments[r].variable;qt(()=>{const h=ot(Ue(l,this.decay),Ue(ji(a),1-this.decay));if(this.centered){const f=this.accumulatedMeanGrads[r].variable,p=ot(Ue(f,this.decay),Ue(a,1-this.decay)),g=In(Ue(a,this.learningRate),ka(wt(h,ot(ji(p),this.epsilon)))),b=ot(Ue(u,this.momentum),g);l.assign(h),f.assign(p),u.assign(b);const T=wt(i,b);i.assign(T)}else{const f=ot(Ue(l,this.decay),Ue(ji(a),1-this.decay)),p=ot(Ue(u,this.momentum),In(Ue(a,this.learningRate),ka(ot(f,this.epsilon))));l.assign(f),u.assign(p);const g=wt(i,p);i.assign(g)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Tr(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Tr(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Tr(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r1e=[OA,PA,FA,LA,VA,BA,cT];function i1e(){for(const n of r1e)$W(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o1e="model",a1e=".json",l1e=".weights.bin";function E3(n){return new Promise(e=>setTimeout(e)).then(n)}class Lh{constructor(e){if(!ut().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(Lh.URL_SCHEME)&&(e=e.slice(Lh.URL_SCHEME.length)),(e==null||e.length===0)&&(e=o1e),this.modelJsonFileName=e+a1e,this.weightDataFileName=e+l1e}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=Ml.join(e.weightData),s=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=X6(e,r),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),a=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=o,await E3(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=s,await E3(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:by(e)}}}}Lh.URL_SCHEME="downloads://";class u1e{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,t)=>{const s=new FileReader;s.onload=r=>{const i=JSON.parse(r.target.result),o=i.modelTopology;if(o==null){t(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(i.weightsManifest==null){t(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:o});return}const l=KN(i,u=>this.loadWeights(u));e(l)},s.onerror=r=>t(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),s.readAsText(this.jsonFile)})}loadWeights(e){const t=[],s=[];for(const o of e)t.push(...o.weights),s.push(...o.paths);const r=this.checkManifestAndWeightFiles(e),i=s.map(o=>this.loadWeightsFile(o,r[o]));return Promise.all(i).then(o=>[t,o])}loadWeightsFile(e,t){return new Promise((s,r)=>{const i=new FileReader;i.onload=o=>{const a=o.target.result;s(a)},i.onerror=o=>r(`Failed to weights data from file of path '${e}'.`),i.readAsArrayBuffer(t)})}checkManifestAndWeightFiles(e){const t=[],s=this.weightsFiles.map(i=>p3(i.name)),r={};for(const i of e)i.paths.forEach(o=>{const a=p3(o);if(t.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(t.push(a),s.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);r[o]=this.weightsFiles[s.indexOf(a)]});if(t.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${t.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}const c1e=n=>ut().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Lh.URL_SCHEME)?h1e(n.slice(Lh.URL_SCHEME.length)):null;Ei.registerSaveRouter(c1e);function h1e(n="model"){return new Lh(n)}function d1e(n){return new u1e(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I3(n,e,t,s){o(n),t=t??0,s=s??1,a(t,s);let r=0;const i=l=>(l.then(u=>{const h=t+ ++r/n.length*(s-t);return e(h),u}),l);function o(l){Y(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){Y(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),Y(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),Y(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(n.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function RW(n,e){e==null&&(e={});const t=e.fetchFunc==null?ut().platform.fetch:e.fetchFunc,s=n.map(f=>t(f,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await I3(s,e.onProgress,0,.5)).map(f=>f.arrayBuffer());return e.onProgress==null?await Promise.all(a):await I3(a,e.onProgress,.5,1)}function f1e(n,e){var t;const s=e.fetchFunc==null?ut().platform.fetch:e.fetchFunc;let r=0,i;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async o=>{for(var a;r<n.length;){i||(i=(await s(n[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:u}=await i.read();if(l){r++,i=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/n.length);continue}o.enqueue(u);return}o.close()}})}async function p1e(n,e="",t,s){return DW(o=>RW(o,{requestInit:s}))(n,e,t)}function DW(n){return async(e,t="",s)=>{const r=e.map(()=>!1),i={},o=s!=null?s.map(()=>!1):[],a=[];if(e.forEach((g,b)=>{let T=0;g.weights.forEach(w=>{const _="quantization"in w?w.quantization.dtype:w.dtype,C=Mh[_]*dn(w.shape),N=()=>{r[b]=!0,i[b]==null&&(i[b]=[]),i[b].push({manifestEntry:w,groupOffset:T,sizeBytes:C})};s!=null?s.forEach((A,P)=>{A===w.name&&(N(),o[P]=!0)}):N(),a.push(w.name),T+=C})}),!o.every(g=>g)){const g=s.filter((b,T)=>!o[T]);throw new Error(`Could not find weights in manifest with names: ${g.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}const l=r.reduce((g,b,T)=>(b&&g.push(T),g),[]),u=[];l.forEach(g=>{e[g].paths.forEach(b=>{const T=t+(t.endsWith("/")?"":"/")+b;u.push(T)})});const h=await n(u),f={};let p=0;return l.forEach(g=>{const b=e[g].paths.length,T=new Ml(h.slice(p,p+b));i[g].forEach(_=>{const C=T.slice(_.groupOffset,_.groupOffset+_.sizeBytes),N=q6(C,[_.manifestEntry]);for(const A in N)f[A]=N[A]}),p+=b}),f}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m1e="application/octet-stream",g1e="application/json";class UA{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(Y(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=ut().platform.fetch,Y(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&Y(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=X6(e,s);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:g1e}),"model.json"),e.weightData!=null){const o=Ml.join(e.weightData);t.body.append("model.weights.bin",new Blob([o],{type:m1e}),"model.weights.bin")}const i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:by(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const s=t.modelTopology,r=t.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return KN(e,t=>this.loadWeights(t))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),s=xI(e.weightsManifest),r=()=>f1e(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=y1e(t),i=this.weightPathPrefix||s,o=[],a=[];for(const l of e)for(const u of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(u)):o.push(i+u+r);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const t=await this.getWeightUrls(e),s=xI(e),r=await RW(t,this.loadOptions);return[s,r]}}UA.URL_SCHEME_REGEX=/^https?:\/\//;function y1e(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),s=n.substring(0,e),r=t>e?n.substring(t):"";return[s+"/",r]}function AI(n){return n.match(UA.URL_SCHEME_REGEX)!=null}const MW=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(s=>AI(s)):t=AI(n),t)return zA(n,e)}return null};Ei.registerSaveRouter(MW);Ei.registerLoadRouter(MW);function zA(n,e){return new UA(n,e)}function b1e(n,e){return zA(n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oE{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class OW{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class v1e{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=t=>Promise.resolve(e.save(t)))}}function w1e(n,e,t,s){const r=arguments;return new v1e(PW(...r))}function PW(n,e,t,s){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new oE(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new oE({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new oE({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:s}))}function T1e(n){return new OW(n)}function x1e(n){return new OW(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GA=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:Ml,browserFiles:d1e,browserHTTPRequest:b1e,concatenateArrayBuffers:mfe,copyModel:Ffe,decodeWeights:q6,decodeWeightsStream:K6,encodeWeights:ufe,fromMemory:w1e,fromMemorySync:PW,getLoadHandlers:Sfe,getModelArtifactsForJSON:KN,getModelArtifactsForJSONSync:Y6,getModelArtifactsInfoForJSON:by,getSaveHandlers:xfe,getWeightSpecs:xI,http:zA,isHTTPScheme:AI,listModels:Ofe,loadWeights:p1e,moveModel:Lfe,registerLoadRouter:Tfe,registerSaveRouter:wfe,removeModel:Pfe,weightsLoaderFactory:DW,withSaveHandler:T1e,withSaveHandlerSync:x1e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S1e(n,e,t){const s=H(n,"labels","confusionMatrix"),r=H(e,"predictions","confusionMatrix");Y(t==null||t>0&&Number.isInteger(t),()=>`If provided, numClasses must be a positive integer, but got ${t}`),Y(s.rank===1,()=>`Expected the rank of labels to be 1, but got ${s.rank}`),Y(r.rank===1,()=>`Expected the rank of predictions to be 1, but got ${r.rank}`),Y(s.shape[0]===r.shape[0],()=>`Mismatch in the number of examples: ${s.shape[0]} vs. ${r.shape[0]}. Labels and predictions should have the same number of elements.`),Y(t>0&&Number.isInteger(t),()=>`numClasses is required to be a positive integer, but got ${t}`);const i=Gv(vn(s,"int32"),t),o=Gv(vn(r,"int32"),t),a=zg(i),l=tn(a,o);return vn(l,"int32")}const _1e=j({confusionMatrix_:S1e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E1e=Object.freeze(Object.defineProperty({__proto__:null,confusionMatrix:_1e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let oh,C3=!1;function FW(n,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let t=!1,s=!1,r=!1,i=!1,o=!1,a=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)r=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)i=!0;else if(n.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&n instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${n.constructor.name}`);if($g(uI,Z.backendName)!=null){const b={pixels:n},T={numChannels:e};return Z.runKernel(uI,b,T)}const[u,h]=r?[n.videoWidth,n.videoHeight]:[n.width,n.height];let f;if(o)f=n.getContext("2d").getImageData(0,0,u,h).data;else if(s||t)f=n.data;else if(i||r||a){if(oh==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")oh=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else oh=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});oh.canvas.width=u,oh.canvas.height=h,oh.drawImage(n,0,0,u,h),f=oh.getImageData(0,0,u,h).data}let p;if(e===4)p=new Int32Array(f);else{const b=u*h;p=new Int32Array(b*e);for(let T=0;T<b;T++)for(let w=0;w<e;++w)p[T*e+w]=f[T*4+w]}return AA(p,[h,u,e],"int32")}function I1e(n){return n!=null&&n.data instanceof Uint8Array}function C1e(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function N1e(n){return n!=null&&n.width!==0&&n.height!==0}function A1e(n){return C1e()&&!(n instanceof ImageBitmap)&&N1e(n)&&!I1e(n)}async function k1e(n,e=3){let t=null;if(ut().getBool("WRAP_TO_IMAGEBITMAP")&&A1e(n)){let s;try{s=await createImageBitmap(n,{premultiplyAlpha:"none"})}catch{s=null}s!=null&&s.width===n.width&&s.height===n.height?t=s:t=n}else t=n;return FW(t,e)}function LW(n){if(n.rank!==2&&n.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const e=n.rank===2?1:n.shape[2];if(e>4||e===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${e}`);if(n.dtype!=="float32"&&n.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`)}function $1e(n){const e=(n==null?void 0:n.alpha)||1;if(e>1||e<0)throw new Error(`Alpha value ${e} is suppoed to be in range [0 - 1].`)}async function R1e(n,e){let t=H(n,"img","toPixels");if(!(n instanceof Vn)){const u=t;t=vn(u,"int32"),u.dispose()}LW(t);const[s,r]=t.shape.slice(0,2),i=t.rank===2?1:t.shape[2],o=await t.data(),a=t.dtype==="float32"?255:1,l=new Uint8ClampedArray(r*s*4);for(let u=0;u<s*r;++u){const h=[0,0,0,255];for(let p=0;p<i;p++){const g=o[u*i+p];if(t.dtype==="float32"){if(g<0||g>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${g}.`)}else if(t.dtype==="int32"&&(g<0||g>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${g}.`);i===1?(h[0]=g*a,h[1]=g*a,h[2]=g*a):h[p]=g*a}const f=u*4;l[f+0]=Math.round(h[0]),l[f+1]=Math.round(h[1]),l[f+2]=Math.round(h[2]),l[f+3]=Math.round(h[3])}if(e!=null){C3||$g(LN,Z.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),C3=!0),e.width=r,e.height=s;const u=e.getContext("2d"),h=new ImageData(l,r,s);u.putImageData(h,0,0)}return t!==n&&t.dispose(),l}function D1e(n,e,t){let s=H(n,"img","draw");if(!(n instanceof Vn)){const o=s;s=vn(o,"int32"),o.dispose()}LW(s),$1e(t==null?void 0:t.imageOptions);const r={image:s},i={canvas:e,options:t};Z.runKernel(LN,r,i)}const VW=j({fromPixels_:FW}),M1e=Object.freeze(Object.defineProperty({__proto__:null,draw:D1e,fromPixels:VW,fromPixelsAsync:k1e,toPixels:R1e},Symbol.toStringTag,{value:"Module"}));function BW(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(dn(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,i=r[r.length-1];let o=1;for(let f=0;f<r.length-1;++f)o*=r[f];const a=n.shape,l=r.slice();l.pop();let u=1;for(let f=i;f<t;++f)u*=a[f],l.push(a[f]);const h=[...vp(n.shape).map(f=>f/u),1].slice(0,i);return[l,o,u,h]}const O1e=Object.freeze(Object.defineProperty({__proto__:null,prepareAndValidate:BW},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kI=-2,P1e=-1;function F1e(n,e,t){const s=n.shape.length;Y(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),Y(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)Y(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function L1e(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function V1e(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function UW(n,e,t,s){const r=[...n];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<t;i++)i===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function zW(n,e,t){return t<=n?t:t-(e-1)}function GW(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function B1e(n,e,t,s,r,i,o,a,l){const u=n.length;let h=new Array(u),f=new Array(u),p=new Array(u);if(e.length&&t>0){const g=e[0],b=t+1;h=HW(o,g,b,s,n),f=qW(a,g,b,r,n),p=UW(i,g,b,n)}else for(let g=0;g<u;g++)h[g]=KW(o,s,i,n,g,l),f[g]=XW(a,r,i,n,g,l),p[g]=WW(i,g,l);return{begin:h,end:f,strides:p}}function HW(n,e,t,s,r){const i=[...r],o=GW(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=zW(e,t,a);let u=s[l];n&1<<l&&(u=0),i[a]=u}return i}function qW(n,e,t,s,r){const i=[...r],o=GW(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=zW(e,t,a);let u=s[l];n&1<<l&&(u=Number.MAX_SAFE_INTEGER),i[a]=u}for(let a=0;a<i.length;a++){const l=r[a];i[a]<0&&(i[a]+=l),i[a]=Ag(0,i[a],r[a])}return i}function WW(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function KW(n,e,t,s,r,i){let o=e[r];const a=t[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),o=Ag(0,o,l-1),o}function XW(n,e,t,s,r,i){let o=e[r];const a=t[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),a>0?o=Ag(0,o,l):o=Ag(-1,o,l-1),o}function U1e(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function z1e(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function G1e(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(o=>{Y(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(r).fill(-1):typeof t=="number"?i=[t,...new Array(r-1).fill(-1)]:t.length<r?i=t.concat(new Array(r-t.length).fill(-1)):i=t,i=i.map((o,a)=>o>=0?o:(Y(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),n.shape[a]-s[a])),[s,i]}function H1e(n,e,t,s,r,i,o,a,l){let u;if(s==null?(u=new Array(e.length),u.fill(1)):u=s,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let h=!1;const f={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:u.slice(),beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let N=0;N<f.dims;N++)h&&(1<<N&a)!==0&&f.numAddAxisAfterEllipsis++,1<<N&o&&(h=!0);h||(f.ellipsisMask|=1<<f.dims,f.dims++);const p={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};q1e(f,p);let g=!0,b=!0,T=!0;const w=[],_=[];for(let N=0;N<n.length;++N){if(p.strides[N]===0)throw Error(`strides[${N}] must be non-zero`);const A=!!(p.shrinkAxisMask&1<<N),P=n[N];if(P===-1){w.push(A?1:-1);continue}const V=[p.beginMask&1<<N,p.endMask&1<<N],D=[p.strides[N]>0?0:-1,p.strides[N]>0?P:P-1];if(A&&p.strides[N]<=0)throw Error("only stride 1 allowed on non-range indexing.");T=T&&p.strides[N]===1;const M=!!(p.beginMask&1<<N&&p.endMask&1<<N);if(p.beginValid&&p.endValid){if(A){const z=p.begin[N]<0?P+p.begin[N]:p.begin[N];if(p.begin[N]=z,p.end[N]=p.begin[N]+1,z<0||z>=P)throw Error(`slice index ${p.begin[N]} of dimension ${N} out of bounds.`)}else p.begin[N]=N3(p.begin[N],0,p.strides[N],P,V,D),p.end[N]=N3(p.end[N],1,p.strides[N],P,V,D);const k=p.strides[N]===1&&p.begin[N]===0&&p.end[N]===P;g=g&&k,b=b&&(N===0&&p.strides[N]===1||k)}else g=g&&p.strides[N]===1&&M,b=b&&(N===0&&p.strides[N]===1||M);let $,O=!1;if(p.beginValid&&p.endValid?($=p.end[N]-p.begin[N],O=!0):A?($=1,O=!0):M&&P>=0&&(p.strides[N]<0?$=-P:$=P,O=!0),O){let k;$===0||$<0!=p.strides[N]<0?k=0:k=Math.trunc($/p.strides[N])+($%p.strides[N]!==0?1:0),w.push(k)}else w.push(-1)}for(let N=0;N<p.finalShapeGatherIndices.length;++N){const A=p.finalShapeGatherIndices[N];A>=0?_.push(w[A]):A===kI&&_.push(1)}return{finalShapeSparse:_.filter((N,A)=>p.finalShapeGatherIndices[A]!==kI),finalShape:_,isIdentity:g,sliceDim0:b,isSimpleSlice:T,begin:p.begin,end:p.end,strides:p.strides}}function q1e(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(kI),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(P1e),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function N3(n,e,t,s,r,i){if(r[e])return t>0?i[e]:i[e+1&1];{const o=n<0?s+n:n;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const YW=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:F1e,computeFlatOffset:z1e,computeOutShape:V1e,getNormalizedAxes:B1e,isSliceContinous:U1e,maskToAxes:L1e,parseSliceParams:G1e,sliceInfo:H1e,startForAxis:KW,startIndicesWithElidedDims:HW,stopForAxis:XW,stopIndicesWithElidedDims:qW,stridesForAxis:WW,stridesWithElidedDims:UW},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const W1e="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let JW=class{static sgd(e){return new cT(e)}static momentum(e,t,s=!1){return new VA(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,i=!1){return new BA(e,t,s,r,i)}static adam(e=.001,t=.9,s=.999,r=null){return new FA(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new OA(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,i=0){return new LA(e,t,s,r,i)}static adagrad(e,t=.1){return new PA(e,t)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K1e=JW;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X1e=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function Y1e(){return new Promise(n=>X1e(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J1e(n,e){const t=n[0].length;n.forEach((r,i)=>{Y(r.length===t,()=>`Error in concat${t}D: rank of tensors[${i}] must be the same as the rank of the rest (${t})`)}),Y(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,i)=>{for(let o=0;o<t;o++)Y(o===e||r[o]===s[o],()=>`Error in concat${t}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function j1e(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ca;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(ca||(ca={}));function Q1e(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const i=t[r],o=s[s.length-t.length+r],a=s[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${i} but shape[${r+n}] = ${a}`)}else s[o]=i}return s}function Z1e(n){const e={FIRST_DIM_SIZE:ca.FIRST_DIM_SIZE,VALUE_ROWIDS:ca.VALUE_ROWIDS,ROW_LENGTHS:ca.ROW_LENGTHS,ROW_SPLITS:ca.ROW_SPLITS,ROW_LIMITS:ca.ROW_LIMITS,ROW_STARTS:ca.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function eve(n){return n.length===0?0:n[0]===ca.FIRST_DIM_SIZE?n.length-1:n.length}function tve(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const i=n[r],o=e[r+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${i} but ragged tensor input.flatValues.shape[${r-n.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HA=30;function nve(n){return n<=HA?n:Pv(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sve(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rve(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const i=e.length;for(let o=0;o<i;++o)r=r.concat([n[o+1]/e[o],e[o]]);r=r.concat(n.slice(i+1))}return r}function ive(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],i=[];for(let o=1;o<n;++o)o>=e*2+1||o%2===1?i.push(o):r.push(o);s.push(...r),s.push(0),s.push(...i)}return s}function ove(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let i=1;i<n.length;++i)i<=e.length?s?r.push(e[i-1]*n[i]):r.push(n[i]/e[i-1]):r.push(n[i]);return r}function ave(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function lve(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uve=1.7580993408473768,cve=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hve=.3275911,dve=.254829592,fve=-.284496736,pve=1.421413741,mve=-1.453152027,gve=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yve(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function bve(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function vve(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function wve(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function Tve(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function xve(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function Sve(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const i=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:t,imag:s}}function _ve(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aE="->",Eve=/->/g,A3=",",k3="...";function Ive(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(Eve,"").length)/aE.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${aE}").`);const[s,r]=n.split(aE);Y(s.indexOf(k3)===-1,()=>`The ellipsis notation ("${k3}") is not supported yet.`);const i=s.split(A3),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let p=0;p<r.length;++p){const g=r[p];if(!i.some(b=>b.indexOf(g)!==-1))throw new Error(`Output subscripts contain the label ${g} not present in the input subscripts.`);a.indexOf(g)===-1&&a.push(g)}for(let p=0;p<s.length;++p){const g=s[p];a.indexOf(g)===-1&&g!==A3&&a.push(g)}const l=new Array(i.length);for(let p=0;p<o;++p){if(new Set(i[p].split("")).size!==i[p].length)throw new Error(`Found duplicate axes in input component ${i[p]}. Support for duplicate axes in input is not implemented yet.`);l[p]=[];for(let g=0;g<i[p].length;++g)l[p].push(a.indexOf(i[p][g]))}const u=a.length,h=r.length,f=[];for(let p=h;p<u;++p)f.push(p);return{allDims:a,summedDims:f,idDims:l}}function Cve(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function Nve(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const i=t[r].shape;for(let o=0;o<e[r].length;++o)s[e[r][o]]===void 0?s[e[r][o]]=i[o]:Y(s[e[r][o]]===i[o],()=>`Expected dimension ${s[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function Ave(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let o=0;o<r;++o)s.push([]);const i=[];for(let o=0;o<t.length;++o){const a=t[o],l=$ve(e,a);for(const u of l)i.indexOf(u)===-1&&(s[o].push(u),i.push(u))}return{path:t,steps:s}}function kve(n){return n.every((e,t)=>e===t)}function $ve(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function Rve(n,e,t=0){let s=[];if(typeof e=="number")Y(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);Y(r<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=n.shape[t]-o}Y(n.shape[t]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dve(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function Mve(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function Ove(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pve(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function Fve(n,e){return`size ${n} must be non-negative, not ${e}`}function Lve(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Vve(n,e){const t=dn(n),s=dn(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function Bve(n,e){const t=dn(n),s=dn(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uve(){return"segment ids must be >= 0"}function zve(){return"segment ids are not increasing"}function Gve(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function Hve(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qve(n,e){let t=!1,s;for(n<=HA?(s=n,t=!0):s=Pv(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=Pv(n,s+1);return s}function Wve(n,e,t){const s=[],r=n.length;for(let i=0;i<r;i++)i!==e?s.push(n[i]):s.push(t);return s}function Kve(n,e,t,s){const r=e.shape.length,i=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let f=0;f<s;++f)if(n.shape[f]!==e.shape[f])throw new Error(`x.shape[${f}]: ${n.shape[f]} should be equal to indices.shape[${f}]: ${e.shape[f]}.`);const o=n.shape[t],a=[];let l=1,u=1,h=1;for(let f=0;f<s;++f)a.push(n.shape[f]),l*=n.shape[f];for(let f=s;f<t;f++)a.push(n.shape[f]),u*=n.shape[f];for(let f=s;f<r;f++)a.push(e.shape[f]);for(let f=t+1;f<i;f++)a.push(n.shape[f]),h*=n.shape[f];return{batchSize:l,sliceSize:h,outerSize:u,dimSize:o,outputShape:a}}const Xve=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:Kve,computeOutShape:Wve,segOpComputeOptimalWindowSize:qve},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yve(n){try{return n.map(e=>Lv(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function Jve(n){return n.map(e=>yy(e))}const jve=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:dve,ERF_A2:fve,ERF_A3:pve,ERF_A4:mve,ERF_A5:gve,ERF_P:hve,PARALLELIZE_THRESHOLD:HA,get RowPartitionType(){return ca},SELU_SCALE:cve,SELU_SCALEALPHA:uve,applyActivation:lT,assertAndGetBroadcastShape:is,assertAxesAreInnerMostDims:fme,assertParamsConsistent:J1e,assignToTypedArray:xve,axesAreInnerMostDims:sA,calculateShapes:tW,checkEinsumDimSizes:Nve,checkPadOnDimRoundingMode:to,combineLocations:YH,combineRaggedTensorToTensorShapes:Q1e,complexWithEvenIndex:vve,complexWithOddIndex:wve,computeConv2DInfo:vy,computeConv3DInfo:gH,computeDefaultPad:JN,computeDilation2DInfo:lpe,computeOptimalWindowSize:nve,computeOutAndReduceShapes:dme,computeOutShape:j1e,computePool2DInfo:mH,computePool3DInfo:upe,convertConv2DDataFormat:yH,decodeEinsumEquation:Ive,eitherStridesOrDilationsAreOne:Ol,expandShapeToKeepDim:xy,exponent:_ve,exponents:Sve,fromStringArrayToUint8:Jve,fromUint8ToStringArray:Yve,getAxesPermutation:pme,getBroadcastDims:HH,getComplexWithIndex:Tve,getEinsumComputePath:Ave,getEinsumPermutation:Cve,getFusedBiasGradient:aT,getFusedDyActivation:oT,getImageCenter:sve,getInnerMostAxes:gme,getPermuted:ive,getRaggedRank:eve,getReductionAxes:eA,getReshaped:rve,getReshapedPermuted:ove,getRowPartitionTypesHelper:Z1e,getSliceBeginCoords:ave,getSliceSize:lve,getSparseFillEmptyRowsIndicesDenseShapeMismatch:Dve,getSparseFillEmptyRowsNegativeIndexErrorMessage:Mve,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Ove,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Lve,getSparseReshapeInputOutputMismatchErrorMessage:Bve,getSparseReshapeInputOutputMultipleErrorMessage:Vve,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:Pve,getSparseReshapeNegativeOutputDimErrorMessage:Fve,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:Hve,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Uve,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:zve,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Gve,getUndoAxesPermutation:mme,isIdentityPermutation:kve,log:cde,mergeRealAndImagArrays:yve,prepareAndValidate:BW,prepareSplitSize:Rve,segment_util:Xve,shouldFuse:uT,slice_util:YW,splitRealAndImagArrays:bve,stridesOrDilationsArePositive:Fh,tupleValuesAreOne:Fg,upcastType:Jw,validateDefaultValueShape:tve,validateInput:rT,validateUpdateShape:kA,warn:Nu},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qve=Object.freeze(Object.defineProperty({__proto__:null,nonMaxSuppressionV3Impl:wW,nonMaxSuppressionV4Impl:TW,nonMaxSuppressionV5Impl:xW,whereImpl:uW},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */i1e();const Zve=Object.freeze(Object.defineProperty({__proto__:null,Abs:LU,Acos:VU,Acosh:BU,AdadeltaOptimizer:OA,AdagradOptimizer:PA,AdamOptimizer:FA,AdamaxOptimizer:LA,Add:PN,AddN:UU,All:zU,Any:GU,ArgMax:HU,ArgMin:qU,Asin:WU,Asinh:KU,Atan:XU,Atan2:JU,Atanh:YU,AvgPool:jU,AvgPool3D:QU,AvgPool3DGrad:Whe,AvgPoolGrad:qhe,BatchMatMul:ZU,BatchToSpaceND:ez,Bincount:tz,BitwiseAnd:nz,BroadcastArgs:sz,BroadcastTo:Khe,Cast:FN,Ceil:rz,ClipByValue:iz,Complex:oz,ComplexAbs:az,Concat:lz,Conv2D:uz,Conv2DBackpropFilter:cz,Conv2DBackpropInput:hz,Conv3D:dz,Conv3DBackpropFilterV2:Xhe,Conv3DBackpropInputV2:fz,Cos:pz,Cosh:mz,CropAndResize:bz,Cumprod:gz,Cumsum:yz,DataStorage:She,DenseBincount:vz,DepthToSpace:wz,DepthwiseConv2dNative:Tz,DepthwiseConv2dNativeBackpropFilter:xz,DepthwiseConv2dNativeBackpropInput:Sz,Diag:_z,Dilation2D:Ez,Dilation2DBackpropFilter:Jhe,Dilation2DBackpropInput:Yhe,Draw:LN,get ENV(){return MN},Einsum:Cz,Elu:Nz,EluGrad:jhe,Environment:PU,Equal:kz,Erf:Az,Exp:$z,ExpandDims:Rz,Expm1:Dz,FFT:Mz,Fill:Oz,FlipLeftRight:Pz,Floor:Fz,FloorDiv:Lz,FromPixels:uI,FusedBatchNorm:Vz,FusedConv2D:hI,FusedDepthwiseConv2D:dI,GatherNd:Uz,GatherV2:Bz,Greater:zz,GreaterEqual:Gz,IFFT:Hz,Identity:VN,Imag:qz,IsFinite:Wz,IsInf:Kz,IsNan:Xz,KernelBackend:EU,LRN:rG,LRNGrad:tde,LeakyRelu:Yz,Less:Jz,LessEqual:jz,LinSpace:Qz,Log:Zz,Log1p:eG,LogSoftmax:Zhe,LogicalAnd:tG,LogicalNot:nG,LogicalOr:sG,LogicalXor:Qhe,LowerBound:ede,MatrixBandPart:nde,Max:iG,MaxPool:aG,MaxPool3D:lG,MaxPool3DGrad:rde,MaxPoolGrad:sde,MaxPoolWithArgmax:uG,Maximum:oG,Mean:cG,Min:hG,Minimum:dG,MirrorPad:fG,Mod:pG,MomentumOptimizer:VA,Multinomial:mG,Multiply:gG,Neg:yG,NonMaxSuppressionV3:vG,NonMaxSuppressionV4:wG,NonMaxSuppressionV5:TG,NotEqual:bG,OP_SCOPE_SUFFIX:qN,OneHot:SG,OnesLike:xG,Optimizer:Tc,OptimizerConstructors:JW,Pack:_G,PadV2:EG,Pool:ide,Pow:IG,Prelu:CG,Prod:NG,RMSPropOptimizer:BA,RaggedGather:AG,RaggedRange:kG,RaggedTensorToTensor:$G,Range:RG,get Rank(){return mI},Real:DG,RealDiv:Iz,Reciprocal:MG,get Reduction(){return br},Relu:OG,Relu6:VG,Reshape:PG,ResizeBilinear:LG,ResizeBilinearGrad:ade,ResizeNearestNeighbor:FG,ResizeNearestNeighborGrad:ode,Reverse:BG,RotateWithOffset:I6,Round:UG,Rsqrt:zG,SGDOptimizer:cT,ScatterNd:GG,SearchSorted:qG,Select:WG,Selu:KG,Sigmoid:QG,Sign:jG,Sin:YG,Sinh:JG,Slice:XG,Softmax:r6,Softplus:ZG,SpaceToBatchND:n6,SparseFillEmptyRows:i6,SparseReshape:o6,SparseSegmentMean:a6,SparseSegmentSum:l6,SparseToDense:u6,SplitV:s6,Sqrt:e6,Square:lde,SquaredDifference:c6,StaticRegexReplace:h6,Step:E6,StridedSlice:d6,StringNGrams:f6,StringSplit:p6,StringToHashBucketFast:m6,Sub:g6,Sum:t6,Tan:y6,Tanh:b6,Tensor:Vn,TensorBuffer:Vv,TensorScatterUpdate:HG,Tile:BN,TopK:v6,Transform:w6,Transpose:j1,Unique:T6,Unpack:x6,UnsortedSegmentSum:S6,UpperBound:ude,Variable:Dg,ZerosLike:_6,_FusedMatMul:cI,abs:ni,acos:sH,acosh:rH,add:ot,addN:iH,all:oH,any:aH,argMax:lH,argMin:uH,asin:cH,asinh:hH,atan:dH,atan2:fH,atanh:pH,avgPool:jN,avgPool3d:bH,backend:H6,backend_util:jve,basicLSTMCell:vH,batchNorm:wy,batchNorm2d:wH,batchNorm3d:TH,batchNorm4d:xH,batchToSpaceND:QN,bincount:ZN,bitwiseAnd:SH,booleanMaskAsync:cW,broadcastArgs:_H,broadcastTo:mg,broadcast_util:nme,browser:M1e,buffer:Aa,cast:vn,ceil:EH,clipByValue:IH,clone:ml,complex:El,concat:sr,concat1d:CH,concat2d:NH,concat3d:AH,concat4d:kH,conv1d:$H,conv2d:Ty,conv2dTranspose:DH,conv3d:MH,conv3dTranspose:OH,copyRegisteredKernels:pde,cos:PH,cosh:FH,cosineWindow:iT,cumprod:LH,cumsum:VH,customGrad:$a,denseBincount:BH,deprecationWarn:Jde,depthToSpace:UH,depthwiseConv2d:jw,device_util:Hde,diag:zH,dilation2d:GH,disableDeprecationWarnings:Yde,dispose:Tr,disposeVariables:jde,div:In,divNoNan:qH,dot:WH,dropout:mW,einsum:fh,elu:nA,enableDebugMode:Xde,enableProdMode:Kde,enclosingPowerOfTwo:RA,engine:Qde,ensureShape:KH,env:ut,equal:tA,erf:XH,euclideanNorm:jH,exp:oc,expandDims:il,expm1:QH,eye:rA,fft:nT,fill:wp,findBackend:ife,findBackendFactory:ofe,floor:iA,floorDiv:YN,fused:yW,gather:oA,gatherND:pW,gather_util:O1e,getBackend:G6,getGradient:fI,getKernel:$g,getKernelsForBackend:Fv,grad:Hme,grads:qme,greater:_y,greaterEqual:aA,ifft:Ug,imag:Ey,image:MA,inTopKAsync:gW,io:GA,irfft:IA,isFinite:ZH,isInf:eq,isNaN:tq,keep:Io,kernel_impls:Qve,leakyRelu:lA,less:zv,lessEqual:Qw,linalg:EW,linspace:nq,localResponseNormalization:sq,log:Wf,log1p:uA,logSigmoid:iq,logSoftmax:oq,logSumExp:hA,logicalAnd:Lg,logicalNot:dA,logicalOr:fA,logicalXor:aq,losses:IW,lowerBound:lq,matMul:tn,math:E1e,max:Eh,maxPool:pA,maxPool3d:uq,maxPoolWithArgmax:cq,maximum:mA,mean:Vg,memory:Zde,meshgrid:hq,min:Uv,minimum:Bg,mirrorPad:dq,mod:fq,moments:pq,movingAverage:hW,mul:Ue,multiRNNCell:mq,multinomial:gq,neg:Ao,nextFrame:Y1e,norm:Sy,notEqual:gA,oneHot:Gv,ones:Ru,onesLike:yq,op:j,outerProduct:bq,pad:Tp,pad1d:vq,pad2d:wq,pad3d:Tq,pad4d:xq,pool:Sq,pow:qf,prelu:bA,print:XN,prod:_q,profile:efe,raggedGather:Eq,raggedRange:Iq,raggedTensorToTensor:Cq,rand:Nq,randomGamma:$q,randomNormal:xA,randomStandardNormal:Rq,randomUniform:tT,randomUniformInt:Dq,range:Kf,ready:sfe,real:Xf,reciprocal:Mq,registerBackend:afe,registerGradient:hde,registerKernel:C6,relu:Iy,relu6:SA,removeBackend:rfe,reshape:ke,reverse:lc,reverse1d:Oq,reverse2d:Pq,reverse3d:Fq,reverse4d:Lq,rfft:sT,round:_A,rsqrt:Vq,scalar:Ot,scatterND:dW,scatter_util:Yye,searchSorted:eT,selu:Bq,separableConv2d:Uq,serialization:s1e,setBackend:nfe,setPlatform:lfe,setdiff1dAsync:zq,sigmoid:_h,sign:Gq,signal:_W,sin:Hq,sinh:qq,slice:hn,slice1d:Wq,slice2d:Kq,slice3d:Xq,slice4d:Yq,slice_util:YW,softmax:EA,softplus:cA,spaceToBatchND:yA,sparse:CW,sparseToDense:fW,spectral:SW,split:Yf,sqrt:ka,square:ji,squaredDifference:CA,squeeze:Cy,stack:Ra,step:NA,stridedSlice:Jq,string:NW,sub:wt,sum:En,sumOutType:Ode,tan:jq,tanh:Bv,tensor:No,tensor1d:xi,tensor2d:Af,tensor3d:AA,tensor4d:Qq,tensor5d:Zq,tensor6d:eW,tensorScatterUpdate:nW,tensor_util:Lde,test_util:lye,tidy:qt,tile:Nf,time:tfe,topk:sW,train:K1e,transpose:zg,truncatedNormal:rW,unique:iW,unregisterGradient:fde,unregisterKernel:dde,unsortedSegmentSum:oW,unstack:wc,upcastType:Jw,upperBound:aW,util:_de,valueAndGrad:Wme,valueAndGrads:Kme,variable:lW,variableGrads:rq,version_core:W1e,where:gl,whereAsync:$A,zeros:ac,zerosLike:oi},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ewe=ut();ewe.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var Zr;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(Zr||(Zr={}));var $3;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})($3||($3={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const twe={};function jW(n){return twe[n]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F(n,e,t,s,r){const i=e.inputParams[n];if(i&&i.inputIndexStart!==void 0){const a=i.inputIndexStart,l=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?a+1:i.inputIndexEnd,u=a<0?e.inputNames.length+a:a;if(i.type==="tensor")return Ls(e.inputNames[u],t,s,r);if(i.type==="tensors"){const p=e.inputs.slice(a,l);return e.inputNames.slice(a,l).filter((b,T)=>{var w;return((w=p[T])===null||w===void 0?void 0:w.op)!=="NoOp"}).map(b=>Ls(b,t,s,r))}const h=Ls(e.inputNames[u],t,s,r),f=h.dataSync();return i.type==="number"?f[0]:Sh(h.shape,f)}const o=e.attrParams[n];return o&&o.value}function Ls(n,e,t,s){const[r,i]=ei(n,t);if(s!=null){const a=s.getHashTableHandleByName(r);if(a!=null)return a}const o=t.currentContextIds.find(a=>!!e[Hv(r,a)]);return o!==void 0?e[Hv(r,o)][i]:void 0}function R3(n,e,t){return e[Hv(n,t.currentContextId)]}function ol(n,e){const[t,s,r]=ei(n,e);return[Hv(t,e&&e.currentContextId),s,r]}function Hv(n,e){return e?`${n}-${e}`:n}function ei(n,e){if(n==="")return["",0,void 0];const t=e!=null&&e.parseNodeNameCache!=null;if(t){const i=e.parseNodeNameCache.get(n);if(i!=null)return i}const s=n.split(":");let r;if(s.length===1)r=[n,0,void 0];else{const i=s[0],o=s.length===3?s[1]:void 0,a=Number(s[s.length-1]);r=[i,a,o]}return t&&e.parseNodeNameCache.set(n,r),r}function av(n,e,t){let s=F("pad",n,e,t);if(s==="explicit"){s=F("explicitPaddings",n,e,t);const r=[[0,0],[0,0],[0,0],[0,0]];for(let i=0;i<4;i++)r[i][0]=s[i*2],r[i][1]=s[i*2+1];return r}return s}function al(n){return n.kept?n:ml(n)}/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nwe=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],swe=Object.freeze(Object.defineProperty({__proto__:null,json:nwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rwe=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],iwe=Object.freeze(Object.defineProperty({__proto__:null,json:rwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const owe=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],awe=Object.freeze(Object.defineProperty({__proto__:null,json:owe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lwe=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],uwe=Object.freeze(Object.defineProperty({__proto__:null,json:lwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cwe=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],hwe=Object.freeze(Object.defineProperty({__proto__:null,json:cwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dwe=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],fwe=Object.freeze(Object.defineProperty({__proto__:null,json:dwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pwe=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],mwe=Object.freeze(Object.defineProperty({__proto__:null,json:pwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gwe=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],ywe=Object.freeze(Object.defineProperty({__proto__:null,json:gwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bwe=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],vwe=Object.freeze(Object.defineProperty({__proto__:null,json:bwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wwe=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],Twe=Object.freeze(Object.defineProperty({__proto__:null,json:wwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xwe=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],Swe=Object.freeze(Object.defineProperty({__proto__:null,json:xwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _we=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],Ewe=Object.freeze(Object.defineProperty({__proto__:null,json:_we},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iwe=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],Cwe=Object.freeze(Object.defineProperty({__proto__:null,json:Iwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nwe=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],Awe=Object.freeze(Object.defineProperty({__proto__:null,json:Nwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kwe=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],$we=Object.freeze(Object.defineProperty({__proto__:null,json:kwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rwe=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],Dwe=Object.freeze(Object.defineProperty({__proto__:null,json:Rwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mwe=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],Owe=Object.freeze(Object.defineProperty({__proto__:null,json:Mwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pwe=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],Fwe=Object.freeze(Object.defineProperty({__proto__:null,json:Pwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lwe=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],Vwe=Object.freeze(Object.defineProperty({__proto__:null,json:Lwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D3{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[swe,iwe,awe,uwe,hwe,fwe,mwe,ywe,vwe,Twe,Swe,Ewe,Cwe,Awe,$we,Dwe,Owe,Fwe,Vwe],t=[].concat(...e.map(s=>s.json));this.opMappers=t.reduce((s,r)=>(s[r.tfOpName]=r,s),{})}transformGraph(e,t={}){const s=e.node,r=[],i=[],o=[],a=s.reduce((T,w)=>(T[w.name]=this.mapNode(w),w.op.startsWith("Placeholder")?r.push(T[w.name]):w.op==="Const"?i.push(T[w.name]):(w.input==null||w.input.length===0)&&o.push(T[w.name]),T),{});let l=[];const u=[];let h={},f={};t!=null&&(h=this.mapSignatureEntries(t.inputs),f=this.mapSignatureEntries(t.outputs));const p=Object.keys(a);p.forEach(T=>{const w=a[T];w.inputNames.forEach((_,C)=>{const[N,,A]=ol(_),P=a[N];if(P.outputs!=null){const V=P.outputs.indexOf(A);if(V!==-1){const D=`${N}:${V}`;w.inputNames[C]=D}}w.inputs.push(P),P.children.push(w)})}),Object.keys(f).length===0?p.forEach(T=>{const w=a[T];w.children.length===0&&u.push(w)}):Object.keys(f).forEach(T=>{const[w]=ol(T),_=a[w];_!=null&&(_.signatureKey=f[T],u.push(_))}),Object.keys(h).length>0?Object.keys(h).forEach(T=>{const[w]=ol(T),_=a[w];_&&(_.signatureKey=h[T],l.push(_))}):l=r;let g={};e.library!=null&&e.library.function!=null&&(g=e.library.function.reduce((T,w)=>(T[w.signature.name]=this.mapFunction(w),T),{}));const b={nodes:a,inputs:l,outputs:u,weights:i,placeholders:r,signature:t,functions:g};return o.length>0&&(b.initNodes=o),b}mapSignatureEntries(e){return Object.keys(e||{}).reduce((t,s)=>(t[e[s].name]=s,t),{})}mapNode(e){const t=jW(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});const s={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(r=>r.startsWith("^")?r.slice(1):r),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(s.inputParams=t.inputs.reduce((r,i)=>(r[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},r),{})),t.attrs!=null&&(s.attrParams=t.attrs.reduce((r,i)=>{const o=i.type;let a;switch(i.type){case"string":a=$I(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=$I(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":a=LI(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=LI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":a=DI(e.attr,i.tfName,i.defaultValue||0),a===void 0&&i.tfDeprecatedName&&(a=DI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":a=FI(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=FI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":a=RI(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=RI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":a=BI(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=BI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":a=PI(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=PI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":a=VI(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=VI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":a=MI(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=MI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":a=OI(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=OI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":a=M3(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=M3(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${i.type} for op: ${e.op}`)}return r[i.name]={value:a,type:o},r},{})),s}mapFunction(e){const t=e.nodeDef,s=[],r=[];let i={};t!=null&&(i=t.reduce((f,p)=>(f[p.name]=this.mapNode(p),p.op==="Const"&&r.push(f[p.name]),f),{}));const o=[],a=[];e.signature.inputArg.forEach(f=>{const[p]=ol(f.name),g={name:p,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:qA(f.type),type:"dtype"}},children:[]};g.signatureKey=f.name,o.push(g),i[p]=g}),Object.keys(i).forEach(f=>{const p=i[f];p.inputNames.forEach((g,b)=>{const[T,,w]=ol(g),_=i[T];if(_.outputs!=null){const C=_.outputs.indexOf(w);if(C!==-1){const N=`${T}:${C}`;p.inputNames[b]=N}}p.inputs.push(_),_.children.push(p)})});const u=e.ret;e.signature.outputArg.forEach(f=>{const[p,g]=ol(u[f.name]),b=i[p];b!=null&&(b.defaultOutput=g,a.push(b))});const h=this.mapArgsToSignature(e);return{nodes:i,inputs:o,outputs:a,weights:r,placeholders:s,signature:h}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((t,s)=>(t[s.name]=this.mapArgToTensorInfo(s),t),{}),outputs:e.signature.outputArg.reduce((t,s)=>(t[s.name]=this.mapArgToTensorInfo(s,e.ret),t),{})}}mapArgToTensorInfo(e,t){let s=e.name;return t!=null&&(s=t[s]),{name:s,dtype:e.type}}}function Bwe(n){const e=ut().global;if(typeof e.atob<"u")return e.atob(n);if(typeof Buffer<"u")return new Buffer(n,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function QW(n,e){const t=Array.isArray(n)?String.fromCharCode.apply(null,n):Bwe(n);return e?t:t.toLowerCase()}function $I(n,e,t,s=!1){const r=n[e];return r!=null?QW(r.s,s):t}function RI(n,e,t){const s=n[e];return s?s.b:t}function DI(n,e,t){const s=n[e]||{},r=s.i!=null?s.i:s.f!=null?s.f:t;return typeof r=="number"?r:parseInt(r,10)}function qA(n){switch(typeof n=="string"&&(n=Zr[n]),n){case Zr.DT_FLOAT:case Zr.DT_HALF:return"float32";case Zr.DT_INT32:case Zr.DT_INT64:case Zr.DT_INT8:case Zr.DT_UINT8:return"int32";case Zr.DT_BOOL:return"bool";case Zr.DT_DOUBLE:return"float32";case Zr.DT_STRING:return"string";case Zr.DT_COMPLEX64:case Zr.DT_COMPLEX128:return"complex64";default:return null}}function M3(n,e,t){const s=n[e];return s&&s.func?s.func.name:t}function MI(n,e,t){const s=n[e];return s&&s.type?qA(s.type):t}function OI(n,e,t){const s=n[e];return s&&s.list&&s.list.type?s.list.type.map(r=>qA(r)):t}function ZW(n){if(!n.unknownRank)return n.dim!=null?n.dim.map(e=>typeof e.size=="number"?e.size:parseInt(e.size,10)):[]}function PI(n,e,t){const s=n[e];return s&&s.shape?ZW(s.shape):t}function FI(n,e,t){const s=n[e];return s?((s.list.f&&s.list.f.length?s.list.f:s.list.i)||[]).map(r=>typeof r=="number"?r:parseInt(r,10)):t}function LI(n,e,t,s=!1){const r=n[e];return r&&r.list&&r.list.s?r.list.s.map(i=>QW(i,s)):t}function VI(n,e,t){const s=n[e];return s&&s.list&&s.list.shape?s.list.shape.map(r=>ZW(r)):t}function BI(n,e,t){const s=n[e];return s&&s.list&&s.list.b?s.list.b:t}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uwe{constructor(e,t,s){this.node=e,this.tensorMap=t,this.context=s,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(r=>this.getInput(r)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((r,i)=>(r[i]=this.getAttr(i),r),{}))}getInput(e){return Ls(e,this.tensorMap,this.context)}getAttr(e,t){const s=this.node.rawAttrs[e];if(s.tensor!=null)return Ls(e,this.tensorMap,this.context);if(s.i!=null||s.f!=null)return DI(this.node.rawAttrs,e,t);if(s.s!=null)return $I(this.node.rawAttrs,e,t);if(s.b!=null)return RI(this.node.rawAttrs,e,t);if(s.shape!=null)return PI(this.node.rawAttrs,e,t);if(s.type!=null)return MI(this.node.rawAttrs,e,t);if(s.list!=null){if(s.list.i!=null||s.list.f!=null)return FI(this.node.rawAttrs,e,t);if(s.list.s!=null)return LI(this.node.rawAttrs,e,t);if(s.list.shape!=null)return VI(this.node.rawAttrs,e,t);if(s.list.b!=null)return BI(this.node.rawAttrs,e,t);if(s.list.type!=null)return OI(this.node.rawAttrs,e,t)}return t}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Us=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:qN,abs:ni,acos:sH,acosh:rH,add:ot,addN:iH,all:oH,any:aH,argMax:lH,argMin:uH,asin:cH,asinh:hH,atan:dH,atan2:fH,atanh:pH,avgPool:jN,avgPool3d:bH,basicLSTMCell:vH,batchNorm:wy,batchNorm2d:wH,batchNorm3d:TH,batchNorm4d:xH,batchToSpaceND:QN,bincount:ZN,bitwiseAnd:SH,booleanMaskAsync:cW,broadcastArgs:_H,broadcastTo:mg,buffer:Aa,cast:vn,ceil:EH,clipByValue:IH,clone:ml,complex:El,concat:sr,concat1d:CH,concat2d:NH,concat3d:AH,concat4d:kH,conv1d:$H,conv2d:Ty,conv2dTranspose:DH,conv3d:MH,conv3dTranspose:OH,cos:PH,cosh:FH,cosineWindow:iT,cumprod:LH,cumsum:VH,denseBincount:BH,depthToSpace:UH,depthwiseConv2d:jw,diag:zH,dilation2d:GH,div:In,divNoNan:qH,dot:WH,dropout:mW,einsum:fh,elu:nA,enclosingPowerOfTwo:RA,ensureShape:KH,equal:tA,erf:XH,euclideanNorm:jH,exp:oc,expandDims:il,expm1:QH,eye:rA,fft:nT,fill:wp,floor:iA,floorDiv:YN,fused:yW,gather:oA,gatherND:pW,greater:_y,greaterEqual:aA,ifft:Ug,imag:Ey,image:MA,inTopKAsync:gW,irfft:IA,isFinite:ZH,isInf:eq,isNaN:tq,leakyRelu:lA,less:zv,lessEqual:Qw,linalg:EW,linspace:nq,localResponseNormalization:sq,log:Wf,log1p:uA,logSigmoid:iq,logSoftmax:oq,logSumExp:hA,logicalAnd:Lg,logicalNot:dA,logicalOr:fA,logicalXor:aq,losses:IW,lowerBound:lq,matMul:tn,max:Eh,maxPool:pA,maxPool3d:uq,maxPoolWithArgmax:cq,maximum:mA,mean:Vg,meshgrid:hq,min:Uv,minimum:Bg,mirrorPad:dq,mod:fq,moments:pq,movingAverage:hW,mul:Ue,multiRNNCell:mq,multinomial:gq,neg:Ao,norm:Sy,notEqual:gA,oneHot:Gv,ones:Ru,onesLike:yq,op:j,outerProduct:bq,pad:Tp,pad1d:vq,pad2d:wq,pad3d:Tq,pad4d:xq,pool:Sq,pow:qf,prelu:bA,print:XN,prod:_q,raggedGather:Eq,raggedRange:Iq,raggedTensorToTensor:Cq,rand:Nq,randomGamma:$q,randomNormal:xA,randomStandardNormal:Rq,randomUniform:tT,randomUniformInt:Dq,range:Kf,real:Xf,reciprocal:Mq,relu:Iy,relu6:SA,reshape:ke,reverse:lc,reverse1d:Oq,reverse2d:Pq,reverse3d:Fq,reverse4d:Lq,rfft:sT,round:_A,rsqrt:Vq,scalar:Ot,scatterND:dW,searchSorted:eT,selu:Bq,separableConv2d:Uq,setdiff1dAsync:zq,sigmoid:_h,sign:Gq,signal:_W,sin:Hq,sinh:qq,slice:hn,slice1d:Wq,slice2d:Kq,slice3d:Xq,slice4d:Yq,softmax:EA,softplus:cA,spaceToBatchND:yA,sparse:CW,sparseToDense:fW,spectral:SW,split:Yf,sqrt:ka,square:ji,squaredDifference:CA,squeeze:Cy,stack:Ra,step:NA,stridedSlice:Jq,string:NW,sub:wt,sum:En,tan:jq,tanh:Bv,tensor:No,tensor1d:xi,tensor2d:Af,tensor3d:AA,tensor4d:Qq,tensor5d:Zq,tensor6d:eW,tensorScatterUpdate:nW,tile:Nf,topk:sW,transpose:zg,truncatedNormal:rW,unique:iW,unsortedSegmentSum:oW,unstack:wc,upperBound:aW,variable:lW,where:gl,whereAsync:$A,zeros:ac,zerosLike:oi},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zwe=(n,e,t,s=Us)=>{switch(n.op){case"BiasAdd":case"AddV2":case"Add":return[s.add(F("a",n,e,t),F("b",n,e,t))];case"AddN":return[s.addN(F("tensors",n,e,t))];case"FloorMod":case"Mod":return[s.mod(F("a",n,e,t),F("b",n,e,t))];case"Mul":return[s.mul(F("a",n,e,t),F("b",n,e,t))];case"RealDiv":case"Div":return[s.div(F("a",n,e,t),F("b",n,e,t))];case"DivNoNan":return[s.divNoNan(F("a",n,e,t),F("b",n,e,t))];case"FloorDiv":return[s.floorDiv(F("a",n,e,t),F("b",n,e,t))];case"Sub":return[s.sub(F("a",n,e,t),F("b",n,e,t))];case"Minimum":return[s.minimum(F("a",n,e,t),F("b",n,e,t))];case"Maximum":return[s.maximum(F("a",n,e,t),F("b",n,e,t))];case"Pow":return[s.pow(F("a",n,e,t),F("b",n,e,t))];case"SquaredDifference":return[s.squaredDifference(F("a",n,e,t),F("b",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gwe=(n,e,t,s=Us)=>{switch(n.op){case"Abs":case"ComplexAbs":return[s.abs(F("x",n,e,t))];case"Acos":return[s.acos(F("x",n,e,t))];case"Acosh":return[s.acosh(F("x",n,e,t))];case"Asin":return[s.asin(F("x",n,e,t))];case"Asinh":return[s.asinh(F("x",n,e,t))];case"Atan":return[s.atan(F("x",n,e,t))];case"Atan2":return[s.atan2(F("x",n,e,t),F("y",n,e,t))];case"Atanh":return[s.atanh(F("x",n,e,t))];case"Ceil":return[s.ceil(F("x",n,e,t))];case"Complex":return[s.complex(F("real",n,e,t),F("imag",n,e,t))];case"Cos":return[s.cos(F("x",n,e,t))];case"Cosh":return[s.cosh(F("x",n,e,t))];case"Elu":return[s.elu(F("x",n,e,t))];case"Erf":return[s.erf(F("x",n,e,t))];case"Exp":return[s.exp(F("x",n,e,t))];case"Expm1":return[s.expm1(F("x",n,e,t))];case"Floor":return[s.floor(F("x",n,e,t))];case"Log":return[s.log(F("x",n,e,t))];case"Log1p":return[s.log1p(F("x",n,e,t))];case"Imag":return[s.imag(F("x",n,e,t))];case"Neg":return[s.neg(F("x",n,e,t))];case"Reciprocal":return[s.reciprocal(F("x",n,e,t))];case"Real":return[s.real(F("x",n,e,t))];case"Relu":return[s.relu(F("x",n,e,t))];case"Round":return[s.round(F("x",n,e,t))];case"Selu":return[s.selu(F("x",n,e,t))];case"Sigmoid":return[s.sigmoid(F("x",n,e,t))];case"Sin":return[s.sin(F("x",n,e,t))];case"Sign":return[s.sign(F("x",n,e,t))];case"Sinh":return[s.sinh(F("x",n,e,t))];case"Softplus":return[s.softplus(F("x",n,e,t))];case"Sqrt":return[s.sqrt(F("x",n,e,t))];case"Square":return[s.square(F("x",n,e,t))];case"Tanh":return[s.tanh(F("x",n,e,t))];case"Tan":return[s.tan(F("x",n,e,t))];case"ClipByValue":return[s.clipByValue(F("x",n,e,t),F("clipValueMin",n,e,t),F("clipValueMax",n,e,t))];case"Relu6":return[s.relu6(F("x",n,e,t))];case"Rsqrt":return[s.rsqrt(Ls(n.inputNames[0],e,t))];case"LeakyRelu":return[s.leakyRelu(F("x",n,e,t),F("alpha",n,e,t))];case"Prelu":return[s.prelu(F("x",n,e,t),F("alpha",n,e,t))];case"IsNan":return[s.isNaN(Ls(n.inputNames[0],e,t))];case"IsInf":return[s.isInf(Ls(n.inputNames[0],e,t))];case"IsFinite":return[s.isFinite(Ls(n.inputNames[0],e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qi(n,e,t=""){if(!(typeof n=="number"||typeof e=="number")){Y(n.length===e.length,()=>t+` Shapes ${n} and ${e} must match`);for(let s=0;s<n.length;s++){const r=n[s],i=e[s];Y(r<0||i<0||r===i,()=>t+` Shapes ${n} and ${e} must match`)}}}function O3(n){return!(typeof n=="number"||n.some(e=>e<0))}function Hm(n,e,t){let s=UI(n,t);const r=!O3(s);if(r&&e.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${s}`);if(r&&e.forEach(i=>{s=UI(i.shape,s)}),!O3(s))throw new Error(`Non-fully-defined elementShape: ${s}`);return s}function UI(n,e){if(typeof n=="number")return e;if(typeof e=="number")return n;if(n.length!==e.length)throw new Error(`Incompatible ranks during merge: ${n} vs. ${e}`);const t=[];for(let s=0;s<n.length;++s){const r=n[s],i=e[s];if(r>=0&&i>=0&&r!==i)throw new Error(`Incompatible shape during merge: ${n} vs. ${e}`);t[s]=r>=0?r:i}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hwe{constructor(e,t,s,r,i,o,a){this.name=e,this.dtype=t,this.maxSize=s,this.elementShape=r,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=a,this.tensors=[],this.closed_=!1,this.idTensor=Ot(0),Io(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const t=this.tensors[e];if(t.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map(t=>this.read(t))}write(e,t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const s=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${t.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),qi(this.elementShape,t.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),s.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(s.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);s.tensor=t,Io(t),s.written=!0,this.tensors[e]=s}writeMany(e,t){if(e.length!==t.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${t.length}.`);e.forEach((s,r)=>this.write(s,t[r]))}gather(e,t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${t}`);if(e)e=e.slice(0,this.size());else{e=[];for(let r=0;r<this.size();r++)e.push(r)}if(e.length===0)return No([],[0].concat(this.elementShape));const s=this.readMany(e);return qi(this.elementShape,s[0].shape,"TensorArray shape mismatch: "),Ra(s,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return No([],[0].concat(this.elementShape));const t=[];for(let r=0;r<this.size();r++)t.push(r);const s=this.readMany(t);return qi(this.elementShape,s[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${s[0].shape})`),sr(s,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const s=Math.max(...e);if(!this.dynamicSize&&s>=this.maxSize)throw new Error(`Max index must be < array size (${s}  vs. ${this.maxSize})`);this.writeMany(e,wc(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);let s=0;const r=e.map(l=>(s+=l,s));if(s!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${t.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const i=s===0?0:t.size/s,o=[];qt(()=>{t=ke(t,[1,s,i]);for(let l=0;l<e.length;++l){const h=[0,l===0?0:r[l-1],0],f=[1,e[l],i];o[l]=ke(hn(t,h,f),this.elementShape)}return o});const a=[];for(let l=0;l<e.length;l++)a[l]=l;this.writeMany(a,o)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vh{get id(){return this.idTensor.id}constructor(e,t,s,r=-1){this.tensors=e,this.elementShape=t,this.elementDtype=s,e!=null&&e.forEach(i=>{if(s!==i.dtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${i.dtype}`);qi(t,i.shape,"TensorList shape mismatch: "),Io(i)}),this.idTensor=Ot(0),this.maxNumElements=r,Io(this.idTensor)}copy(){return new Vh([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.id))&&t.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,t,s=-1){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(s!==-1&&this.tensors.length!==s)throw new Error(`Operation expected a list with ${s} elements but got a list with ${this.tensors.length} elements.`);qi(e,this.elementShape,"TensorList shape mismatch: ");const r=Hm(this.elementShape,this.tensors,e);return qt(()=>{const i=this.tensors.map(o=>ke(o,r));return Ra(i,0)})}popBack(e,t){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");const s=Hm(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,qi(r.shape,e,"TensorList shape mismatch: "),ke(r,s)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(qi(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Io(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);const t=new Vh([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(let s=0;s<Math.min(this.tensors.length,e);++s)t.tensors[s]=this.tensors[s];return t}getItem(e,t,s){if(s!==this.elementDtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(this.tensors[e]==null)throw new Error(`element at index ${e} is null.`);qi(this.tensors[e].shape,t,"TensorList shape mismatch: ");const r=Hm(this.elementShape,this.tensors,t);return ke(this.tensors[e],r)}setItem(e,t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);qi(this.elementShape,t.shape,"TensorList shape mismatch: "),Io(t),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=t}gather(e,t,s){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);qi(this.elementShape,s,"TensorList shape mismatch: "),e=e.slice(0,this.size());const r=Hm(this.elementShape,this.tensors,s);return e.length===0?No([],[0].concat(r)):qt(()=>{const i=e.map(o=>ke(this.tensors[o],r));return Ra(i,0)})}concat(e,t){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);qi(this.elementShape,t,"TensorList shape mismatch: ");const s=Hm(this.elementShape,this.tensors,t);return this.size()===0?No([],[0].concat(s)):qt(()=>{const r=this.tensors.map(i=>ke(i,s));return sr(r,0)})}}function qwe(n,e,t){const s=n.dtype;if(n.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${n.shape}`);if(n.dtype!==t)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${t}`);const r=n.shape.slice(1);qi(r,e,"TensorList shape mismatch: ");const i=wc(n);return new Vh(i,e,s)}function Wwe(n,e,t,s){return new Vh([],n,e,s)}function Kwe(n,e,t,s){if(e.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${n.shape[0]}`);const r=Math.max(...e);if(s!=null&&s!==-1&&r>=s)throw new Error(`Max index must be < array size (${r}  vs. ${s})`);const i=new Vh([],t,n.dtype,s),o=wc(n,0);return e.forEach((a,l)=>{i.setItem(a,o[l])}),i}function Xwe(n,e,t){let s=0;const r=e.map(h=>(s+=h,s));if(s!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${n.shape}`);const i=n.shape.slice(1),o=UI(i,t),a=s===0?0:n.size/s,l=qt(()=>{const h=[];n=ke(n,[1,s,a]);for(let f=0;f<e.length;++f){const g=[0,f===0?0:r[f-1],0],b=[1,e[f],a];h[f]=ke(hn(n,g,b),o)}return n.dispose(),h}),u=new Vh([],t,n.dtype,e.length);for(let h=0;h<l.length;h++)u.setItem(h,l[h]);return u}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ywe=async(n,e,t)=>{switch(n.op){case"If":case"StatelessIf":{const s=F("thenBranch",n,e,t),r=F("elseBranch",n,e,t),i=F("cond",n,e,t),o=F("args",n,e,t);return(await i.data())[0]?t.functionMap[s].executeFunctionAsync(o,t.tensorArrayMap,t.tensorListMap):t.functionMap[r].executeFunctionAsync(o,t.tensorArrayMap,t.tensorListMap)}case"While":case"StatelessWhile":{const s=F("body",n,e,t),r=F("cond",n,e,t),i=F("args",n,e,t),o=await t.functionMap[r].executeFunctionAsync(i,t.tensorArrayMap,t.tensorListMap),a=i.map(h=>h.id);let l=await o[0].data();o.forEach(h=>{!h.kept&&a.indexOf(h.id)===-1&&h.dispose()});let u=i;for(;l[0];){const h=u;u=await t.functionMap[s].executeFunctionAsync(u,t.tensorArrayMap,t.tensorListMap);const f=u.map(g=>g.id);h.forEach(g=>{!g.kept&&a.indexOf(g.id)===-1&&f.indexOf(g.id)===-1&&g.dispose()});const p=await t.functionMap[r].executeFunctionAsync(u,t.tensorArrayMap,t.tensorListMap);l=await p[0].data(),p.forEach(g=>{!g.kept&&a.indexOf(g.id)===-1&&f.indexOf(g.id)===-1&&g.dispose()})}return u}case"LoopCond":{const s=F("pred",n,e,t);return[al(s)]}case"Switch":{const s=F("pred",n,e,t);let r=F("data",n,e,t);return r.kept||(r=al(r)),(await s.data())[0]?[void 0,r]:[r,void 0]}case"Merge":{const s=n.inputNames.find(r=>Ls(r,e,t)!==void 0);if(s){const r=Ls(s,e,t);return[al(r)]}return}case"Enter":{const s=F("frameName",n,e,t),r=F("tensor",n,e,t);return t.enterFrame(s),[al(r)]}case"Exit":{const s=F("tensor",n,e,t);return t.exitFrame(),[al(s)]}case"NextIteration":{const s=F("tensor",n,e,t);return t.nextIteration(),[al(s)]}case"TensorArrayV3":{const s=F("size",n,e,t),r=F("dtype",n,e,t),i=F("elementShape",n,e,t),o=F("dynamicSize",n,e,t),a=F("clearAfterRead",n,e,t),l=F("identicalElementShapes",n,e,t),u=F("name",n,e,t),h=new Hwe(u,r,s,i,l,o,a);return t.addTensorArray(h),[h.idTensor,Ot(1)]}case"TensorArrayWriteV3":{const s=F("tensorArrayId",n,e,t),r=F("index",n,e,t),i=F("tensor",n,e,t),o=t.getTensorArray(s.id);return o.write(r,i),[o.idTensor]}case"TensorArrayReadV3":{const s=F("tensorArrayId",n,e,t),r=F("index",n,e,t);return[t.getTensorArray(s.id).read(r)]}case"TensorArrayGatherV3":{const s=F("tensorArrayId",n,e,t),r=F("indices",n,e,t),i=F("dtype",n,e,t);return[t.getTensorArray(s.id).gather(r,i)]}case"TensorArrayScatterV3":{const s=F("tensorArrayId",n,e,t),r=F("indices",n,e,t),i=F("tensor",n,e,t),o=t.getTensorArray(s.id);return o.scatter(r,i),[o.idTensor]}case"TensorArrayConcatV3":{const s=F("tensorArrayId",n,e,t),r=t.getTensorArray(s.id),i=F("dtype",n,e,t);return[r.concat(i)]}case"TensorArraySplitV3":{const s=F("tensorArrayId",n,e,t),r=F("tensor",n,e,t),i=F("lengths",n,e,t),o=t.getTensorArray(s.id);return o.split(i,r),[o.idTensor]}case"TensorArraySizeV3":{const s=F("tensorArrayId",n,e,t),r=t.getTensorArray(s.id);return[Ot(r.size(),"int32")]}case"TensorArrayCloseV3":{const s=F("tensorArrayId",n,e,t),r=t.getTensorArray(s.id);return r.clearAndClose(),[r.idTensor]}case"TensorListSetItem":{const s=F("tensorListId",n,e,t),r=F("index",n,e,t),i=F("tensor",n,e,t),o=t.getTensorList(s.id);return o.setItem(r,i),[o.idTensor]}case"TensorListGetItem":{const s=F("tensorListId",n,e,t),r=F("index",n,e,t),i=F("elementShape",n,e,t),o=F("elementDType",n,e,t);return[t.getTensorList(s.id).getItem(r,i,o)]}case"TensorListScatterV2":case"TensorListScatter":{const s=F("indices",n,e,t),r=F("tensor",n,e,t),i=F("elementShape",n,e,t),o=F("numElements",n,e,t),a=Kwe(r,s,i,o);return t.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const s=F("elementShape",n,e,t),r=F("elementDType",n,e,t);let i;n.op==="TensorListReserve"?i="numElements":i="maxNumElements";const o=F(i,n,e,t),a=n.op==="TensorListReserve"?-1:o,l=Wwe(s,r,o,a);return t.addTensorList(l),[l.idTensor]}case"TensorListGather":{const s=F("tensorListId",n,e,t),r=F("indices",n,e,t),i=F("elementShape",n,e,t),o=F("elementDType",n,e,t);return[t.getTensorList(s.id).gather(r,o,i)]}case"TensorListStack":{const s=F("tensorListId",n,e,t),r=F("elementShape",n,e,t),i=F("elementDType",n,e,t),o=F("numElements",n,e,t);return[t.getTensorList(s.id).stack(r,i,o)]}case"TensorListFromTensor":{const s=F("tensor",n,e,t),r=F("elementShape",n,e,t),i=F("elementDType",n,e,t),o=qwe(s,r,i);return t.addTensorList(o),[o.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const s=F("tensorListId",n,e,t),r=t.getTensorList(s.id),i=F("dtype",n,e,t),o=F("elementShape",n,e,t);return[r.concat(i,o)]}case"TensorListPushBack":{const s=F("tensorListId",n,e,t),r=F("tensor",n,e,t),i=t.getTensorList(s.id);return i.pushBack(r),[i.idTensor]}case"TensorListPopBack":{const s=F("tensorListId",n,e,t),r=F("elementShape",n,e,t),i=F("elementDType",n,e,t);return[t.getTensorList(s.id).popBack(r,i)]}case"TensorListSplit":{const s=F("tensor",n,e,t),r=F("elementShape",n,e,t),i=F("lengths",n,e,t),o=Xwe(s,i,r);return t.addTensorList(o),[o.idTensor]}case"TensorListLength":{const s=F("tensorListId",n,e,t),r=t.getTensorList(s.id);return[Ot(r.size(),"int32")]}case"TensorListResize":{const s=F("tensorListId",n,e,t),r=F("size",n,e,t),o=t.getTensorList(s.id).resize(r);return t.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P3(n,e,t){const[s,r]=F("fusedOps",n,e,t),i=s==="biasadd",o=!i,a=r==="prelu",l=s==="fusedbatchnorm",u=F("numArgs",n,e,t);if(i){if(a&&u!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&i&&u!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const h=F("strides",n,e,t),f=av(n,e,t),p=F("dataFormat",n,e,t).toUpperCase(),g=F("dilations",n,e,t);let[b,T]=F("args",n,e,t);o&&(T=b,b=void 0);const w=F("leakyreluAlpha",n,e,t);return{stride:h,pad:f,dataFormat:p,dilations:g,biasArg:b,preluArg:T,activationFunc:r,leakyreluAlpha:w}}const Jwe=(n,e,t,s=Us)=>{switch(n.op){case"Conv1D":{const r=F("stride",n,e,t),i=F("pad",n,e,t),o=F("dataFormat",n,e,t).toUpperCase(),a=F("dilation",n,e,t);return[s.conv1d(F("x",n,e,t),F("filter",n,e,t),r,i,o,a)]}case"Conv2D":{const r=F("strides",n,e,t),i=av(n,e,t),o=F("dataFormat",n,e,t).toUpperCase(),a=F("dilations",n,e,t);return[s.conv2d(F("x",n,e,t),F("filter",n,e,t),[r[1],r[2]],i,o,[a[1],a[2]])]}case"_FusedConv2D":{const{stride:r,pad:i,dataFormat:o,dilations:a,biasArg:l,preluArg:u,activationFunc:h,leakyreluAlpha:f}=P3(n,e,t);return[s.fused.conv2d({x:F("x",n,e,t),filter:F("filter",n,e,t),strides:[r[1],r[2]],pad:i,dataFormat:o,dilations:[a[1],a[2]],bias:l,activation:h,preluActivationWeights:u,leakyreluAlpha:f})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:i,dataFormat:o,dilations:a,biasArg:l,preluArg:u,activationFunc:h,leakyreluAlpha:f}=P3(n,e,t);return[s.fused.depthwiseConv2d({x:F("x",n,e,t),filter:F("filter",n,e,t),strides:[r[1],r[2]],pad:i,dataFormat:o,dilations:[a[1],a[2]],bias:l,activation:h,preluActivationWeights:u,leakyreluAlpha:f})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=F("outputShape",n,e,t),i=F("strides",n,e,t),o=av(n,e,t);return[s.conv2dTranspose(F("x",n,e,t),F("filter",n,e,t),r,[i[1],i[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=F("strides",n,e,t),i=av(n,e,t),o=F("dilations",n,e,t),a=F("dataFormat",n,e,t).toUpperCase();return[s.depthwiseConv2d(F("input",n,e,t),F("filter",n,e,t),[r[1],r[2]],i,a,[o[1],o[2]])]}case"Conv3D":{const r=F("strides",n,e,t),i=F("pad",n,e,t),o=F("dataFormat",n,e,t).toUpperCase(),a=F("dilations",n,e,t);return[s.conv3d(F("x",n,e,t),F("filter",n,e,t),[r[1],r[2],r[3]],i,o,[a[1],a[2],a[3]])]}case"AvgPool":{const r=F("strides",n,e,t),i=F("pad",n,e,t),o=F("kernelSize",n,e,t);return[s.avgPool(F("x",n,e,t),[o[1],o[2]],[r[1],r[2]],i)]}case"MaxPool":{const r=F("strides",n,e,t),i=F("pad",n,e,t),o=F("kernelSize",n,e,t);return[s.maxPool(F("x",n,e,t),[o[1],o[2]],[r[1],r[2]],i)]}case"MaxPoolWithArgmax":{const r=F("strides",n,e,t),i=F("pad",n,e,t),o=F("kernelSize",n,e,t),a=F("includeBatchInIndex",n,e,t),{result:l,indexes:u}=s.maxPoolWithArgmax(F("x",n,e,t),[o[1],o[2]],[r[1],r[2]],i,a);return[l,u]}case"AvgPool3D":{const r=F("strides",n,e,t),i=F("pad",n,e,t),o=F("kernelSize",n,e,t);return[s.avgPool3d(F("x",n,e,t),[o[1],o[2],o[3]],[r[1],r[2],r[3]],i)]}case"MaxPool3D":{const r=F("strides",n,e,t),i=F("pad",n,e,t),o=F("kernelSize",n,e,t);return[s.maxPool3d(F("x",n,e,t),[o[1],o[2],o[3]],[r[1],r[2],r[3]],i)]}case"Dilation2D":{const r=F("strides",n,e,t),i=F("pad",n,e,t),o=F("dilations",n,e,t),a=r[1],l=r[2],u=o[1],h=o[2];return[s.dilation2d(F("x",n,e,t),F("filter",n,e,t),[a,l],i,[u,h],"NHWC")]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jwe=(n,e,t,s=Us)=>{switch(n.op){case"Fill":{const r=F("shape",n,e,t),i=F("dtype",n,e,t),o=F("value",n,e,t);return[s.fill(r,o,i)]}case"LinSpace":{const r=F("start",n,e,t),i=F("stop",n,e,t),o=F("num",n,e,t);return[s.linspace(r,i,o)]}case"Multinomial":{const r=F("logits",n,e,t),i=F("numSamples",n,e,t),o=F("seed",n,e,t);return[s.multinomial(r,i,o)]}case"OneHot":{const r=F("indices",n,e,t),i=F("depth",n,e,t),o=F("onValue",n,e,t),a=F("offValue",n,e,t),l=F("dtype",n,e,t);return[s.oneHot(r,i,o,a,l)]}case"Ones":return[s.ones(F("shape",n,e,t),F("dtype",n,e,t))];case"OnesLike":return[s.onesLike(F("x",n,e,t))];case"RandomStandardNormal":return[s.randomStandardNormal(F("shape",n,e,t),F("dtype",n,e,t),F("seed",n,e,t))];case"RandomUniform":return[s.randomUniform(F("shape",n,e,t),F("minval",n,e,t),F("maxval",n,e,t),F("dtype",n,e,t))];case"RandomUniformInt":return[s.randomUniformInt(F("shape",n,e,t),F("minval",n,e,t),F("maxval",n,e,t),F("seed",n,e,t))];case"Range":{const r=F("start",n,e,t),i=F("stop",n,e,t),o=F("step",n,e,t);return[s.range(r,i,o,F("dtype",n,e,t))]}case"TruncatedNormal":{const r=F("shape",n,e,t),i=F("mean",n,e,t),o=F("stdDev",n,e,t),a=F("seed",n,e,t);return[s.truncatedNormal(r,i,o,F("dtype",n,e,t),a)]}case"Zeros":return[s.zeros(F("shape",n,e,t),F("dtype",n,e,t))];case"ZerosLike":return[s.zerosLike(F("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lE(n,e,t){const s=F("boxes",n,e,t),r=F("scores",n,e,t),i=F("maxOutputSize",n,e,t),o=F("iouThreshold",n,e,t),a=F("scoreThreshold",n,e,t),l=F("softNmsSigma",n,e,t);return{boxes:s,scores:r,maxOutputSize:i,iouThreshold:o,scoreThreshold:a,softNmsSigma:l}}const Qwe=async(n,e,t,s,r=Us)=>{switch(n.op){case"NonMaxSuppressionV5":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:u,softNmsSigma:h}=lE(n,e,t),f=await r.image.nonMaxSuppressionWithScoreAsync(i,o,a,l,u,h);return[f.selectedIndices,f.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:u}=lE(n,e,t),h=F("padToMaxOutputSize",n,e,t),f=await r.image.nonMaxSuppressionPaddedAsync(i,o,a,l,u,h);return[f.selectedIndices,f.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:u}=lE(n,e,t);return[await r.image.nonMaxSuppressionAsync(i,o,a,l,u)]}case"Where":{const i=r.cast(F("condition",n,e,t),"bool"),o=[await r.whereAsync(i)];return i.dispose(),o}case"ListDiff":return r.setdiff1dAsync(F("x",n,e,t),F("y",n,e,t));default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zwe=(n,e,t,s=Us)=>{switch(n.op){case"LowerBound":{const r=F("sortedSequence",n,e,t),i=F("values",n,e,t);return[s.lowerBound(r,i)]}case"TopKV2":{const r=F("x",n,e,t),i=F("k",n,e,t),o=F("sorted",n,e,t),a=s.topk(r,i,o);return[a.values,a.indices]}case"UpperBound":{const r=F("sortedSequence",n,e,t),i=F("values",n,e,t);return[s.upperBound(r,i)]}case"Unique":{const r=F("x",n,e,t),i=s.unique(r);return[i.values,i.indices]}case"UniqueV2":{const r=F("x",n,e,t),i=F("axis",n,e,t),o=s.unique(r,i);return[o.values,o.indices]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eTe=(n,e,t,s=Us)=>{switch(n.op){case"Const":return e[n.name];case"PlaceholderWithDefault":const r=F("default",n,e,t);return[Ls(n.name,e,t)||r];case"Placeholder":return[Ls(n.name,e,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{const h=F("x",n,e,t);return[al(h)]}case"IdentityN":return F("x",n,e,t).map(h=>al(h));case"Snapshot":const i=F("x",n,e,t);return[al(i)];case"Shape":return[s.tensor1d(F("x",n,e,t).shape,"int32")];case"ShapeN":return F("x",n,e,t).map(h=>s.tensor1d(h.shape));case"Size":return[s.scalar(F("x",n,e,t).size,"int32")];case"Rank":return[s.scalar(F("x",n,e,t).rank,"int32")];case"NoOp":return[s.scalar(1)];case"Print":const o=F("x",n,e,t),a=F("data",n,e,t),l=F("message",n,e,t),u=F("summarize",n,e,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(l);for(let h=0;h<a.length;h++)console.log(Array.prototype.slice.call(a[h].dataSync()).slice(0,u));return[o];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tTe{get id(){return this.handle.id}constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=Ot(0),this.tensorMap=new Map,Io(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Ot(this.size(),"int32")}async import(e,t){this.checkKeyAndValueTensor(e,t);const s=await e.data();return this.tensorMap.forEach(r=>r.dispose()),this.tensorMap.clear(),qt(()=>{const r=wc(t),i=s.length,o=r.length;Y(i===o,()=>`The number of elements doesn't match, keys has ${i} elements, the values has ${o} elements.`);for(let a=0;a<i;a++){const l=s[a],u=r[a];Io(u),this.tensorMap.set(l,u)}return this.handle})}async find(e,t){this.checkKeyAndValueTensor(e,t);const s=await e.data();return qt(()=>{const r=[];for(let i=0;i<s.length;i++){const o=s[i],a=this.findWithDefault(o,t);r.push(a)}return Ra(r)})}findWithDefault(e,t){const s=this.tensorMap.get(e);return s??t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(t.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${t.dtype}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nTe=async(n,e,t,s)=>{switch(n.op){case"HashTable":case"HashTableV2":{const r=s.getHashTableHandleByName(n.name);if(r!=null)return[r];{const i=F("keyDType",n,e,t),o=F("valueDType",n,e,t),a=new tTe(i,o);return s.addHashTable(n.name,a),[a.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{const r=F("tableHandle",n,e,t,s),i=F("keys",n,e,t),o=F("values",n,e,t);return[await s.getHashTableById(r.id).import(i,o)]}case"LookupTableFind":case"LookupTableFindV2":{const r=F("tableHandle",n,e,t,s),i=F("keys",n,e,t),o=F("defaultValue",n,e,t);return[await s.getHashTableById(r.id).find(i,o)]}case"LookupTableSize":case"LookupTableSizeV2":{const r=F("tableHandle",n,e,t,s);return[s.getHashTableById(r.id).tensorSize()]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sTe=(n,e,t,s=Us)=>{switch(n.op){case"ResizeBilinear":{const r=F("images",n,e,t),i=F("size",n,e,t),o=F("alignCorners",n,e,t),a=F("halfPixelCenters",n,e,t);return[s.image.resizeBilinear(r,[i[0],i[1]],o,a)]}case"ResizeNearestNeighbor":{const r=F("images",n,e,t),i=F("size",n,e,t),o=F("alignCorners",n,e,t),a=F("halfPixelCenters",n,e,t);return[s.image.resizeNearestNeighbor(r,[i[0],i[1]],o,a)]}case"CropAndResize":{const r=F("image",n,e,t),i=F("boxes",n,e,t),o=F("boxInd",n,e,t),a=F("cropSize",n,e,t),l=F("method",n,e,t),u=F("extrapolationValue",n,e,t);return[s.image.cropAndResize(r,i,o,a,l,u)]}case"ImageProjectiveTransformV3":{const r=F("images",n,e,t),i=F("transforms",n,e,t),o=F("outputShape",n,e,t),a=F("fillValue",n,e,t),l=F("interpolation",n,e,t),u=F("fillMode",n,e,t);return[s.image.transform(r,i,l.toLowerCase(),u.toLowerCase(),a,o)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rTe=(n,e,t,s=Us)=>{switch(n.op){case"Equal":return[s.equal(F("a",n,e,t),F("b",n,e,t))];case"NotEqual":return[s.notEqual(F("a",n,e,t),F("b",n,e,t))];case"Greater":return[s.greater(F("a",n,e,t),F("b",n,e,t))];case"GreaterEqual":return[s.greaterEqual(F("a",n,e,t),F("b",n,e,t))];case"Less":return[s.less(F("a",n,e,t),F("b",n,e,t))];case"LessEqual":return[s.lessEqual(F("a",n,e,t),F("b",n,e,t))];case"LogicalAnd":return[s.logicalAnd(F("a",n,e,t),F("b",n,e,t))];case"LogicalNot":return[s.logicalNot(F("a",n,e,t))];case"LogicalOr":return[s.logicalOr(F("a",n,e,t),F("b",n,e,t))];case"Select":case"SelectV2":return[s.where(F("condition",n,e,t),F("a",n,e,t),F("b",n,e,t))];case"BitwiseAnd":return[s.bitwiseAnd(F("a",n,e,t),F("b",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iTe=(n,e,t,s=Us)=>{switch(n.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[s.matMul(F("a",n,e,t),F("b",n,e,t),F("transposeA",n,e,t),F("transposeB",n,e,t))];case"Einsum":return[s.einsum(F("equation",n,e,t),...F("tensors",n,e,t))];case"Transpose":return[s.transpose(F("x",n,e,t),F("perm",n,e,t))];case"_FusedMatMul":const[r,i]=F("fusedOps",n,e,t),o=r==="biasadd",a=i==="prelu",l=F("numArgs",n,e,t),u=F("leakyreluAlpha",n,e,t);if(o){if(a&&l!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&l!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[h,f]=F("args",n,e,t);return[s.fused.matMul({a:F("a",n,e,t),b:F("b",n,e,t),transposeA:F("transposeA",n,e,t),transposeB:F("transposeB",n,e,t),bias:h,activation:i,preluActivationWeights:f,leakyreluAlpha:u})];case"MatrixBandPart":return[s.linalg.bandPart(F("a",n,e,t),F("numLower",n,e,t),F("numUpper",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oTe=(n,e,t,s=Us)=>{switch(n.op){case"EuclideanNorm":return[s.euclideanNorm(F("x",n,e,t),F("axis",n,e,t),F("keepDims",n,e,t))];case"FusedBatchNorm":case"FusedBatchNormV2":return[s.batchNorm(F("x",n,e,t),F("mean",n,e,t),F("variance",n,e,t),F("offset",n,e,t),F("scale",n,e,t),F("epsilon",n,e,t))];case"FusedBatchNormV3":return[s.batchNorm(F("x",n,e,t),F("mean",n,e,t),F("variance",n,e,t),F("offset",n,e,t),F("scale",n,e,t),F("epsilon",n,e,t))];case"LRN":return[s.localResponseNormalization(F("x",n,e,t),F("radius",n,e,t),F("bias",n,e,t),F("alpha",n,e,t),F("beta",n,e,t))];case"Softmax":return[s.softmax(F("x",n,e,t))];case"LogSoftmax":return[s.logSoftmax(F("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aTe=(n,e,t,s=Us)=>{switch(n.op){case"RaggedGather":{const{outputNestedSplits:r,outputDenseValues:i}=s.raggedGather(F("paramsNestedSplits",n,e,t),F("paramsDenseValues",n,e,t),F("indices",n,e,t),F("outputRaggedRank",n,e,t));return r.concat(i)}case"RaggedRange":{const{rtNestedSplits:r,rtDenseValues:i}=s.raggedRange(F("starts",n,e,t),F("limits",n,e,t),F("splits",n,e,t));return[r,i]}case"RaggedTensorToTensor":return[s.raggedTensorToTensor(F("shape",n,e,t),F("values",n,e,t),F("defaultValue",n,e,t),F("rowPartitionTensors",n,e,t),F("rowPartitionTypes",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lTe=(n,e,t,s=Us)=>{switch(n.op){case"Max":{const a=F("axis",n,e,t),l=F("keepDims",n,e,t);return[s.max(F("x",n,e,t),a,l)]}case"Mean":{const a=F("axis",n,e,t),l=F("keepDims",n,e,t);return[s.mean(F("x",n,e,t),a,l)]}case"Min":{const a=F("axis",n,e,t),l=F("keepDims",n,e,t);return[s.min(F("x",n,e,t),a,l)]}case"Sum":{const a=F("axis",n,e,t),l=F("keepDims",n,e,t);return[s.sum(F("x",n,e,t),a,l)]}case"All":{const a=F("axis",n,e,t),l=F("keepDims",n,e,t);return[s.all(F("x",n,e,t),a,l)]}case"Any":{const a=F("axis",n,e,t),l=F("keepDims",n,e,t);return[s.any(F("x",n,e,t),a,l)]}case"ArgMax":{const a=F("axis",n,e,t);return[s.argMax(F("x",n,e,t),a)]}case"ArgMin":{const a=F("axis",n,e,t);return[s.argMin(F("x",n,e,t),a)]}case"Prod":{const a=F("axis",n,e,t),l=F("keepDims",n,e,t);return[s.prod(F("x",n,e,t),a,l)]}case"Cumprod":{const a=F("axis",n,e,t),l=F("exclusive",n,e,t),u=F("reverse",n,e,t);return[s.cumprod(F("x",n,e,t),a,l,u)]}case"Cumsum":{const a=F("axis",n,e,t),l=F("exclusive",n,e,t),u=F("reverse",n,e,t);return[s.cumsum(F("x",n,e,t),a,l,u)]}case"Bincount":const r=F("x",n,e,t),i=F("weights",n,e,t),o=F("size",n,e,t);return[s.bincount(r,i,o)];case"DenseBincount":{const a=F("x",n,e,t),l=F("weights",n,e,t),u=F("size",n,e,t),h=F("binaryOutput",n,e,t);return[s.denseBincount(a,l,u,h)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uTe=(n,e,t,s=Us)=>{switch(n.op){case"ConcatV2":case"Concat":{const r=F("n",n,e,t),i=F("axis",n,e,t);let o=F("tensors",n,e,t);return o=o.slice(0,r),[s.concat(o,i)]}case"Gather":{const r=F("x",n,e,t),i=F("indices",n,e,t);return[s.gather(r,s.cast(i,"int32"),0)]}case"GatherV2":{const r=F("axis",n,e,t),i=F("batchDims",n,e,t),o=F("x",n,e,t),a=F("indices",n,e,t);return[s.gather(o,s.cast(a,"int32"),r,i)]}case"Reverse":{const r=F("dims",n,e,t),i=[];for(let a=0;a<r.length;a++)r[a]&&i.push(a);const o=F("x",n,e,t);return[s.reverse(o,i)]}case"ReverseV2":{const r=F("axis",n,e,t),i=F("x",n,e,t);return[s.reverse(i,r)]}case"Slice":{const r=F("begin",n,e,t),i=F("size",n,e,t);return[s.slice(F("x",n,e,t),r,i)]}case"StridedSlice":{const r=F("begin",n,e,t),i=F("end",n,e,t),o=F("strides",n,e,t),a=F("beginMask",n,e,t),l=F("endMask",n,e,t),u=F("ellipsisMask",n,e,t),h=F("newAxisMask",n,e,t),f=F("shrinkAxisMask",n,e,t),p=F("x",n,e,t);return[s.stridedSlice(p,r,i,o,a,l,u,h,f)]}case"Pack":return qt(()=>{const r=F("axis",n,e,t),i=F("tensors",n,e,t),o=i[0].shape,a=s.squeeze(i[0]).shape,l=i.map(u=>{const h=Mo(u.shape,o);if(!h&&!Mo(s.squeeze(u).shape,a))throw new Error("the input tensors shape does not match");return h?u:s.reshape(u,o)});return[s.stack(l,r)]});case"Unpack":{const r=F("axis",n,e,t),i=F("tensor",n,e,t);return s.unstack(i,r)}case"Tile":{const r=F("reps",n,e,t);return[s.tile(F("x",n,e,t),r)]}case"Split":case"SplitV":{const r=F("axis",n,e,t),i=F("numOrSizeSplits",n,e,t),o=F("x",n,e,t);return s.split(o,i,r)}case"ScatterNd":{const r=F("indices",n,e,t),i=F("values",n,e,t),o=F("shape",n,e,t);return[s.scatterND(r,i,o)]}case"GatherNd":{const r=F("x",n,e,t),i=F("indices",n,e,t);return[s.gatherND(r,i)]}case"SparseToDense":{const r=F("sparseIndices",n,e,t),i=F("outputShape",n,e,t),o=F("sparseValues",n,e,t),a=F("defaultValue",n,e,t);return[s.sparseToDense(r,o,i,o.dtype===a.dtype?a:s.cast(a,o.dtype))]}case"TensorScatterUpdate":{const r=F("indices",n,e,t),i=F("values",n,e,t),o=F("tensor",n,e,t);return[s.tensorScatterUpdate(o,r,i)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cTe=(n,e,t,s=Us)=>{switch(n.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:i,emptyRowIndicator:o,reverseIndexMap:a}=s.sparse.sparseFillEmptyRows(F("indices",n,e,t),F("values",n,e,t),F("denseShape",n,e,t),F("defaultValue",n,e,t));return[r,i,o,a]}case"SparseReshape":{const{outputIndices:r,outputShape:i}=s.sparse.sparseReshape(F("inputIndices",n,e,t),F("inputShape",n,e,t),F("newShape",n,e,t));return[r,i]}case"SparseSegmentMean":return[s.sparse.sparseSegmentMean(F("data",n,e,t),F("indices",n,e,t),F("segmentIds",n,e,t))];case"SparseSegmentSum":return[s.sparse.sparseSegmentSum(F("data",n,e,t),F("indices",n,e,t),F("segmentIds",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hTe=(n,e,t,s=Us)=>{switch(n.op){case"FFT":return[s.fft(F("x",n,e,t))];case"IFFT":return[s.ifft(F("x",n,e,t))];case"RFFT":return[s.rfft(F("x",n,e,t))];case"IRFFT":return[s.irfft(F("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dTe=(n,e,t,s=Us)=>{switch(n.op){case"StaticRegexReplace":return[s.string.staticRegexReplace(F("input",n,e,t),F("pattern",n,e,t),F("rewrite",n,e,t),F("replaceGlobal",n,e,t))];case"StringNGrams":{const{nGrams:r,nGramsSplits:i}=s.string.stringNGrams(F("data",n,e,t),F("dataSplits",n,e,t),F("separator",n,e,t),F("nGramWidths",n,e,t),F("leftPad",n,e,t),F("rightPad",n,e,t),F("padWidth",n,e,t),F("preserveShortSequences",n,e,t));return[r,i]}case"StringSplit":{const{indices:r,values:i,shape:o}=s.string.stringSplit(F("input",n,e,t),F("delimiter",n,e,t),F("skipEmpty",n,e,t));return[r,i,o]}case"StringToHashBucketFast":return[s.string.stringToHashBucketFast(F("input",n,e,t),F("numBuckets",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fTe=(n,e,t,s=Us)=>{switch(n.op){case"Cast":return[s.cast(F("x",n,e,t),F("dtype",n,e,t))];case"ExpandDims":{const r=F("axis",n,e,t);return[s.expandDims(F("x",n,e,t),r)]}case"Squeeze":{const r=F("axis",n,e,t);return[s.squeeze(F("x",n,e,t),r)]}case"Reshape":return[s.reshape(F("x",n,e,t),F("shape",n,e,t))];case"EnsureShape":return[s.ensureShape(F("x",n,e,t),F("shape",n,e,t))];case"MirrorPad":return[s.mirrorPad(F("x",n,e,t),F("padding",n,e,t),F("mode",n,e,t))];case"PadV2":case"Pad":return[s.pad(F("x",n,e,t),F("padding",n,e,t),F("constantValue",n,e,t))];case"SpaceToBatchND":{const r=F("blockShape",n,e,t),i=F("paddings",n,e,t);return[s.spaceToBatchND(F("x",n,e,t),r,i)]}case"BatchToSpaceND":{const r=F("blockShape",n,e,t),i=F("crops",n,e,t);return[s.batchToSpaceND(F("x",n,e,t),r,i)]}case"DepthToSpace":{const r=F("blockSize",n,e,t),i=F("dataFormat",n,e,t).toUpperCase();return[s.depthToSpace(F("x",n,e,t),r,i)]}case"BroadcastTo":return[s.broadcastTo(F("x",n,e,t),F("shape",n,e,t))];case"BroadcastArgs":return[s.broadcastArgs(F("s0",n,e,t),F("s1",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F3(n,e,t,s,r=qt){const i=((o,a,l)=>{switch(o.category){case"arithmetic":return r(()=>zwe(o,a,l));case"basic_math":return r(()=>Gwe(o,a,l));case"control":return Ywe(o,a,l);case"convolution":return r(()=>Jwe(o,a,l));case"creation":return r(()=>jwe(o,a,l));case"dynamic":return Qwe(o,a,l);case"evaluation":return r(()=>Zwe(o,a,l));case"image":return r(()=>sTe(o,a,l));case"graph":return r(()=>eTe(o,a,l));case"logical":return r(()=>rTe(o,a,l));case"matrices":return r(()=>iTe(o,a,l));case"normalization":return r(()=>oTe(o,a,l));case"ragged":return r(()=>aTe(o,a,l));case"reduction":return r(()=>lTe(o,a,l));case"slice_join":return r(()=>uTe(o,a,l));case"sparse":return r(()=>cTe(o,a,l));case"spectral":return r(()=>hTe(o,a,l));case"string":return r(()=>dTe(o,a,l));case"transformation":return r(()=>fTe(o,a,l));case"hash_table":return nTe(o,a,l,s);case"custom":const u=jW(o.op);if(u&&u.customExecutor)return u.customExecutor(new Uwe(o,a,l));throw TypeError(`Custom op ${o.op} is not registered.`);default:throw TypeError(`Unknown op '${o.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(n,e,t);return nc(i)?i.then(o=>[].concat(o)):[].concat(i)}class L3{constructor(e={},t={},s={},r={},i){this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=s,this.functionMap=r,this.parseNodeNameCache=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let t=0;t<this.contexts.length-1;t++){const s=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(s))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(t=>t.id===0&&t.iterationId===0?"":`${t.frameName}-${t.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(const t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V3(n,e,t,s){const r=new Set,i=[];let o=null,a=null;const l=new Set,u=new Set(Object.keys(n).map(p=>ei(p)[0]));s=s||[];const h=new Set(s.map(p=>ei(p.name)[0])),f=[...e];for(;f.length>0;){const p=f.pop();if((ph(p)||TTe(p)||xTe(p))&&o==null&&(o=p,a=o.children.map(g=>g.name).filter(g=>r.has(g))),r.add(p.name),t[p.name]==null&&!u.has(p.name)&&!h.has(p.name)){if(p.inputs.length===0){i.push(p.name);continue}p.inputs.forEach(g=>{l.has(g.name)||(l.add(g.name),f.push(g))})}}return{inputs:n,outputs:e,usedNodes:r,missingInputs:i,dynamicNode:o,syncInputs:a}}function pTe(n,e){const{usedNodes:t,inputs:s}=e,r=Object.keys(s).map(w=>ei(w)[0]).map(w=>n.nodes[w]),i=n.initNodes||[],o=w=>t.has(typeof w=="string"?w:w.name);function a(w){return[...new Map(w.map(_=>[_.name,_])).values()]}const l=a([...r,...n.weights,...i]).filter(o),u=a([...l,...Object.values(n.nodes)]).filter(o),h=new Map(u.map(w=>[w.name,w])),f={};for(const w of u){f[w.name]=f[w.name]||0;for(const _ of w.children)o(_)||(f[_.name]=Number.POSITIVE_INFINITY),f[_.name]=(f[_.name]||0)+1}const p=Object.entries(f).filter(([,w])=>w===0).map(([w])=>w),g=[...p];for(;p.length>0;){const w=p.pop(),_=h.get(w);for(const C of _.children.filter(o))--f[C.name]===0&&(g.push(C.name),p.push(C.name))}const b=g.map(w=>h.get(w)),T=mTe(b,l);return gTe(T,l),T}function mTe(n,e){const t=new Map(n.map(o=>[o.name,o])),s=e.map(o=>o.name),r=new Set(s);for(;s.length>0;){const o=s.pop(),a=t.get(o);for(const l of a.children)!t.has(l.name)||r.has(l.name)||(r.add(l.name),s.push(l.name))}return n.filter(o=>r.has(o.name))}class E1 extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}}function gTe(n,e){const t=new Map(n.map((a,l)=>[a.name,l])),s=new Set(e.map(a=>a.name)),r=a=>s.has(typeof a=="string"?a:a.name),i=new Set(n.map(a=>a.name)),o=a=>i.has(typeof a=="string"?a:a.name);for(const a of n){for(const l of a.children.filter(o)){if(!t.has(l.name))throw new E1(`Child ${l.name} of node ${a.name} is unreachable.`);if(t.get(a.name)>t.get(l.name))throw new E1(`Node ${a.name} is scheduled to run after its child ${l.name}.`)}if(!r(a))for(const l of a.inputs){if(!t.has(l.name))throw new E1(`Input ${l.name} of node ${a.name} is unreachable.`);if(t.get(l.name)>t.get(a.name))throw new E1(`Node ${a.name} is scheduled to run before its input ${l.name}.`)}}}function yTe(n){const e=new Map(n.map((a,l)=>[a.name,l])),t=Number.MAX_SAFE_INTEGER,s=n.map((a,l)=>ph(a)?t:l),r=a=>{const l=s[e.get(a.name)];return l??-1},i=n.map((a,l)=>a.children.map(r).reduce((u,h)=>Math.max(u,h),s[l])),o=new Map;for(let a=0;a<n.length;++a){const l=i[a];if(l===t)continue;const u=n[a],h=n[l];o.has(h.name)||o.set(h.name,[]),o.get(h.name).push(u)}return o}const bTe=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),vTe=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),wTe=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function ph(n){return bTe.has(n.op)}function TTe(n){return vTe.has(n.op)}function xTe(n){return wTe.has(n.op)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qv{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const t=Object.keys(e).map(s=>e[s].map(r=>r.id));this._weightIds=[].concat(...t),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const t=e.signatureKey||e.name;return e.defaultOutput?`${t}:${e.defaultOutput}`:t})}get functions(){return Object.keys(this._functions).reduce((e,t)=>(e[t]=this._functions[t].signature,e),{})}constructor(e,t){this.graph=e,this.parent=t,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(s=>{this._functionExecutorMap[s]=new qv(e.functions[s],this)})}getCompilationKey(e,t){const s=e.map(i=>i.name).sort(),r=t.map(i=>i.name).sort();return s.join(this.SEPARATOR)+"--"+r.join(this.SEPARATOR)}compile(e,t){const s=V3(e,t,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:i,syncInputs:o}=s;if(i!=null)throw new Error(`This execution contains the node '${i.name}', which has the dynamic op '${i.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(r.length>0){const u=t.map(f=>f.name),h=Object.keys(e);throw new Error(`Cannot compute the outputs [${u}] from the provided inputs [${h}]. Missing the following inputs: [${r}]`)}const a=pTe(this.graph,s),l=yTe(a);return{orderedNodes:a,nodeLiveUntilMap:l}}cloneAndKeepTensor(e){if(e==null)return null;const t=e.clone();return Io(t),t}cloneTensorList(e){return e?e.map(s=>this.cloneAndKeepTensor(s)):null}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map(([t,s])=>[t,this.cloneTensorList(s)]))}execute(e,t){this.disposeIntermediateTensors(),e=this.mapInputs(e);const s=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);const r=s.map(p=>this.graph.nodes[ei(p)[0]]),i=t.map(p=>ei(p)[0]),o=new Set(i);let a=i.map(p=>this.graph.nodes[p]);a.length===0&&(a=this._outputs);const l=this.getCompilationKey(r,a);let u=this.compiledMap.get(l);u==null&&(u=this.compile(e,a),this.compiledMap.set(l,u));try{this.keepIntermediateTensors=ut().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}const h={},f={};return qt(()=>{const p=new L3(this.weightMap,h,f,this.functionExecutorMap,this.parseNodeNameCache),g=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach(_=>{const[C,N]=ei(_,p),A=[];A[N]=e[_],g[C]=A,this.keepIntermediateTensors&&(this.clonedTensorsMap[C]=this.cloneTensorList(A))});const b=this.getFrozenTensorIds(g),{orderedNodes:T,nodeLiveUntilMap:w}=u;for(const _ of T){if(g[_.name])continue;const C=F3(_,g,p,this._resourceManager);if(nc(C))throw new Error(`The execution of the op '${_.op}' returned a promise. Please use model.executeAsync() instead.`);g[_.name]=C,this.keepIntermediateTensors&&(this.clonedTensorsMap[_.name]=this.cloneTensorList(C)),this.checkTensorForDisposalWithNodeLiveUntilInfo(_,g,p,b,o,w.get(_.name))}return this.parent==null&&p.dispose(b),t.map(_=>Ls(_,g,p))})}getFrozenTensorIds(e){const t=[].concat.apply([],Object.keys(e).map(s=>e[s]).map(s=>s.map(r=>r.id)));return new Set(t)}checkTensorForDisposal(e,t,s,r,i,o,a){if(!(ph(t)||o.has(e))){for(const l of s[e])l!=null&&(a[l.id]=(a[l.id]||0)+t.children.length);for(const l of t.inputs){if(ph(l))continue;const u=R3(l.name,s,r);if(u!=null)for(const h of u){if(!h||h.kept||i.has(h.id))continue;const f=a[h.id];f===1?(h.dispose(),delete a[h.id]):f!=null&&a[h.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,t,s,r,i,o){function a(l){return ph(l)||i.has(l.name)}if(!(ph(e)||o==null))for(const l of o){if(a(l))continue;const u=R3(l.name,t,s);for(const h of u)!h||h.kept||r.has(h.id)||h.dispose()}}async executeAsync(e,t){return this._executeAsync(e,t)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(e=>{for(const t of e)t&&!t.isDisposed&&t.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(e,t,s=!1,r={},i={}){this.disposeIntermediateTensors(),s||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=ut().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}const o=new L3(this.weightMap,r,i,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));const a=await this.executeWithControlFlow(e,o,t,s),l=t.map(p=>Ls(p,a,o)),u=l.map(p=>p.id),h=Object.keys(e).map(p=>e[p].id),f=new Set([...u,...h,...this.weightIds]);return Object.values(a).forEach(p=>{p.forEach(g=>{g&&!g.isDisposed&&!f.has(g.id)&&g.dispose()})}),this.parent==null&&o.dispose(f),l}async executeFunctionAsync(e,t,s){const r=e.reduce((i,o,a)=>(i[this.inputs[a].name]=o,i),{});return this._executeAsync(r,this.outputNodes,!0,t,s)}async executeWithControlFlow(e,t,s,r){const i=Object.keys(e),o=i.map(A=>this.graph.nodes[ei(A)[0]]),a=s.map(A=>ei(A)[0]),l=new Set(a);let u=a.map(A=>this.graph.nodes[A]);u.length===0&&(u=this._outputs);const{usedNodes:h,missingInputs:f,dynamicNode:p,syncInputs:g}=V3(e,u,this.weightMap,this._initNodes),b=[...o,...this.graph.weights,...this._initNodes||[]].map(A=>({node:A,contexts:t.currentContext})),T=Object.assign({},this.weightMap);Object.keys(e).forEach(A=>{const[P,V]=ei(A),D=[];D[V]=e[A],T[P]=D});const w={},_=this.getFrozenTensorIds(T),C={};for(;b.length>0;){const A=this.processStack(o,b,t,T,C,_,l,w,h);await Promise.all(A)}p==null&&!r&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const N=u.filter(A=>!ph(A)&&!Ls(A.name,T,t)).map(A=>A.name);if(N.length>0){let A="";throw p!=null&&(A=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${g}]`),new Error(`Cannot compute the outputs [${N}] from the provided inputs [${i}]. Consider providing the following inputs: [${f}]. ${A}`)}return T}processStack(e,t,s,r,i,o,a,l,u){const h=[];for(;t.length>0;){const f=t.pop();s.currentContext=f.contexts;let p="";if(f.node.op==="Enter"&&F("isConstant",f.node,r,s)&&([p]=ol(f.node.name,s)),r[f.node.name]==null){const g=F3(f.node,r,s,this._resourceManager);p||([p]=ol(f.node.name,s));const b=s.currentContext;nc(g)?h.push(g.then(T=>(r[p]=T,this.keepIntermediateTensors&&(this.clonedTensorsMap[p]=this.cloneTensorList(T)),s.currentContext=b,this.checkTensorForDisposal(p,f.node,r,s,o,a,l),this.processChildNodes(f.node,t,s,r,i,u),T))):(r[p]=g,this.keepIntermediateTensors&&(this.clonedTensorsMap[p]=this.cloneTensorList(g)),this.checkTensorForDisposal(p,f.node,r,s,o,a,l),this.processChildNodes(f.node,t,s,r,i,u))}else this.processChildNodes(f.node,t,s,r,i,u)}return h}processChildNodes(e,t,s,r,i,o){e.children.forEach(a=>{const[l]=ol(a.name,s);i[l]||!o.has(a.name)||(a.op==="Merge"?a.inputNames.some(u=>!!Ls(u,r,s))&&(i[l]=!0,t.push({contexts:s.currentContext,node:a})):a.inputNames.every(u=>!!Ls(u,r,s))&&(i[l]=!0,t.push({contexts:s.currentContext,node:a})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(t=>t.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(t=>{const s=e[t],[r]=ei(t),i=this.graph.nodes[r];if(i.attrParams.shape&&i.attrParams.shape.value){const o=i.attrParams.shape.value,a=o.length===s.shape.length&&s.shape.every((l,u)=>o[u]===-1||o[u]===l);Y(a,()=>`The shape of dict['${i.name}'] provided in model.execute(dict) must be [${o}], but was [${s.shape}]`)}i.attrParams.dtype&&i.attrParams.dtype.value&&Y(s.dtype===i.attrParams.dtype.value,()=>`The dtype of dict['${i.name}'] provided in model.execute(dict) must be ${i.attrParams.dtype.value}, but was ${s.dtype}`)})}mapInputs(e){var t,s;const r={};for(const i in e){const o=(s=(t=this._signature)===null||t===void 0?void 0:t.inputs)===null||s===void 0?void 0:s[i];o!=null?r[o.name]=e[i]:r[i]=e[i]}return r}checkInputs(e){const t=Object.keys(e).filter(s=>{const[r]=ei(s);return this.graph.nodes[r]==null});if(t.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${t}] that are not part of graph`)}mapOutputs(e){return e.map(t=>{var s,r;const i=(r=(s=this._signature)===null||s===void 0?void 0:s.outputs)===null||r===void 0?void 0:r[t];return i!=null?i.name:t},{})}checkOutputs(e){e.forEach(t=>{const[s]=ei(t);if(!this.graph.nodes[s])throw new Error(`The output '${t}' is not found in the graph`)})}}class STe{constructor(e={},t={}){this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Te="?tfjs-format=file",ETe="model.json";class ITe{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,t={},s=GA){this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=s,t==null&&(this.loadOptions={}),this.resourceManager=new STe}findIOHandler(){const e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error(`Found more than one (${t.length}) load handlers for URL '${[e]}'`);this.handler=t[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return nc(e)?e.then(t=>t.getWeightStream==null?this.loadSync(t):this.loadStreaming(t)):this.loadSync(e)}loadSync(e){const t=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,t)}async loadStreaming(e){if(e.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");const t=await K6(e.getWeightStream(),e.weightSpecs);return this.loadWithWeightMap(e,t)}loadWithWeightMap(e,t){this.artifacts=e;const s=this.artifacts.modelTopology;let r=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){const i=this.artifacts.userDefinedMetadata;i.signature!=null&&(r=i.signature),i.structuredOutputKeys!=null&&(this.structuredOutputKeys=i.structuredOutputKeys)}if(this.signature=r,this.version=`${s.versions.producer}.${s.versions.minConsumer}`,this.executor=new qv(D3.Instance.transformGraph(s,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(t),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){const i=D3.Instance.transformGraph(e.modelInitializer);this.initializer=new qv(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,t){if(typeof e=="string"){const s=this.io.getSaveHandlers(e);if(s.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(s.length>1)throw new Error(`Found more than one (${s.length}) save handlers for URL '${e}'`);e=s[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){const t=e instanceof Vn?[e]:e,s={};return t.forEach((r,i)=>s[this.structuredOutputKeys[i]]=r),s}return e}predict(e,t){const s=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(s)}async predictAsync(e,t){const s=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(s)}normalizeInputs(e){var t;if(!(e instanceof Vn)&&!Array.isArray(e)){const i=(t=this.signature)===null||t===void 0?void 0:t.inputs;if(i!=null)for(const o in i){const a=i[o];a.resourceId!=null&&(e[o]=this.resourceIdToCapturedInput[a.resourceId])}return e}e=Array.isArray(e)?e:[e];const s=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+s!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-s} non-resource placeholders, while there are ${e.length} input tensors provided.`);let r=0;return this.inputNodes.reduce((i,o)=>{var a,l,u;const h=(u=(l=(a=this.signature)===null||a===void 0?void 0:a.inputs)===null||l===void 0?void 0:l[o])===null||u===void 0?void 0:u.resourceId;return h!=null?i[o]=this.resourceIdToCapturedInput[h]:i[o]=e[r++],i},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){const t=this.initializerSignature.outputs,s=Object.keys(t);for(let r=0;r<s.length;r++){const i=s[r],o=t[i];this.resourceIdToCapturedInput[o.resourceId]=e[r]}}}execute(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const s=this.executor.execute(e,t);return s.length>1?s:s[0]}async executeAsync(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const s=await this.executor.executeAsync(e,t);return s.length>1?s:s[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((t,s)=>(t[s]=[e[s]],t),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&Tr(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}async function B3(n,e={},t=GA){if(n==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");e==null&&(e={}),e.fromTFHub&&typeof n=="string"&&(n=CTe(n));const s=new ITe(n,e,t);return await s.load(),s}function CTe(n){return n.endsWith("/")||(n=n+"/"),`${n}${ETe}${_Te}`}/**
    * @license
    * Copyright 2023 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function Wv(n,e,t,s){return new(t||(t=Promise))(function(r,i){function o(u){try{l(s.next(u))}catch(h){i(h)}}function a(u){try{l(s.throw(u))}catch(h){i(h)}}function l(u){var h;u.done?r(u.value):(h=u.value,h instanceof t?h:new t(function(f){f(h)})).then(o,a)}l((s=s.apply(n,[])).next())})}function Kv(n,e){var t,s,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(l){return function(u){return(function(h){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,s&&(r=2&h[0]?s.return:h[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,h[1])).done)return r;switch(s=0,r&&(h=[2&h[0],r.value]),h[0]){case 0:case 1:r=h;break;case 4:return o.label++,{value:h[1],done:!1};case 5:o.label++,s=h[1],h=[0];continue;case 7:h=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(h[0]===6||h[0]===2)){o=0;continue}if(h[0]===3&&(!r||h[1]>r[0]&&h[1]<r[3])){o.label=h[1];break}if(h[0]===6&&o.label<r[1]){o.label=r[1],r=h;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(h);break}r[2]&&o.ops.pop(),o.trys.pop();continue}h=e.call(n,o)}catch(f){h=[6,f],s=0}finally{t=r=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}})([l,u])}}}var NTe={0:"tench, Tinca tinca",1:"goldfish, Carassius auratus",2:"great white shark, white shark, man-eater, man-eating shark, Carcharodon carcharias",3:"tiger shark, Galeocerdo cuvieri",4:"hammerhead, hammerhead shark",5:"electric ray, crampfish, numbfish, torpedo",6:"stingray",7:"cock",8:"hen",9:"ostrich, Struthio camelus",10:"brambling, Fringilla montifringilla",11:"goldfinch, Carduelis carduelis",12:"house finch, linnet, Carpodacus mexicanus",13:"junco, snowbird",14:"indigo bunting, indigo finch, indigo bird, Passerina cyanea",15:"robin, American robin, Turdus migratorius",16:"bulbul",17:"jay",18:"magpie",19:"chickadee",20:"water ouzel, dipper",21:"kite",22:"bald eagle, American eagle, Haliaeetus leucocephalus",23:"vulture",24:"great grey owl, great gray owl, Strix nebulosa",25:"European fire salamander, Salamandra salamandra",26:"common newt, Triturus vulgaris",27:"eft",28:"spotted salamander, Ambystoma maculatum",29:"axolotl, mud puppy, Ambystoma mexicanum",30:"bullfrog, Rana catesbeiana",31:"tree frog, tree-frog",32:"tailed frog, bell toad, ribbed toad, tailed toad, Ascaphus trui",33:"loggerhead, loggerhead turtle, Caretta caretta",34:"leatherback turtle, leatherback, leathery turtle, Dermochelys coriacea",35:"mud turtle",36:"terrapin",37:"box turtle, box tortoise",38:"banded gecko",39:"common iguana, iguana, Iguana iguana",40:"American chameleon, anole, Anolis carolinensis",41:"whiptail, whiptail lizard",42:"agama",43:"frilled lizard, Chlamydosaurus kingi",44:"alligator lizard",45:"Gila monster, Heloderma suspectum",46:"green lizard, Lacerta viridis",47:"African chameleon, Chamaeleo chamaeleon",48:"Komodo dragon, Komodo lizard, dragon lizard, giant lizard, Varanus komodoensis",49:"African crocodile, Nile crocodile, Crocodylus niloticus",50:"American alligator, Alligator mississipiensis",51:"triceratops",52:"thunder snake, worm snake, Carphophis amoenus",53:"ringneck snake, ring-necked snake, ring snake",54:"hognose snake, puff adder, sand viper",55:"green snake, grass snake",56:"king snake, kingsnake",57:"garter snake, grass snake",58:"water snake",59:"vine snake",60:"night snake, Hypsiglena torquata",61:"boa constrictor, Constrictor constrictor",62:"rock python, rock snake, Python sebae",63:"Indian cobra, Naja naja",64:"green mamba",65:"sea snake",66:"horned viper, cerastes, sand viper, horned asp, Cerastes cornutus",67:"diamondback, diamondback rattlesnake, Crotalus adamanteus",68:"sidewinder, horned rattlesnake, Crotalus cerastes",69:"trilobite",70:"harvestman, daddy longlegs, Phalangium opilio",71:"scorpion",72:"black and gold garden spider, Argiope aurantia",73:"barn spider, Araneus cavaticus",74:"garden spider, Aranea diademata",75:"black widow, Latrodectus mactans",76:"tarantula",77:"wolf spider, hunting spider",78:"tick",79:"centipede",80:"black grouse",81:"ptarmigan",82:"ruffed grouse, partridge, Bonasa umbellus",83:"prairie chicken, prairie grouse, prairie fowl",84:"peacock",85:"quail",86:"partridge",87:"African grey, African gray, Psittacus erithacus",88:"macaw",89:"sulphur-crested cockatoo, Kakatoe galerita, Cacatua galerita",90:"lorikeet",91:"coucal",92:"bee eater",93:"hornbill",94:"hummingbird",95:"jacamar",96:"toucan",97:"drake",98:"red-breasted merganser, Mergus serrator",99:"goose",100:"black swan, Cygnus atratus",101:"tusker",102:"echidna, spiny anteater, anteater",103:"platypus, duckbill, duckbilled platypus, duck-billed platypus, Ornithorhynchus anatinus",104:"wallaby, brush kangaroo",105:"koala, koala bear, kangaroo bear, native bear, Phascolarctos cinereus",106:"wombat",107:"jelly fish",108:"sea anemone, anemone",109:"brain coral",110:"flatworm, platyhelminth",111:"nematode, nematode worm, roundworm",112:"conch",113:"snail",114:"slug",115:"sea slug, nudibranch",116:"chiton, coat-of-mail shell, sea cradle, polyplacophore",117:"chambered nautilus, pearly nautilus, nautilus",118:"Dungeness crab, Cancer magister",119:"rock crab, Cancer irroratus",120:"fiddler crab",121:"king crab, Alaska crab, Alaskan king crab, Alaska king crab, Paralithodes camtschatica",122:"American lobster, Northern lobster, Maine lobster, Homarus americanus",123:"spiny lobster, langouste, rock lobster, crawfish, crayfish, sea crawfish",124:"crayfish, crawfish, crawdad, crawdaddy",125:"hermit crab",126:"isopod",127:"white stork, Ciconia ciconia",128:"black stork, Ciconia nigra",129:"spoonbill",130:"flamingo",131:"little blue heron, Egretta caerulea",132:"American egret, great white heron, Egretta albus",133:"bittern",134:"crane",135:"limpkin, Aramus pictus",136:"European gallinule, Porphyrio porphyrio",137:"American coot, marsh hen, mud hen, water hen, Fulica americana",138:"bustard",139:"ruddy turnstone, Arenaria interpres",140:"red-backed sandpiper, dunlin, Erolia alpina",141:"redshank, Tringa totanus",142:"dowitcher",143:"oystercatcher, oyster catcher",144:"pelican",145:"king penguin, Aptenodytes patagonica",146:"albatross, mollymawk",147:"grey whale, gray whale, devilfish, Eschrichtius gibbosus, Eschrichtius robustus",148:"killer whale, killer, orca, grampus, sea wolf, Orcinus orca",149:"dugong, Dugong dugon",150:"sea lion",151:"Chihuahua",152:"Japanese spaniel",153:"Maltese dog, Maltese terrier, Maltese",154:"Pekinese, Pekingese, Peke",155:"Shih-Tzu",156:"Blenheim spaniel",157:"papillon",158:"toy terrier",159:"Rhodesian ridgeback",160:"Afghan hound, Afghan",161:"basset, basset hound",162:"beagle",163:"bloodhound, sleuthhound",164:"bluetick",165:"black-and-tan coonhound",166:"Walker hound, Walker foxhound",167:"English foxhound",168:"redbone",169:"borzoi, Russian wolfhound",170:"Irish wolfhound",171:"Italian greyhound",172:"whippet",173:"Ibizan hound, Ibizan Podenco",174:"Norwegian elkhound, elkhound",175:"otterhound, otter hound",176:"Saluki, gazelle hound",177:"Scottish deerhound, deerhound",178:"Weimaraner",179:"Staffordshire bullterrier, Staffordshire bull terrier",180:"American Staffordshire terrier, Staffordshire terrier, American pit bull terrier, pit bull terrier",181:"Bedlington terrier",182:"Border terrier",183:"Kerry blue terrier",184:"Irish terrier",185:"Norfolk terrier",186:"Norwich terrier",187:"Yorkshire terrier",188:"wire-haired fox terrier",189:"Lakeland terrier",190:"Sealyham terrier, Sealyham",191:"Airedale, Airedale terrier",192:"cairn, cairn terrier",193:"Australian terrier",194:"Dandie Dinmont, Dandie Dinmont terrier",195:"Boston bull, Boston terrier",196:"miniature schnauzer",197:"giant schnauzer",198:"standard schnauzer",199:"Scotch terrier, Scottish terrier, Scottie",200:"Tibetan terrier, chrysanthemum dog",201:"silky terrier, Sydney silky",202:"soft-coated wheaten terrier",203:"West Highland white terrier",204:"Lhasa, Lhasa apso",205:"flat-coated retriever",206:"curly-coated retriever",207:"golden retriever",208:"Labrador retriever",209:"Chesapeake Bay retriever",210:"German short-haired pointer",211:"vizsla, Hungarian pointer",212:"English setter",213:"Irish setter, red setter",214:"Gordon setter",215:"Brittany spaniel",216:"clumber, clumber spaniel",217:"English springer, English springer spaniel",218:"Welsh springer spaniel",219:"cocker spaniel, English cocker spaniel, cocker",220:"Sussex spaniel",221:"Irish water spaniel",222:"kuvasz",223:"schipperke",224:"groenendael",225:"malinois",226:"briard",227:"kelpie",228:"komondor",229:"Old English sheepdog, bobtail",230:"Shetland sheepdog, Shetland sheep dog, Shetland",231:"collie",232:"Border collie",233:"Bouvier des Flandres, Bouviers des Flandres",234:"Rottweiler",235:"German shepherd, German shepherd dog, German police dog, alsatian",236:"Doberman, Doberman pinscher",237:"miniature pinscher",238:"Greater Swiss Mountain dog",239:"Bernese mountain dog",240:"Appenzeller",241:"EntleBucher",242:"boxer",243:"bull mastiff",244:"Tibetan mastiff",245:"French bulldog",246:"Great Dane",247:"Saint Bernard, St Bernard",248:"Eskimo dog, husky",249:"malamute, malemute, Alaskan malamute",250:"Siberian husky",251:"dalmatian, coach dog, carriage dog",252:"affenpinscher, monkey pinscher, monkey dog",253:"basenji",254:"pug, pug-dog",255:"Leonberg",256:"Newfoundland, Newfoundland dog",257:"Great Pyrenees",258:"Samoyed, Samoyede",259:"Pomeranian",260:"chow, chow chow",261:"keeshond",262:"Brabancon griffon",263:"Pembroke, Pembroke Welsh corgi",264:"Cardigan, Cardigan Welsh corgi",265:"toy poodle",266:"miniature poodle",267:"standard poodle",268:"Mexican hairless",269:"timber wolf, grey wolf, gray wolf, Canis lupus",270:"white wolf, Arctic wolf, Canis lupus tundrarum",271:"red wolf, maned wolf, Canis rufus, Canis niger",272:"coyote, prairie wolf, brush wolf, Canis latrans",273:"dingo, warrigal, warragal, Canis dingo",274:"dhole, Cuon alpinus",275:"African hunting dog, hyena dog, Cape hunting dog, Lycaon pictus",276:"hyena, hyaena",277:"red fox, Vulpes vulpes",278:"kit fox, Vulpes macrotis",279:"Arctic fox, white fox, Alopex lagopus",280:"grey fox, gray fox, Urocyon cinereoargenteus",281:"tabby, tabby cat",282:"tiger cat",283:"Persian cat",284:"Siamese cat, Siamese",285:"Egyptian cat",286:"cougar, puma, catamount, mountain lion, painter, panther, Felis concolor",287:"lynx, catamount",288:"leopard, Panthera pardus",289:"snow leopard, ounce, Panthera uncia",290:"jaguar, panther, Panthera onca, Felis onca",291:"lion, king of beasts, Panthera leo",292:"tiger, Panthera tigris",293:"cheetah, chetah, Acinonyx jubatus",294:"brown bear, bruin, Ursus arctos",295:"American black bear, black bear, Ursus americanus, Euarctos americanus",296:"ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus",297:"sloth bear, Melursus ursinus, Ursus ursinus",298:"mongoose",299:"meerkat, mierkat",300:"tiger beetle",301:"ladybug, ladybeetle, lady beetle, ladybird, ladybird beetle",302:"ground beetle, carabid beetle",303:"long-horned beetle, longicorn, longicorn beetle",304:"leaf beetle, chrysomelid",305:"dung beetle",306:"rhinoceros beetle",307:"weevil",308:"fly",309:"bee",310:"ant, emmet, pismire",311:"grasshopper, hopper",312:"cricket",313:"walking stick, walkingstick, stick insect",314:"cockroach, roach",315:"mantis, mantid",316:"cicada, cicala",317:"leafhopper",318:"lacewing, lacewing fly",319:"dragonfly, darning needle, devil's darning needle, sewing needle, snake feeder, snake doctor, mosquito hawk, skeeter hawk",320:"damselfly",321:"admiral",322:"ringlet, ringlet butterfly",323:"monarch, monarch butterfly, milkweed butterfly, Danaus plexippus",324:"cabbage butterfly",325:"sulphur butterfly, sulfur butterfly",326:"lycaenid, lycaenid butterfly",327:"starfish, sea star",328:"sea urchin",329:"sea cucumber, holothurian",330:"wood rabbit, cottontail, cottontail rabbit",331:"hare",332:"Angora, Angora rabbit",333:"hamster",334:"porcupine, hedgehog",335:"fox squirrel, eastern fox squirrel, Sciurus niger",336:"marmot",337:"beaver",338:"guinea pig, Cavia cobaya",339:"sorrel",340:"zebra",341:"hog, pig, grunter, squealer, Sus scrofa",342:"wild boar, boar, Sus scrofa",343:"warthog",344:"hippopotamus, hippo, river horse, Hippopotamus amphibius",345:"ox",346:"water buffalo, water ox, Asiatic buffalo, Bubalus bubalis",347:"bison",348:"ram, tup",349:"bighorn, bighorn sheep, cimarron, Rocky Mountain bighorn, Rocky Mountain sheep, Ovis canadensis",350:"ibex, Capra ibex",351:"hartebeest",352:"impala, Aepyceros melampus",353:"gazelle",354:"Arabian camel, dromedary, Camelus dromedarius",355:"llama",356:"weasel",357:"mink",358:"polecat, fitch, foulmart, foumart, Mustela putorius",359:"black-footed ferret, ferret, Mustela nigripes",360:"otter",361:"skunk, polecat, wood pussy",362:"badger",363:"armadillo",364:"three-toed sloth, ai, Bradypus tridactylus",365:"orangutan, orang, orangutang, Pongo pygmaeus",366:"gorilla, Gorilla gorilla",367:"chimpanzee, chimp, Pan troglodytes",368:"gibbon, Hylobates lar",369:"siamang, Hylobates syndactylus, Symphalangus syndactylus",370:"guenon, guenon monkey",371:"patas, hussar monkey, Erythrocebus patas",372:"baboon",373:"macaque",374:"langur",375:"colobus, colobus monkey",376:"proboscis monkey, Nasalis larvatus",377:"marmoset",378:"capuchin, ringtail, Cebus capucinus",379:"howler monkey, howler",380:"titi, titi monkey",381:"spider monkey, Ateles geoffroyi",382:"squirrel monkey, Saimiri sciureus",383:"Madagascar cat, ring-tailed lemur, Lemur catta",384:"indri, indris, Indri indri, Indri brevicaudatus",385:"Indian elephant, Elephas maximus",386:"African elephant, Loxodonta africana",387:"lesser panda, red panda, panda, bear cat, cat bear, Ailurus fulgens",388:"giant panda, panda, panda bear, coon bear, Ailuropoda melanoleuca",389:"barracouta, snoek",390:"eel",391:"coho, cohoe, coho salmon, blue jack, silver salmon, Oncorhynchus kisutch",392:"rock beauty, Holocanthus tricolor",393:"anemone fish",394:"sturgeon",395:"gar, garfish, garpike, billfish, Lepisosteus osseus",396:"lionfish",397:"puffer, pufferfish, blowfish, globefish",398:"abacus",399:"abaya",400:"academic gown, academic robe, judge's robe",401:"accordion, piano accordion, squeeze box",402:"acoustic guitar",403:"aircraft carrier, carrier, flattop, attack aircraft carrier",404:"airliner",405:"airship, dirigible",406:"altar",407:"ambulance",408:"amphibian, amphibious vehicle",409:"analog clock",410:"apiary, bee house",411:"apron",412:"ashcan, trash can, garbage can, wastebin, ash bin, ash-bin, ashbin, dustbin, trash barrel, trash bin",413:"assault rifle, assault gun",414:"backpack, back pack, knapsack, packsack, rucksack, haversack",415:"bakery, bakeshop, bakehouse",416:"balance beam, beam",417:"balloon",418:"ballpoint, ballpoint pen, ballpen, Biro",419:"Band Aid",420:"banjo",421:"bannister, banister, balustrade, balusters, handrail",422:"barbell",423:"barber chair",424:"barbershop",425:"barn",426:"barometer",427:"barrel, cask",428:"barrow, garden cart, lawn cart, wheelbarrow",429:"baseball",430:"basketball",431:"bassinet",432:"bassoon",433:"bathing cap, swimming cap",434:"bath towel",435:"bathtub, bathing tub, bath, tub",436:"beach wagon, station wagon, wagon, estate car, beach waggon, station waggon, waggon",437:"beacon, lighthouse, beacon light, pharos",438:"beaker",439:"bearskin, busby, shako",440:"beer bottle",441:"beer glass",442:"bell cote, bell cot",443:"bib",444:"bicycle-built-for-two, tandem bicycle, tandem",445:"bikini, two-piece",446:"binder, ring-binder",447:"binoculars, field glasses, opera glasses",448:"birdhouse",449:"boathouse",450:"bobsled, bobsleigh, bob",451:"bolo tie, bolo, bola tie, bola",452:"bonnet, poke bonnet",453:"bookcase",454:"bookshop, bookstore, bookstall",455:"bottlecap",456:"bow",457:"bow tie, bow-tie, bowtie",458:"brass, memorial tablet, plaque",459:"brassiere, bra, bandeau",460:"breakwater, groin, groyne, mole, bulwark, seawall, jetty",461:"breastplate, aegis, egis",462:"broom",463:"bucket, pail",464:"buckle",465:"bulletproof vest",466:"bullet train, bullet",467:"butcher shop, meat market",468:"cab, hack, taxi, taxicab",469:"caldron, cauldron",470:"candle, taper, wax light",471:"cannon",472:"canoe",473:"can opener, tin opener",474:"cardigan",475:"car mirror",476:"carousel, carrousel, merry-go-round, roundabout, whirligig",477:"carpenter's kit, tool kit",478:"carton",479:"car wheel",480:"cash machine, cash dispenser, automated teller machine, automatic teller machine, automated teller, automatic teller, ATM",481:"cassette",482:"cassette player",483:"castle",484:"catamaran",485:"CD player",486:"cello, violoncello",487:"cellular telephone, cellular phone, cellphone, cell, mobile phone",488:"chain",489:"chainlink fence",490:"chain mail, ring mail, mail, chain armor, chain armour, ring armor, ring armour",491:"chain saw, chainsaw",492:"chest",493:"chiffonier, commode",494:"chime, bell, gong",495:"china cabinet, china closet",496:"Christmas stocking",497:"church, church building",498:"cinema, movie theater, movie theatre, movie house, picture palace",499:"cleaver, meat cleaver, chopper",500:"cliff dwelling",501:"cloak",502:"clog, geta, patten, sabot",503:"cocktail shaker",504:"coffee mug",505:"coffeepot",506:"coil, spiral, volute, whorl, helix",507:"combination lock",508:"computer keyboard, keypad",509:"confectionery, confectionary, candy store",510:"container ship, containership, container vessel",511:"convertible",512:"corkscrew, bottle screw",513:"cornet, horn, trumpet, trump",514:"cowboy boot",515:"cowboy hat, ten-gallon hat",516:"cradle",517:"crane",518:"crash helmet",519:"crate",520:"crib, cot",521:"Crock Pot",522:"croquet ball",523:"crutch",524:"cuirass",525:"dam, dike, dyke",526:"desk",527:"desktop computer",528:"dial telephone, dial phone",529:"diaper, nappy, napkin",530:"digital clock",531:"digital watch",532:"dining table, board",533:"dishrag, dishcloth",534:"dishwasher, dish washer, dishwashing machine",535:"disk brake, disc brake",536:"dock, dockage, docking facility",537:"dogsled, dog sled, dog sleigh",538:"dome",539:"doormat, welcome mat",540:"drilling platform, offshore rig",541:"drum, membranophone, tympan",542:"drumstick",543:"dumbbell",544:"Dutch oven",545:"electric fan, blower",546:"electric guitar",547:"electric locomotive",548:"entertainment center",549:"envelope",550:"espresso maker",551:"face powder",552:"feather boa, boa",553:"file, file cabinet, filing cabinet",554:"fireboat",555:"fire engine, fire truck",556:"fire screen, fireguard",557:"flagpole, flagstaff",558:"flute, transverse flute",559:"folding chair",560:"football helmet",561:"forklift",562:"fountain",563:"fountain pen",564:"four-poster",565:"freight car",566:"French horn, horn",567:"frying pan, frypan, skillet",568:"fur coat",569:"garbage truck, dustcart",570:"gasmask, respirator, gas helmet",571:"gas pump, gasoline pump, petrol pump, island dispenser",572:"goblet",573:"go-kart",574:"golf ball",575:"golfcart, golf cart",576:"gondola",577:"gong, tam-tam",578:"gown",579:"grand piano, grand",580:"greenhouse, nursery, glasshouse",581:"grille, radiator grille",582:"grocery store, grocery, food market, market",583:"guillotine",584:"hair slide",585:"hair spray",586:"half track",587:"hammer",588:"hamper",589:"hand blower, blow dryer, blow drier, hair dryer, hair drier",590:"hand-held computer, hand-held microcomputer",591:"handkerchief, hankie, hanky, hankey",592:"hard disc, hard disk, fixed disk",593:"harmonica, mouth organ, harp, mouth harp",594:"harp",595:"harvester, reaper",596:"hatchet",597:"holster",598:"home theater, home theatre",599:"honeycomb",600:"hook, claw",601:"hoopskirt, crinoline",602:"horizontal bar, high bar",603:"horse cart, horse-cart",604:"hourglass",605:"iPod",606:"iron, smoothing iron",607:"jack-o'-lantern",608:"jean, blue jean, denim",609:"jeep, landrover",610:"jersey, T-shirt, tee shirt",611:"jigsaw puzzle",612:"jinrikisha, ricksha, rickshaw",613:"joystick",614:"kimono",615:"knee pad",616:"knot",617:"lab coat, laboratory coat",618:"ladle",619:"lampshade, lamp shade",620:"laptop, laptop computer",621:"lawn mower, mower",622:"lens cap, lens cover",623:"letter opener, paper knife, paperknife",624:"library",625:"lifeboat",626:"lighter, light, igniter, ignitor",627:"limousine, limo",628:"liner, ocean liner",629:"lipstick, lip rouge",630:"Loafer",631:"lotion",632:"loudspeaker, speaker, speaker unit, loudspeaker system, speaker system",633:"loupe, jeweler's loupe",634:"lumbermill, sawmill",635:"magnetic compass",636:"mailbag, postbag",637:"mailbox, letter box",638:"maillot",639:"maillot, tank suit",640:"manhole cover",641:"maraca",642:"marimba, xylophone",643:"mask",644:"matchstick",645:"maypole",646:"maze, labyrinth",647:"measuring cup",648:"medicine chest, medicine cabinet",649:"megalith, megalithic structure",650:"microphone, mike",651:"microwave, microwave oven",652:"military uniform",653:"milk can",654:"minibus",655:"miniskirt, mini",656:"minivan",657:"missile",658:"mitten",659:"mixing bowl",660:"mobile home, manufactured home",661:"Model T",662:"modem",663:"monastery",664:"monitor",665:"moped",666:"mortar",667:"mortarboard",668:"mosque",669:"mosquito net",670:"motor scooter, scooter",671:"mountain bike, all-terrain bike, off-roader",672:"mountain tent",673:"mouse, computer mouse",674:"mousetrap",675:"moving van",676:"muzzle",677:"nail",678:"neck brace",679:"necklace",680:"nipple",681:"notebook, notebook computer",682:"obelisk",683:"oboe, hautboy, hautbois",684:"ocarina, sweet potato",685:"odometer, hodometer, mileometer, milometer",686:"oil filter",687:"organ, pipe organ",688:"oscilloscope, scope, cathode-ray oscilloscope, CRO",689:"overskirt",690:"oxcart",691:"oxygen mask",692:"packet",693:"paddle, boat paddle",694:"paddlewheel, paddle wheel",695:"padlock",696:"paintbrush",697:"pajama, pyjama, pj's, jammies",698:"palace",699:"panpipe, pandean pipe, syrinx",700:"paper towel",701:"parachute, chute",702:"parallel bars, bars",703:"park bench",704:"parking meter",705:"passenger car, coach, carriage",706:"patio, terrace",707:"pay-phone, pay-station",708:"pedestal, plinth, footstall",709:"pencil box, pencil case",710:"pencil sharpener",711:"perfume, essence",712:"Petri dish",713:"photocopier",714:"pick, plectrum, plectron",715:"pickelhaube",716:"picket fence, paling",717:"pickup, pickup truck",718:"pier",719:"piggy bank, penny bank",720:"pill bottle",721:"pillow",722:"ping-pong ball",723:"pinwheel",724:"pirate, pirate ship",725:"pitcher, ewer",726:"plane, carpenter's plane, woodworking plane",727:"planetarium",728:"plastic bag",729:"plate rack",730:"plow, plough",731:"plunger, plumber's helper",732:"Polaroid camera, Polaroid Land camera",733:"pole",734:"police van, police wagon, paddy wagon, patrol wagon, wagon, black Maria",735:"poncho",736:"pool table, billiard table, snooker table",737:"pop bottle, soda bottle",738:"pot, flowerpot",739:"potter's wheel",740:"power drill",741:"prayer rug, prayer mat",742:"printer",743:"prison, prison house",744:"projectile, missile",745:"projector",746:"puck, hockey puck",747:"punching bag, punch bag, punching ball, punchball",748:"purse",749:"quill, quill pen",750:"quilt, comforter, comfort, puff",751:"racer, race car, racing car",752:"racket, racquet",753:"radiator",754:"radio, wireless",755:"radio telescope, radio reflector",756:"rain barrel",757:"recreational vehicle, RV, R.V.",758:"reel",759:"reflex camera",760:"refrigerator, icebox",761:"remote control, remote",762:"restaurant, eating house, eating place, eatery",763:"revolver, six-gun, six-shooter",764:"rifle",765:"rocking chair, rocker",766:"rotisserie",767:"rubber eraser, rubber, pencil eraser",768:"rugby ball",769:"rule, ruler",770:"running shoe",771:"safe",772:"safety pin",773:"saltshaker, salt shaker",774:"sandal",775:"sarong",776:"sax, saxophone",777:"scabbard",778:"scale, weighing machine",779:"school bus",780:"schooner",781:"scoreboard",782:"screen, CRT screen",783:"screw",784:"screwdriver",785:"seat belt, seatbelt",786:"sewing machine",787:"shield, buckler",788:"shoe shop, shoe-shop, shoe store",789:"shoji",790:"shopping basket",791:"shopping cart",792:"shovel",793:"shower cap",794:"shower curtain",795:"ski",796:"ski mask",797:"sleeping bag",798:"slide rule, slipstick",799:"sliding door",800:"slot, one-armed bandit",801:"snorkel",802:"snowmobile",803:"snowplow, snowplough",804:"soap dispenser",805:"soccer ball",806:"sock",807:"solar dish, solar collector, solar furnace",808:"sombrero",809:"soup bowl",810:"space bar",811:"space heater",812:"space shuttle",813:"spatula",814:"speedboat",815:"spider web, spider's web",816:"spindle",817:"sports car, sport car",818:"spotlight, spot",819:"stage",820:"steam locomotive",821:"steel arch bridge",822:"steel drum",823:"stethoscope",824:"stole",825:"stone wall",826:"stopwatch, stop watch",827:"stove",828:"strainer",829:"streetcar, tram, tramcar, trolley, trolley car",830:"stretcher",831:"studio couch, day bed",832:"stupa, tope",833:"submarine, pigboat, sub, U-boat",834:"suit, suit of clothes",835:"sundial",836:"sunglass",837:"sunglasses, dark glasses, shades",838:"sunscreen, sunblock, sun blocker",839:"suspension bridge",840:"swab, swob, mop",841:"sweatshirt",842:"swimming trunks, bathing trunks",843:"swing",844:"switch, electric switch, electrical switch",845:"syringe",846:"table lamp",847:"tank, army tank, armored combat vehicle, armoured combat vehicle",848:"tape player",849:"teapot",850:"teddy, teddy bear",851:"television, television system",852:"tennis ball",853:"thatch, thatched roof",854:"theater curtain, theatre curtain",855:"thimble",856:"thresher, thrasher, threshing machine",857:"throne",858:"tile roof",859:"toaster",860:"tobacco shop, tobacconist shop, tobacconist",861:"toilet seat",862:"torch",863:"totem pole",864:"tow truck, tow car, wrecker",865:"toyshop",866:"tractor",867:"trailer truck, tractor trailer, trucking rig, rig, articulated lorry, semi",868:"tray",869:"trench coat",870:"tricycle, trike, velocipede",871:"trimaran",872:"tripod",873:"triumphal arch",874:"trolleybus, trolley coach, trackless trolley",875:"trombone",876:"tub, vat",877:"turnstile",878:"typewriter keyboard",879:"umbrella",880:"unicycle, monocycle",881:"upright, upright piano",882:"vacuum, vacuum cleaner",883:"vase",884:"vault",885:"velvet",886:"vending machine",887:"vestment",888:"viaduct",889:"violin, fiddle",890:"volleyball",891:"waffle iron",892:"wall clock",893:"wallet, billfold, notecase, pocketbook",894:"wardrobe, closet, press",895:"warplane, military plane",896:"washbasin, handbasin, washbowl, lavabo, wash-hand basin",897:"washer, automatic washer, washing machine",898:"water bottle",899:"water jug",900:"water tower",901:"whiskey jug",902:"whistle",903:"wig",904:"window screen",905:"window shade",906:"Windsor tie",907:"wine bottle",908:"wing",909:"wok",910:"wooden spoon",911:"wool, woolen, woollen",912:"worm fence, snake fence, snake-rail fence, Virginia fence",913:"wreck",914:"yawl",915:"yurt",916:"web site, website, internet site, site",917:"comic book",918:"crossword puzzle, crossword",919:"street sign",920:"traffic light, traffic signal, stoplight",921:"book jacket, dust cover, dust jacket, dust wrapper",922:"menu",923:"plate",924:"guacamole",925:"consomme",926:"hot pot, hotpot",927:"trifle",928:"ice cream, icecream",929:"ice lolly, lolly, lollipop, popsicle",930:"French loaf",931:"bagel, beigel",932:"pretzel",933:"cheeseburger",934:"hotdog, hot dog, red hot",935:"mashed potato",936:"head cabbage",937:"broccoli",938:"cauliflower",939:"zucchini, courgette",940:"spaghetti squash",941:"acorn squash",942:"butternut squash",943:"cucumber, cuke",944:"artichoke, globe artichoke",945:"bell pepper",946:"cardoon",947:"mushroom",948:"Granny Smith",949:"strawberry",950:"orange",951:"lemon",952:"fig",953:"pineapple, ananas",954:"banana",955:"jackfruit, jak, jack",956:"custard apple",957:"pomegranate",958:"hay",959:"carbonara",960:"chocolate sauce, chocolate syrup",961:"dough",962:"meat loaf, meatloaf",963:"pizza, pizza pie",964:"potpie",965:"burrito",966:"red wine",967:"espresso",968:"cup",969:"eggnog",970:"alp",971:"bubble",972:"cliff, drop, drop-off",973:"coral reef",974:"geyser",975:"lakeside, lakeshore",976:"promontory, headland, head, foreland",977:"sandbar, sand bar",978:"seashore, coast, seacoast, sea-coast",979:"valley, vale",980:"volcano",981:"ballplayer, baseball player",982:"groom, bridegroom",983:"scuba diver",984:"rapeseed",985:"daisy",986:"yellow lady's slipper, yellow lady-slipper, Cypripedium calceolus, Cypripedium parviflorum",987:"corn",988:"acorn",989:"hip, rose hip, rosehip",990:"buckeye, horse chestnut, conker",991:"coral fungus",992:"agaric",993:"gyromitra",994:"stinkhorn, carrion fungus",995:"earthstar",996:"hen-of-the-woods, hen of the woods, Polyporus frondosus, Grifola frondosa",997:"bolete",998:"ear, spike, capitulum",999:"toilet tissue, toilet paper, bathroom tissue"},Tu=224,ATe={"1.00":"module_apply_default/MobilenetV1/Logits/global_pool","2.00":"module_apply_default/MobilenetV2/Logits/AvgPool"},df={"1.00":{.25:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",inputRange:[0,1]},"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1",inputRange:[0,1]}},"2.00":{"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2",inputRange:[0,1]}}};function kTe(n){return n===void 0&&(n={version:1,alpha:1}),Wv(this,void 0,void 0,function(){var e,t,s,r,i,o,a;return Kv(this,function(l){switch(l.label){case 0:if(Zve==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");if(e=n.version.toFixed(2),t=n.alpha?n.alpha.toFixed(2):"",s=-1,r=1,n.modelUrl==null){if(!(e in df))throw new Error("Invalid version of MobileNet. Valid versions are: "+Object.keys(df));if(!(t in df[e]))throw new Error("MobileNet constructed with invalid alpha "+n.alpha+". Valid multipliers for this version are: "+Object.keys(df[e])+".");o=df[e][t].inputRange,s=o[0],r=o[1]}return n.inputRange!=null&&(a=n.inputRange,s=a[0],r=a[1]),[4,(i=new $Te(e,t,n.modelUrl,s,r)).load()];case 1:return l.sent(),[2,i]}})})}var $Te=(function(){function n(e,t,s,r,i){r===void 0&&(r=-1),i===void 0&&(i=1),this.version=e,this.alpha=t,this.modelUrl=s,this.inputMin=r,this.inputMax=i,this.normalizationConstant=(i-r)/255}return n.prototype.load=function(){return Wv(this,void 0,void 0,function(){var e,t,s,r,i=this;return Kv(this,function(o){switch(o.label){case 0:return this.modelUrl?(e=this,[4,B3(this.modelUrl)]):[3,2];case 1:return e.model=o.sent(),[3,4];case 2:return t=df[this.version][this.alpha].url,s=this,[4,B3(t,{fromTFHub:!0})];case 3:s.model=o.sent(),o.label=4;case 4:return[4,(r=qt(function(){return i.model.predict(ac([1,Tu,Tu,3]))})).data()];case 5:return o.sent(),r.dispose(),[2]}})})},n.prototype.infer=function(e,t){var s=this;return t===void 0&&(t=!1),qt(function(){e instanceof Vn||(e=VW(e));var r=ot(Ue(vn(e,"float32"),s.normalizationConstant),s.inputMin),i=r;(e.shape[0]!==Tu||e.shape[1]!==Tu)&&(i=MA.resizeBilinear(r,[Tu,Tu],!0));var o,a=ke(i,[-1,Tu,Tu,3]);if(t){var l=ATe[s.version],u=s.model.execute(a,l);o=Cy(u,[1,2])}else{var h=s.model.predict(a);o=hn(h,[0,1],[-1,1e3])}return o})},n.prototype.classify=function(e,t){return t===void 0&&(t=3),Wv(this,void 0,void 0,function(){var s,r;return Kv(this,function(i){switch(i.label){case 0:return[4,RTe(s=this.infer(e),t)];case 1:return r=i.sent(),s.dispose(),[2,r]}})})},n})();function RTe(n,e){return Wv(this,void 0,void 0,function(){var t,s,r,i,o,a,l;return Kv(this,function(u){switch(u.label){case 0:return[4,(t=EA(n)).data()];case 1:for(s=u.sent(),t.dispose(),r=[],l=0;l<s.length;l++)r.push({value:s[l],index:l});for(r.sort(function(h,f){return f.value-h.value}),i=new Float32Array(e),o=new Int32Array(e),l=0;l<e;l++)i[l]=r[l].value,o[l]=r[l].index;for(a=[],l=0;l<o.length;l++)a.push({className:NTe[o[l]],probability:i[l]});return[2,a]}})})}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DTe=1e-7,MTe=1e-4;class e5{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class WA{refCount(e){return Qr("refCount")}incRef(e){return Qr("incRef")}timerAvailable(){return!0}time(e){return Qr("time")}read(e){return Qr("read")}readSync(e){return Qr("readSync")}readToGPU(e,t){return Qr("readToGPU")}numDataIds(){return Qr("numDataIds")}disposeData(e,t){return Qr("disposeData")}write(e,t,s){return Qr("write")}move(e,t,s,r,i){return Qr("move")}createTensorFromGPUData(e,t,s){return Qr("createTensorFromGPUData")}memory(){return Qr("memory")}floatPrecision(){return Qr("floatPrecision")}epsilon(){return this.floatPrecision()===32?DTe:MTe}dispose(){return Qr("dispose")}}function Qr(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OTe(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,ff(n,e,t)}function Bh(n,e,t){return Math.max(n,Math.min(e,t))}function KA(n){return n%2===0?n:n+1}function ff(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function PTe(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function q(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function XA(n,e,t=""){q(jt(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function t5(n){q(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Ee(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function jt(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Jf(n){return n%1===0}function zI(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function kf(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function U3(n,e=r=>0,t,s){return new Promise((r,i)=>{let o=0;const a=()=>{if(n()){r();return}o++;const l=e(o);if(t!=null&&o>=t){i();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function n5(n,e){let t=1,s=-1;for(let i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(n[i]<0)throw Error(`Shapes can not be < 0. Found ${n[i]} at dim ${i}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function xt(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),q(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),q(n.every(s=>Jf(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function xc(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||r?null:xt(e,n).sort();let o=0;for(let a=0;a<n.length;++a){if(i!=null){if(i[o]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(i[o]==null||i[o]>a)&&n[a]===1&&(t.push(n[a]),s.push(a)),i[o]<=a&&o++}n[a]!==1&&(t.push(n[a]),s.push(a))}return{newShape:t,keptDims:s}}function ir(n,e){return Wn(n,e)}function Wn(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function FTe(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function LTe(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function s5(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function Xv(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function VTe(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function Ny(n){return typeof n=="string"||n instanceof String}function BTe(n){return typeof n=="boolean"}function GI(n){return typeof n=="number"}function _p(n){return Array.isArray(n)?_p(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":GI(n)?"float32":Ny(n)?"string":BTe(n)?"bool":"float32"}function HI(n){return!!(n&&n.constructor&&n.call&&n.apply)}function qI(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function Qe(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function r5(n,e,t,s=!1){const r=new Array;if(e.length===1){const i=e[0]*(s?2:1);for(let o=0;o<i;o++)r[o]=t[n+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,u)=>l*u)*(s?2:1);for(let l=0;l<i;l++)r[l]=r5(n+l*a,o,t,s)}return r}function ko(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,i)=>r*i)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return r5(0,n,e,t)}function UTe(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function YA(n,e){const t=or(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function or(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function i5(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return ko(n,new Float32Array(t));if(e==="int32")return ko(n,new Int32Array(t));if(e==="bool")return ko(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function Fl(n){n.forEach(e=>{q(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function xa(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function Ep(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function JA(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z3="tfjsflags";class zTe{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=GTe,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(we().getBool("IS_TEST")||we().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];we().getBool("IS_TEST")||we().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(JA(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);z3 in e&&e[z3].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=qTe(r,i)})}}function GTe(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(HTe(e,s[0],s[1]),s.join("="))),e}function HTe(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function qTe(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function we(){return o5}let o5=null;function WTe(n){o5=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let uE;function a5(){if(uE==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");uE=n}return uE}function KTe(){const n=a5();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function jA(n,e){const t=KTe();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const hT="Abs",Ay="Acos",ky="Acosh",Ip="Add",QA="AddN",ZA="All",ek="Any",dT="ArgMax",fT="ArgMin",$y="Asin",Ry="Asinh",Dy="Atan",My="Atanh",Oy="Atan2",pT="AvgPool",tk="AvgPoolGrad",mT="AvgPool3D",nk="AvgPool3DGrad",gT="BatchMatMul",yT="BatchToSpaceND",sk="Bincount",rk="BitwiseAnd",XTe="BroadcastTo",l5="BroadcastArgs",Py="Cast",Fy="Ceil",Ly="ClipByValue",ik="Complex",bT="ComplexAbs",vT="Concat",wT="Conv2D",ok="Conv2DBackpropFilter",TT="Conv2DBackpropInput",xT="Conv3D",ak="Conv3DBackpropFilterV2",lk="Conv3DBackpropInputV2",Vy="Cos",By="Cosh",uk="Cumprod",ST="Cumsum",ck="CropAndResize",hk="DenseBincount",dk="DepthToSpace",_T="DepthwiseConv2dNative",fk="DepthwiseConv2dNativeBackpropFilter",pk="DepthwiseConv2dNativeBackpropInput",u5="Diag",ET="Dilation2D",WI="Dilation2DBackpropInput",KI="Dilation2DBackpropFilter",YTe="Draw",Uy="RealDiv",mk="Einsum",zy="Elu",gk="EluGrad",Gy="Erf",IT="Equal",Hy="Exp",CT="ExpandDims",qy="Expm1",yk="FFT",bk="Fill",vk="FlipLeftRight",Wy="Floor",Ky="FloorDiv",NT="FusedBatchNorm",AT="GatherV2",c5="GatherNd",kT="Greater",Xy="GreaterEqual",Yy="Identity",wk="IFFT",Tk="Imag",Jy="IsFinite",jy="IsInf",Qy="IsNan",$T="LeakyRelu",RT="Less",DT="LessEqual",h5="LinSpace",Zy="Log",eb="Log1p",MT="LogicalAnd",OT="LogicalNot",PT="LogicalOr",JTe="LogSoftmax",FT="LRN",xk="LRNGrad",LT="Max",tb="Maximum",VT="MaxPool",Sk="MaxPoolGrad",BT="MaxPool3D",_k="MaxPool3DGrad",d5="MaxPoolWithArgmax",UT="Mean",zT="Min",nb="Minimum",GT="MirrorPad",sb="Mod",f5="Multinomial",rb="Multiply",HT="Neg",qT="NotEqual",Ek="NonMaxSuppressionV3",Ik="NonMaxSuppressionV4",Ck="NonMaxSuppressionV5",WT="OnesLike",KT="OneHot",XT="Pack",YT="PadV2",ib="Pow",JT="Prelu",jT="Prod",p5="RaggedGather",m5="RaggedRange",g5="RaggedTensorToTensor",Nk="Range",Ak="Real",ob="Reciprocal",ab="Relu",QT="Reshape",ZT="ResizeNearestNeighbor",kk="ResizeNearestNeighborGrad",ex="ResizeBilinear",$k="ResizeBilinearGrad",lb="Relu6",tx="Reverse",ub="Round",cb="Rsqrt",y5="ScatterNd",b5="TensorScatterUpdate",v5="SearchSorted",nx="Select",hb="Selu",sx="Slice",db="Sin",fb="Sinh",pb="Sign",mb="Sigmoid",gb="Softplus",yb="Sqrt",rx="Sum",ix="SpaceToBatchND",ox="SplitV",ax="Softmax",w5="SparseFillEmptyRows",T5="SparseReshape",x5="SparseSegmentMean",S5="SparseSegmentSum",_5="SparseToDense",bb="SquaredDifference",Rk="Square",Dk="StaticRegexReplace",Mk="StridedSlice",E5="StringNGrams",I5="StringSplit",C5="StringToHashBucketFast",vb="Sub",wb="Tan",Tb="Tanh",xb="Tile",Ok="TopK",Pk="Transform",$f="Transpose",Fk="Unique",lx="Unpack",ux="UnsortedSegmentSum",cx="ZerosLike",Sb="Step",jTe="FromPixels",Lk="RotateWithOffset",Yv="_FusedMatMul",Jv="FusedConv2D",N5="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wi(...n){we().getBool("IS_TEST")||we().getBool("PROD")||console.warn(...n)}function QTe(...n){we().getBool("IS_TEST")||we().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jv=jA("kernelRegistry",()=>new Map),XI=jA("gradRegistry",()=>new Map);function G3(n,e){const t=k5(n,e);return jv.get(t)}function H3(n){return XI.get(n)}function q3(n){const e=jv.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[i,o]=r,[a]=i.split("_");a===n&&t.push(o)}return t}function A5(n){const{kernelName:e,backendName:t}=n,s=k5(e,t);jv.has(s)&&wi(`The kernel '${e}' for backend '${t}' is already registered`),jv.set(s,n)}function ZTe(n){const{kernelName:e}=n;XI.has(e)&&we().getBool("DEBUG")&&wi(`Overriding the gradient for '${e}'`),XI.set(e,n)}function k5(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $5(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mh=zN||k6;function hx(n){return mh.fromString(n,!0,16)}const R5=hx("c3a5c85c97cb3127"),hh=hx("b492b66fbe98f273"),yr=hx("9ae16a3b2f90404f");function YI(n){return n.xor(n.shru(47))}function D5(n,e,t){const s=n.slice(e,e+t);return mh.fromBytes(Array.from(s),!0,!0)}function Sn(n,e){return D5(n,e,8)}function W3(n,e){return D5(n,e,4)}function As(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function Hu(n,e,t=hx("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function exe(n,e,t,s,r,i){r=r.add(n),i=As(i.add(r).add(s),21);const o=r;return r=r.add(e),r=r.add(t),i=i.add(As(r,44)),[r.add(s),i.add(o)]}function I1(n,e,t,s){return exe(Sn(n,e),Sn(n,e+8),Sn(n,e+16),Sn(n,e+24),t,s)}function txe(n,e=n.length){if(e>=8){const t=yr.add(e*2),s=Sn(n,0).add(yr),r=Sn(n,e-8),i=As(r,37).mul(t).add(s),o=As(s,25).add(r).mul(t);return Hu(i,o,t)}if(e>=4){const t=yr.add(e*2),s=W3(n,0);return Hu(s.shl(3).add(e),W3(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],i=t+(s<<8),o=e+(r<<2);return YI(yr.mul(i).xor(R5.mul(o))).mul(yr)}return yr}function nxe(n,e=n.length){const t=yr.add(e*2),s=Sn(n,0).mul(hh),r=Sn(n,8),i=Sn(n,e-8).mul(t),o=Sn(n,e-16).mul(yr);return Hu(As(s.add(r),43).add(As(i,30)).add(o),s.add(As(r.add(yr),18)).add(i),t)}function sxe(n,e=n.length){const t=yr.add(e*2),s=Sn(n,0).mul(yr),r=Sn(n,8),i=Sn(n,e-8).mul(t),o=Sn(n,e-16).mul(yr),a=As(s.add(r),43).add(As(i,30)).add(o),l=Hu(a,s.add(As(r.add(yr),18)).add(i),t),u=Sn(n,16).mul(t),h=Sn(n,24),f=a.add(Sn(n,e-32)).mul(t),p=l.add(Sn(n,e-24)).mul(t);return Hu(As(u.add(h),43).add(As(f,30)).add(p),u.add(As(h.add(s),18)).add(f),t)}function rxe(n,e=n.length){const t=mh.fromNumber(81,!0);if(e<=32)return e<=16?txe(n,e):nxe(n,e);if(e<=64)return sxe(n,e);let s=t,r=t.mul(hh).add(113),i=YI(r.mul(yr).add(113)).mul(yr),o=[mh.UZERO,mh.UZERO],a=[mh.UZERO,mh.UZERO];s=s.mul(yr).add(Sn(n,0));let l=0;const u=(e-1>>6)*64,h=u+(e-1&63)-63;do s=As(s.add(r).add(o[0]).add(Sn(n,l+8)),37).mul(hh),r=As(r.add(o[1]).add(Sn(n,l+48)),42).mul(hh),s=s.xor(a[1]),r=r.add(o[0]).add(Sn(n,l+40)),i=As(i.add(a[0]),33).mul(hh),o=I1(n,l,o[1].mul(hh),s.add(a[0])),a=I1(n,l+32,i.add(a[1]),r.add(Sn(n,l+16))),[i,s]=[s,i],l+=64;while(l!==u);const f=hh.add(i.and(255).shl(1));return l=h,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=As(s.add(r).add(o[0]).add(Sn(n,l+8)),37).mul(f),r=As(r.add(o[1]).add(Sn(n,l+48)),42).mul(f),s=s.xor(a[1].mul(9)),r=r.add(o[0].mul(9).add(Sn(n,l+40))),i=As(i.add(a[0]),33).mul(f),o=I1(n,l,o[1].mul(f),s.add(a[0])),a=I1(n,l+32,i.add(a[1]),r.add(Sn(n,l+16))),[i,s]=[s,i],Hu(Hu(o[0],a[0],f).add(YI(r).mul(R5)).add(i),Hu(o[1],a[1],f).add(s),f)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sc(n,e){return e==="string"?qu(n):sd([n],e)}function ixe(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function sd(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Uh(n)),we().getBool("DEBUG")&&FTe(n,e),ixe(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function kr(){return we().platform.now()}function qu(n,e="utf-8"){return e=e||"utf-8",we().platform.encode(n,e)}function uc(n,e="utf-8"){return e=e||"utf-8",we().platform.decode(n,e)}function Zi(n){return we().platform.isTypedArray!=null?we().platform.isTypedArray(n):$5(n)}function Uh(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||JA(n)||n==null||Zi(n)&&t)e.push(n);else if(Array.isArray(n)||Zi(n))for(let s=0;s<n.length;++s)Uh(n[s],e,t);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)Uh(n[r],e,t)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oxe{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new lxe)}profileKernel(e,t,s){let r;const i=()=>{r=s()};let o;const a=kr();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const u of r)u.dataSync();o=Promise.resolve({kernelMs:kr()-a})}if(we().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<r.length;u++){const h=r[u];h.data().then(f=>{axe(f,h.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:o.then(u=>u.kernelMs),extraInfo:o.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:i,extraInfo:o}=e;s.forEach(a=>{Promise.all([a.data(),r,o]).then(l=>{this.logger.logKernelProfile(t,a,l[0],l[1],i,l[2])})})}}function axe(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}class lxe{logKernelProfile(e,t,s,r,i,o){const a=typeof r=="number"?kf(`${r}ms`,9):r.error,l=kf(e,25),u=t.rank,h=t.size,f=kf(t.shape.toString(),14);let p="";for(const g in i){const b=i[g];if(b!=null){const T=b.shape||t.shape,w=T.length;p+=`${g}: ${w}D ${w>0?T:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${f}	%c${h}	%c${p}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uxe(n,e,t){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<n.length;l++){const u=n[l],h=u.inputs;for(const f in h){const p=h[f];let g=!1;for(let b=0;b<e.length;b++)if(s[p.id]){u.outputs.forEach(T=>s[T.id]=!0),g=!0,r[u.id]=!0;break}if(g)break}}const i={};i[t.id]=!0;const o={};for(let l=n.length-1;l>=0;l--){const u=n[l],h=u.inputs;for(let f=0;f<u.outputs.length;f++)if(i[u.outputs[f].id]){for(const p in h)i[h[p].id]=!0,o[u.id]=!0;break}}const a=[];for(let l=0;l<n.length;l++){const u=n[l];if(r[u.id]&&o[u.id]){const h={};for(const p in u.inputs){const g=u.inputs[p];s[g.id]&&(h[p]=g)}const f=Object.assign({},u);f.inputs=h,f.outputs=u.outputs,a.push(f)}}return a}function cxe(n,e,t,s){for(let r=e.length-1;r>=0;r--){const i=e[r],o=[];if(i.outputs.forEach(l=>{const u=n[l.id];u!=null?o.push(u):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=t(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const h=i.inputs[l];if(!jt(u.shape,h.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${h.shape}'`);if(n[h.id]==null)n[h.id]=u;else{const f=n[h.id];n[h.id]=s(f,u),f.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K3=20,qm=3,cE=7;function hxe(n,e,t,s){const r=Qe(e),i=dxe(n,e,t,r),o=e.length,a=lv(n,e,t,r,i),l=["Tensor"];return s&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function dxe(n,e,t,s){const r=Ee(e),i=s[s.length-1],o=new Array(i).fill(0),a=e.length,l=t==="complex64"?ng(n):n;if(a>1)for(let u=0;u<r/i;u++){const h=u*i;for(let f=0;f<i;f++)o[f]=Math.max(o[f],tg(l[h+f],0,t).length)}return o}function tg(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(cE))} + ${parseFloat(n[1].toFixed(cE))}j`:Ny(n)?s=`'${n}'`:t==="bool"?s=M5(n):s=parseFloat(n.toFixed(cE)).toString(),kf(s,e)}function M5(n){return n===0?"false":"true"}function lv(n,e,t,s,r,i=!0){const o=t==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(t==="complex64"){const T=ng(n);return[tg(T[0],0,t)]}return t==="bool"?[M5(n[0])]:[n[0].toString()]}if(l===1){if(a>K3){const w=qm*o;let _=Array.from(n.slice(0,w)),C=Array.from(n.slice((a-qm)*o,a*o));return t==="complex64"&&(_=ng(_),C=ng(C)),["["+_.map((N,A)=>tg(N,r[A],t)).join(", ")+", ..., "+C.map((N,A)=>tg(N,r[a-qm+A],t)).join(", ")+"]"]}return["["+(t==="complex64"?ng(n):Array.from(n)).map((w,_)=>tg(w,r[_],t)).join(", ")+"]"]}const u=e.slice(1),h=s.slice(1),f=s[0]*o,p=[];if(a>K3){for(let T=0;T<qm;T++){const w=T*f,_=w+f;p.push(...lv(n.slice(w,_),u,t,h,r,!1))}p.push("...");for(let T=a-qm;T<a;T++){const w=T*f,_=w+f;p.push(...lv(n.slice(w,_),u,t,h,r,T===a-1))}}else for(let T=0;T<a;T++){const w=T*f,_=w+f;p.push(...lv(n.slice(w,_),u,t,h,r,T===a-1))}const g=l===2?",":"";p[0]="["+(a>0?p[0]+g:"");for(let T=1;T<p.length-1;T++)p[T]=" "+p[T]+g;let b=`,
`;for(let T=2;T<l;T++)b+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(i?"":b),p}function ng(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bs{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=Ee(e),s!=null){const r=s.length;q(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||Wn(t,this.size),this.strides=Qe(e)}set(e,...t){t.length===0&&(t=[0]),q(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return xo().makeTensor(this.values,this.shape,this.dtype)}}let xo=null,pf=null;function fxe(n){xo=n}function pxe(n){pf=n}class gs{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Ee(e),this.strides=Qe(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return pf.buffer(this.shape,this.dtype,e)}bufferSync(){return pf.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return ko(this.shape,e,this.dtype==="complex64")}arraySync(){return ko(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=xo().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>uc(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),xo().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=xo().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>uc(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await xo().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),xo().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return pf.print(this,e)}clone(){return this.throwIfDisposed(),pf.clone(this)}toString(e=!1){const t=this.dataSync();return hxe(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),pf.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),xo().makeVariable(this,e,t,s)}}Object.defineProperty(gs,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function _e(){return jA("Tensor",()=>gs)}_e();class Qv extends gs{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!jt(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);xo().disposeTensor(this),this.dataId=e.dataId,xo().incRef(this,null)}dispose(){xo().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Qv,Symbol.hasInstance,{value:n=>n instanceof gs&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var X3;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(X3||(X3={}));var JI;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(JI||(JI={}));var jI;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(jI||(jI={}));var QI;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(QI||(QI={}));var ZI;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(ZI||(ZI={}));const mxe={float32:QI,int32:JI,bool:jI,complex64:ZI};function ai(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return mxe[n][e]}function Vk(n){return ai(n,"int32")}function O5(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function P5(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xn(n,e){if(n.dtype===e.dtype)return[n,e];const t=ai(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function F5(n){const e=[];return L5(n,e,new Set),e}function L5(n,e,t){if(n==null)return;if(n instanceof gs){e.push(n);return}if(!gxe(n))return;const s=n;for(const r in s){const i=s[r];t.has(i)||(t.add(i),L5(i,e,t))}}function gxe(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hE(n){return n.kernelName!=null}class Y3{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class jf{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Y3}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(wi(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new oxe(this.backendInstance),!0}setupRegisteredKernels(){q3(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){q3(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof WA)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,wi(`Initialization of backend ${e} failed`),wi(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return wi(`Initialization of backend ${e} failed`),wi(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,i=this.readSync(t),o=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,i,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return jf.nextTensorId++}nextVariableId(){return jf.nextVariableId++}clone(e){const t=le.runKernel(Yy,{x:e}),s={x:e},r=o=>({x:()=>{const a="float32",l={x:o},u={dtype:a};return le.runKernel(Py,l,u)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,i,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!(G3(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let i=0;s.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-t-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=hE(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(hE(e)){const{kernelName:b,inputs:T,attrs:w}=e;this.backendName==null&&this.backend;const _=G3(b,this.backendName);q(_!=null,()=>`Cannot find registered kernel '${b}' for backend '${this.backendName}'`),a=()=>{const C=this.backend.numDataIds();l=_.kernelFunc({inputs:T,attrs:w,backend:this.backend});const N=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(b,C,N);const A=N.map(P=>P.rank!=null?P:this.makeTensorFromTensorInfo(P));if(r){const P=this.getTensorsForGradient(b,T,A);s=this.saveTensorsForBackwardMode(P)}return A}}else{const{forwardFunc:b}=e,T=w=>{r&&(s=w.map(_=>this.keep(this.clone(_))))};a=()=>{const w=this.backend.numDataIds();l=this.tidy(()=>b(this.backend,T));const _=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,w,_),_}}const{inputs:h,attrs:f}=e,p=hE(e)?null:e.backwardsFunc;let g;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(g=this.profiler.profileKernel(u,h,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(g),t=g.outputs)}),r&&this.addTapeNode(u,h,t,p,s,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(h).map(b=>h[b]!=null?h[b].shape:null),outputShapes:t.map(b=>b.shape),kernelTimeMs:g.timeMs,extraInfo:g.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=H3(e);if(r!=null){const i=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(q(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(u=>t[u])):a=i.map(u=>t[u]);const l=s.filter((u,h)=>o[h]);return a.concat(l)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=e;s==="string"&&Ny(e[0])&&(i=e.map(l=>qu(l)));const o=r.write(i,t,s),a=new gs(t,s,o,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(o),u=VTe(i);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,t,s,r){s=s||"float32";const i={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:i}=e,o=new gs(r,i,s,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const i=new Qv(e,t,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*Xv(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof Qv||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*Xv(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:i},l=H3(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=u=>(u=u.map((h,f)=>{if(h==null){const p=s[f],g=or(p.size,p.dtype);return this.makeTensor(g,p.shape,p.dtype)}return h}),r(u.length>1?u:u[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=F5(e),s=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!s.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(e,t,s,r=!1){if(q(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));q(i instanceof gs,()=>"The result y returned by f() must be a tensor.");const o=uxe(this.state.activeTape,t,i);if(!r&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=s??yxe(i.shape),cxe(a,o,u=>this.tidy(u),bxe);const l=t.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const h of u.saved)h.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return q(HI(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{q(t.every(a=>a instanceof gs),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((a,l)=>{r[l]=a});const i=(a,l)=>(s=e(...t,l),q(s.value instanceof gs,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),q(HI(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,l)=>{const u=s.gradFunc(a,l),h=Array.isArray(u)?u:[u];q(h.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),q(h.every(p=>p instanceof gs),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const f={};return h.forEach((p,g)=>{f[g]=()=>p}),f};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=kr(),s=await this.backend.time(e);return s.wallMs=kr()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Y3;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}jf.nextTensorId=0;jf.nextVariableId=0;function yxe(n){const e=YA(Ee(n),"float32");return le.makeTensor(e,n,"float32")}function V5(){const n=a5();if(n._tfengine==null){const e=new zTe(n);n._tfengine=new jf(e)}return WTe(n._tfengine.ENV),fxe(()=>n._tfengine),n._tfengine}const le=V5();function bxe(n,e){const t={a:n,b:e};return le.runKernel(Ip,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vxe(){return typeof navigator<"u"&&navigator!=null}function B5(n){if(n||vxe()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function U5(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fr=we();Fr.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Fr.registerFlag("IS_BROWSER",()=>U5());Fr.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Fr.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Fr.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Fr.registerFlag("PROD",()=>!1);Fr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Fr.getBool("DEBUG"));Fr.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Fr.registerFlag("IS_TEST",()=>!1);Fr.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Fr.getBool("DEBUG"));Fr.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Fr.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Fr.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dx(n,e){let t=n;if(Zi(n))return e==="string"?[]:[n.length];if(O5(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(P5(n))return[n.buffer.size/(e==null?4:Xv(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||Zi(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&we().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&z5(n,s,[]),s}function z5(n,e,t){if(t=t||[],!Array.isArray(n)&&!Zi(n)){q(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}q(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),q(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)z5(n[r],s,t.concat(r))}function J3(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function J(n,e,t,s="numeric"){if(n instanceof _e())return J3(s,n.dtype,e,t),n;let r=_p(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),J3(s,r,e,t),n==null||!Zi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const i=dx(n,r);!Zi(n)&&!Array.isArray(n)&&(n=[n]);const a=r!=="string"?sd(n,r):Uh(n,[],!0);return le.makeTensor(a,i,r)}function G5(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,o)=>J(i,`${e}[${o}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wxe="__op";function he(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+wxe;const r=(...i)=>{le.startScope(t);try{const o=s(...i);return JA(o)&&console.error("Cannot return a Promise inside of tidy."),le.endScope(o),o}catch(o){throw le.endScope(null),o}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Txe(n,e){const t=J(n,"real","complex"),s=J(e,"imag","complex");XA(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return le.runKernel(ik,r)}const Qf=he({complex_:Txe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fx(n,e,t,s){if(s==null)s=_p(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(P5(n)||O5(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return le.backend.createTensorFromGPUData(n,e||t,s)}if(!Zi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Fl(e);const r=Ee(e),i=Ee(t);q(r===i,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${i}`);for(let o=0;o<t.length;++o){const a=t[o],l=o===t.length-1?a!==Ee(e.slice(o)):!0;q(t[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Zi(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?sd(n,s):Uh(n,[],!0),le.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H5(n,e,t){const s=dx(n,t);return fx(n,e,s,t)}class Cp{static join(e){return new Cp(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>Zi(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=t+r.byteLength;this.shards.push({buffer:r,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let l=s;l<this.shards.length;l++){const u=this.shards[l],f=e+a-u.start,p=a,b=Math.min(t,u.end)-u.start,T=new Uint8Array(u.buffer,f,b-f);if(o.set(T,p),a+=T.length,t<u.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=xxe(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function xxe(n,e){let t=0,s=n.length;for(;t<=s;){const r=Math.floor((s-t)/2)+t,i=e(n[r]);if(i===0)return r;i<0?s=r:t=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aa(){return le}function j3(){return le.memory()}function ge(n,e){return le.tidy(n,e)}function _t(n){F5(n).forEach(t=>t.dispose())}function Sa(n){return le.keep(n)}function q5(n,e,t=1){return le.registerBackend(n,e,t)}function Sxe(){return le.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q3=4;async function Z3(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(o=>o.name):Object.keys(n);for(let o=0;o<r.length;++o){const a=r[o],l=Array.isArray(n)?n[o].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const h=new Promise(async f=>{const p=await l.bytes(),g=p.reduce((w,_)=>w+_.length,0)+Q3*p.length,b=new Uint8Array(g);let T=0;for(let w=0;w<p.length;w++){const _=p[w],C=new Uint8Array(new Uint32Array([_.length]).buffer);b.set(C,T),T+=Q3,b.set(_,T),T+=_.length}f(b)});s.push(h)}else s.push(l.data());e!=null&&(u.group=e),t.push(u)}const i=await Promise.all(s);return{data:_xe(i),specs:t}}function _xe(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(i=>{if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const Bk=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function eL(n){return Bk?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function Exe(n){if(Bk)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function Ixe(n){if(Bk){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function Cxe(n){return Cp.join(n)}function W5(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:eL(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:eL(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Cp(n.weightData).byteLength}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dr{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return dr.instance==null&&(dr.instance=new dr),dr.instance}static registerSaveRouter(e){dr.getInstance().saveRouters.push(e)}static registerLoadRouter(e){dr.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return dr.getHandlers(e,"save")}static getLoadHandlers(e,t){return dr.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?dr.getInstance().loadRouters:dr.getInstance().saveRouters).forEach(o=>{const a=o(e,s);a!==null&&r.push(a)}),r}}const Nxe=n=>dr.getSaveHandlers(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eC="tensorflowjs",tC=1,wh="models_store",Du="model_info_store";function K5(){if(!we().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function nC(n){const e=n.result;e.createObjectStore(wh,{keyPath:"modelPath"}),e.createObjectStore(Du,{keyPath:"modelPath"})}class zh{constructor(e){if(this.indexedDB=K5(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const i=this.indexedDB.open(eC,tC);i.onupgradeneeded=()=>nC(i),i.onsuccess=()=>{const o=i.result;if(t==null){const a=o.transaction(wh,"readonly"),u=a.objectStore(wh).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(u.result.modelArtifacts)},u.onerror=h=>(o.close(),r(u.error)),a.oncomplete=()=>o.close()}else{t.weightData=Cp.join(t.weightData);const a=W5(t),l=o.transaction(Du,"readwrite");let u=l.objectStore(Du),h;try{h=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(p){return r(p)}let f;h.onsuccess=()=>{f=o.transaction(wh,"readwrite");const p=f.objectStore(wh);let g;try{g=p.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(b){return r(b)}g.onsuccess=()=>s({modelArtifactsInfo:a}),g.onerror=b=>{u=l.objectStore(Du);const T=u.delete(this.modelPath);T.onsuccess=()=>(o.close(),r(g.error)),T.onerror=w=>(o.close(),r(g.error))}},h.onerror=p=>(o.close(),r(h.error)),l.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},i.onerror=o=>r(i.error)})}}zh.URL_SCHEME="indexeddb://";const X5=n=>we().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(zh.URL_SCHEME)?Axe(n.slice(zh.URL_SCHEME.length)):null;dr.registerSaveRouter(X5);dr.registerLoadRouter(X5);function Axe(n){return new zh(n)}function kxe(n){return n.startsWith(zh.URL_SCHEME)?n.slice(zh.URL_SCHEME.length):n}class $xe{constructor(){this.indexedDB=K5()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(eC,tC);s.onupgradeneeded=()=>nC(s),s.onsuccess=()=>{const r=s.result,i=r.transaction(Du,"readonly"),a=i.objectStore(Du).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),t(a.error)),i.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=kxe(e),new Promise((t,s)=>{const r=this.indexedDB.open(eC,tC);r.onupgradeneeded=()=>nC(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(Du,"readwrite"),a=o.objectStore(Du),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return i.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const h=a.delete(e),f=()=>{u=i.transaction(wh,"readwrite");const g=u.objectStore(wh).delete(e);g.onsuccess=()=>t(l.result.modelArtifactsInfo),g.onerror=b=>s(l.error)};h.onsuccess=f,h.onerror=p=>(f(),i.close(),s(l.error))}},l.onerror=h=>(i.close(),s(l.error)),o.oncomplete=()=>{u==null?i.close():u.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cl="/",mf="tensorflowjs_models",Y5="info",Rxe="model_topology",Dxe="weight_specs",Mxe="weight_data",Oxe="model_metadata";function J5(n){return{info:[mf,n,Y5].join(cl),topology:[mf,n,Rxe].join(cl),weightSpecs:[mf,n,Dxe].join(cl),weightData:[mf,n,Mxe].join(cl),modelMetadata:[mf,n,Oxe].join(cl)}}function j5(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function Pxe(n){const e=n.split(cl);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(cl)}function Fxe(n){return n.startsWith(Gh.URL_SCHEME)?n.slice(Gh.URL_SCHEME.length):n}class Gh{constructor(e){if(!we().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=J5(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=W5(e),i=Cp.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,Exe(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw j5(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=Ixe(o),t}}Gh.URL_SCHEME="localstorage://";const Q5=n=>we().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Gh.URL_SCHEME)?Lxe(n.slice(Gh.URL_SCHEME.length)):null;dr.registerSaveRouter(Q5);dr.registerLoadRouter(Q5);function Lxe(n){return new Gh(n)}class Vxe{constructor(){q(we().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),q(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=mf+cl,s=cl+Y5;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(t)&&i.endsWith(s)){const o=Pxe(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=Fxe(e);const t=J5(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return j5(t),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tL="://";class ua{constructor(){this.managers={}}static getInstance(){return ua.instance==null&&(ua.instance=new ua),ua.instance}static registerManager(e,t){q(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(tL)&&(e=e.slice(0,e.indexOf(tL))),q(e.length>0,()=>"scheme must not be an empty string.");const s=ua.getInstance();q(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=ua.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(ua.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bxe{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!we().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return $5(e)}}if(we().get("IS_BROWSER")){we().setPlatform("browser",new Bxe);try{ua.registerManager(Gh.URL_SCHEME,new Vxe)}catch{}try{ua.registerManager(zh.URL_SCHEME,new $xe)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uxe={importFetch:()=>require("node-fetch")};let dE;class zxe{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return we().global.fetch!=null?we().global.fetch(e,t):(dE==null&&(dE=Uxe.importFetch()),dE(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}we().get("IS_NODE")&&!we().get("IS_BROWSER")&&we().setPlatform("node",new zxe);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tt(n,e="float32",t){return e=e||"float32",Fl(n),new Bs(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gxe(n,e){const t=J(n,"x","cast");if(!LTe(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return le.runKernel(Py,s,r)}const Ge=he({cast_:Gxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hxe(n){const t={x:J(n,"x","clone","string_or_numeric")};return le.runKernel(Yy,t)}const Ih=he({clone_:Hxe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qxe(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */V5();const Wxe={buffer:Tt,cast:Ge,clone:Ih,print:qxe};pxe(Wxe);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kxe(n,e){let t=J(n,"a","add"),s=J(e,"b","add");[t,s]=Xn(t,s);const r={a:t,b:s};return le.runKernel(Ip,r)}const Pe=he({add_:Kxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xxe(n,e){let t=J(n,"a","floorDiv"),s=J(e,"b","floorDiv");[t,s]=Xn(t,s);const r={a:t,b:s};return le.runKernel(Ky,r)}const Z5=he({floorDiv_:Xxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yxe(n,e){let t=J(n,"a","div"),s=J(e,"b","div");if([t,s]=Xn(t,s),t.dtype==="int32"&&s.dtype==="int32")return Z5(t,s);const r={a:t,b:s},i={};return le.runKernel(Uy,r,i)}const nt=he({div_:Yxe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jxe(n,e){let t=J(n,"a","mul"),s=J(e,"b","mul");[t,s]=Xn(t,s);const r={a:t,b:s};return le.runKernel(rb,r)}const ae=he({mul_:Jxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jxe(n){const e=J(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return le.runKernel(bT,t)}else{const t={x:e};return le.runKernel(hT,t)}}const pr=he({abs_:jxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qxe(n){const t={x:J(n,"x","acos")};return le.runKernel(Ay,t)}const Zxe=he({acos_:Qxe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eSe(n){const t={x:J(n,"x","acosh")};return le.runKernel(ky,t)}const tSe=he({acosh_:eSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nSe(n,e=null,t=!1){const r={x:J(n,"x","all","bool")},i={axis:e,keepDims:t};return le.runKernel(ZA,r,i)}const e9=he({all_:nSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sSe(n,e=null,t=!1){const r={x:J(n,"x","any","bool")},i={axis:e,keepDims:t};return le.runKernel(ek,r,i)}const sC=he({any_:sSe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rSe(n,e=0){const s={x:J(n,"x","argMax")},r={axis:e};return le.runKernel(dT,s,r)}const Gg=he({argMax_:rSe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iSe(n,e=0){const s={x:J(n,"x","argMin")},r={axis:e};return le.runKernel(fT,s,r)}const oSe=he({argMin_:iSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aSe(n){const t={x:J(n,"x","asin")};return le.runKernel($y,t)}const lSe=he({asin_:aSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uSe(n){const t={x:J(n,"x","asinh")};return le.runKernel(Ry,t)}const cSe=he({asinh_:uSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hSe(n){const t={x:J(n,"x","atan")};return le.runKernel(Dy,t)}const dSe=he({atan_:hSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fSe(n,e){let t=J(n,"a","atan2"),s=J(e,"b","atan2");[t,s]=Xn(t,s);const r={a:t,b:s};return le.runKernel(Oy,r)}const pSe=he({atan2_:fSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mSe(n){const t={x:J(n,"x","atanh")};return le.runKernel(My,t)}const gSe=he({atanh_:mSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _b(n,e,t,s,r="NHWC",i){const o=n[3],a=[...e,o],l=Vl(r);return zs(n,a,t,i,s,null,null,l)}function no(n,e,t,s,r,i,o="channelsLast"){const[a,l]=Hg(e);let u;if(o==="channelsLast")u=[a,l,n[3],n[3]];else if(o==="channelsFirst")u=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return zs(n,u,t,s,r,i,!1,o)}function Ll(n,e,t,s,r,i,o="NDHWC"){const[a,l,u]=rC(e);let h,f;if(o==="NDHWC")f="channelsLast",h=[a,l,u,n[4],n[4]];else if(o==="NCDHW")f="channelsFirst",h=[a,l,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return _c(n,h,t,s,r,!1,f,i)}function zs(n,e,t,s,r,i,o=!1,a="channelsLast"){let[l,u,h,f]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,h,f]=n;else if(a==="channelsFirst")[l,f,u,h]=n;else throw new Error(`Unknown dataFormat ${a}`);const[p,g,,b]=e,[T,w]=Hg(t),[_,C]=Hg(s),N=Rf(p,_),A=Rf(g,C),{padInfo:P,outHeight:V,outWidth:D}=vSe(r,u,h,T,w,N,A,i,a),M=o?b*f:b;let $;return a==="channelsFirst"?$=[l,M,V,D]:a==="channelsLast"&&($=[l,V,D,M]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:h,inChannels:f,outHeight:V,outWidth:D,outChannels:M,padInfo:P,strideHeight:T,strideWidth:w,filterHeight:p,filterWidth:g,effectiveFilterHeight:N,effectiveFilterWidth:A,dilationHeight:_,dilationWidth:C,inShape:n,outShape:$,filterShape:e}}function _c(n,e,t,s,r,i=!1,o="channelsLast",a){let[l,u,h,f,p]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,u,h,f,p]=n;else if(o==="channelsFirst")[l,p,u,h,f]=n;else throw new Error(`Unknown dataFormat ${o}`);const[g,b,T,,w]=e,[_,C,N]=rC(t),[A,P,V]=rC(s),D=Rf(g,A),M=Rf(b,P),$=Rf(T,V),{padInfo:O,outDepth:k,outHeight:z,outWidth:U}=wSe(r,u,h,f,_,C,N,D,M,$,a),te=i?w*p:w;let se;return o==="channelsFirst"?se=[l,te,k,z,U]:o==="channelsLast"&&(se=[l,k,z,U,te]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:h,inWidth:f,inChannels:p,outDepth:k,outHeight:z,outWidth:U,outChannels:te,padInfo:O,strideDepth:_,strideHeight:C,strideWidth:N,filterDepth:g,filterHeight:b,filterWidth:T,effectiveFilterDepth:D,effectiveFilterHeight:M,effectiveFilterWidth:$,dilationDepth:A,dilationHeight:P,dilationWidth:V,inShape:n,outShape:se,filterShape:e}}function ySe(n,e,t,s,r){s==null&&(s=Uk(n,e,t));const i=n[0],o=n[1],a=qg((i-e+2*s)/t+1,r),l=qg((o-e+2*s)/t+1,r);return[a,l]}function bSe(n,e,t,s,r,i){r==null&&(r=Uk(n,e[0],s[0]));const o=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*r>=e[a]&&(o[a]=qg((n[a]-e[a]+2*r)/s[a]+1,i));return o}function Uk(n,e,t,s=1){const r=Rf(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function Hg(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function rC(n){return typeof n=="number"?[n,n,n]:n}function Rf(n,e){return e<=1?n:n+(n-1)*(e-1)}function vSe(n,e,t,s,r,i,o,a,l){let u,h,f;if(typeof n=="number"){u={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const g=ySe([e,t],i,s,n,a);h=g[0],f=g[1]}else if(n==="same"){h=Math.ceil(e/s),f=Math.ceil(t/r);const p=Math.max(0,(h-1)*s+i-e),g=Math.max(0,(f-1)*r+o-t),b=Math.floor(p/2),T=p-b,w=Math.floor(g/2),_=g-w;u={top:b,bottom:T,left:w,right:_,type:"SAME"}}else if(n==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},h=Math.ceil((e-i+1)/s),f=Math.ceil((t-o+1)/r);else if(typeof n=="object"){const p=l==="channelsLast"?n[1][0]:n[2][0],g=l==="channelsLast"?n[1][1]:n[2][1],b=l==="channelsLast"?n[2][0]:n[3][0],T=l==="channelsLast"?n[2][1]:n[3][1];u={top:p,bottom:g,left:b,right:T,type:p===0&&g===0&&b===0&&T===0?"VALID":"EXPLICIT"},h=qg((e-i+p+g)/s+1,a),f=qg((t-o+b+T)/r+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:u,outHeight:h,outWidth:f}}function wSe(n,e,t,s,r,i,o,a,l,u,h){let f,p,g,b;if(n==="valid"&&(n=0),typeof n=="number"){f={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const w=bSe([e,t,s,1],[a,l,u],1,[r,i,o],n,h);p=w[0],g=w[1],b=w[2]}else if(n==="same"){p=Math.ceil(e/r),g=Math.ceil(t/i),b=Math.ceil(s/o);const T=(p-1)*r+a-e,w=(g-1)*i+l-t,_=(b-1)*o+u-s,C=Math.floor(T/2),N=T-C,A=Math.floor(w/2),P=w-A,V=Math.floor(_/2),D=_-V;f={top:A,bottom:P,left:V,right:D,front:C,back:N,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:f,outDepth:p,outHeight:g,outWidth:b}}function qg(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Hh(n){const[e,t,s]=Hg(n);return e===1&&t===1&&s===1}function ar(n,e){return Hh(n)||Hh(e)}function qh(n){return Hg(n).every(e=>e>0)}function Vl(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Vr(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")q(Jf(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{q(Jf(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TSe(n,e){const s={x:J(n,"x","reshape","string_or_numeric")},r={shape:e};return le.runKernel(QT,s,r)}const ce=he({reshape_:TSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xSe(n,e,t,s,r){const i=J(n,"x","avgPool","float32"),o=1;q(ar(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=ce(i,[1,i.shape[0],i.shape[1],i.shape[2]])),q(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Vr("avgPool",s,r);const u={x:a},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let f=le.runKernel(pT,u,h);return f=Ge(f,i.dtype),l?ce(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const zk=he({avgPool_:xSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SSe(n,e,t,s,r,i="NDHWC"){const o=J(n,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=ce(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),q(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),q(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),q(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),Vr("avgPool3d",s,r);const u={x:a},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i};let f=le.runKernel(mT,u,h);return f=Ge(f,a.dtype),l?ce(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const _Se=he({avgPool3d_:SSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ESe(n,e=0){q(n.length>=1,()=>"Pass at least one tensor to concat");const t=G5(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return Ih(t[0]);const s=t,r={axis:e};return le.runKernel(vT,s,r)}const Mr=he({concat_:ESe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ISe(n,e,t=!1,s=!1){let r=J(n,"a","matMul"),i=J(e,"b","matMul");[r,i]=Xn(r,i);const o={a:r,b:i},a={transposeA:t,transposeB:s};return le.runKernel(gT,o,a)}const Xt=he({matMul_:ISe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CSe(n){const t={x:J(n,"x","sigmoid","float32")};return le.runKernel(mb,t)}const Np=he({sigmoid_:CSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NSe(n,e,t){const s=J(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:e,size:t};return le.runKernel(sx,r,i)}const _n=he({slice_:NSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ASe(n){const t={x:J(n,"x","tanh","float32")};return le.runKernel(Tb,t)}const Gk=he({tanh_:ASe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kSe(n,e,t){const s=J(n,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);q(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),q(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),q(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const i={x:s},o={blockShape:e,crops:t};return le.runKernel(yT,i,o)}const Hk=he({batchToSpaceND_:kSe});function $Se(n){let e;return n.rank===0||n.rank===1?e=ce(n,[1,1,1,n.size]):n.rank===2?e=ce(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ce(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RSe(n,e,t,s,r,i){i==null&&(i=.001);const o=J(n,"x","batchNorm"),a=J(e,"mean","batchNorm"),l=J(t,"variance","batchNorm");let u;r!=null&&(u=J(r,"scale","batchNorm"));let h;s!=null&&(h=J(s,"offset","batchNorm")),q(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),q(h==null||a.rank===h.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),q(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const p={x:$Se(o),scale:u,offset:h,mean:a,variance:l},g={varianceEpsilon:i},b=le.runKernel(NT,p,g);return ce(b,o.shape)}const px=he({batchNorm_:RSe});function DSe(n,e,t,s,r,i){const o=J(n,"x","batchNorm"),a=J(e,"mean","batchNorm"),l=J(t,"variance","batchNorm");let u;r!=null&&(u=J(r,"scale","batchNorm"));let h;return s!=null&&(h=J(s,"offset","batchNorm")),q(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),q(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),q(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&q(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),h!=null&&q(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${h.rank}.`),px(o,a,l,h,u,i)}const MSe=he({batchNorm2d_:DSe});function OSe(n,e,t,s,r,i){const o=J(n,"x","batchNorm"),a=J(e,"mean","batchNorm"),l=J(t,"variance","batchNorm");let u;r!=null&&(u=J(r,"scale","batchNorm"));let h;return s!=null&&(h=J(s,"offset","batchNorm")),q(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),q(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),q(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&q(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),h!=null&&q(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${h.rank}.`),px(o,a,l,h,u,i)}const PSe=he({batchNorm3d_:OSe});function FSe(n,e,t,s,r,i){const o=J(n,"x","batchNorm"),a=J(e,"mean","batchNorm"),l=J(t,"variance","batchNorm");let u;r!=null&&(u=J(r,"scale","batchNorm"));let h;return s!=null&&(h=J(s,"offset","batchNorm")),q(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),q(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),q(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&q(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),h!=null&&q(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${h.rank}.`),px(o,a,l,h,u,i)}const LSe=he({batchNorm4d_:FSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VSe(n,e,t){const s=J(n,"x","bincount"),r=J(e,"weights","bincount");q(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),q(t>=0,()=>`size must be non-negative, but got ${t}.`),q(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},o={size:t};return le.runKernel(sk,i,o)}const BSe=he({bincount_:VSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function USe(n,e){let t=J(n,"broadcastTo","x");const s=t.shape;if(Fl(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const u=t.shape.slice();for(;u.length<e.length;)u.unshift(1);t=ce(t,u)}const r=t.shape,i=Array.from(e);for(let u=e.length-1;u>=0;u--)if(r[u]===e[u])i[u]=1;else if(t.shape[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(i.map((u,h)=>u>1?h:-1).filter(u=>u>=0).length===0)return Ih(t);const a={x:t},l={reps:i};return le.runKernel(xb,a,l)}const gg=he({broadcastTo_:USe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zSe(n){const t={x:J(n,"x","ceil","float32")};return le.runKernel(Fy,t)}const GSe=he({ceil_:zSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mx(n,e,t){Fl(n),t=t||_p(e);const s={shape:n,value:e,dtype:t};return le.runKernel(bk,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HSe(n,e,t){const s=J(n,"x","clipByValue");if(q(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return mx(s.shape,e,s.dtype);const r={x:s},i={clipValueMin:e,clipValueMax:t};return le.runKernel(Ly,r,i)}const Ii=he({clipByValue_:HSe});function qSe(n){return Mr(n,0)}const WSe=he({concat1d_:qSe});function KSe(n,e){return Mr(n,e)}const XSe=he({concat2d_:KSe});function YSe(n,e){return Mr(n,e)}const JSe=he({concat3d_:YSe});function jSe(n,e){return Mr(n,e)}const QSe=he({concat4d_:jSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZSe(n,e,t,s,r="NHWC",i=[1,1],o){const a=J(n,"x","conv2d","float32"),l=J(e,"filter","conv2d","float32");let u=a,h=!1;a.rank===3&&(h=!0,u=ce(a,[1,a.shape[0],a.shape[1],a.shape[2]])),q(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),q(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Vr("conv2d",s,o);const f=r==="NHWC"?u.shape[3]:u.shape[1];q(f===l.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${l.shape[2]}.`),q(ar(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),q(qh(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),q(qh(t),()=>"Error in conv2D: Strides should be larger than 0.");const p={x:u,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},b=le.runKernel(wT,p,g);return h?ce(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const Wh=he({conv2d_:ZSe});function e_e(n,e,t,s,r="NWC",i=1,o){const a=J(n,"x","conv1d"),l=J(e,"filter","conv1d");let u=a,h=!1;a.rank===2&&(h=!0,u=ce(a,[1,a.shape[0],a.shape[1]])),q(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),q(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Vr("conv1d",s,o),q(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),q(ar(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),q(qh(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),q(qh(t),()=>"Error in conv1D: Stride should be larger than 0."),q(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const f=ce(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=ce(u,[u.shape[0],1,u.shape[1],u.shape[2]]),w=Wh(p,f,[1,t],s,"NHWC",[1,i],o);return h?ce(w,[w.shape[2],w.shape[3]]):ce(w,[w.shape[0],w.shape[2],w.shape[3]])}const t9=he({conv1d_:e_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t_e(n,e,t,s,r,i="NHWC",o){q(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,l=e,u=!1;e.rank===3&&(u=!0,l=ce(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),q(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),q(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),q(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const h=i==="NHWC"?a[3]:a[1],f=i==="NHWC"?l.shape[3]:l.shape[1];q(h===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${h}) must match input depth for filter ${t.shape[2]}.`),q(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),Vr("conv2dDerInput",r,o);const p={dy:l,filter:t},g={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,inputShape:a},b=le.runKernel(TT,p,g);return u?ce(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const qk=he({conv2DBackpropInput_:t_e});function n_e(n,e,t,s,r,i){const o=J(n,"x","conv2dTranspose"),a=J(e,"filter","conv2dTranspose");return qk(t,o,a,s,r,"NHWC",i)}const n9=he({conv2dTranspose_:n_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s_e(n,e,t,s,r="NDHWC",i=[1,1,1]){const o=J(n,"x","conv3d"),a=J(e,"filter","conv3d");let l=o,u=!1;o.rank===4&&(u=!0,l=ce(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),q(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),q(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),q(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),q(ar(t,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),q(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),q(qh(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),q(qh(t),()=>"Error in conv3D: Strides should be larger than 0.");const h={x:l,filter:a},f={strides:t,pad:s,dataFormat:r,dilations:i},p=le.runKernel(xT,h,f);return u?ce(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const r_e=he({conv3d_:s_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i_e(n,e,t,s,r){q(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,o=e,a=!1;e.rank===4&&(a=!0,o=ce(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);const l=i[4],u=o.shape[4];q(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),q(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),q(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),q(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),q(u===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${t.shape[4]}.`);const h={dy:o,filter:t},f={pad:r,strides:s,inputShape:i},p=le.runKernel(lk,h,f);return a?ce(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const s9=he({conv3DBackpropInput_:i_e});function o_e(n,e,t,s,r){const i=J(n,"x","conv3dTranspose"),o=J(e,"filter","conv3dTranspose");return s9(t,i,o,s,r)}const a_e=he({conv3dTranspose_:o_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l_e(n){const t={x:J(n,"x","cos","float32")};return le.runKernel(Vy,t)}const Wk=he({cos_:l_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u_e(n){const t={x:J(n,"x","cosh","float32")};return le.runKernel(By,t)}const r9=he({cosh_:u_e});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c_e(n,e=0,t=!1,s=!1){const i={x:J(n,"x","cumprod")},o={axis:e,exclusive:t,reverse:s};return le.runKernel(uk,i,o)}const iC=he({cumprod_:c_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h_e(n,e=0,t=!1,s=!1){const i={x:J(n,"x","cumsum")},o={axis:e,exclusive:t,reverse:s};return le.runKernel(ST,i,o)}const i9=he({cumsum_:h_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d_e(n,e,t,s=!1){const r=J(n,"x","denseBincount"),i=J(e,"weights","denseBincount");q(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),q(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),q(t>=0,()=>`size must be non-negative, but got ${t}.`),q(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},a={size:t,binaryOutput:s};return le.runKernel(hk,o,a)}const nL=he({denseBincount_:d_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f_e(n,e,t="NHWC"){const s=J(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],i=t==="NHWC"?s.shape[2]:s.shape[3],o=t==="NHWC"?s.shape[3]:s.shape[1];q(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),q(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),q(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${s.shape}`),q(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:t};return le.runKernel(dk,a,l)}const p_e=he({depthToSpace_:f_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m_e(n,e,t,s,r="NHWC",i=[1,1],o){const a=J(n,"x","depthwiseConv2d","float32"),l=J(e,"filter","depthwiseConv2d","float32");let u=a,h=!1;a.rank===3&&(h=!0,u=ce(a,[1,a.shape[0],a.shape[1],a.shape[2]])),q(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),q(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const f=r==="NHWC"?u.shape[3]:u.shape[1];q(f===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${l.shape[2]}.`),Vr("depthwiseConv2d",s,o);const p={x:u,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},b=le.runKernel(_T,p,g);return h?ce(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const Kk=he({depthwiseConv2d_:m_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g_e(n,e,t,s,r=[1,1],i="NHWC"){const o=J(n,"x","dilation2d"),a=J(e,"filter","dilation2d");q(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),q(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),q(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,u=!1;o.rank===3&&(l=ce(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0),q(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const h={x:l,filter:a},f={strides:t,pad:s,dilations:r},p=le.runKernel(ET,h,f);return u?ce(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const y_e=he({dilation2d_:g_e});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zf(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const i=t-1-r,o=n[i]||1;(e[e.length-1-r]||1)>1&&o===1&&s.unshift(i)}return s}function Ss(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],i=e.length-s-1,o=e[i];(r==null||r===1&&o>1)&&t.unshift(i)}return t}function pt(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let r=0;r<t;r++){let i=n[n.length-r-1];i==null&&(i=1);let o=e[e.length-r-1];if(o==null&&(o=1),i===1)s[t-r-1]=o;else if(o===1)s[t-r-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else s[t-r-1]=i}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b_e(n,e){let t=J(n,"a","equal","string_or_numeric"),s=J(e,"b","equal","string_or_numeric");[t,s]=Xn(t,s),pt(t.shape,s.shape);const r={a:t,b:s};return le.runKernel(IT,r)}const Da=he({equal_:b_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v_e(n,e,t){const s=J(e,"a","where"),r=J(t,"b","where"),i=J(n,"condition","where","bool"),o=pt(pt(i.shape,s.shape),r.shape),a=gg(i,o),l=gg(s,o),u=gg(r,o),h={condition:a,t:l,e:u};return le.runKernel(nx,h)}const xr=he({where_:v_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w_e(n){const t={x:J(n,"x","zerosLike")};return le.runKernel(cx,t)}const Lt=he({zerosLike_:w_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T_e(n,e){let t=J(n,"a","div"),s=J(e,"b","div");[t,s]=Xn(t,s);const r=nt(t,s),i=Lt(r),o=Da(s,i);return xr(o,i,r)}const x_e=he({divNoNan_:T_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S_e(n,e){const t=J(n,"t1","dot"),s=J(e,"t2","dot");q((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],i=s.rank===1?s.size:s.shape[0];if(q(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),t.rank===1&&s.rank===1){const o=ce(t,[1,-1]),a=ce(s,[-1,1]),l=Xt(o,a);return ce(l,[])}else if(t.rank===1&&s.rank===2){const o=ce(t,[1,-1]),a=ce(s,[s.shape[0],s.shape[1]]),l=Xt(o,a);return ce(l,[l.size])}else if(t.rank===2&&s.rank===1){const o=ce(s,[-1,1]),a=Xt(t,o);return ce(a,[a.size])}else{const o=ce(s,[s.shape[0],s.shape[1]]);return Xt(t,o)}}const __e=he({dot_:S_e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E_e(n,...e){const t=e.map((r,i)=>J(r,`tensors${i}`,"einsum")),s={equation:n};return le.runKernel(mk,t,s)}const Wm=he({einsum_:E_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I_e(n){const t={x:J(n,"x","elu","float32")};return le.runKernel(zy,t)}const gx=he({elu_:I_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C_e(n){let e=J(n,"x","erf");q(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Ge(e,"float32"));const t={x:e};return le.runKernel(Gy,t)}const N_e=he({erf_:C_e});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xk(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function o9(n,e,t){const s=n.length+e.length,r=[];let i=0,o=0;for(let a=0;a<s;a++)t.indexOf(a)===-1?r.push(n[i++]):r.push(e[o++]);return r}function Ds(n,e){const t=[],s=n.length;for(let i=0;i<s;i++)e.indexOf(i)===-1&&t.push(n[i]);const r=e.map(i=>n[i]);return[t,r]}function os(n,e){const t=e.map(s=>1);return o9(n,t,e)}function Gs(n,e,t){q(Xk(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function zn(n,e){if(Xk(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function Ec(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function Yn(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A_e(n,e=null,t=!1){const r={x:J(n,"x","max")},i={reductionIndices:e,keepDims:t};return le.runKernel(LT,r,i)}const $o=he({max_:A_e});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k_e(n,e=null,t=!1){const r={x:J(n,"x","min")},i={axis:e,keepDims:t};return le.runKernel(zT,r,i)}const Zv=he({min_:k_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $_e(n,e){let t=J(n,"base","pow"),s=J(e,"exp","pow");[t,s]=Xn(t,s);const r={a:t,b:s};return le.runKernel(ib,r)}const ep=he({pow_:$_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yt(n,e){if((Zi(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Zi(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return fx(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R_e(n){const t={x:J(n,"x","sqrt","float32")};return le.runKernel(yb,t)}const _r=he({sqrt_:R_e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D_e(n){const e=J(n,"x","square"),t={};return le.runKernel("Square",{x:e},t)}const An=he({square_:D_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M_e(n,e=null,t=!1){let s=J(n,"x","sum");s.dtype==="bool"&&(s=Ge(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return le.runKernel(rx,r,i)}const Ze=he({sum_:M_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O_e(n,e="euclidean",t=null,s=!1){n=J(n,"x","norm");const r=a9(n,e,t);let i=r.shape;if(s){const o=xt(t,n.shape);i=os(r.shape,o)}return ce(r,i)}function a9(n,e,t=null){if(n.rank===0)return pr(n);if(n.rank!==1&&t===null)return a9(ce(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Ze(pr(n),t);if(e===1/0)return $o(pr(n),t);if(e===-1/0)return Zv(pr(n),t);if(e==="euclidean"||e===2)return _r(Ze(ep(pr(n),Yt(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return $o(Ze(pr(n),t[0]),t[1]-1);if(e===1/0)return $o(Ze(pr(n),t[1]),t[0]);if(e===-1/0)return Zv(Ze(pr(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return _r(Ze(An(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const yx=he({norm_:O_e});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P_e(n,e=null,t=!1){return yx(n,"euclidean",e,t)}const F_e=he({euclideanNorm_:P_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L_e(n){const t={x:J(n,"x","exp")};return le.runKernel(Hy,t)}const Ma=he({exp_:L_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V_e(n,e=0){const t=J(n,"x","expandDims","string_or_numeric");q(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return le.runKernel(CT,s,r)}const $r=he({expandDims_:V_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B_e(n){const t={x:J(n,"x","expm1")};return le.runKernel(qy,t)}const U_e=he({expm1_:B_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z_e(n,e){const t=J(n,"x","tile","string_or_numeric");q(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return le.runKernel(xb,s,r)}const Co=he({tile_:z_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G_e(n,e,t,s="float32"){e==null&&(e=n);const r=Tt([n,e],s),i=n<=e?n:e;for(let a=0;a<i;++a)r.set(1,a,a);const o=ce(r.toTensor(),[n,e]);if(t==null)return o;if(t.length===1)return Co($r(o,0),[t[0],1,1]);if(t.length===2)return Co($r($r(o,0),0),[t[0],t[1],1,1]);if(t.length===3)return Co($r($r($r(o,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const l9=he({eye_:G_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H_e(n){const t={x:J(n,"x","floor","float32")};return le.runKernel(Wy,t)}const bx=he({floor_:H_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q_e(n,e,t=0,s=0){const r=J(n,"x","gather"),i=J(e,"indices","gather","int32"),o={x:r,indices:i},a={axis:t,batchDims:s};return le.runKernel(AT,o,a)}const Yk=he({gather_:q_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W_e(n,e){let t=J(n,"a","greater","string_or_numeric"),s=J(e,"b","greater","string_or_numeric");[t,s]=Xn(t,s),pt(t.shape,s.shape);const r={a:t,b:s};return le.runKernel(kT,r)}const Ci=he({greater_:W_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K_e(n,e){let t=J(n,"a","greaterEqual","string_or_numeric"),s=J(e,"b","greaterEqual","string_or_numeric");[t,s]=Xn(t,s),pt(t.shape,s.shape);const r={a:t,b:s};return le.runKernel(Xy,r)}const rd=he({greaterEqual_:K_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X_e(n){const t={input:J(n,"input","imag")};return le.runKernel(Tk,t)}const Jk=he({imag_:X_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y_e(n){const t={x:J(n,"x","isFinite")};return le.runKernel(Jy,t)}const J_e=he({isFinite_:Y_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j_e(n){const t={x:J(n,"x","isInf")};return le.runKernel(jy,t)}const Q_e=he({isInf_:j_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z_e(n){const t={x:J(n,"x","isNaN")};return le.runKernel(Qy,t)}const eEe=he({isNaN_:Z_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tEe(n,e=.2){const s={x:J(n,"x","leakyRelu")},r={alpha:e};return le.runKernel($T,s,r)}const jk=he({leakyRelu_:tEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nEe(n,e){let t=J(n,"a","less","string_or_numeric"),s=J(e,"b","less","string_or_numeric");[t,s]=Xn(t,s),pt(t.shape,s.shape);const r={a:t,b:s};return le.runKernel(RT,r)}const ew=he({less_:nEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sEe(n,e){let t=J(n,"a","lessEqual","string_or_numeric"),s=J(e,"b","lessEqual","string_or_numeric");[t,s]=Xn(t,s),pt(t.shape,s.shape);const r={a:t,b:s};return le.runKernel(DT,r)}const Ap=he({lessEqual_:sEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rEe(n,e=5,t=1,s=1,r=.5){const i=J(n,"x","localResponseNormalization");q(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),q(Jf(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=ce(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},u={depthRadius:e,bias:t,alpha:s,beta:r},h=le.runKernel(FT,l,u);return a?ce(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const iEe=he({localResponseNormalization_:rEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oEe(n){const t={x:J(n,"x","log","float32")};return le.runKernel(Zy,t)}const Oa=he({log_:oEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aEe(n){const t={x:J(n,"x","log1p")};return le.runKernel(eb,t)}const u9=he({log1p_:aEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lEe(n,e){q(HI(n),()=>"The f passed in variableGrads(f) must be a function"),q(e==null||Array.isArray(e)&&e.every(u=>u instanceof Qv),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const u in le.registeredVariables)e.push(le.registeredVariables[u])}const s=t?e.filter(u=>!u.trainable):null,r=e.length;e=e.filter(u=>u.trainable),q(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:o,grads:a}=le.gradients(n,e,null,i);q(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),q(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((u,h)=>{a[h]!=null&&(l[u.name]=a[h])}),s!=null&&s.forEach(u=>l[u.name]=null),{value:o,grads:l}}function tp(n){return le.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uEe(n){const t={x:J(n,"x","neg")};return le.runKernel(HT,t)}const Kn=he({neg_:uEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cEe(n){const t={x:J(n,"x","softplus")};return le.runKernel(gb,t)}const Eb=he({softplus_:cEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hEe(n){const e=J(n,"x","logSigmoid");return tp(s=>({value:Kn(Eb(Kn(s))),gradFunc:o=>ae(o,Np(Kn(s)))}))(e)}const dEe=he({logSigmoid_:hEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fEe(n,e){let t=J(n,"a","sub"),s=J(e,"b","sub");[t,s]=Xn(t,s);const r={a:t,b:s};return le.runKernel(vb,r)}const rt=he({sub_:fEe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pEe(n,e=-1){const t=J(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return tp((r,i)=>{const a=$o(r,e,!0),l=rt(r,a),u=rt(Ge(l,"float32"),Oa(Ze(Ma(l),e,!0)));return i([u]),{value:u,gradFunc:(f,p)=>{const[g]=p,b=!0,T=Ma(g);return rt(f,ae(Ze(f,e,b),T))}}})(t)}const c9=he({logSoftmax_:pEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mEe(n,e=null,t=!1){const s=J(n,"x","logSumExp"),r=xt(e,s.shape),i=$o(s,r,!0),o=rt(s,i),a=Ma(o),l=Ze(a,r),u=Oa(l),h=Pe(ce(i,u.shape),u);if(t){const f=os(h.shape,r);return ce(h,f)}return h}const h9=he({logSumExp_:mEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gEe(n,e){const t=J(n,"a","logicalAnd","bool"),s=J(e,"b","logicalAnd","bool");pt(t.shape,s.shape);const r={a:t,b:s};return le.runKernel(MT,r)}const Il=he({logicalAnd_:gEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yEe(n){const t={x:J(n,"x","logicalNot","bool")};return le.runKernel(OT,t)}const Qk=he({logicalNot_:yEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bEe(n,e){const t=J(n,"a","logicalOr","bool"),s=J(e,"b","logicalOr","bool");pt(t.shape,s.shape);const r={a:t,b:s};return le.runKernel(PT,r)}const d9=he({logicalOr_:bEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vEe(n,e){const t=J(n,"a","logicalXor","bool"),s=J(e,"b","logicalXor","bool");return pt(t.shape,s.shape),Il(d9(n,e),Qk(Il(n,e)))}const wEe=he({logicalXor_:vEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TEe(n,e,t,s,r){const i=J(n,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=ce(i,[1,i.shape[0],i.shape[1],i.shape[2]])),q(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),q(ar(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),Vr("maxPool",s,r);const u={x:a},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r},f=le.runKernel(VT,u,h);return l?ce(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const Zk=he({maxPool_:TEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xEe(n,e=[1,1,1],t,s,r,i="NDHWC"){const o=J(n,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=ce(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),q(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),q(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Vr("maxPool3d",s,r);const u={x:a},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i},f=le.runKernel(BT,u,h);return l?ce(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const SEe=he({maxPool3d_:xEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ee(n,e){let t=J(n,"a","maximum"),s=J(e,"b","maximum");[t,s]=Xn(t,s),t.dtype==="bool"&&(t=Ge(t,"int32"),s=Ge(s,"int32")),pt(t.shape,s.shape);const r={a:t,b:s};return le.runKernel(tb,r)}const Ic=he({maximum_:_Ee});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EEe(n,e=null,t=!1){const r={x:J(n,"x","mean")},i={axis:e,keepDims:t};return le.runKernel(UT,r,i)}const ss=he({mean_:EEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ks(n,e="float32"){if(Fl(n),e==="complex64"){const s=ks(n,"float32"),r=ks(n,"float32");return Qf(s,r)}const t=or(Ee(n),e);return le.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cc(n,e="float32"){if(Fl(n),e==="complex64"){const s=Cc(n,"float32"),r=ks(n,"float32");return Qf(s,r)}const t=YA(Ee(n),e);return le.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IEe(n,e){let t=J(n,"a","minimum"),s=J(e,"b","minimum");[t,s]=Xn(t,s),t.dtype==="bool"&&(t=Ge(t,"int32"),s=Ge(s,"int32")),pt(t.shape,s.shape);const r={a:t,b:s};return le.runKernel(nb,r)}const Wg=he({minimum_:IEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CEe(n,e,t){q(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=J(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");q(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let a=0;a<s.rank;a++)q(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),q(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:e,mode:t},o={x:s};return le.runKernel(GT,o,i)}const NEe=he({mirrorPad_:CEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AEe(n,e){let t=J(n,"a","mod"),s=J(e,"b","mod");[t,s]=Xn(t,s);const r={a:t,b:s};return le.runKernel(sb,r)}const kEe=he({mod_:AEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ee(n,e=null,t=!1){n=J(n,"x","moments");const s=xt(e,n.shape),r=ss(n,s,t);let i=r.shape;t||(i=os(r.shape,s));const o=An(rt(Ge(n,"float32"),ce(r,i))),a=ss(o,s,t);return{mean:r,variance:a}}const e2=he({moments_:$Ee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function REe(n,e){let t=J(n,"a","notEqual","string_or_numeric"),s=J(e,"b","notEqual","string_or_numeric");[t,s]=Xn(t,s),pt(t.shape,s.shape);const r={a:t,b:s};return le.runKernel(qT,r)}const tw=he({notEqual_:REe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DEe(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:J(n,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:t,offValue:s};return le.runKernel(KT,o,a)}const f9=he({oneHot_:DEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MEe(n){const t={x:J(n,"x","onesLike")};return le.runKernel(WT,t)}const eo=he({onesLike_:MEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OEe(n,e,t=0){const s=J(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},i={x:s};return le.runKernel(YT,i,r)}const t2=he({pad_:OEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PEe(n,e,t){const s=J(n,"x","spaceToBatchND");q(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),q(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),q(s.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+t[l-1][0]+t[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},i={blockShape:e,paddings:t};return le.runKernel(ix,r,i)}const n2=he({spaceToBatchND_:PEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FEe(n,e,t,s,r,i,o){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const a=J(n,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=ce(a,[1,a.shape[0],a.shape[1],a.shape[2]])),q(ar(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const h=no(l.shape,e,i,r,s),f=[h.dilationHeight,h.dilationWidth];let p;s==="same"?p=VEe([h.filterHeight,h.filterWidth],f):p=[[0,0],[0,0]];const g=f[0]===1&&f[1]===1,[b,T]=LEe([h.inHeight,h.inWidth],f,p),w=g?s:"valid",_=g?l:n2(l,f,b),N=(t==="avg"?()=>zk(_,e,i,w,o):()=>Zk(_,e,i,w,o))(),A=g?N:Hk(N,f,T);return u?ce(A,[A.shape[1],A.shape[2],A.shape[3]]):A}function LEe(n,e,t){const s=t.map(h=>h[0]),r=t.map(h=>h[1]),i=n.concat(s,r),o=e.map((h,f)=>(h-i[f]%h)%h),a=r.map((h,f)=>h+o[f]),l=e.map((h,f)=>[s[f],a[f]]),u=e.map((h,f)=>[0,o[f]]);return[l,u]}function VEe(n,e){const s=n.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),r=s.map(o=>Math.floor(o/2)),i=s.map((o,a)=>o-r[a]);return s.map((o,a)=>[r[a],i[a]])}const BEe=he({pool_:FEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UEe(n,e){const t=J(n,"x","prelu"),s=J(e,"alpha","prelu"),r={x:t,alpha:s};return le.runKernel(JT,r)}const s2=he({prelu_:UEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zEe(n,e=null,t=!1){let s=J(n,"x","prod");s.dtype==="bool"&&(s=Ge(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return le.runKernel(jT,r,i)}const GEe=he({prod_:zEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p9{constructor(e,t,s,r,i){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=xp.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,i,o;do r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*r*a,t=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class HEe{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=xp.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qEe(n,e=0,t=1,s,r){if(Fl(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new p9(e,t,s,!1,r),o=Tt(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const WEe=he({randomNormal_:qEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KEe(n,e=0,t=1,s="float32",r){Fl(n);const i=Tt(n,s),o=new HEe(e,t,null,r);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const Ib=he({randomUniform_:KEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kg(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return le.runKernel(Nk,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XEe(n){const t={input:J(n,"input","real")};return le.runKernel(Ak,t)}const nw=he({real_:XEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YEe(n){const t={x:J(n,"x","reciprocal")};return le.runKernel(ob,t)}const JEe=he({reciprocal_:YEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jEe(n){const t={x:J(n,"x","relu")};return le.runKernel(ab,t)}const id=he({relu_:jEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QEe(n){const t={x:J(n,"x","relu6")};return le.runKernel(lb,t)}const m9=he({relu6_:QEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZEe(n,e){const s={x:J(n,"x","reverse")},r={dims:e};return le.runKernel(tx,s,r)}const Kh=he({reverse_:ZEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eIe(n){const t={x:J(n,"x","round")};return le.runKernel(ub,t)}const g9=he({round_:eIe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tIe(n){const t={x:J(n,"x","rsqrt","float32")};return le.runKernel(cb,t)}const y9=he({rsqrt_:tIe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nIe(n){const t={x:J(n,"x","selu")};return le.runKernel(hb,t)}const b9=he({selu_:nIe});function sIe(n,e,t,s,r,i=[1,1],o="NHWC"){const a=J(n,"x","separableConv2d"),l=J(e,"depthwiseFilter","separableConv2d"),u=J(t,"pointwiseFilter","separableConv2d");let h=a,f=!1;if(a.rank===3&&(f=!0,h=ce(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");q(h.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${h.rank}.`),q(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),q(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),q(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),q(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const p=l.shape[2],g=l.shape[3];q(u.shape[2]===p*g,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*g}, but got ${u.shape[2]}.`);const b=Kk(h,l,s,r,o,i),w=Wh(b,u,1,"valid",o);return f?ce(w,[w.shape[1],w.shape[2],w.shape[3]]):w}const v9=he({separableConv2d_:sIe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rIe(n){const t={x:J(n,"x","sign")};return le.runKernel(pb,t)}const iIe=he({sign_:rIe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oIe(n){const t={x:J(n,"x","sin","float32")};return le.runKernel(db,t)}const w9=he({sin_:oIe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aIe(n){const t={x:J(n,"x","sinh")};return le.runKernel(fb,t)}const T9=he({sinh_:aIe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lIe(n,e,t){const s=J(n,"x","slice1d");return q(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),_n(s,[e],[t])}const r2=he({slice1d_:lIe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uIe(n,e,t){const s=J(n,"x","slice2d");return q(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),_n(s,e,t)}const x9=he({slice2d_:uIe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cIe(n,e,t){const s=J(n,"x","slice3d");return q(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),_n(s,e,t)}const i2=he({slice3d_:cIe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hIe(n,e,t){const s=J(n,"x","slice4d");return q(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),_n(s,e,t)}const sw=he({slice4d_:hIe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dIe(n,e=-1){const t=J(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return le.runKernel(ax,s,r)}const o2=he({softmax_:dIe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fIe(n){q(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return le.runKernel(yk,e)}const S9=he({fft_:fIe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pIe(n){q(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return le.runKernel(wk,e)}const oC=he({ifft_:pIe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mIe(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=ce(n,[t,e]);s=oC(r)}else{const r=[t,2*(e-1)],i=ce(nw(n),[t,e]),o=ce(Jk(n),[t,e]),a=Kh(_n(i,[0,1],[t,e-2]),1),l=ae(Kh(_n(o,[0,1],[t,e-2]),1),Yt(-1)),u=Mr([i,a],1),h=Mr([o,l],1),f=ce(Qf(u,h),[r[0],r[1]]);s=oC(f)}if(s=nw(s),n.rank===3&&n.shape[0]!==0){const r=s,i=n.shape[0];s=ce(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const gIe=he({irfft_:mIe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yIe(n,e,t=0){const r={x:J(n,"x","split")},i={numOrSizeSplits:e,axis:t};return le.runKernel(ox,r,i)}const _i=he({split_:yIe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bIe(n,e){q(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const b=n.shape.map(w=>0),T=n.shape.map(w=>w);T[n.shape.length-1]=e,r=_n(n,b,T),t=e}else if(e!=null&&e>t){const b=n.shape.map(T=>T);b[n.shape.length-1]=e-t,r=Mr([n,ks(b)],n.shape.length-1),t=e}else r=n;const i=Lt(r),o=ce(Qf(r,i),[s,t]),a=S9(o),l=Math.floor(t/2)+1,u=nw(a),h=Jk(a),f=_i(u,[l,t-l],u.shape.length-1),p=_i(h,[l,t-l],h.shape.length-1),g=r.shape.slice();return g[r.shape.length-1]=l,ce(Qf(f[0],p[0]),g)}const vIe=he({rfft_:bIe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wIe(n,e){let t=J(n,"a","squaredDifference"),s=J(e,"b","squaredDifference");[t,s]=Xn(t,s),pt(t.shape,s.shape);const r={a:t,b:s},i={};return le.runKernel(bb,r,i)}const TIe=he({squaredDifference_:wIe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xIe(n,e){const t=J(n,"x","squeeze","string_or_numeric");return ce(t,xc(t.shape,e).newShape)}const Cb=he({squeeze_:xIe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SIe(n,e=0){const t=G5(n,"tensors","stack","string_or_numeric");q(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&q(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return le.runKernel(XT,s,r)}const Cl=he({stack_:SIe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ie(n,e=0){const s={x:J(n,"x","step")},r={alpha:e};return le.runKernel(Sb,s,r)}const Nb=he({step_:_Ie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EIe(n,e,t,s,r=0,i=0,o=0,a=0,l=0){const h={x:J(n,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:s,beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return le.runKernel(Mk,h,f)}const IIe=he({stridedSlice_:EIe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CIe(n){const t={x:J(n,"x","tan","float32")};return le.runKernel(wb,t)}const NIe=he({tan_:CIe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ii(n,e){t5(n);const t=dx(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return fx(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fE(n,e,t){if(t5(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=dx(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return fx(n,e,s,t)}function _9(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(i+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(i+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(i+` update.rank != ${r+n.length-s}`);for(let o=0;o<r;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-r;++o)if(t.shape[o+r]!==n[o+s])throw new Error(i+` updates.shape[${o+r}] (${t.shape[o+r]}) != shape[${o+r}] (${n[o+r]})`)}function AIe(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}_9(t,e,n)}function od(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,i=t.length;let o=1;for(let f=r;f<i;++f)o*=t[f];const a=r<1?1:r,l=Ee(e.shape)/a,u=[...Qe(t.slice(0,r)),1],h=Ee(t);return{sliceRank:r,numUpdates:l,sliceSize:o,strides:u,outputSize:h}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kIe(n,e=1,t=!0){const s=J(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const i={x:s},o={k:e,sorted:t},[a,l]=le.runKernel(Ok,i,o);return{values:a,indices:l}}const $Ie=he({topk_:kIe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RIe(n,e=0,t=1,s,r){if(Fl(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new p9(e,t,s,!0,r),o=Tt(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const E9=he({truncatedNormal_:RIe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DIe(n,e=0){const t=J(n,"x","unique","string_or_numeric");q(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[i,o]=le.runKernel(Fk,s,r);return{values:i,indices:o}}const MIe=he({unique_:DIe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OIe(n,e,t){const s=J(n,"x","unsortedSegmentSum"),r=J(e,"segmentIds","unsortedSegmentSum","int32");q(Jf(t),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},o={numSegments:t};return le.runKernel(ux,i,o)}const I9=he({unsortedSegmentSum_:OIe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PIe(n,e=0){const t=J(n,"x","unstack","string_or_numeric");q(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return le.runKernel(lx,s,r)}const Xh=he({unstack_:PIe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FIe(n,e=!0,t,s){return le.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C9(n,e){const t=[];for(let i=0;i<e.length;i++)e[i]&&t.push(i);const s=Tt(n,"int32"),r=Tt([t.length,n.length],"int32");for(let i=0;i<t.length;i++){const o=s.indexToLoc(t[i]),a=i*n.length;r.values.set(o,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LIe(n,e,t){const s=J(n,"x","transpose");if(e==null&&(e=s.shape.map((o,a)=>a).reverse()),q(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(o=>{q(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:e};return s.dtype==="complex64"?ge(()=>{let o=nw(s),a=Jk(s);return o=le.runKernel($f,{x:o},i),a=le.runKernel($f,{x:a},i),t&&(a=Kn(a)),Qf(o,a)}):le.runKernel($f,r,i)}const Ft=he({transpose_:LIe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VIe(n,e){if(e==null)return n.shape.slice();if(jt(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BIe(n,e,t,s){const r=J(n,"x","dropout");if(q(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),q(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof gs?r.clone():r;const i=VIe(r,t),o=1-e,a=nt(bx(Pe(Ib(i,0,1,"float32",s),o)),o);return ae(r,a)}const UIe=he({dropout_:BIe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zIe(n,e,t,s,r,i="NHWC",o){let a=n;n.rank===3&&(a=ce(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ce(e,[1,e.shape[0],e.shape[1],e.shape[2]])),q(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),q(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),q(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const u=i==="NHWC"?a.shape[3]:a.shape[1],h=i==="NHWC"?l.shape[3]:l.shape[1];q(u===t[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${t[2]}.`),q(h===t[3],()=>`Error in conv2dDerFilter: depth of dy (${h}) must match output depth for filter (${t[3]}).`),Vr("conv2dDerFilter",r,o);const f={x:a,dy:l},p={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,filterShape:t};return le.runKernel(ok,f,p)}const a2=he({conv2DBackpropFilter_:zIe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l2(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return ae(n,Nb(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function u2(n,e){let t=e;const s=Ss(n.shape,e.shape);return s.length>0&&(t=Ze(t,s)),ce(t,n.shape)}function c2(n,e,t,s){if(e==="linear")return n;if(e==="relu")return id(n);if(e==="elu")return gx(n);if(e==="relu6")return m9(n);if(e==="prelu")return s2(n,t);if(e==="leakyrelu")return jk(n,s);if(e==="sigmoid")return Np(n);throw new Error(`Unknown fused activation ${e}.`)}const h2=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GIe({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:h}){if(l=l||"linear",h2(le.state.gradientDepth,l)===!1){q(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let V=Wh(n,e,t,s,r,i,o);return a!=null&&(V=Pe(V,a)),c2(V,l,u,h)}const f=J(n,"x","conv2d","float32"),p=J(e,"filter","conv2d","float32");let g=f,b=!1;f.rank===3&&(b=!0,g=ce(f,[1,f.shape[0],f.shape[1],f.shape[2]])),q(g.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${g.rank}.`),q(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),Vr("fused conv2d",s,o);const T=r==="NHWC"?g.shape[3]:g.shape[1];q(p.shape[2]===T,()=>`Error in conv2d: depth of input (${T}) must match input depth for filter ${p.shape[2]}.`),q(ar(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);const w=zs(g.shape,p.shape,t,i,s,o);let _;a!=null&&(_=J(a,"bias","fused conv2d"),[_]=Xn(_,f),r==="NHWC"?pt(w.outShape,_.shape):(q(_.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${_.shape.length}.`),q(_.shape.length===0||_.shape[0]===w.outChannels||_.shape[0]===1,()=>`Error in fused conv2d: bias shape (${_.shape}) is not compatible with the number of output channels (${w.outChannels})`)));let C;if(u!=null){const V=u.shape;if(q(V.length<=1||V.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${V.length}.`),V.length===1)q(V[0]===1||V[0]===w.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${V}) is not compatible with the number of output channels (${w.outChannels}).`);else if(V.length===3)try{pt(V,w.outShape)}catch{const M=`Error in fused conv2d: PReLU activation weights (${V}) is not compatible with the output shape of the conv2d (${w.outShape}).`;throw Error(M)}C=J(u,"prelu weights","fused conv2d")}const N=(V,D)=>{q(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[M,$,O,k]=D,z=l2(V,O,l);q(Hh(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const U=qk($.shape,z,M,t,s),te=a2($,z,M.shape,t,s),se=[U,te];if(k!=null){const X=u2(k,z);se.push(X)}return se},A={x:g,filter:p,bias:_,preluActivationWeights:C},P={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:h};return a==null?tp((D,M,$)=>{let O=le.runKernel(Jv,A,P);return $([M,D,O]),b&&(O=ce(O,[O.shape[1],O.shape[2],O.shape[3]])),{value:O,gradFunc:N}})(g,p):tp((D,M,$,O)=>{let k=le.runKernel(Jv,A,P);return O([M,D,k,$]),b&&(k=ce(k,[k.shape[1],k.shape[2],k.shape[3]])),{value:k,gradFunc:N}})(g,p,_)}const HIe=he({fusedConv2d_:GIe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qIe(n,e,t,s,r,i=[1,1],o){let a=n;n.rank===3&&(a=ce(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ce(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},h={strides:s,pad:r,dimRoundingMode:o,dilations:i,filterShape:t};return le.runKernel(fk,u,h)}const WIe=he({depthwiseConv2dNativeBackpropFilter_:qIe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KIe(n,e,t,s,r,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=ce(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:t},h={strides:s,pad:r,dimRoundingMode:o,dilations:i,inputShape:n},f=le.runKernel(pk,u,h);return l?ce(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const XIe=he({depthwiseConv2dNativeBackpropInput_:KIe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YIe({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(h2(le.state.gradientDepth,i)===!1){let k=Xt(n,e,t,s);return r!=null&&(k=Pe(k,r)),c2(k,i,o,a)}let l=J(n,"a","fused matMul"),u=J(e,"b","fused matMul");[l,u]=Xn(l,u);const h=t?l.shape[l.rank-2]:l.shape[l.rank-1],f=s?u.shape[u.rank-1]:u.shape[u.rank-2],p=t?l.shape[l.rank-1]:l.shape[l.rank-2],g=s?u.shape[u.rank-2]:u.shape[u.rank-1],b=l.shape.slice(0,-2),T=u.shape.slice(0,-2),w=Ee(b),_=Ee(T);q(h===f,()=>`Error in fused matMul: inner shapes (${h}) and (${f}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${t} and transposeB=${s} must match.`);const N=pt(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([p,g]),A=t?ce(l,[w,h,p]):ce(l,[w,p,h]),P=s?ce(u,[_,g,f]):ce(u,[_,f,g]);let V;r!=null&&(V=J(r,"bias","fused matMul"),[V]=Xn(V,l),pt(N,V.shape));let D;o!=null&&(D=J(o,"prelu weights","fused matMul"));const M=(k,z)=>{const[U,te,se,X]=z,Q=l2(ce(k,se.shape),se,i);let re,fe;if(!t&&!s?(re=Xt(Q,te,!1,!0),fe=Xt(U,Q,!0,!1)):!t&&s?(re=Xt(Q,te,!1,!1),fe=Xt(Q,U,!0,!1)):t&&!s?(re=Xt(te,Q,!1,!0),fe=Xt(U,Q,!1,!1)):(re=Xt(te,Q,!0,!0),fe=Xt(Q,U,!0,!0)),r!=null){const be=u2(X,Q);return[re,fe,be]}else return[re,fe]},$={a:A,b:P,bias:V,preluActivationWeights:D},O={transposeA:t,transposeB:s,activation:i,leakyreluAlpha:a};return r==null?tp((z,U,te)=>{const se=le.runKernel(Yv,$,O);return te([z,U,se]),{value:ce(se,N),gradFunc:M}})(A,P):tp((z,U,te,se)=>{const X=le.runKernel(Yv,$,O);return se([z,U,X,te]),{value:ce(X,N),gradFunc:M}})(A,P,V)}const sL=he({fusedMatMul_:YIe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JIe(n,e,t,s,r="bilinear",i=0){const o=J(n,"image","cropAndResize"),a=J(e,"boxes","cropAndResize","float32"),l=J(t,"boxInd","cropAndResize","int32"),u=a.shape[0];q(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),q(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),q(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),q(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),q(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),q(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const h={image:o,boxes:a,boxInd:l},f={method:r,extrapolationValue:i,cropSize:s};return le.runKernel(ck,h,f)}const jIe=he({cropAndResize_:JIe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QIe(n){const e=J(n,"image","flipLeftRight","float32");q(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return le.runKernel(vk,t,{})}const ZIe=he({flipLeftRight_:QIe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eCe(n){const e=J(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];q(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),q(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,Co(e,r)}const tCe=he({grayscaleToRGB_:eCe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nCe(n){const e=J(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];q(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),q(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,i=Ge(e,"float32"),o=ii([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Wm("ij,j->i",i,o);break;case 3:a=Wm("ijk,k->ij",i,o);break;case 4:a=Wm("ijkl,l->ijk",i,o);break;case 5:a=Wm("ijklm,m->ijkl",i,o);break;case 6:a=Wm("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=$r(a,-1),Ge(a,r)}const sCe=he({rgbToGrayscale_:nCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rCe(n,e,t=0,s=.5){const r=J(n,"image","rotateWithOffset","float32");q(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},o={radians:e,fillValue:t,center:s};return le.runKernel(Lk,i,o)}const iCe=he({rotateWithOffset_:rCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kp(n,e,t,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=n.shape[0];return t=Math.min(t,o),q(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),q(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),q(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),q(e.rank===1,()=>"scores must be a 1D tensor"),q(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),q(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oCe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=J(n,"boxes","nonMaxSuppression","float32"),o=J(e,"scores","nonMaxSuppression","float32"),a=kp(i,o,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return le.runKernel(Ek,{boxes:i,scores:o},l)}const aCe=he({nonMaxSuppression_:oCe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lCe(n,e,t){const s=uCe(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function uCe(n,e,t){return hCe(n,e,t||cCe)}function cCe(n,e){return n>e?1:n<e?-1:0}function hCe(n,e,t){let s=0,r=n.length,i=0,o=!1;for(;s<r;){i=s+(r-s>>>1);const a=t(e,n[i]);a>0?s=i+1:(r=i,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d2(n,e,t,s,r){return m2(n,e,t,s,r,0)}function f2(n,e,t,s,r,i){return m2(n,e,t,s,r,0,!1,i,!0)}function p2(n,e,t,s,r,i){return m2(n,e,t,s,r,i,!0)}function m2(n,e,t,s,r,i,o=!1,a=!1,l=!1){const u=[];for(let w=0;w<e.length;w++)e[w]>r&&u.push({score:e[w],boxIndex:w,suppressBeginIndex:0});u.sort(rL);const h=i>0?-.5/i:0,f=[],p=[];for(;f.length<t&&u.length>0;){const w=u.pop(),{score:_,boxIndex:C,suppressBeginIndex:N}=w;if(_<r)break;let A=!1;for(let P=f.length-1;P>=N;--P){const V=dCe(n,C,f[P]);if(V>=s){A=!0;break}if(w.score=w.score*fCe(s,h,V),w.score<=r)break}w.suppressBeginIndex=f.length,A||(w.score===_?(f.push(C),p.push(w.score)):w.score>r&&lCe(u,w,rL))}const g=f.length,b=t-g;a&&b>0&&(f.push(...new Array(b).fill(0)),p.push(...new Array(b).fill(0)));const T={selectedIndices:f};return o&&(T.selectedScores=p),l&&(T.validOutputs=g),T}function dCe(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),i=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),u=Math.min(r[0],r[2]),h=Math.min(r[1],r[3]),f=Math.max(r[0],r[2]),p=Math.max(r[1],r[3]),g=(a-i)*(l-o),b=(f-u)*(p-h);if(g<=0||b<=0)return 0;const T=Math.max(i,u),w=Math.max(o,h),_=Math.min(a,f),C=Math.min(l,p),N=Math.max(_-T,0)*Math.max(C-w,0);return N/(g+b-N)}function fCe(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function rL(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function pCe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=J(n,"boxes","nonMaxSuppressionAsync"),o=J(e,"scores","nonMaxSuppressionAsync"),a=kp(i,o,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),u=l[0],h=l[1],{selectedIndices:f}=d2(u,h,t,s,r);return i!==n&&i.dispose(),o!==e&&o.dispose(),ii(f,"int32")}const mCe=pCe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gCe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=J(n,"boxes","nonMaxSuppression"),a=J(e,"scores","nonMaxSuppression"),l=kp(o,a,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u={boxes:o,scores:a},h={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},f=le.runKernel(Ck,u,h);return{selectedIndices:f[0],selectedScores:f[1]}}const yCe=he({nonMaxSuppressionWithScore_:gCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function bCe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=J(n,"boxes","nonMaxSuppressionAsync"),a=J(e,"scores","nonMaxSuppressionAsync"),l=kp(o,a,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u=await Promise.all([o.data(),a.data()]),h=u[0],f=u[1],{selectedIndices:p,selectedScores:g}=p2(h,f,t,s,r,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:ii(p,"int32"),selectedScores:ii(g)}}const vCe=bCe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wCe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=J(n,"boxes","nonMaxSuppression"),a=J(e,"scores","nonMaxSuppression"),l=kp(o,a,t,s,r,null),u=l.maxOutputSize,h=l.iouThreshold,f=l.scoreThreshold,p={boxes:o,scores:a},g={maxOutputSize:u,iouThreshold:h,scoreThreshold:f,padToMaxOutputSize:i},b=le.runKernel(Ik,p,g);return{selectedIndices:b[0],validOutputs:b[1]}}const TCe=he({nonMaxSuppressionPadded_:wCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function xCe(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=J(n,"boxes","nonMaxSuppressionAsync"),a=J(e,"scores","nonMaxSuppressionAsync"),l=kp(o,a,t,s,r,null),u=l.maxOutputSize,h=l.iouThreshold,f=l.scoreThreshold,[p,g]=await Promise.all([o.data(),a.data()]),{selectedIndices:b,validOutputs:T}=f2(p,g,u,h,f,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:ii(b,"int32"),validOutputs:Yt(T,"int32")}}const SCe=xCe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ce(n,e,t=!1,s=!1){const r=J(n,"images","resizeBilinear");q(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),q(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),q(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=ce(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},u=le.runKernel(ex,a,l);return o?ce(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const N9=he({resizeBilinear_:_Ce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ECe(n,e,t=!1,s=!1){const r=J(n,"images","resizeNearestNeighbor");q(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),q(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),q(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),q(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=ce(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},u=le.runKernel(ZT,a,l);return o?ce(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const A9=he({resizeNearestNeighbor_:ECe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ICe(n,e="binary",t=!1,s=.5){const r=J(n,"image","threshold"),i=.2989,o=.587,a=.114,l=r.shape[0]*r.shape[1];let u=ae(ii([s]),255),h,f,p,g;if(q(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),q(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),q(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),q(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[h,f,p]=_i(r,[1,1,1],-1);const w=ae(h,i),_=ae(f,o),C=ae(p,a);g=Pe(Pe(w,_),C)}else g=n;if(e==="otsu"){const w=BSe(Ge(g9(g),"int32"),H5([]),256);u=CCe(w,l)}const b=t?Ap(g,u):Ci(g,u);return Ge(ae(b,255),"int32")}function CCe(n,e){let t=ii([-1]),s=ii([0]),r=ii([0]),i,o,a,l,u,h;for(let f=0;f<n.size-1;f++){i=_n(n,0,f+1),o=_n(n,f+1),u=nt(Ze(i),e),h=nt(Ze(o),e);const p=Ze(ae(i,Kg(0,i.size)));a=nt(p,Ze(i));const g=mx(o.shape,i.size),b=Pe(Kg(0,o.size),g),T=ae(o,b);l=nt(Ze(T),Ze(o));const w=rt(a,l),_=rt(a,l),C=ae(u,h);r=ae(ae(C,w),_);const N=Ci(r,s);s=xr(N,r,s),t=xr(N,ii([f]),t)}return t}const NCe=he({threshold_:ICe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ACe(n,e,t="nearest",s="constant",r=0,i){const o=J(n,"image","transform","float32"),a=J(e,"transforms","transform","float32");q(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),q(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),q(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},u={interpolation:t,fillMode:s,fillValue:r,outputShape:i};return le.runKernel(Pk,l,u)}const kCe=he({transform_:ACe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ce(n,e,t){const s=J(n,"a","bandPart");q(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,o]=s.shape.slice(-2);let a,l;typeof e=="number"?(q(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),q(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=J(e<0?i:e,"numLower","bandPart")):(q(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=xr(ew(e,0),i,Wg(e,i))),typeof t=="number"?(q(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),q(t<=o,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${o}).`),l=J(t<0?o:t,"numUpper","bandPart")):(q(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=xr(ew(t,0),o,Wg(t,o)));const u=ce(Kg(0,i,1,"int32"),[-1,1]),h=Kg(0,o,1,"int32"),f=rt(u,h),p=Il(Ap(f,a),rd(f,Kn(l))),g=ks([i,o],s.dtype);return ce(Cl(Xh(ce(s,[-1,i,o])).map(b=>xr(p,b,g))),r)}const RCe=he({bandPart_:$Ce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DCe(n){let e;if(Array.isArray(n)){e=!1,q(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let i=1;i<n.length;++i)q(n[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[i].shape[0]} vs. ${r})`)}else e=!0,n=_i(n,n.shape[0],0).map(r=>Cb(r,[0]));q(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(le.tidy(()=>{let i=s[r];if(r>0)for(let o=0;o<r;++o){const a=ae(Ze(ae(t[o],i)),t[o]);i=rt(i,a)}return nt(i,yx(i,"euclidean"))}));return e?Cl(t,0):t}const MCe=he({gramSchmidt_:DCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OCe(n,e=!1){if(q(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return iL(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,u)=>l*u),s=Xh(ce(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],i=[];s.forEach(l=>{const[u,h]=iL(l,e);r.push(u),i.push(h)});const o=ce(Cl(r,0),n.shape),a=ce(Cl(i,0),n.shape);return[o,a]}}function iL(n,e=!1){return le.tidy(()=>{q(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=l9(t),i=Ih(n);const o=fE([[1]],[1,1]);let a=Ih(o);const l=t>=s?s:t;for(let u=0;u<l;++u){const h=i,f=a,p=r;[a,i,r]=le.tidy(()=>{const g=_n(i,[u,u],[t-u,1]),b=yx(g),T=_n(i,[u,u],[1,1]),w=xr(Ci(T,0),fE([[-1]]),fE([[1]])),_=rt(T,ae(w,b)),C=nt(g,_);C.shape[0]===1?a=Ih(o):a=Mr([o,_n(C,[1,0],[C.shape[0]-1,C.shape[1]])],0);const N=Kn(nt(Xt(w,_),b)),A=_n(i,[u,0],[t-u,s]),P=ae(N,a),V=Ft(a);if(u===0)i=rt(A,Xt(P,Xt(V,A)));else{const $=rt(A,Xt(P,Xt(V,A)));i=Mr([_n(i,[0,0],[u,s]),$],0)}const D=Ft(P),M=_n(r,[0,u],[t,r.shape[1]-u]);if(u===0)r=rt(M,Xt(Xt(M,a),D));else{const $=rt(M,Xt(Xt(M,a),D));r=Mr([_n(r,[0,0],[t,u]),$],1)}return[a,i,r]}),_t([h,f,p])}return!e&&t>s&&(r=_n(r,[0,0],[t,s]),i=_n(i,[0,0],[s,s])),[r,i]})}const PCe=he({qr_:OCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fl={flipLeftRight:ZIe,grayscaleToRGB:tCe,resizeNearestNeighbor:A9,resizeBilinear:N9,rgbToGrayscale:sCe,rotateWithOffset:iCe,cropAndResize:jIe,nonMaxSuppression:aCe,nonMaxSuppressionAsync:mCe,nonMaxSuppressionWithScore:yCe,nonMaxSuppressionWithScoreAsync:vCe,nonMaxSuppressionPadded:TCe,nonMaxSuppressionPaddedAsync:SCe,threshold:NCe,transform:kCe},FCe={bandPart:RCe,gramSchmidt:MCe,qr:PCe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LCe=new Map,VCe=new Map;class $p{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Ki{constructor(){this.classNameMap={}}static getMap(){return Ki.instance==null&&(Ki.instance=new Ki),Ki.instance}static register(e){Ki.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Oe(n,e,t){q(n.className!=null,()=>"Class being registered does not have the static className property defined."),q(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),q(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,r=e+">"+s;return Ki.register(n),LCe.set(r,n),VCe.set(n,r),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nc extends $p{minimize(e,t=!1,s){const{value:r,grads:i}=this.computeGradients(e,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return _t(i),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return lEe(e,t)}dispose(){this.iterations_!=null&&_t(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Yt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Nc,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class k9 extends Nc{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=le.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=le.registeredVariables[s],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:ge(()=>Lt(i).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:ge(()=>Lt(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,u=this.accumulatedUpdates[r].variable;ge(()=>{const h=Pe(ae(l,this.rho),ae(An(a),1-this.rho)),f=ae(nt(_r(Pe(u,this.epsilon)),_r(Pe(l,this.epsilon))),a),p=Pe(ae(u,this.rho),ae(An(f),1-this.rho));l.assign(h),u.assign(p);const g=Pe(ae(f,-this.learningRate),i);i.assign(g)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(_t(this.accumulatedGrads.map(e=>e.variable)),_t(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $9 extends Nc{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=le.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:ge(()=>mx(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const a=this.accumulatedGrads[r].variable;ge(()=>{const l=Pe(a,An(o));a.assign(l);const u=Pe(ae(nt(o,_r(Pe(l,le.backend.epsilon()))),-this.learningRate),i);i.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&_t(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R9 extends Nc{static get className(){return"Adam"}constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ge(()=>{this.accBeta1=Yt(t).variable(),this.accBeta2=Yt(s).variable()}),r==null&&(this.epsilon=le.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);ge(()=>{const s=rt(1,this.accBeta1),r=rt(1,this.accBeta2);t.forEach((i,o)=>{const a=le.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:ge(()=>Lt(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:ge(()=>Lt(a).variable(l))});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const h=this.accumulatedFirstMoment[o].variable,f=this.accumulatedSecondMoment[o].variable,p=Pe(ae(h,this.beta1),ae(u,1-this.beta1)),g=Pe(ae(f,this.beta2),ae(An(u),1-this.beta2)),b=nt(p,s),T=nt(g,r);h.assign(p),f.assign(g);const w=Pe(ae(nt(b,Pe(_r(T),this.epsilon)),-this.learningRate),a);a.assign(w)}),this.accBeta1.assign(ae(this.accBeta1,this.beta1)),this.accBeta2.assign(ae(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&_t(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&_t(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),ge(()=>{this.accBeta1.assign(ep(this.beta1,this.iterations_+1)),this.accBeta2.assign(ep(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D9 extends Nc{static get className(){return"Adamax"}constructor(e,t,s,r=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ge(()=>{this.iteration=Yt(0).variable(),this.accBeta1=Yt(t).variable()}),r==null&&(this.epsilon=le.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);ge(()=>{const s=rt(1,this.accBeta1),r=nt(-this.learningRate,Pe(ae(this.iteration,this.decay),1));t.forEach((i,o)=>{const a=le.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:Lt(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:Lt(a).variable(l)});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const h=this.accumulatedFirstMoment[o].variable,f=this.accumulatedWeightedInfNorm[o].variable,p=Pe(ae(h,this.beta1),ae(u,1-this.beta1)),g=ae(f,this.beta2),b=pr(u),T=Ic(g,b);h.assign(p),f.assign(T);const w=Pe(ae(nt(r,s),nt(p,Pe(T,this.epsilon))),a);a.assign(w)}),this.iteration.assign(Pe(this.iteration,1)),this.accBeta1.assign(ae(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&_t(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&_t(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g2 extends Nc{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const o=le.registeredVariables[s];ge(()=>{const a=Pe(ae(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Sa(Yt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M9 extends g2{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=Yt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=le.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:ge(()=>Lt(i).variable(!1))});const o=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&ge(()=>{let l;const u=Pe(ae(this.m,o),a);this.useNesterov?l=Pe(ae(this.c,Pe(a,ae(u,this.m))),i):l=Pe(ae(this.c,u),i),o.assign(u),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&_t(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class O9 extends Nc{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=le.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=le.registeredVariables[s],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:ge(()=>Lt(i).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:ge(()=>Lt(i).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:ge(()=>Lt(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,u=this.accumulatedMoments[r].variable;ge(()=>{const h=Pe(ae(l,this.decay),ae(An(a),1-this.decay));if(this.centered){const f=this.accumulatedMeanGrads[r].variable,p=Pe(ae(f,this.decay),ae(a,1-this.decay)),g=nt(ae(a,this.learningRate),_r(rt(h,Pe(An(p),this.epsilon)))),b=Pe(ae(u,this.momentum),g);l.assign(h),f.assign(p),u.assign(b);const T=rt(i,b);i.assign(T)}else{const f=Pe(ae(l,this.decay),ae(An(a),1-this.decay)),p=Pe(ae(u,this.momentum),nt(ae(a,this.learningRate),_r(Pe(f,this.epsilon))));l.assign(f),u.assign(p);const g=rt(i,p);i.assign(g)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&_t(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&_t(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&_t(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BCe=[k9,$9,R9,D9,M9,O9,g2];function UCe(){for(const n of BCe)Oe(n)}function y2(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(Ee(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,i=r[r.length-1];let o=1;for(let f=0;f<r.length-1;++f)o*=r[f];const a=n.shape,l=r.slice();l.pop();let u=1;for(let f=i;f<t;++f)u*=a[f],l.push(a[f]);const h=[...Qe(n.shape).map(f=>f/u),1].slice(0,i);return[l,o,u,h]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aC=-2,zCe=-1;function b2(n,e,t){const s=n.shape.length;q(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),q(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)q(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function GCe(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function v2(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function P9(n,e,t,s){const r=[...n];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<t;i++)i===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function F9(n,e,t){return t<=n?t:t-(e-1)}function L9(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function HCe(n,e,t,s,r,i,o,a,l){const u=n.length;let h=new Array(u),f=new Array(u),p=new Array(u);if(e.length&&t>0){const g=e[0],b=t+1;h=V9(o,g,b,s,n),f=B9(a,g,b,r,n),p=P9(i,g,b,n)}else for(let g=0;g<u;g++)h[g]=z9(o,s,i,n,g,l),f[g]=G9(a,r,i,n,g,l),p[g]=U9(i,g,l);return{begin:h,end:f,strides:p}}function V9(n,e,t,s,r){const i=[...r],o=L9(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=F9(e,t,a);let u=s[l];n&1<<l&&(u=0),i[a]=u}return i}function B9(n,e,t,s,r){const i=[...r],o=L9(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=F9(e,t,a);let u=s[l];n&1<<l&&(u=Number.MAX_SAFE_INTEGER),i[a]=u}for(let a=0;a<i.length;a++){const l=r[a];i[a]<0&&(i[a]+=l),i[a]=Bh(0,i[a],r[a])}return i}function U9(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function z9(n,e,t,s,r,i){let o=e[r];const a=t[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),o=Bh(0,o,l-1),o}function G9(n,e,t,s,r,i){let o=e[r];const a=t[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),a>0?o=Bh(0,o,l):o=Bh(-1,o,l-1),o}function w2(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function T2(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function vx(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(o=>{q(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(r).fill(-1):typeof t=="number"?i=[t,...new Array(r-1).fill(-1)]:t.length<r?i=t.concat(new Array(r-t.length).fill(-1)):i=t,i=i.map((o,a)=>o>=0?o:(q(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),n.shape[a]-s[a])),[s,i]}function x2(n,e,t,s,r,i,o,a,l){let u;if(s==null?(u=new Array(e.length),u.fill(1)):u=s,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let h=!1;const f={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:u.slice(),beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let N=0;N<f.dims;N++)h&&(1<<N&a)!==0&&f.numAddAxisAfterEllipsis++,1<<N&o&&(h=!0);h||(f.ellipsisMask|=1<<f.dims,f.dims++);const p={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};qCe(f,p);let g=!0,b=!0,T=!0;const w=[],_=[];for(let N=0;N<n.length;++N){if(p.strides[N]===0)throw Error(`strides[${N}] must be non-zero`);const A=!!(p.shrinkAxisMask&1<<N),P=n[N];if(P===-1){w.push(A?1:-1);continue}const V=[p.beginMask&1<<N,p.endMask&1<<N],D=[p.strides[N]>0?0:-1,p.strides[N]>0?P:P-1];if(A&&p.strides[N]<=0)throw Error("only stride 1 allowed on non-range indexing.");T=T&&p.strides[N]===1;const M=!!(p.beginMask&1<<N&&p.endMask&1<<N);if(p.beginValid&&p.endValid){if(A){const z=p.begin[N]<0?P+p.begin[N]:p.begin[N];if(p.begin[N]=z,p.end[N]=p.begin[N]+1,z<0||z>=P)throw Error(`slice index ${p.begin[N]} of dimension ${N} out of bounds.`)}else p.begin[N]=oL(p.begin[N],0,p.strides[N],P,V,D),p.end[N]=oL(p.end[N],1,p.strides[N],P,V,D);const k=p.strides[N]===1&&p.begin[N]===0&&p.end[N]===P;g=g&&k,b=b&&(N===0&&p.strides[N]===1||k)}else g=g&&p.strides[N]===1&&M,b=b&&(N===0&&p.strides[N]===1||M);let $,O=!1;if(p.beginValid&&p.endValid?($=p.end[N]-p.begin[N],O=!0):A?($=1,O=!0):M&&P>=0&&(p.strides[N]<0?$=-P:$=P,O=!0),O){let k;$===0||$<0!=p.strides[N]<0?k=0:k=Math.trunc($/p.strides[N])+($%p.strides[N]!==0?1:0),w.push(k)}else w.push(-1)}for(let N=0;N<p.finalShapeGatherIndices.length;++N){const A=p.finalShapeGatherIndices[N];A>=0?_.push(w[A]):A===aC&&_.push(1)}return{finalShapeSparse:_.filter((N,A)=>p.finalShapeGatherIndices[A]!==aC),finalShape:_,isIdentity:g,sliceDim0:b,isSimpleSlice:T,begin:p.begin,end:p.end,strides:p.strides}}function qCe(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(aC),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(zCe),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function oL(n,e,t,s,r,i){if(r[e])return t>0?i[e]:i[e+1&1];{const o=n<0?s+n:n;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const WCe=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:b2,computeFlatOffset:T2,computeOutShape:v2,getNormalizedAxes:HCe,isSliceContinous:w2,maskToAxes:GCe,parseSliceParams:vx,sliceInfo:x2,startForAxis:z9,startIndicesWithElidedDims:V9,stopForAxis:G9,stopIndicesWithElidedDims:B9,stridesForAxis:U9,stridesWithElidedDims:P9},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KCe{static sgd(e){return new g2(e)}static momentum(e,t,s=!1){return new M9(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,i=!1){return new O9(e,t,s,r,i)}static adam(e=.001,t=.9,s=.999,r=null){return new R9(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new k9(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,i=0){return new D9(e,t,s,r,i)}static adagrad(e,t=.1){return new $9(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tf=KCe;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XCe=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function H9(){return new Promise(n=>XCe(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S2(n,e){const t=n[0].length;n.forEach((r,i)=>{q(r.length===t,()=>`Error in concat${t}D: rank of tensors[${i}] must be the same as the rank of the rest (${t})`)}),q(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,i)=>{for(let o=0;o<t;o++)q(o===e||r[o]===s[o],()=>`Error in concat${t}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function _a(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var So;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(So||(So={}));function q9(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const i=t[r],o=s[s.length-t.length+r],a=s[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${i} but shape[${r+n}] = ${a}`)}else s[o]=i}return s}function W9(n){const e={FIRST_DIM_SIZE:So.FIRST_DIM_SIZE,VALUE_ROWIDS:So.VALUE_ROWIDS,ROW_LENGTHS:So.ROW_LENGTHS,ROW_SPLITS:So.ROW_SPLITS,ROW_LIMITS:So.ROW_LIMITS,ROW_STARTS:So.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function K9(n){return n.length===0?0:n[0]===So.FIRST_DIM_SIZE?n.length-1:n.length}function X9(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const i=n[r],o=e[r+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${i} but ragged tensor input.flatValues.shape[${r-n.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _2=30;function wx(n){return n<=_2?n:qI(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E2(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ab(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const i=e.length;for(let o=0;o<i;++o)r=r.concat([n[o+1]/e[o],e[o]]);r=r.concat(n.slice(i+1))}return r}function kb(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],i=[];for(let o=1;o<n;++o)o>=e*2+1||o%2===1?i.push(o):r.push(o);s.push(...r),s.push(0),s.push(...i)}return s}function $b(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let i=1;i<n.length;++i)i<=e.length?s?r.push(e[i-1]*n[i]):r.push(n[i]/e[i-1]):r.push(n[i]);return r}function I2(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function C2(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tx=1.7580993408473768,xx=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N2=.3275911,A2=.254829592,k2=-.284496736,$2=1.421413741,R2=-1.453152027,D2=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nl(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function Y9(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function J9(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function j9(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function M2(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function Q9(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function Z9(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const i=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:t,imag:s}}function e8(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pE="->",YCe=/->/g,aL=",",lL="...";function O2(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(YCe,"").length)/pE.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${pE}").`);const[s,r]=n.split(pE);q(s.indexOf(lL)===-1,()=>`The ellipsis notation ("${lL}") is not supported yet.`);const i=s.split(aL),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let p=0;p<r.length;++p){const g=r[p];if(!i.some(b=>b.indexOf(g)!==-1))throw new Error(`Output subscripts contain the label ${g} not present in the input subscripts.`);a.indexOf(g)===-1&&a.push(g)}for(let p=0;p<s.length;++p){const g=s[p];a.indexOf(g)===-1&&g!==aL&&a.push(g)}const l=new Array(i.length);for(let p=0;p<o;++p){if(new Set(i[p].split("")).size!==i[p].length)throw new Error(`Found duplicate axes in input component ${i[p]}. Support for duplicate axes in input is not implemented yet.`);l[p]=[];for(let g=0;g<i[p].length;++g)l[p].push(a.indexOf(i[p][g]))}const u=a.length,h=r.length,f=[];for(let p=h;p<u;++p)f.push(p);return{allDims:a,summedDims:f,idDims:l}}function P2(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function F2(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const i=t[r].shape;for(let o=0;o<e[r].length;++o)s[e[r][o]]===void 0?s[e[r][o]]=i[o]:q(s[e[r][o]]===i[o],()=>`Expected dimension ${s[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function L2(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let o=0;o<r;++o)s.push([]);const i=[];for(let o=0;o<t.length;++o){const a=t[o],l=JCe(e,a);for(const u of l)i.indexOf(u)===-1&&(s[o].push(u),i.push(u))}return{path:t,steps:s}}function V2(n){return n.every((e,t)=>e===t)}function JCe(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function B2(n,e,t=0){let s=[];if(typeof e=="number")q(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);q(r<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=n.shape[t]-o}q(n.shape[t]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t8(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function n8(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function s8(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r8(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function i8(n,e){return`size ${n} must be non-negative, not ${e}`}function o8(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function a8(n,e){const t=Ee(n),s=Ee(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function l8(n,e){const t=Ee(n),s=Ee(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lC(){return"segment ids must be >= 0"}function u8(){return"segment ids are not increasing"}function c8(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function h8(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d8(n,e){let t=!1,s;for(n<=_2?(s=n,t=!0):s=qI(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=qI(n,s+1);return s}function f8(n,e,t){const s=[],r=n.length;for(let i=0;i<r;i++)i!==e?s.push(n[i]):s.push(t);return s}function U2(n,e,t,s){const r=e.shape.length,i=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let f=0;f<s;++f)if(n.shape[f]!==e.shape[f])throw new Error(`x.shape[${f}]: ${n.shape[f]} should be equal to indices.shape[${f}]: ${e.shape[f]}.`);const o=n.shape[t],a=[];let l=1,u=1,h=1;for(let f=0;f<s;++f)a.push(n.shape[f]),l*=n.shape[f];for(let f=s;f<t;f++)a.push(n.shape[f]),u*=n.shape[f];for(let f=s;f<r;f++)a.push(e.shape[f]);for(let f=t+1;f<i;f++)a.push(n.shape[f]),h*=n.shape[f];return{batchSize:l,sliceSize:h,outerSize:u,dimSize:o,outputShape:a}}const jCe=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:U2,computeOutShape:f8,segOpComputeOptimalWindowSize:d8},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Al(n){try{return n.map(e=>uc(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function p8(n){return n.map(e=>qu(e))}const QCe=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:A2,ERF_A2:k2,ERF_A3:$2,ERF_A4:R2,ERF_A5:D2,ERF_P:N2,PARALLELIZE_THRESHOLD:_2,get RowPartitionType(){return So},SELU_SCALE:xx,SELU_SCALEALPHA:Tx,applyActivation:c2,assertAndGetBroadcastShape:pt,assertAxesAreInnerMostDims:Gs,assertParamsConsistent:S2,assignToTypedArray:Q9,axesAreInnerMostDims:Xk,calculateShapes:od,checkEinsumDimSizes:F2,checkPadOnDimRoundingMode:Vr,combineLocations:o9,combineRaggedTensorToTensorShapes:q9,complexWithEvenIndex:J9,complexWithOddIndex:j9,computeConv2DInfo:zs,computeConv3DInfo:_c,computeDefaultPad:Uk,computeDilation2DInfo:_b,computeOptimalWindowSize:wx,computeOutAndReduceShapes:Ds,computeOutShape:_a,computePool2DInfo:no,computePool3DInfo:Ll,convertConv2DDataFormat:Vl,decodeEinsumEquation:O2,eitherStridesOrDilationsAreOne:ar,expandShapeToKeepDim:os,exponent:e8,exponents:Z9,fromStringArrayToUint8:p8,fromUint8ToStringArray:Al,getAxesPermutation:zn,getBroadcastDims:Zf,getComplexWithIndex:M2,getEinsumComputePath:L2,getEinsumPermutation:P2,getFusedBiasGradient:u2,getFusedDyActivation:l2,getImageCenter:E2,getInnerMostAxes:Yn,getPermuted:kb,getRaggedRank:K9,getReductionAxes:Ss,getReshaped:Ab,getReshapedPermuted:$b,getRowPartitionTypesHelper:W9,getSliceBeginCoords:I2,getSliceSize:C2,getSparseFillEmptyRowsIndicesDenseShapeMismatch:t8,getSparseFillEmptyRowsNegativeIndexErrorMessage:n8,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:s8,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:o8,getSparseReshapeInputOutputMismatchErrorMessage:l8,getSparseReshapeInputOutputMultipleErrorMessage:a8,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:r8,getSparseReshapeNegativeOutputDimErrorMessage:i8,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:h8,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:lC,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:u8,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:c8,getUndoAxesPermutation:Ec,isIdentityPermutation:V2,log:QTe,mergeRealAndImagArrays:Nl,prepareAndValidate:y2,prepareSplitSize:B2,segment_util:jCe,shouldFuse:h2,slice_util:WCe,splitRealAndImagArrays:Y9,stridesOrDilationsArePositive:qh,tupleValuesAreOne:Hh,upcastType:ai,validateDefaultValueShape:X9,validateInput:AIe,validateUpdateShape:_9,warn:wi},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */UCe();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m8={kernelName:hT,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(n,Nb(Ge(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZCe={kernelName:Ay,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=An(Ge(t,"float32")),r=_r(rt(Yt(1),s));return Kn(nt(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eNe={kernelName:ky,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=_r(rt(An(Ge(t,"float32")),1));return nt(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tNe={kernelName:Ip,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=pt(t.shape,s.shape);return{a:()=>{let a=n;const l=Ss(t.shape,r);return l.length>0&&(a=Ze(a,l)),ce(a,t.shape)},b:()=>{let a=n;const l=Ss(s.shape,r);return l.length>0&&(a=Ze(a,l)),ce(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nNe={kernelName:QA,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,r)=>{t[r]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sNe={kernelName:dT,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Lt(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rNe={kernelName:fT,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Lt(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iNe={kernelName:$y,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>nt(n,_r(rt(Yt(1),An(Ge(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oNe={kernelName:Ry,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=_r(Pe(Yt(1),An(Ge(t,"float32"))));return nt(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aNe={kernelName:Oy,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=pt(t.shape,s.shape);return{a:()=>{const a=Pe(An(t),An(s));let l=ae(n,nt(s,a));const u=Ss(t.shape,r);return u.length>0&&(l=Ze(l,u)),ce(l,t.shape)},b:()=>{const a=Pe(An(t),An(s));let l=Kn(ae(n,nt(t,a)));const u=Ss(s.shape,r);return u.length>0&&(l=Ze(l,u)),ce(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lNe={kernelName:Dy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>nt(n,Pe(An(Ge(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uNe={kernelName:My,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>nt(n,rt(Yt(1),An(Ge(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cNe(n,e,t,s,r,i){const o=J(n,"dy","avgPool3dGrad"),a=J(e,"input","avgPool3dGrad");let l=o,u=a,h=!1;a.rank===4&&(h=!0,l=ce(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),u=ce(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),q(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),q(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),Vr("avgPool3dGrad",r,i);const f={dy:l,input:u},p={filterSize:t,strides:s,pad:r,dimRoundingMode:i},g=le.runKernel(nk,f,p);return h?ce(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const hNe=he({avgPool3dGrad_:cNe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dNe={kernelName:mT,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:i,pad:o,dimRoundingMode:a}=t;return{x:()=>hNe(n,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fNe(n,e,t,s,r){const i=J(n,"dy","avgPoolGrad"),o=J(e,"input","avgPoolGrad");q(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let a=o,l=i,u=!1;o.rank===3&&(u=!0,a=ce(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=ce(i,[1,i.shape[0],i.shape[1],i.shape[2]])),q(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),q(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const h={dy:l,input:a},f={filterSize:t,strides:s,pad:r},p=le.runKernel(tk,h,f);return u?ce(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const pNe=he({avgPoolGrad_:fNe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mNe={kernelName:pT,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:i,pad:o}=t;return{x:()=>pNe(n,s,r,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gNe={kernelName:gT,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,r]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>Xt(n,r,!1,!0),b:()=>Xt(s,n,!0,!1)}:!i&&o?{a:()=>Xt(n,r,!1,!1),b:()=>Xt(n,s,!0,!1)}:i&&!o?{a:()=>Xt(r,n,!1,!0),b:()=>Xt(s,n,!1,!1)}:{a:()=>Xt(r,n,!0,!0),b:()=>Xt(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yNe={kernelName:yT,gradFunc:(n,e,t)=>{const{blockShape:s,crops:r}=t;return{x:()=>n2(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bNe={kernelName:XTe,gradFunc:(n,e,t)=>{const s=t,r=s.inputShape,i=s.shape,o=Array.from(i);for(let l=r.length-1;l>=0;l--)if(r[l]===i[l])o[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>Ze(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vNe={kernelName:Py,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wNe={kernelName:Fy,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TNe={kernelName:Ly,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:r,clipValueMax:i}=t;return{x:()=>xr(Il(rd(s,r),Ap(s,i)),n,Lt(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xNe={kernelName:bT,inputsToSave:["x"],gradFunc:m8.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SNe={kernelName:vT,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(l=>l.shape),{axis:r}=t,i=xt(r,e[0].shape)[0],o=s.map(l=>l[i]);return _i(n,o,i).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Ne={kernelName:wT,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{dilations:i,strides:o,pad:a,dataFormat:l}=t;return q(Hh(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>qk(s.shape,n,r,o,a,l),filter:()=>a2(s,n,r.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ENe={kernelName:TT,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{strides:i,pad:o,dataFormat:a,dimRoundingMode:l}=t;return{dy:()=>Wh(n,r,i,o,a,1,l),filter:()=>a2(n,s,r.shape,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function INe(n,e,t,s,r){let i=n;n.rank===4&&(i=ce(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=e;o.rank===4&&(o=ce(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),q(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),q(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),q(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),q(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),q(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:i,dy:o},l={strides:s,pad:r,filterShape:t};return le.runKernel(ak,a,l)}const CNe=he({conv3DBackpropFilter_:INe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NNe={kernelName:xT,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:i}=t;q(Hh(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,a]=e;return{x:()=>s9(o.shape,n,a,r,i),filter:()=>CNe(o,n,a.shape,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ANe={kernelName:Vy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(Kn(w9(Ge(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kNe={kernelName:By,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(T9(Ge(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Ne={kernelName:ST,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r,exclusive:i,reverse:o}=t;return{x:()=>{const a=zn([r],s.rank);let l=i9(n,r,i,!o);return a!=null&&(l=Ft(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RNe={kernelName:_T,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:i,dimRoundingMode:o}=t,a=s??[1,1];q(Hh(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;return q(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),q(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),q(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),q(ar(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),Vr("depthwiseConv2d",i,o),{x:()=>XIe(l.shape,n,u,r,i,a,o),filter:()=>WIe(l,n,u.shape,r,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DNe={kernelName:ET,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,i={x:s,filter:r,dy:n},o={x:s,filter:r,dy:n};return{x:()=>le.runKernel(WI,i,t),filter:()=>le.runKernel(KI,o,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MNe={kernelName:zy,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>le.runKernel(gk,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ONe={kernelName:Gy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=ae(Ma(Kn(An(t))),2/Math.sqrt(Math.PI));return{x:()=>ae(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PNe={kernelName:Hy,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FNe={kernelName:CT,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>ce(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LNe={kernelName:qy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(n,Ma(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VNe={kernelName:Wy,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BNe={kernelName:Ky,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=pt(t.shape,s.shape);return{a:()=>{const a=nt(n,Ge(s,"float32")),l=Ss(t.shape,r);return l.length>0?ce(Ze(a,l),t.shape):a},b:()=>{let a=ae(n,Ge(t,"float32"));const l=Ss(s.shape,r);l.length>0&&(a=ce(Ze(a,l),s.shape));const u=An(s);return Kn(nt(a,Ge(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UNe={kernelName:NT,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[r,i,o,a]=e,l=a??Yt(1),u=Ss(i.shape,r.shape),h=[];if(i.rank===1){for(let A=0;A<r.shape.length-1;++A)h.push(r.shape[A]);h.push(1)}const f=rt(r,i),p=ae(n,l),g=y9(Pe(o,Yt(s))),b=ae(ae(ae(g,g),g),Yt(-.5));return{x:()=>i.rank===1?ce(ae(ae(n,Co(ce(g,[1,1,1,i.shape[0]]),h)),l),r.shape):ce(ae(ae(n,g),l),r.shape),mean:()=>{let A=ae(ae(g,Yt(-1)),p);return i.rank===1&&(A=Ze(A,u)),ce(A,i.shape)},variance:()=>{let A=ae(ae(b,f),p);return i.rank===1&&(A=Ze(A,u)),ce(A,i.shape)},scale:()=>{const A=ae(f,g);let P=ae(n,A);return i.rank===1&&(P=Ze(P,u)),ce(P,i.shape)},offset:()=>{let A=n;return i.rank===1&&(A=Ze(A,u)),ce(A,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zNe={kernelName:AT,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,r]=e,{axis:i,batchDims:o}=t,a=xt(i,s.shape)[0],l=(u,h,f)=>()=>{const p=u.shape,g=h.size,b=p.slice(0,a),T=b.length,w=p.slice(i,p.length).slice(1),_=w.length,C=uL(0,T),N=uL(T+1,T+1+_),A=cL([b,[g],w]),P=ce(f,A),V=ce(h,[g]),D=cL([[T],C,N]),M=Ft(P,D);let $=I9(M,V,u.shape[a]);const O=Ec(D);return $=Ft($,O),$};if(o===1){const u=s.shape[0],h=s.split(u,0);return{x:()=>Cl(h.map((g,b)=>l(g,r.slice(b,1),n.slice(b,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,n),indices:()=>r}}};function uL(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function cL(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GNe={kernelName:Xy,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>Lt(t),b:()=>Lt(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HNe={kernelName:Yy,gradFunc:n=>({x:()=>Ge(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qNe={kernelName:Jy,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WNe={kernelName:jy,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KNe={kernelName:Qy,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XNe={kernelName:$T,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:r}=t,i=Ci(s,0);return{x:()=>xr(i,n,ae(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YNe={kernelName:eb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>nt(n,Pe(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JNe={kernelName:Zy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>nt(n,Ge(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jNe={kernelName:JTe,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;return{logits:()=>{const o=Ma(s);return rt(n,ae(Ze(n,r,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QNe(n,e,t,s=5,r=1,i=1,o=.5){const a={x:n,y:e,dy:t},l={depthRadius:s,bias:r,alpha:i,beta:o};return le.runKernel(xk,a,l)}const ZNe=he({localResponseNormalizationBackprop_:QNe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eAe={kernelName:FT,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{depthRadius:i,bias:o,alpha:a,beta:l}=t;return{x:()=>ZNe(s,r,n,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g8(n,e,t,s){return e.rank<t.rank&&(e=ce(e,os(e.shape,s))),n.rank<t.rank&&(n=ce(n,os(n.shape,s))),{x:()=>ae(n,Ge(Da(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hL={kernelName:LT,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:r}=s,i=e[0],o=e[1],a=xt(r,i.shape),l=g8(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tAe={kernelName:tb,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>ae(n,Ge(rd(t,s),"float32")),b:()=>ae(n,Ge(ew(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nAe(n,e,t,s,r,i,o){const a=J(n,"dy","maxPool3dGrad"),l=J(e,"input","maxPool3dGrad"),u=J(t,"output","maxPool3dGrad");let h=a,f=l,p=u,g=!1;l.rank===4&&(g=!0,h=ce(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),f=ce(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=ce(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),q(h.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${h.rank}.`),q(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),q(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),Vr("maxPool3dGrad",i,o);const b={dy:h,input:f,output:p},T={filterSize:s,strides:r,pad:i,dimRoundingMode:o},w=le.runKernel(_k,b,T);return g?ce(w,[w.shape[1],w.shape[2],w.shape[3],w.shape[4]]):w}const sAe=he({maxPool3dGrad_:nAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rAe={kernelName:BT,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=t;return{x:()=>sAe(n,s,r,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iAe(n,e,t,s,r,i,o){const a=J(n,"dy","maxPoolGrad"),l=J(e,"input","maxPoolGrad"),u=J(t,"output","maxPoolGrad");q(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),q(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),q(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Vr("maxPoolGrad",i,o);const h={dy:a,input:l,output:u},f={filterSize:s,strides:r,pad:i,dimRoundingMode:o};return le.runKernel(Sk,h,f)}const oAe=he({maxPoolGrad_:iAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aAe={kernelName:VT,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a}=t;return{x:()=>oAe(n,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lAe={kernelName:UT,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t,i=xt(r,s.shape),a=Ds(s.shape,i)[1],l=Ee(a);return{x:()=>{const h=s.shape.slice();i.forEach(g=>{h[g]=1});const f=ce(n,h);return nt(ae(f,Cc(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uAe={kernelName:zT,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:r}=s,[i,o]=e,a=xt(r,i.shape),l=g8(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cAe={kernelName:nb,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>ae(n,Ge(Ap(t,s),"float32")),b:()=>ae(n,Ge(Ci(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hAe={kernelName:GT,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,i=r.map(o=>o[0]);return{x:()=>_n(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dAe={kernelName:sb,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=pt(t.shape,s.shape);return{a:()=>{const a=Ss(t.shape,r);return a.length>0?ce(Ze(n,a),t.shape):n},b:()=>{const a=ae(n,Kn(bx(nt(t,s)))),l=Ss(s.shape,r);return l.length>0?ce(Ze(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fAe={kernelName:rb,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=pt(t.shape,s.shape);return{a:()=>{const a=ae(n,Ge(s,"float32")),l=Ss(t.shape,r);return l.length>0?ce(Ze(a,l),t.shape):a},b:()=>{const a=ae(n,Ge(t,"float32")),l=Ss(s.shape,r);return l.length>0?ce(Ze(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pAe={kernelName:HT,gradFunc:n=>({x:()=>Kn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mAe={kernelName:KT,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>ks(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gAe={kernelName:WT,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yAe={kernelName:XT,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return Xh(n,s).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dL={kernelName:YT,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,i=r.map(o=>o[0]);return{x:()=>_n(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bAe={kernelName:ib,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,r]=e,i=t,o=s,a=pt(i.shape,o.shape);return{a:()=>{const h=Ge(o,"float32");let f=ae(n,ae(h,ep(i,rt(h,Yt(1)))));const p=Ss(i.shape,a);return p.length>0&&(f=Ze(f,p)),ce(f,i.shape)},b:()=>{const h=Ci(i,0),f=xr(h,Oa(i),Lt(i));let p=ae(n,ae(r,f));const g=Ss(o.shape,a);return g.length>0&&(p=Ze(p,g)),ce(p,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vAe={kernelName:JT,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,r=Ci(t,0);return{x:()=>xr(r,n,ae(n,s)),alpha:()=>{let i=xr(r,Lt(n),ae(n,t));const o=Ss(s.shape,n.shape);return o.length>0&&(i=Ze(i,o)),ce(i,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wAe(n,e,t){const s=n.shape.slice();s[t]=1;const r=ce(e,s),i=iC(n,t,!0,!1),o=iC(n,t,!0,!0),a=ae(i,o);return ae(r,a)}function TAe(n,e,t){const s=n.shape.length,r=s-t.length,i=zn(t,s);let o=n;i!=null&&(o=Ft(n,i));const a=o.shape.slice(),u=a.splice(s-t.length,t.length).reduce((p,g)=>p*g,1);a.push(u);const h=o.reshape(a);let f=wAe(h,e,r);if(f=f.reshape(o.shape),i!=null){const p=Ec(i);f=Ft(f,p)}return f}const xAe={kernelName:jT,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;let i=[];return r==null?i=s.shape.map((o,a)=>a):typeof r=="number"?i=[r]:i=r,{x:()=>TAe(s,n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SAe={kernelName:Uy,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=pt(t.shape,s.shape);return{a:()=>{const a=nt(n,Ge(s,"float32")),l=Ss(t.shape,r);return l.length>0?ce(Ze(a,l),t.shape):a},b:()=>{let a=ae(n,Ge(t,"float32"));const l=Ss(s.shape,r);l.length>0&&(a=ce(Ze(a,l),s.shape));const u=An(s);return Kn(nt(a,Ge(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Ae={kernelName:ob,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>nt(n,Kn(An(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EAe={kernelName:lb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=ae(Ap(t,6),Nb(t));return{x:()=>ae(n,Ge(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IAe={kernelName:ab,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(n,Ge(Nb(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CAe={kernelName:QT,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ce(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NAe={kernelName:ex,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>le.runKernel($k,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AAe={kernelName:ZT,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>le.runKernel(kk,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kAe={kernelName:tx,gradFunc:(n,e,t)=>{const{dims:s}=t,r=xt(s,n.shape);return{x:()=>Kh(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Ae={kernelName:ub,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RAe={kernelName:cb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Kn(nt(n,ae(ep(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DAe={kernelName:nx,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>Ge(Lt(t),"float32"),t:()=>ae(n,Ge(t,n.dtype)),e:()=>ae(n,Ge(Qk(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MAe={kernelName:hb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Ci(t,Yt(0)),r=Yt(Tx),i=Yt(xx),o=ae(n,i),a=ae(ae(n,r),Ma(Ge(t,"float32")));return xr(s,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OAe={kernelName:mb,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(n,ae(t,rt(Yt(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PAe={kernelName:pb,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FAe={kernelName:db,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(Wk(Ge(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LAe={kernelName:fb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(r9(Ge(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VAe={kernelName:sx,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:r,size:i}=t,o=s.shape,[a,l]=vx(s,r,i),u=[];for(let h=0;h<n.rank;h++)u.push([a[h],o[h]-a[h]-l[h]]);return{x:()=>t2(n,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BAe={kernelName:ax,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:r}=t,i=!0,o=ae(n,s);return{logits:()=>rt(o,ae(Ze(o,[r],i),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UAe={kernelName:gb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(n,Np(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fL={kernelName:ix,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:r}=t;return{x:()=>Hk(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pL={kernelName:ox,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>Mr(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zAe={kernelName:yb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>nt(n,ae(_r(Ge(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GAe={kernelName:Rk,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(n,ae(Ge(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HAe={kernelName:bb,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Yt(2);return{a:()=>ae(n,ae(r,rt(t,s))),b:()=>ae(n,ae(r,rt(s,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qAe={kernelName:Sb,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WAe={kernelName:vb,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=pt(t.shape,s.shape);return{a:()=>{let a=n;const l=Ss(t.shape,r);return l.length>0&&(a=Ze(a,l)),ce(a,t.shape)},b:()=>{let a=n;const l=Ss(s.shape,r);return l.length>0&&(a=Ze(a,l)),ce(Kn(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KAe={kernelName:rx,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,r=s.shape.slice(),{axis:i}=t;xt(i,s.shape).forEach(u=>{r[u]=1});const a=ce(n,r),l=ae(a,Cc(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XAe={kernelName:wb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>nt(n,An(Wk(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YAe={kernelName:Tb,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ae(rt(Yt(1),An(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JAe={kernelName:xb,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:r}=t;return{x:()=>{let o=Lt(s);if(s.rank===1)for(let a=0;a<r[0];++a)o=Pe(o,_n(n,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)o=Pe(o,_n(n,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)o=Pe(o,_n(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)for(let h=0;h<r[3];++h)o=Pe(o,_n(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2],h*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jAe={kernelName:$f,gradFunc:(n,e,t)=>{const s=t,{perm:r}=s,i=Ec(r);return{x:()=>Ft(n,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QAe={kernelName:lx,gradFunc:(n,e,t)=>{const s=t,{axis:r}=s;return{value:()=>Cl(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZAe={kernelName:ux,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>eke(n,t)}}};function eke(n,e){const t=Ic(e,Lt(e)),s=Yk(n,t);let r=rd(e,Yt(0,"int32"));const i=s.rank-r.rank;for(let a=0;a<i;++a)r=$r(r,a+1);r=Il(r,Cc(s.shape,"bool"));const o=Lt(s);return xr(r,s,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tke={kernelName:cx,gradFunc:n=>({x:()=>Lt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nke=[m8,ZCe,eNe,tNe,nNe,sNe,rNe,iNe,oNe,aNe,lNe,uNe,dNe,mNe,gNe,yNe,bNe,vNe,wNe,TNe,xNe,SNe,ENe,_Ne,NNe,ANe,kNe,$Ne,RNe,DNe,SAe,MNe,ONe,PNe,FNe,LNe,BNe,VNe,UNe,zNe,GNe,HNe,qNe,WNe,KNe,XNe,YNe,JNe,jNe,eAe,hL,hL,tAe,rAe,aAe,lAe,uAe,cAe,hAe,dAe,fAe,pAe,mAe,gAe,yAe,dL,dL,bAe,vAe,xAe,_Ae,EAe,IAe,CAe,NAe,AAe,kAe,$Ae,RAe,DAe,MAe,OAe,PAe,FAe,LAe,VAe,BAe,UAe,fL,fL,pL,pL,zAe,HAe,GAe,qAe,WAe,KAe,XAe,YAe,JAe,jAe,QAe,ZAe,tke];for(const n of nke)ZTe(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.abs=function(){return this.throwIfDisposed(),pr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.acos=function(){return this.throwIfDisposed(),Zxe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.acosh=function(){return this.throwIfDisposed(),tSe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.add=function(n){return this.throwIfDisposed(),Pe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.all=function(n,e){return this.throwIfDisposed(),e9(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.any=function(n,e){return this.throwIfDisposed(),sC(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.argMax=function(n){return this.throwIfDisposed(),Gg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.argMin=function(n){return this.throwIfDisposed(),oSe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.asScalar=function(){return this.throwIfDisposed(),q(this.size===1,()=>"The array must have only 1 element."),ce(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.asType=function(n){return this.throwIfDisposed(),Ge(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.as1D=function(){return this.throwIfDisposed(),ce(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.as2D=function(n,e){return this.throwIfDisposed(),ce(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),ce(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),ce(this,[n,e,t,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.as5D=function(n,e,t,s,r){return this.throwIfDisposed(),ce(this,[n,e,t,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.asin=function(){return this.throwIfDisposed(),lSe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.asinh=function(){return this.throwIfDisposed(),cSe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.atan=function(){return this.throwIfDisposed(),dSe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.atan2=function(n){return this.throwIfDisposed(),pSe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.atanh=function(){return this.throwIfDisposed(),gSe(this)};_e().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),zk(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),Hk(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.batchNorm=function(n,e,t,s,r){return this.throwIfDisposed(),px(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.broadcastTo=function(n){return this.throwIfDisposed(),gg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.cast=function(n){return this.throwIfDisposed(),Ge(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.ceil=function(){return this.throwIfDisposed(),GSe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),Ii(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof gs&&(n=[n]),Mr([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.conv1d=function(n,e,t,s,r,i){return this.throwIfDisposed(),t9(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.conv2dTranspose=function(n,e,t,s,r){return this.throwIfDisposed(),n9(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.conv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),Wh(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.cos=function(){return this.throwIfDisposed(),Wk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.cosh=function(){return this.throwIfDisposed(),r9(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),iC(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),i9(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),p_e(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.depthwiseConv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),Kk(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.dilation2d=function(n,e,t,s,r){return this.throwIfDisposed(),y_e(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.divNoNan=function(n){return this.throwIfDisposed(),x_e(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.div=function(n){return this.throwIfDisposed(),nt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.dot=function(n){return this.throwIfDisposed(),__e(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.elu=function(){return this.throwIfDisposed(),gx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.equal=function(n){return this.throwIfDisposed(),Da(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.erf=function(){return this.throwIfDisposed(),N_e(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),F_e(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.exp=function(){return this.throwIfDisposed(),Ma(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.expandDims=function(n){return this.throwIfDisposed(),$r(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.expm1=function(){return this.throwIfDisposed(),U_e(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.fft=function(){return this.throwIfDisposed(),S9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.flatten=function(){return this.throwIfDisposed(),ce(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.floor=function(){return this.throwIfDisposed(),bx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.floorDiv=function(n){return this.throwIfDisposed(),Z5(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.gather=function(n,e,t){return this.throwIfDisposed(),Yk(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.greaterEqual=function(n){return this.throwIfDisposed(),rd(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.greater=function(n){return this.throwIfDisposed(),Ci(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.ifft=function(){return this.throwIfDisposed(),oC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.irfft=function(){return this.throwIfDisposed(),gIe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.isFinite=function(){return this.throwIfDisposed(),J_e(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.isInf=function(){return this.throwIfDisposed(),Q_e(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.isNaN=function(){return this.throwIfDisposed(),eEe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.leakyRelu=function(n){return this.throwIfDisposed(),jk(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.lessEqual=function(n){return this.throwIfDisposed(),Ap(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.less=function(n){return this.throwIfDisposed(),ew(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),iEe(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.logSigmoid=function(){return this.throwIfDisposed(),dEe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.logSoftmax=function(n){return this.throwIfDisposed(),c9(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),h9(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.log=function(){return this.throwIfDisposed(),Oa(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.log1p=function(){return this.throwIfDisposed(),u9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.logicalAnd=function(n){return this.throwIfDisposed(),Il(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.logicalNot=function(){return this.throwIfDisposed(),Qk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.logicalOr=function(n){return this.throwIfDisposed(),d9(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.logicalXor=function(n){return this.throwIfDisposed(),wEe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),Xt(this,n,e,t)};_e().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),Zk(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.max=function(n,e){return this.throwIfDisposed(),$o(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.maximum=function(n){return this.throwIfDisposed(),Ic(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.mean=function(n,e){return this.throwIfDisposed(),ss(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.min=function(n,e){return this.throwIfDisposed(),Zv(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.minimum=function(n){return this.throwIfDisposed(),Wg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),NEe(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.mod=function(n){return this.throwIfDisposed(),kEe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.mul=function(n){return this.throwIfDisposed(),ae(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.neg=function(){return this.throwIfDisposed(),Kn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.norm=function(n,e,t){return this.throwIfDisposed(),yx(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.notEqual=function(n){return this.throwIfDisposed(),tw(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),f9(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.onesLike=function(){return this.throwIfDisposed(),eo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.pad=function(n,e){return this.throwIfDisposed(),t2(this,n,e)};_e().prototype.pool=function(n,e,t,s,r,i){return this.throwIfDisposed(),BEe(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.pow=function(n){return this.throwIfDisposed(),ep(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.prelu=function(n){return this.throwIfDisposed(),s2(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.prod=function(n,e){return this.throwIfDisposed(),GEe(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.reciprocal=function(){return this.throwIfDisposed(),JEe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.relu=function(){return this.throwIfDisposed(),id(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.relu6=function(){return this.throwIfDisposed(),m9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.reshapeAs=function(n){return this.throwIfDisposed(),ce(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.reshape=function(n){return this.throwIfDisposed(),ce(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),N9(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),A9(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.reverse=function(n){return this.throwIfDisposed(),Kh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.rfft=function(){return this.throwIfDisposed(),vIe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.round=function(){return this.throwIfDisposed(),g9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.rsqrt=function(){return this.throwIfDisposed(),y9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.selu=function(){return this.throwIfDisposed(),b9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.separableConv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),v9(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.sigmoid=function(){return this.throwIfDisposed(),Np(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.sign=function(){return this.throwIfDisposed(),iIe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.sin=function(){return this.throwIfDisposed(),w9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.sinh=function(){return this.throwIfDisposed(),T9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.slice=function(n,e){return this.throwIfDisposed(),_n(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.softmax=function(n){return this.throwIfDisposed(),o2(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.softplus=function(){return this.throwIfDisposed(),Eb(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),n2(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.split=function(n,e){return this.throwIfDisposed(),_i(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.sqrt=function(){return this.throwIfDisposed(),_r(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.square=function(){return this.throwIfDisposed(),An(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.squaredDifference=function(n){return this.throwIfDisposed(),TIe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.squeeze=function(n){return this.throwIfDisposed(),Cb(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof gs?[this,n]:[this,...n];return Cl(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.step=function(n){return this.throwIfDisposed(),Nb(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.stridedSlice=function(n,e,t,s,r,i,o,a){return this.throwIfDisposed(),IIe(this,n,e,t,s,r,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.sub=function(n){return this.throwIfDisposed(),rt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.sum=function(n,e){return this.throwIfDisposed(),Ze(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.tan=function(){return this.throwIfDisposed(),NIe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.tanh=function(){return this.throwIfDisposed(),Gk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.tile=function(n){return this.throwIfDisposed(),Co(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.toBool=function(){return this.throwIfDisposed(),Ge(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.toFloat=function(){return this.throwIfDisposed(),Ge(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.toInt=function(){return this.throwIfDisposed(),Ge(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.topk=function(n,e){return this.throwIfDisposed(),$Ie(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.transpose=function(n){return this.throwIfDisposed(),Ft(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.unique=function(n){return this.throwIfDisposed(),MIe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),I9(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.unstack=function(n){return this.throwIfDisposed(),Xh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.where=function(n,e){return this.throwIfDisposed(),xr(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_e().prototype.zerosLike=function(){return this.throwIfDisposed(),Lt(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ha extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ha.prototype)}}class Xi extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Xi.prototype)}}class ie extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ie.prototype)}}class bt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,bt.prototype)}}class z2 extends Error{constructor(e){super(e),Object.setPrototypeOf(this,z2.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class y8{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Yh(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function da(n,e){if(!n)throw new z2(e)}function mL(n,e){let t=0;for(const s of n)s===e&&t++;return t}function Rr(n){return n.length===1?n[0]:n}function rn(n){return Array.isArray(n)?n:[n]}function ll(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function gh(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let zi={};function G2(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function uC(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>uC(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:uC(s))}}}function Rb(n,e={},t={},s="object",r=!1){if(typeof n=="string"){const i=n;let o;if(i in t)o=t[i];else if(i in zi)o=zi[i];else if(o=e[i],o==null)throw new ie(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=n;if(i.className==null||i.config==null)throw new ie(`${s}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let a,l;if(o in t?[a,l]=t[o]:o in zi?[a,l]=zi.className:o in e&&([a,l]=e[o]),a==null)throw new ie(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const g of Object.keys(zi))u[g]=zi[g];for(const g of Object.keys(t))u[g]=t[g];const h=i.config;h.customObjects=u;const f=Object.assign({},zi);for(const g of Object.keys(t))zi[g]=t[g];uC(i.config);const p=l(a,i.config,t,r);return zi=Object.assign({},f),p}else{const u=Object.assign({},zi);for(const f of Object.keys(t))zi[f]=t[f];const h=new a(i.config);return zi=Object.assign({},u),h}}}function ske(n,e){return n<e?-1:n>e?1:0}function C1(n,e){return-1*ske(n,e)}function Wu(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function rke(n){if(n==null)throw new ie(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function ad(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new ie(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function H2(n,e,t=0,s=1/0){return da(t>=0),da(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(r=>typeof r===e)}function $s(n,e){Array.isArray(n)?(q(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>$s(t,`element ${s+1} of ${e}`))):q(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${b8(n)}.`)}function b8(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>b8(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function ike(n,e,t){let s=t!=null?t():kr(),r;return(...o)=>{const a=t!=null?t():kr();return a-s<e||(s=a,r=n(...o)),r}}function v8(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let oke=0;function w8(){return oke++}const N1={};function Sx(n=""){return n in N1||(N1[n]=0),N1[n]+=1,n+N1[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const ake=["channelsFirst","channelsLast"],lke=["nearest","bilinear"],uke=["valid","same","causal"],cke=["max","avg"],hke=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const nf=new Map;function Jn(n){ad(ake,"DataFormat",n)}function dke(n){ad(lke,"InterpolationFormat",n)}function Ni(n){ad(uke,"PaddingMode",n)}function T8(n){ad(cke,"PoolMode",n)}const yg=[],gL="/";function Ch(n,e){yg.push(n);try{const t=e();return yg.pop(),t}catch(t){throw yg.pop(),t}}function fke(){return yg.length===0?"":yg.join(gL)+gL}function x8(n){if(!_8(n))throw new Error("Not a valid tensor name: '"+n+"'");return fke()+n}function S8(n){if(!_8(n))throw new Error("Not a valid tensor name: '"+n+"'");nf.has(n)||nf.set(n,0);const e=nf.get(n);if(nf.set(n,nf.get(n)+1),e>0){const t=`${n}_${e}`;return nf.set(t,1),t}else return n}const pke=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function _8(n){return!!n.match(pke)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mke(n){return n===parseInt(n.toString(),10)}function Ku(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let r=e;r<t;++r)s*=n[r];return s}function np(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function cc(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function Oo(n,e){if(e<n)throw new ie(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let mE;function vs(){return mE==null&&(mE=Sxe().epsilon()),mE}function Po(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ea(n,e){return Ge(n,e)}function Db(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),ce(n,t)}function gke(n,e){return ge(()=>{if(n.shape.length!==2)throw new ie(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=Db(n,1);return cC(t,[1,e,1])})}function yke(n){const e=[Ku(n.shape)];return ce(n,e)}function bke(n){if(n.rank<=1)throw new ie(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],Ku(n.shape,1)];return ce(n,e)}function Nh(n,e,t){return ge(()=>{switch(n.rank){case 1:return r2(n,e,t);case 2:return x9(n,[e,0],[t,n.shape[1]]);case 3:return i2(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return sw(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return _n(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return _n(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new ie(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function gE(n,e,t){return ge(()=>{switch(n.rank){case 1:return r2(n,e,t);case 2:return x9(n,[0,e],[n.shape[0],t]);case 3:return i2(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return sw(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new ie(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function A1(n,e,t,s){return ge(()=>{switch(n.rank){case 1:return r2(n,e,t);case 2:switch(s){case 1:return Nh(n,e,t);case 2:return gE(n,e,t);default:throw new ie(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Nh(n,e,t);case 2:return i2(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return gE(n,e,t);default:throw new ie(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Nh(n,e,t);case 2:return sw(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return sw(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return gE(n,e,t);default:throw new ie(`The axis is not within the rank of the tensor ${s}`)}default:throw new ie(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function q2(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),Mr(n,e)}function yL(n,e){switch(n.rank){case 1:return WSe([n,e]);case 2:return XSe([n,e],0);case 3:return JSe([n,e],0);case 4:return QSe([n,e],0);default:throw new ie(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function cC(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new ie(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return Co(n,e)}function _x(n,e=0,t=1,s,r){return WEe(n,e,t,s,r)}function Ia(n,e,t,s){if(n.rank<2||e.rank<2)throw new bt(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(r!==i)throw new bt(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return sL({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?hC(n.rank,s,Po()):null,activation:t});{const r=n.shape.slice(),i=r.pop();n=ce(n,[-1,i]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),u=[...o,a],h=Array.from({length:e.rank},(b,T)=>T===0?e.rank-2:T<=e.rank-2?T-1:T);e=ce(Ft(e,h),[l,-1]);const f=[...r,...u];return ce(sL({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?hC(n.rank,s,Po()):null,activation:t}),f)}}function E8(n,e,t){return ge(()=>(Array.isArray(e)?e=ii(e,"int32"):e=Ge(e,"int32"),Yk(n,e,t)))}function Mb(n){return ae(n,n)}function hC(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new ie(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?ce(e,[1,s[0],1,1,1]):ce(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?ce(e,[1,1,1,1,s[0]]):ce(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?ce(e,[1,s[0],1,1]):ce(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?ce(e,[1,1,1,s[0]]):ce(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?ce(e,[1,s[0],1]):ce(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?ce(e,[1,1,s[0]]):ce(e,[1].concat(s))}else if(n<3)return e;throw new ie(`Unsupported input rank by biasAdd: ${e.rank}`)}function Vo(n,e,t){return ge(()=>(t==null&&(t=Po()),Jn(t),Pe(n,hC(n.rank,e,t))))}function vke(n,e=1){if(e!==1)throw new bt(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return gx(n)}function wke(n){return ge(()=>nt(n,Pe(pr(n),1)))}function I8(n,e,t,s){return ge(()=>UIe(n,e,t,s))}function Tke(n){return ge(()=>{const e=Pe(.5,ae(.2,n));return Ii(e,0,1)})}function Ob(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const xke=["fanIn","fanOut","fanAvg"],Ske=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _ke(n){ad(xke,"FanMode",n)}function Eke(n){ad(Ske,"Distribution",n)}class so extends $p{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class C8 extends so{apply(e,t){return ks(e,t)}}C8.className="Zeros";Oe(C8);class W2 extends so{apply(e,t){return Cc(e,t)}}W2.className="Ones";Oe(W2);class N8 extends so{constructor(e){if(super(),typeof e!="object")throw new ie(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new ie(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return ge(()=>ae(Yt(this.value),Cc(e,t)))}getConfig(){return{value:this.value}}}N8.className="Constant";Oe(N8);class A8 extends so{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return Ib(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}A8.className="RandomUniform";Oe(A8);class k8 extends so{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new bt(`randomNormal does not support dType ${t}.`);return _x(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}k8.className="RandomNormal";Oe(k8);class $8 extends so{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new bt(`truncatedNormal does not support dType ${t}.`);return E9(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}$8.className="TruncatedNormal";Oe($8);class R8 extends so{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return ge(()=>{if(e.length!==2||e[0]!==e[1])throw new ie("Identity matrix initializer can only be used for 2D square matrices.");return ae(this.gain,l9(e[0]))})}getConfig(){return{gain:this.gain}}}R8.className="Identity";Oe(R8);function Ike(n,e="channelsLast"){let t,s;if(Jn(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=Ku(n,2);t=n[1]*r,s=n[0]*r}else if(e==="channelsLast"){const r=Ku(n,0,n.length-2);t=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=Ku(n);t=Math.sqrt(r),s=Math.sqrt(r)}return[t,s]}class li extends so{constructor(e){if(super(),e.scale<0)throw new ie(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,_ke(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,Eke(this.distribution),this.seed=e.seed}apply(e,t){const s=Ike(e),r=s[0],i=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,r):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new bt(`${this.getClassName()} does not support dType ${t}.`);return E9(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*o);return Ib(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}li.className="VarianceScaling";Oe(li);class K2 extends li{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return li.className}}K2.className="GlorotUniform";Oe(K2);class X2 extends li{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return li.className}}X2.className="GlorotNormal";Oe(X2);class Y2 extends li{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return li.className}}Y2.className="HeNormal";Oe(Y2);class J2 extends li{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return li.className}}J2.className="HeUniform";Oe(J2);class j2 extends li{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return li.className}}j2.className="LeCunNormal";Oe(j2);class Q2 extends li{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return li.className}}Q2.className="LeCunUniform";Oe(Q2);class D8 extends so{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return ge(()=>{if(e.length<2)throw new bt("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const s=Ee(e.slice(0,-1)),r=e[e.length-1],i=s*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(r,s),Math.min(r,s)],a=_x(o,0,1,t,this.seed),l=FCe.qr(a,!1);let u=l[0];const f=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return u=ae(u,f.sign()),s<r&&(u=u.transpose()),ae(Yt(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}D8.className="Orthogonal";Oe(D8);const bL={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function vL(n,e={}){return Rb(n,Ki.getMap().classNameMap,e,"initializer")}function Bn(n){return G2(n)}function On(n){if(typeof n=="string"){const e=n in bL?bL[n]:n;if(e==="GlorotNormal")return new X2;if(e==="GlorotUniform")return new K2;if(e==="HeNormal")return new Y2;if(e==="HeUniform")return new J2;if(e==="LeCunNormal")return new j2;if(e==="LeCunUniform")return new Q2;{const t={};return t.className=e,t.config={},vL(t)}}else return n instanceof so?n:vL(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function dC(n){return Array.isArray(n)&&Array.isArray(n[0])}function rw(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function at(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new ie(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function Gt(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new ie(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function iw(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const wL="Variable";class Cke{constructor(e,t="float32",s=wL,r=!0,i=null){this.dtype=t??"float32",this.shape=e.shape,this.id=w8(),s=s??wL,this.originalName=x8(s),this.name=S8(this.originalName),this.trainable_=r,this.constraint=i,this.val=FIe(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),Nke(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function Nke(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function fC(n){return n.map(e=>e.read())}function Z2(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ws{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Pa{constructor(e,t,s,r,i,o,a){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=w8(),o!=null&&(this.originalName=x8(o),this.name=S8(this.originalName)),this.rank=t.length}}let Ake=0;class Ex{constructor(e,t){this.callArgs=t,this.id=Ake++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let kke=0;class St extends $p{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=kke++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=ll(s)+"_"+Sx(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),s=[i].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Xi(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new ie(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Rr(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Rr(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new ha(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new ha(`Layer ${this.name} is not connected, no input to return.`);return Rr(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new ha(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new ha(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Rr(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=rn(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=rn(this.inputSpec);if(t.length!==s.length)throw new ie(`Layer ${this.name} expects ${s.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const i=t[r],o=s[r];if(o==null)continue;const a=i.rank;if(o.ndim!=null&&a!==o.ndim)throw new ie(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new ie(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new ie(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new ie(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const l=i.shape;for(const u in o.axes){const h=Number(u),f=o.axes[u],p=h>=0?l[h]:l[l.length+h];if(f!=null&&[f,null].indexOf(p)===-1)throw new ie(`Input ${r} is incompatible with layer ${this.name}: expected axis ${h} of input shape to have value ${f} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const u=o.shape[l],h=i.shape[l];if(u!=null&&h!=null&&u!==h)throw new ie(`Input ${r} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=rn(e),r=Dke(e),i=Mke(e);if(r===i)throw new ie("Arguments to apply() must be all SymbolicTensors or all Tensors");return Ch(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of rn(e))o.push(a.shape);this.build(Rr(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let o=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,o);const a=rn(o),l=[];for(let u of a)s.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(o=Rr(l),this.activityRegularizer!=null)throw new bt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=$ke(e),a=this.computeOutputShape(o);let l;const u=Rke(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((h,f)=>new Pa(u,h,this,rn(e),t,this.name,f)):l=new Pa(u,a,this,rn(e),t,this.name),this.addInboundNode(e,l,null,null,o,a,t),this._refCount++,this.activityRegularizer!=null)throw new bt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new ha(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new ha(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Xi(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return iw(this.weights)}build(e){this.built=!0}getWeights(e=!1){return fC(e?this.trainableWeights:this.weights)}setWeights(e){ge(()=>{const t=this.weights;if(t.length!==e.length)throw new ie(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],r=fC(t);for(let i=0;i<r.length;++i){const o=r[i],a=t[i],l=e[i];if(!jt(o.shape,l.shape))throw new ie(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}Z2(s)})}addWeight(e,t,s,r,i,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new ie(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():On("zeros"));const u=r.apply(t,s),h=new Cke(u,s,e,o,a);return u.dispose(),i!=null&&this.addLoss(()=>i.apply(h.read())),o==null&&(o=!0),o?this._trainableWeights.push(h):this._nonTrainableWeights.push(h),h}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=rn(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),i=rn(t),o=rn(r);if(i.length!==o.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let a=0;a<i.length;a++)i[a].kerasMask=o[a]}addInboundNode(e,t,s,r,i,o,a=null){const l=rn(e);t=rn(t),s=rn(s),r=rn(r),i=rw(i),o=rw(o);const u=[],h=[],f=[];for(const p of l)u.push(p.sourceLayer),h.push(p.nodeIndex),f.push(p.tensorIndex);new Ex({outboundLayer:this,inboundLayers:u,nodeIndices:h,tensorIndices:f,inputTensors:l,outputTensors:t,inputMasks:s,outputMasks:r,inputShapes:i,outputShapes:o},a);for(let p=0;p<t.length;p++)t[p].sourceLayer=this,t[p].nodeIndex=this.inboundNodes.length-1,t[p].tensorIndex=p}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function $ke(n){n=rn(n);const e=[];for(const t of n)e.push(t.shape);return Rr(e)}function Rke(n){return"float32"}function M8(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let i=0;i<s.inboundLayers.length;i++){const o=s.inputTensors[i],a=s.inboundLayers[i],l=s.nodeIndices[i],u=M8(o,a,l);for(const h of u)r.indexOf(h)===-1&&r.push(h)}return r}}}function Dke(n){let e=!0;for(const t of rn(n))if(!(t instanceof Pa)){e=!1;break}return e}function Mke(n){let e=!0;for(const t of rn(n))if(t instanceof Pa){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Pb extends St{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Sx("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new ie("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new ie("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new ie("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const r=new Pa(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Ex({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new ie(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Pb.className="InputLayer";Oe(Pb);function Oke(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new ie("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new Pb({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Pke(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return Ge(e,n.dtype)}catch{throw new ie(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class Mu{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Mu)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=Pke(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new ie(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Pa){if(this.id2Value[e.id]==null)throw new ie(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new ie(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof Pa){if(this.id2Value[e.id]==null)throw new ie(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new ie(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&_t(this.id2Mask)}}const ow=new y8,aw=new y8;function Fke(n){ow!=null&&ow.setMaxEntries(n),aw!=null&&aw.setMaxEntries(n)}function sg(n,e,t,s){const r=t==null?!1:t.training,i=Array.isArray(n),o=i?n:[n],a=o.map(b=>b.name),l=[],u=e.names();for(const b of a)u.indexOf(b)!==-1?l.push(e.getValue(b)):l.push(null);const h=a.join(",")+"|"+e.names().sort().join(",");let f=ow.get(h),p;if(f==null){const b=Lke(o,e);f=b.sorted,p=b.recipientCounts,ow.put(h,f),aw.put(h,p)}p={},r||Object.assign(p,aw.get(h));const g=new Mu(e);for(let b=0;b<f.length;++b){const T=f[b],w=T.sourceLayer;if(w instanceof Pb)continue;const _=[],C=[],N=[];let A=!1;for(const $ of T.inputs){const O=g.getValue($),k=g.getMask($);_.push(O),C.push(k),k!=null&&(A=!0),r||(p[$.name]--,p[$.name]===0&&!e.hasKey($)&&a.indexOf($.name)===-1&&!O.isDisposed&&$.sourceLayer.stateful!==!0&&N.push(O))}A&&(t=t||{},t.mask=C[0]);const P=rn(w.apply(_,t));let V=null;w.supportsMasking&&(V=w.computeMask(_,C));const D=Bke(T),M=Array.isArray(D)?D:[D];for(let $=0;$<M.length;++$){g.hasKey(M[$])||g.add(M[$],P[$],Array.isArray(V)?V[0]:V);const O=a.indexOf(M[$].name);O!==-1&&(l[O]=P[$])}r||_t(N)}return g.disposeMasks(),i?l:l[0]}function Lke(n,e){q(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const r=TL(n[0],e);t=r.sorted,s=r.recipientMap}else{const r=new Set;for(const i of n){const{sorted:o,recipientMap:a}=TL(i,e);for(const l of o)r.has(l.name)||(t.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(u=>s[l].add(u))}}return{sorted:t,recipientCounts:Vke(s)}}function Vke(n){const e={};for(const t in n)e[t]=n[t].size;return e}function TL(n,e){const t=new Set,s=[],r={};for(const a of e.names())t.add(a);const i=[],o=[];for(i.push(n);i.length>0;){const a=i[i.length-1];if(t.has(a.name)){i.pop();continue}const l=o[o.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),s.push(a),t.add(a.name),l&&o.pop();else{o.push(i.length-1);for(const u of a.inputs)r[u.name]==null&&(r[u.name]=new Set),r[u.name].add(a.name),!t.has(u.name)&&i.push(u)}}return{sorted:s,recipientMap:r}}function Bke(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uke=we();Uke.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,Fke);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function e$(n,e){return ge(()=>_r(Ze(ae(n,n),e,!0)))}class Fb extends $p{getConfig(){return{}}}class O8 extends Fb{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ge(()=>{const t=e$(e,this.axis),s=Ii(t,0,this.maxValue);return ae(e,nt(s,Pe(vs(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}O8.className="MaxNorm";Oe(O8);class P8 extends Fb{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ge(()=>nt(e,Pe(vs(),e$(e,this.axis))))}getConfig(){return{axis:this.axis}}}P8.className="UnitNorm";Oe(P8);class F8 extends Fb{apply(e){return id(e)}}F8.className="NonNeg";Oe(F8);class L8 extends Fb{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ge(()=>{const t=e$(e,this.axis),s=Pe(ae(this.rate,Ii(t,this.minValue,this.maxValue)),ae(1-this.rate,t));return ae(e,nt(s,Pe(vs(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}L8.className="MinMaxNorm";Oe(L8);const xL={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Ts(n){return G2(n)}function SL(n,e={}){return Rb(n,Ki.getMap().classNameMap,e,"constraint")}function xs(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in xL?xL[n]:n,config:{}};return SL(t)}else return n instanceof Fb?n:SL(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function ah(n){if(n==null)return;const e=[],t=[],s=[];for(const r in n){const i=n[r];if(typeof i!="number"){const o=i;e.push(o.data()),t.push(r),s.push(o)}}if(e.length>0){const r=await Promise.all(e);for(let i=0;i<r.length;++i)n[t[i]]=r[i][0];_t(s)}}function V8(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var _L;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(_L||(_L={}));const zke=125;class Xg{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class Gke{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class Hke extends Xg{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const r in t){const i=t[r];if(typeof i=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+i*s;else{let o;r in this.totals?o=this.totals[r]:this.totals[r]=0;const a=ge(()=>Pe(this.totals[r],ae(i,s)));this.totals[r]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:ge(()=>{const r=ae(nt(1,this.seen),this.totals[s]);t[s]=r,this.totals[s].dispose(),Sa(t[s])}))}}class qke extends Xg{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const i in this.history){const o=this.history[i];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),t.push(i),s.push(a)}}const r=await Promise.all(e);for(let i=0;i<r.length;++i)this.history[t[i]][s[i]].dispose(),this.history[t[i]][s[i]]=r[i][0]}}class Wke extends Xg{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||H9,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=zke),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");GI(this.yieldEvery)&&(this.maybeWait=ike(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const r=[];this.yield!=null&&(await ah(s),r.push(this.yield(e,t,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await ah(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await ah(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await ah(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await ah(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):GI(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await ah(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await ah(e),await this.trainEnd(e))}}function B8(n,e){return n==null&&(n={}),n instanceof Xg?[n]:Array.isArray(n)&&n[0]instanceof Xg?n:rn(n).map(s=>new Wke(s,e))}class Hi{constructor(){}static registerCallbackConstructor(e,t){q(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),Hi.checkForDuplicate(t),Hi.constructors[e]==null&&(Hi.constructors[e]=[]),Hi.constructors[e].push(t)}static checkForDuplicate(e){for(const t in Hi.constructors)Hi.constructors[+t].forEach(r=>{if(r===e)throw new ie("Duplicate callback constructor.")})}static clear(){Hi.constructors={}}static createCallbacks(e){const t=[];for(const s in Hi.constructors){const r=+s;e>=r&&t.push(...Hi.constructors[r])}return t.map(s=>new s)}}Hi.constructors={};function U8(n,e,t,s,r,i,o,a,l){const u=new qke,h=[new Hke,...Hi.createCallbacks(e)];n!=null&&h.push(...n),h.push(u);const f=new Gke(h);return f.setParams({epochs:t,initialEpoch:s,samples:r,steps:i,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:f,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yl(n,e={},t=!1){return Rb(n,Ki.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function lw(n,e){return ge(()=>{n.dtype!=="float32"&&(n=Ge(n,"float32"));const t=Ze(Mb(n),e,!0),s=mx(t.shape,vs()),r=_r(Ic(t,s));return nt(n,r)})}function Ix(n,e){return ge(()=>ss(Mb(rt(e,n)),-1))}function t$(n,e){return ge(()=>ss(pr(rt(e,n)),-1))}function n$(n,e){return ge(()=>{const t=rt(n,e),s=Ii(pr(n),vs(),Number.MAX_VALUE),r=pr(nt(t,s));return ae(100,ss(r,-1))})}function Kke(n,e){return ge(()=>{const t=Ii(e,vs(),Number.MAX_VALUE),s=Oa(Pe(1,t)),r=Ii(n,vs(),Number.MAX_VALUE),i=Oa(Pe(1,r));return ss(Mb(rt(s,i)),-1)})}function Xke(n,e){return ge(()=>{const t=Ic(0,rt(1,ae(n,e)));return ss(Mb(t),-1)})}function Yke(n,e){return ge(()=>{const t=Ic(0,rt(1,ae(n,e)));return ss(t,-1)})}function Jke(n,e){return ge(()=>{const t=Ze(ae(n,e),-1),s=$o(ae(rt(1,n),e),-1);return Ic(0,Pe(1,rt(s,t)))})}function jke(n,e){return ge(()=>{const t=Math.log(2),s=rt(e,n),r=rt(Pe(s,Eb(ae(-2,s))),t);return ss(r,-1)})}function Yg(n,e,t=!1){return ge(()=>{if(t)e=o2(e);else{const s=Ze(e,e.shape.length-1,!0);e=nt(e,s)}return e=Ii(e,vs(),1-vs()),Kn(Ze(ae(Ge(n,"float32"),Oa(e)),e.shape.length-1))})}function uw(n,e,t=!1){return ge(()=>{const s=Ge(bx(yke(n)),"int32");e=Ii(e,vs(),1-vs());const r=e.shape,i=ce(f9(s,r[r.length-1]),r);return Yg(i,e,t)})}function Qke(n,e){if(!jt(n.shape,e.shape))throw new ie(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return ge(()=>{const t=id(e),s=Kn(pr(e));return Pe(rt(t,ae(e,n)),u9(Ma(s)))})}function Cx(n,e){return ge(()=>{let t;return t=Ii(e,vs(),1-vs()),t=Oa(nt(t,rt(1,t))),ss(Qke(n,t),-1)})}function Zke(n,e){return ge(()=>{const t=Ii(n,vs(),1),s=Ii(e,vs(),1);return Ze(ae(n,Oa(nt(t,s))),-1)})}function e2e(n,e){return ge(()=>{const t=Oa(Pe(vs(),e));return ss(rt(e,ae(n,t)),-1)})}function z8(n,e){return ge(()=>{const t=lw(n,-1),s=lw(e,-1),r=ae(t,s);return Kn(Ze(r,-1))})}const cw={meanSquaredError:Ix,meanAbsoluteError:t$,meanAbsolutePercentageError:n$,meanSquaredLogarithmicError:Kke,squaredHinge:Xke,hinge:Yke,categoricalHinge:Jke,logcosh:jke,categoricalCrossentropy:Yg,sparseCategoricalCrossentropy:uw,binaryCrossentropy:Cx,kullbackLeiblerDivergence:Zke,poisson:e2e,cosineProximity:z8};function yE(n){if(typeof n=="string"){if(n in cw)return cw[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new ie(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function G8(n,e){return ge(()=>{const t=ae(.5,eo(e)),s=Ea(Ci(e,t),n.dtype);return ss(Da(n,s),-1)})}function H8(n,e){return ge(()=>Ea(Da(Gg(n,-1),Gg(e,-1)),"float32"))}function t2e(n,e){return ge(()=>Ge(Ze(Il(Da(n,1),Da(e,1))),"float32"))}function n2e(n,e){return ge(()=>Ge(Ze(Il(Da(n,0),Da(e,1))),"float32"))}function s2e(n,e){return ge(()=>{const t=t2e(n,e),s=n2e(n,e),r=Pe(t,s);return Ge(xr(Ci(r,0),nt(t,r),0),"float32")})}function r2e(n,e){return Cx(n,e)}function i2e(n,e){return n.rank===e.rank&&(n=Cb(n,[n.rank-1])),e=Gg(e,-1),e.dtype!==n.dtype&&(e=Ge(e,n.dtype)),Ge(Da(n,e),"float32")}const o2e=Ix,a2e=Ix,l2e=t$,u2e=t$,c2e=n$,h2e=n$,q8=Yg,d2e=z8,W8=uw,hw={binaryAccuracy:G8,categoricalAccuracy:H8,precision:s2e,categoricalCrossentropy:q8,sparseCategoricalCrossentropy:W8,mse:o2e,MSE:a2e,mae:l2e,MAE:u2e,mape:c2e,MAPE:h2e,cosine:d2e};function f2e(n){if(typeof n=="string"&&n in hw)return hw[n];if(typeof n!="string"&&n!=null)return n;throw new ie(`Unknown metric ${n}`)}function k1(n){if(da(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(cw))if(cw[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(hw))if(hw[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function p2e(n){const e={Adagrad:()=>tf.adagrad(.01),Adadelta:()=>tf.adadelta(1,.95,vs()),Adam:()=>tf.adam(.001,.9,.999,vs()),Adamax:()=>tf.adamax(.002,.9,.999,vs(),0),RMSProp:()=>tf.rmsprop(.001,.9,0,vs()),SGD:()=>tf.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new ie(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const EL=1*1024*1024;function IL(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!pC(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>EL&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${EL}.`)}}function pC(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!pC(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!pC(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function m2e(n,e,t,s=console.log){const r=y2e(n),i=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(h=>Math.floor(e*h)));let o;if(!r){i.push("Receives inputs"),o=[];for(const h in n.nodesByDepth)o.push(...n.nodesByDepth[h])}s("_".repeat(e)),dw(i,t,s),s("=".repeat(e));const a=n.layers;for(let h=0;h<a.length;++h)r?b2e(a[h],t,s):v2e(a[h],t,o,s),s((h===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const l=g2e(n),u=iw(n.nonTrainableWeights);s(`Total params: ${l+u}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${u}`),s("_".repeat(e))}function g2e(n){let e;return n.collectedTrainableWeights!=null?e=iw(n.collectedTrainableWeights):e=iw(n.trainableWeights),e}function y2e(n){let e=!0;const t=[],s=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of n.layers){let i=!1;for(const o of r.inboundNodes)if(s.indexOf(o)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function dw(n,e,t=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);t(s)}function b2e(n,e,t){let s,r;try{r=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const i=n.name,o=n.getClassName(),a=[`${i} (${o})`,r,s,n.countParams().toString()];dw(a,e,t)}function v2e(n,e,t,s){let r,i;try{i=n.inboundNodes.map(f=>JSON.stringify(f.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const o=[];for(const f of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(let p=0;p<f.inboundLayers.length;++p){const g=f.inboundLayers[p].name,b=f.nodeIndices[p],T=f.tensorIndices[p];o.push(`${g}[${b}][${T}]`)}const a=n.name,l=n.getClassName(),u=o.length===0?"":o[0],h=[`${a} (${l})`,i,r,n.countParams().toString(),u];dw(h,e,s);for(let f=1;f<o.length;++f)dw(["","","","",o[f]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function K8(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function mC(n,e){if(n===null)return null;if(typeof n=="string")return gh(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];K8(e,r,i)?t.push(i):t.push(mC(i,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")t[s]=r;else{const i=gh(s);t[i]=mC(r,i)}}return t}}function gC(n,e){if(n==null)return null;if(typeof n=="string")return ll(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];K8(e,r,i)?t.push(i):t.push(gC(i,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s],i=ll(s);(s==="name"||s==="className")&&typeof r=="string"?t[i]=r:t[i]=gC(r,s)}return t}}/** @license See the LICENSE file. */const X8="4.17.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const w2e=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class wo extends St{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const C=this.getClassName().toLowerCase();this.name=Sx(C)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Wu(this.inputs).length!==this.inputs.length)throw new ie(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(C=>C.name)}`);Wu(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(C=>C.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const C of this.outputs){const N=C.sourceLayer,A=C.nodeIndex,P=C.tensorIndex;this.outputLayers.push(N),this.outputLayersNodeIndices.push(A),this.outputLayersTensorIndices.push(P)}for(const C of this.inputs){const N=C.sourceLayer,A=C.nodeIndex,P=C.tensorIndex;da(A===0,"input layer has >1 nodes"),da(P===0,"input layer has >1 tensors"),this.inputLayers.push(N),this.inputLayersNodeIndices.push(A),this.inputLayersTensorIndices.push(P)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let C=0;C<this.inputLayers.length;C++){const N=this.inputLayers[C];if(!(N instanceof Pb))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${C} (0-based) originates from layer type ${N.getClassName()}.`);this.inputNames.push(N.name),this.feedInputShapes.push(N.batchInputShape),this.feedInputNames.push(N.name)}for(const C of this.outputLayers)this.outputNames.push(C.name);this.internalInputShapes=this.inputs.map(C=>C.shape),this.internalOutputShapes=this.outputs.map(C=>C.shape);const t={},s={},r={},i={},o={},a=[],l=(C,N,A,P,V,D)=>{(P==null||V==null||D==null)&&(P=C.sourceLayer,V=C.nodeIndex,D=C.tensorIndex);const M=P.inboundNodes[V];if(A.indexOf(M)!==-1)throw new Xi(`The tensor ${C.name} at layer "${P.name}" is part of a cycle.`);if(N.indexOf(M)!==-1)return;this.containerNodes.add(wo.nodeKey(P,V)),P.id in o||(o[P.id]=Object.keys(o).length),A.indexOf(M)===-1&&A.push(M);const $=M.inboundLayers.length;for(let O=0;O<$;O++){const k=M.inputTensors[O],z=M.inboundLayers[O],U=M.nodeIndices[O],te=M.tensorIndices[O];l(k,N,A,z,U,te)}for(N.push(M);A.indexOf(M)>=0;)A.splice(A.indexOf(M),1);a.push(M)},u=[],h=[];for(const C of this.outputs)l(C,u,h);const f=a.slice().reverse();for(const C of f){s[C.id]=C,C.id in t||(t[C.id]=0);let N=t[C.id];const A=r[C.outboundLayer.id]==null?0:r[C.outboundLayer.id];N=Math.max(N,A),r[C.outboundLayer.id]=N,i[C.outboundLayer.id]=C.outboundLayer,t[C.id]=N;for(let P=0;P<C.inboundLayers.length;P++){const V=C.inboundLayers[P],D=C.nodeIndices[P],M=V.inboundNodes[D],$=t[M.id]==null?0:t[M.id];t[M.id]=Math.max(N+1,$),s[M.id]=M}}const p={};for(const C in t){const N=t[C];N in p||(p[N]=[]),p[N].push(s[C])}const g={};for(const C in r){const N=r[C];N in g||(g[N]=[]),g[N].push(i[C])}let b=Object.keys(g).map(C=>parseInt(C,10)).sort(C1);this.layers=[];for(const C of b){const N=g[C];N.sort((A,P)=>{const V=o[A.id],D=o[P.id];return V<D?-1:V>D?1:0});for(const A of N)A instanceof wo&&this.internalContainerRefs.push(A),this.layers.push(A)}this.layersByDepth=g,b=Object.keys(p).map(C=>parseInt(C,10)).sort(C1);const T=this.inputs.slice(),w=[];for(const C of b)for(const N of p[C]){const A=N.outboundLayer;if(A!=null){for(const P of N.inputTensors)if(T.indexOf(P)===-1)throw new Xi(`Graph disconnected: cannot obtain value for tensor ${P} at layer "${A.name}". The following previous layers were accessed without issue: ${w}`);for(const P of N.outputTensors)T.push(P);w.push(A.name)}}this.nodesByDepth=p;const _=this.layers.map(C=>C.name);for(const C of _){const N=_.filter(A=>A===C).length;if(N!==1)throw new Xi(`The name "${C}" is used ${N} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(_))}this.outboundNodes=[],this.inboundNodes=[],new Ex({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(C=>null),outputMasks:this.outputs.map(C=>null),inputShapes:this.inputs.map(C=>C.shape),outputShapes:this.outputs.map(C=>C.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new ie("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let r=0;const i=w2e(e);i&&this.parseWeights(e);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const h=i?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(s[h]!=null)throw new ie(`Duplicate weight name: ${h}`);s[h]=u,r++}const o=[];for(const a in e){let l=a;if(s[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[l]!=null)o.push([s[l],e[a]]);else if(t)throw new ie(`Provided weight data has no target variable: ${a}`);delete s[l]}if(t){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new ie(`${a.length} of ${r} weights are not set: ${a}`)}Z2(o)}parseWeights(e){for(const t in Object.keys(e)){const s=t.split("/"),r=["vars","layer_checkpoint_dependencies"],i=s.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!r.includes(o)).join("/");i!==t&&(e[i]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${X8}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=gC(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return ge(()=>{e=rn(e);const s=new Mu;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return sg(this.outputs,s,t)})}computeMask(e,t){return ge(()=>{e=rn(e);let s;return t==null?s=Yh(null,e.length):s=rn(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=rw(e);if(t.length!==this.inputLayers.length)throw new ie(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<t.length;a++){const l=this.inputLayers[a],u=t[a],h=l.name+"_0_0";s[h]=u}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(C1);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const u of l){const h=u.outboundLayer;if(this.inputLayers.map(T=>T.id).indexOf(h.id)!==-1)continue;const f=[];for(let T=0;T<u.inboundLayers.length;T++){const w=u.inboundLayers[T],_=u.nodeIndices[T],C=u.tensorIndices[T],N=`${w.name}_${_}_${C}`,A=s[N];f.push(A)}const p=h.computeOutputShape(Rr(f)),g=rw(p),b=h.inboundNodes.indexOf(u);for(let T=0;T<g.length;T++){const w=`${h.name}_${b}_${T}`;s[w]=g[T]}}}const i=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],h=this.outputLayersTensorIndices[a],f=`${l.name}_${u}_${h}`;o.push(f)}for(let a=0;a<o.length;a++){const l=o[a];da(l in s),i.push(s[l])}return Rr(i)}runInternalGraph(e,t){t==null&&(t=Yh(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],h=e[l],f=t[l];s[u.id]=[h,f]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(C1);for(const l of r){const u=this.nodesByDepth[l];for(const h of u){const f=h.outboundLayer,p=h.inputTensors,g=h.outputTensors,b=new Array;for(const T of p)T.id in s&&b.push(s[T.id]);if(b.length===p.length){let T={},w,_,C,N;if(h.callArgs!=null&&(T=h.callArgs),b.length===1){const[A,P]=b[0];T.mask==null&&(T.mask=P),C=rn(f.call(A,T)),N=rn(f.computeMask(A,P)),w=[A],_=[P]}else w=b.map(A=>A[0]),_=b.map(A=>A[1]),T.mask==null&&(T.mask=_),C=rn(f.call(w,T)),N=rn(f.computeMask(w,_));if(f.activityRegularizer)throw new bt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let A=0;A<g.length;++A){const P=g[A],V=C[A],D=N[A];s[P.id]=[V,D]}}}}const i=[],o=[],a=[];for(const l of this.outputs){da(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[u,h]=s[l.id];a.push(u.shape),i.push(u),o.push(h)}return[i,o,a]}buildNodeConversionMap(e){const t={};let s;for(const r of this.layers){s=r instanceof wo?1:0;for(let i=0;i<r.inboundNodes.length;i++){const o=wo.nodeKey(r,i);this.containerNodes.has(o)&&(t[o]=s,s+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new ie("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new ie(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new ie(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return ge(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const r=wo.nodeKey(t,s);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),u=[];for(let f=0;f<o.inboundNodes.length;f++){const p=o.inboundNodes[f],g=wo.nodeKey(o,f);let b={};if(this.containerNodes.has(g)){if(p.callArgs)try{JSON.stringify(p.callArgs),b=p.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),b={}}if(p.inboundLayers.length>0){const T=[];for(let w=0;w<p.inboundLayers.length;w++){const _=p.inboundLayers[w],C=p.nodeIndices[w],N=p.tensorIndices[w],A=wo.nodeKey(_,C);let P=t[A];P==null&&(P=0),T.push([_.name,P,N,b])}u.push(T)}}}const h={};h.name=o.name,h.className=a,h.config=l,h.inboundNodes=u,s.push(h)}e.layers=s;const r=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],u=wo.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let h=t[u];h==null&&(h=0);const f=this.inputLayersTensorIndices[o];r.push([a.name,h,f])}e.inputLayers=r;const i=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],u=wo.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let h=t[u];h==null&&(h=0);const f=this.outputLayersTensorIndices[o];i.push([a.name,h,f])}return e.outputLayers=i,e}static fromConfig(e,t,s={},r=!1){const i={},o={};function a(w,_){w.name in o?o[w.name].push(_):o[w.name]=[_]}function l(w,_){const C=[];let N;for(const A of _){const P=A[0],V=A[1],D=A[2];if(N=A[3]==null?{}:A[3],!(P in i)){a(w,_);return}const M=i[P];if(M.inboundNodes.length<=V){a(w,_);return}const $=M.inboundNodes[V];C.push($.outputTensors[D])}C.length>0&&w.apply(Rr(C),N)}function u(w){const _=w.name,C=yl(w,t.customObjects!=null?t.customObjects:{});C.setFastWeightInitDuringBuild(r),i[_]=C,w.inboundNodes.forEach(A=>{if(!(A instanceof Array))throw new ie(`Corrupted configuration, expected array for nodeData: ${A}`);a(C,A)})}const h=t.name,f=t.layers;for(const w of f)u(w);for(;!rke(o);)for(const w of f){const _=i[w.name];if(_.name in o){const C=o[_.name];delete o[_.name];for(const N of C)l(_,N)}}const p=[],g=[],b=t.inputLayers;for(const w of b){const _=w[0],C=w[1],N=w[2];da(_ in i);const P=i[_].inboundNodes[C].outputTensors;p.push(P[N])}const T=t.outputLayers;for(const w of T){const _=w[0],C=w[1],N=w[2];da(_ in i);const P=i[_].inboundNodes[C].outputTensors;g.push(P[N])}return new e({inputs:p,outputs:g,name:h})}get stateful(){if(this._stateful)throw new ie("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){ge(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function T2e(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(i=>{i in n?r.push(n[i]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function Y8(n,e){return T2e(n,e,"classWeight")}async function J8(n,e,t,s){if(t!=null){const r=ge(()=>{if(n.shape.length===1)return Ih(n);if(n.shape.length===2){if(n.shape[1]>1)return Gg(n,1);if(n.shape[1]===1)return ce(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await r.data());_t(r);const o=[];return i.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(t[a])}),ii(o,"float32")}else return null}function x2e(n,e){return ae(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const S2e=32;function j8(n,e){let t,s;const r=e;t=r.xs,s=r.ys,q(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=CL("input",n.inputNames,t),o=CL("output",n.outputNames,s),a=i[0].shape[0];q(i.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),q(o.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<i.length;l++)q(i[l].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let l=0;l<o.length;l++)q(o[l].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:i,ys:o}}function CL(n,e,t){if(t instanceof gs)return[t];if(Array.isArray(t))return q(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const r of e){if(t[r]==null)throw new ie(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(t[r])}return s}}function _2e(n){if(n.length===3)throw new bt("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function E2e(n,e,t){const s=t.batchesPerEpoch!=null;if(q(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),q(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),q(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),q(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),q(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let i,o;if(r)if(NL(t.validationData))q(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const w=_2e(t.validationData);i=w.xs,o=w.ys}const a=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let u;r?u=l.slice().concat(l.map(w=>"val_"+w)):u=l.slice();const h=B8(t.callbacks,t.yieldEvery),f=t.verbose==null?1:t.verbose,{callbackList:p,history:g}=U8(h,f,t.epochs,null,null,I2e(e,t),null,r,u);p.setModel(n),n.history=g,await p.onTrainBegin(),n.stopTraining_=!1;let b=t.initialEpoch==null?0:t.initialEpoch,T=await e.iterator();for(;b<t.epochs;){const w={};await p.onEpochBegin(b);let _=0,C=0;for(s||(T=await e.iterator());!s||_<t.batchesPerEpoch;){const N=await T.next();if(s&&N.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${_} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(N.value!=null){const{xs:A,ys:P}=j8(n,N.value),V={};V.batch=C,V.size=A[0].shape[0],await p.onBatchBegin(C,V);const D=[];if(t.classWeight!=null){const O=Y8(t.classWeight,n.outputNames);for(let k=0;k<O.length;++k)D.push(await J8(P[k],null,O[k]))}const M=A.concat(P).concat(D),$=a(M);_t(M);for(let O=0;O<l.length;++O){const k=l[O],z=$[O];V[k]=z,Sa(z)}await p.onBatchEnd(C,V),V8(V),C++,_++}if(s?_>=t.batchesPerEpoch:N.done){if(r){let A;NL(t.validationData)?A=rn(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):A=rn(n.evaluate(i,o,{batchSize:t.validationBatchSize==null?S2e:t.validationBatchSize,verbose:0}));for(let P=0;P<n.metricsNames.length;++P)w[`val_${n.metricsNames[P]}`]=A[P]}break}if(n.stopTraining_)break}if(await p.onEpochEnd(b,w),b++,n.stopTraining_)break}return await p.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function I2e(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function NL(n){return typeof n.iterator=="function"}function C2e(n){return typeof n.next=="function"}async function N2e(n,e,t){t=t||{};const s=t.batches!=null,r=n.testFunction;let i=[];if(t.verbose>0)throw new bt("Verbose mode is not implemented yet.");q(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const o=C2e(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<t.batches;){const u=await o.next();if(i=ge(()=>{if(u.value){const{xs:h,ys:f}=j8(n,u.value),p=h.concat(f),g=ge(()=>r(p));if(_t(p),l===0)for(let T=0;T<g.length;++T)i.push(Yt(0));const b=p[0].shape[0];for(let T=0;T<g.length;++T){const w=g[T],_=i[T];i[T]=ge(()=>Pe(i[T],ae(b,w))),l>0&&_t(_)}_t(g),a+=b,++l}return i}),u.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<i.length;++u){const h=i[u];i[u]=nt(i[u],a),_t(h)}return Rr(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function bE(n){q(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Km(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>Nh(s,e,t-e)):Nh(n,e,t-e)}function yC(n,e){return ge(()=>n==null?null:Array.isArray(n)?n.map(t=>yC(t,e)):E8(n,e.dtype==="int32"?e:Ge(e,"int32")))}function vE(n,e){const t=[];let s=0,r=null;for(;s<n;)r=s+e,r>=n&&(r=n),t.push([s,r]),s=r;return t}function Q8(n){const e=[];n instanceof gs&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(Db(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function yo(n,e){if(n==null)return;const t=[];if(e instanceof gs)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const i=e[r];t.push(i.id)}const s=[];if(n instanceof gs)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const i=n[r];t.indexOf(i.id)===-1&&s.push(i)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function A2e(n){return n instanceof gs}function bC(n){return Array.isArray(n)}function AL(n){return!A2e(n)&&!bC(n)}function kL(n,e,t,s=!0,r=""){if(e==null||e.length===0){if(n!=null){let o=!1;if(bC(n)&&n.length>0)o=!0;else if(AL(n)){for(const a in n)if(n.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new ie(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(o=>null);let i;if(AL(n)){n=n,i=[];for(const o of e){if(n[o]==null)throw new ie(`No data provided for "${o}". Need data for each key in: ${e}`);i.push(n[o])}}else if(bC(n)){if(n=n,n.length!==e.length)throw new ie(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);i=n}else{if(n=n,e.length>1)throw new ie(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);i=[n]}if(i=Q8(i),t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new ie(`Error when checking ${r}: expected ${e[o]} to have ${t[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<t[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],h=t[o][l];if(h!=null&&h>=0&&u!==h)throw new ie(`${r} expected a batch of elements where each example has shape [${t[o].slice(1,t[o].length)}] (i.e.,tensor shape [*,${t[o].slice(1,t[o].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function k2e(n,e,t){const s=Wu(n.map(i=>i.shape[0]));s.sort();const r=Wu(e.map(i=>i.shape[0]));if(r.sort(),s.length>1)throw new ie(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(r.length>1)throw new ie(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(s.length>0&&r.length>0&&!jt(s,r))throw new ie(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function $2e(n,e,t){const s=[Ix,Cx,Yg];for(let r=0;r<n.length;++r){const i=n[r],o=e[r],a=t[r];if(o!=null){if(o===Yg&&i.shape[i.shape.length-1]===1)throw new ie(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const l=i.shape.slice(1),u=a.slice(1);for(let h=0;h<l.length;++h){const f=l[h],p=u[h];if(p!=null&&f!==p)throw new ie(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function $L(n,e,t,s=!0,r=""){let i;if(Array.isArray(n)){if(n.length!==e.length)throw new ie(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);i=n}else{if(e.length>1)throw new ie(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);i=[n]}if(t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new ie(`Error when checking ${r}: expected ${e[o]} to have ${t[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<t[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],h=t[o][l];if(h!=null&&h!==u)throw new ie(`Error when checking ${r}: expected ${e[o]} to have shape ${JSON.stringify(t[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function R2e(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const r of e){let i=t.hasOwnProperty(r)?t[r]:[];Array.isArray(i)||(i=[i]),s.push(i)}return s}}const D2e="layers-model";class Df extends wo{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new ie("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");m2e(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=p2e(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Nc))throw new ie("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new ie(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),t.push(yE(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new ie(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>yE(a))}else{const o=yE(e.loss);this.outputs.forEach(a=>{t.push(o)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Ch("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const r=R2e(e.metrics,this.outputNames),i=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};Ch("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=r[o];(u=>{let f,p,g;for(const b of u){if(typeof b=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(b)!==-1){const w=this.internalOutputShapes[o];w[w.length-1]===1||this.lossFunctions[o]===Cx?["accuracy","acc"].indexOf(b)!==-1?p=G8:["crossentropy","ce"].indexOf(b)!==-1&&(p=r2e):this.lossFunctions[o]===uw?["accuracy","acc"].indexOf(b)!==-1?p=i2e:["crossentropy","ce"].indexOf(b)!==-1&&(p=W8):["accuracy","acc"].indexOf(b)!==-1?p=H8:["crossentropy","ce"].indexOf(b)!==-1&&(p=q8);let _;["accuracy","acc"].indexOf(b)!==-1?_="acc":["crossentropy","ce"].indexOf(b)!==-1&&(_="ce"),g=p,f=""+_}else g=f2e(b),f=""+k1(b);let T;Ch(f,()=>{T=g}),i(o,f,T)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const r=s.batchSize==null?32:s.batchSize;bE(r);const o=this.standardizeUserDataXY(e,t,!0,r);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,r,s.verbose,s.steps);return Rr(u)}finally{yo(o[0],e),yo(o[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),N2e(this,e,t)}checkNumSamples(e,t,s,r="steps"){let i;if(s!=null){if(i=null,t!=null)throw new ie(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new ie(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return i}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new ie("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),r=s?t:[t],i=this.retrieveSymbolicTensors(r),o=new Mu;if(e instanceof gs&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new ie(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const u=e[l.name];if(u==null)throw new ie(`No value is provided for the model's input ${l.name}`);o.add(l,u)}const a=sg(i,o);return s?a:a[0]}retrieveSymbolicTensors(e){const t=Yh(null,e.length);let s=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],o=i.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(t[a]=i[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw t.forEach((i,o)=>{i==null&&r.push(e[o])}),new ie(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,s=!1){return ge(()=>{const r=this.checkNumSamples(e);if(s)throw new bt("Verbose predictLoop() is not implemented yet.");const i=vE(r,t),o=this.outputs.map(a=>[]);for(let a=0;a<i.length;++a)ge(()=>{const u=i[a][0],h=i[a][1],f=Km(e,u,h),p=[];if(Array.isArray(f))for(let b=0;b<f.length;++b)p.push({key:this.inputs[b],value:f[b]});else p.push({key:this.inputs[0],value:f});const g=new Mu(p);return sg(this.outputs,g)}).forEach((u,h)=>o[h].push(u));return Rr(o.map(a=>Mr(a,0)))})}predict(e,t={}){const s=Q8(e);$L(s,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return bE(r),this.predictLoop(s,r)}finally{yo(s,e)}}predictOnBatch(e){$L(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,r){if(this.optimizer_==null)throw new Xi("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===uw?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(e=kL(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=kL(t,this.feedOutputNames,i,!1,"target"),k2e(e,t),$2e(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new ie(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,r,i=!0,o){const[a,l]=this.standardizeUserDataXY(e,t,i,o);if(s!=null)throw new Error("sample weight is not supported yet.");let u=null;if(r!=null){const h=Y8(r,this.outputNames);u=[];for(let f=0;f<h.length;++f)u.push(await J8(l[f],null,h[f]))}return[a,l,u]}testLoop(e,t,s,r=0,i){return ge(()=>{const o=this.checkNumSamples(t,s,i,"steps"),a=[];if(r>0)throw new bt("Verbose mode is not implemented yet.");if(i!=null)throw new bt("steps mode in testLoop() is not implemented yet");{const l=vE(o,s),u=ii(Oo(0,o));for(let h=0;h<l.length;++h){const f=l[h][0],p=l[h][1],g=Nh(u,f,p-f),b=yC(t,g),T=e(b);if(h===0)for(let w=0;w<T.length;++w)a.push(Yt(0));for(let w=0;w<T.length;++w){const _=T[w];a[w]=Pe(a[w],ae(p-f,_))}}for(let h=0;h<a.length;++h)a[h]=nt(a[h],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const r=e[s];let i=r;if(mL(e,r)>1){const o=mL(e.slice(0,s),r);i+=`_${o}`}t.push(i)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const f=[];for(let T=0;T<this.inputs.length;++T)f.push({key:this.inputs[T],value:s[T]});const p=new Mu(f),g=sg(this.outputs,p,{training:!0});let b;for(let T=0;T<this.lossFunctions.length;++T){const w=this.lossFunctions[T];let _=w(r[T],g[T]);i[T]!=null&&(_=x2e(_,i[T]));const C=ss(_);t.push(C),T===0?b=_:b=Pe(b,_)}for(let T=0;T<this.metricsTensors.length;++T){let w;if(this.outputs.length>1&&T<this.outputs.length)w=t[T];else{const _=this.metricsTensors[T][0],C=this.metricsTensors[T][1];w=ss(_(r[C],g[C]))}Sa(w),o.push(w)}return b=ss(b),this.calculateLosses().forEach(T=>{b=Pe(b,T)}),b},l=this.collectedTrainableWeights.map(f=>f.read());return[this.optimizer_.minimize(a,!0,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>ge(()=>{const t=[];let s;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let u=0;u<this.inputs.length;++u)o.push({key:this.inputs[u],value:r[u]});const a=new Mu(o),l=sg(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const h=this.lossFunctions[u],f=ss(h(i[u],l[u]));u===0?s=f:s=Pe(s,f),t.push(s)}for(let u=0;u<this.metricsTensors.length;++u){const h=this.metricsTensors[u][0],f=this.metricsTensors[u][1],p=ss(h(i[f],l[f]));t.push(p)}return t})}async fit(e,t,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,i,o,a,l,u,h,f,p;try{const g=s.batchSize==null?32:s.batchSize;bE(g);const T=await this.standardizeUserData(e,t,s.sampleWeight,s.classWeight,!1,g);r=T[0],i=T[1],p=T[2];let w=!1,_;if(s.validationData!=null&&s.validationData.length>0){if(w=!0,s.validationData.length===2)l=s.validationData[0],u=s.validationData[1];else throw s.validationData.length===3?new bt("validationData including sample weights is not supported yet."):new ie(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const O=await this.standardizeUserData(l,u,null,null,!0,g);h=O[0],f=O[1],_=h.concat(f)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){w=!0;const $=Math.floor(r[0].shape[0]*(1-s.validationSplit)),O=r[0].shape[0];h=Km(r,$,O),o=r,r=Km(r,0,$),f=Km(i,$,O),a=i,i=Km(i,0,$),_=h.concat(f)}else s.validationSteps!=null&&(w=!0);const C=r.concat(i).concat(p);this.checkTrainableWeightsConsistency();const N=this.makeTrainFunction(),A=this.getDedupedMetricsNames();let P,V;w?(this.makeTestFunction(),P=this.testFunction,V=A.slice().concat(A.map($=>"val_"+$))):(P=null,_=[],V=A.slice());const D=B8(s.callbacks,s.yieldEvery);return await this.fitLoop(N,C,A,g,s.epochs,s.verbose,D,P,_,s.shuffle,V,s.initialEpoch,null,null)}finally{this.isTraining=!1,yo(r,e),yo(i,t),yo(o,e),yo(a,t),yo(h,l),yo(f,u),p!=null&&_t(p)}}async fitLoop(e,t,s,r,i,o,a,l,u,h,f,p,g,b){r==null&&(r=32),i==null&&(i=1),h==null&&(h=!0),p==null&&(p=0);let T=!1;if(l!=null&&u!=null&&(T=!0),b!=null&&(T=!0,g==null))throw new ie("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const w=this.checkNumSamples(t,r,g,"steps_per_epoch");let _;w!=null&&(_=Oo(0,w)),o==null&&(o=1);const{callbackList:C,history:N}=U8(a,o,i,p,w,g,r,T,f);C.setModel(this),this.history=N,await C.onTrainBegin(),this.stopTraining_=!1;for(let A=p;A<i;++A){await C.onEpochBegin(A);const P={};if(g!=null)throw new bt("stepsPerEpoch mode is not implemented yet.");{if(h==="batch")throw new bt("batch shuffling is not implemneted yet");h&&OTe(_);const V=ii(_),D=vE(w,r);for(let M=0;M<D.length;++M){const $={};if(await C.onBatchBegin(M,$),ge(()=>{const O=D[M][0],k=D[M][1],z=Nh(V,O,k-O);$.batch=M,$.size=k-O;const U=yC(t,z),te=e(U);for(let se=0;se<s.length;++se){const X=s[se],Q=te[se];$[X]=Q,Sa(Q)}if(M===D.length-1&&T){const se=this.testLoop(l,u,r);for(let X=0;X<s.length;++X){const Q=s[X],re=se[X];Sa(re),P["val_"+Q]=re}}}),await C.onBatchEnd(M,$),V8($),this.stopTraining_)break}V.dispose()}if(await C.onEpochEnd(A,P),this.stopTraining_)break}return await C.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return E2e(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),r=s[0],i=s[1],a=this.makeTrainFunction()(r.concat(i)),l=[];for(const u of a){const h=await u.data();l.push(h[0])}return _t(a),yo(s[0],e),yo(s[1],t),Rr(l)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,i=this.getWeights(s);for(let o=0;o<r.length;++o)s&&!r[o].trainable||t.push({name:r[o].originalName,tensor:i[o]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=j3().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-j3().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=ll(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>ll(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const r of t)if(typeof s[r]=="string")e[r]=ll(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[ll(k1(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>ll(k1(e)));{const e={};for(const t in this.metrics)e[t]=ll(k1(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=mC(e.optimizer_config),s=yl(t);let r;if(typeof e.loss=="string")r=gh(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(o=>gh(o));else if(e.loss!=null){r={};for(const o in e.loss)r[o]=gh(e.loss[o])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(o=>gh(o));else if(e.metrics!=null){i={};for(const o in e.metrics)i[o]=gh(e.metrics[o])}this.compile({loss:r,metrics:i,optimizer:s})}async save(e,t){if(typeof e=="string"){const u=Nxe(e);if(u.length===0)throw new ie(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new ie(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new ie("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await Z3(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:D2e,generatedBy:`TensorFlow.js tfjs-layers v${X8}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:h,specs:f}=await Z3(await this.optimizer.getWeights(),u);s.specs.push(...f),s.data=Cxe([s.data,h])}return this.userDefinedMetadata!=null&&(IL(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){IL(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}Df.className="Model";Oe(Df);class Z8 extends Df{}Z8.className="Functional";Oe(Z8);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Jg extends Df{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Sx("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new ie(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof Jg||e instanceof Df;let s;if(t){if(s=e,s.outputs.length!==1)throw new ie("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new ie("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new ie("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=Oke({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new ie(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new ie("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=M8(this.outputs[0])}this.inboundNodes=[],new Ex({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Yh(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(Gt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Df({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new Xi("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new Xi("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new Xi("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new Xi("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},r=!1){let i,o={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new ie("Legacy serialization format not supported yet.");i=t}else q(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=t.layers,delete t.layers,o=t;const a=new e(o);if(!(a instanceof Jg))throw new bt(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of i){const h=yl(l,void 0,r);r&&h.setFastWeightInitDuringBuild(!0),a.add(h)}return a}set stopTraining(e){if(this.model==null)throw new ie("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new ie("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}Jg.className="Sequential";Oe(Jg);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Br=class extends $p{getConfig(){return{}}};class e7 extends Br{apply(e,t=1){return vke(e,t)}}e7.className="elu";Oe(e7);class t7 extends Br{apply(e){return b9(e)}}t7.className="selu";Oe(t7);class n7 extends Br{apply(e){return id(e)}}n7.className="relu";Oe(n7);class s7 extends Br{apply(e){return ge(()=>Wg(6,id(e)))}}s7.className="relu6";Oe(s7);class r7 extends Br{apply(e){return e}}r7.className="linear";Oe(r7);class i7 extends Br{apply(e){return Np(e)}}i7.className="sigmoid";Oe(i7);class o7 extends Br{apply(e){return Tke(e)}}o7.className="hardSigmoid";Oe(o7);class a7 extends Br{apply(e){return Eb(e)}}a7.className="softplus";Oe(a7);class l7 extends Br{apply(e){return wke(e)}}l7.className="softsign";Oe(l7);class u7 extends Br{apply(e){return Gk(e)}}u7.className="tanh";Oe(u7);let s$=class extends Br{apply(e,t=-1){return o2(e,t)}};s$.className="softmax";Oe(s$);class c7 extends Br{apply(e,t=-1){return c9(e,t)}}c7.className="logSoftmax";Oe(c7);class h7 extends Br{apply(e,t=1){return ge(()=>ae(Np(ae(e,t)),e))}}h7.className="swish";Oe(h7);class d7 extends Br{apply(e){return ge(()=>ae(e,Gk(Eb(e))))}}d7.className="mish";Oe(d7);function hc(n){return n.getClassName()}function wE(n,e={}){return Rb(n,Ki.getMap().classNameMap,e,"activation")}function dc(n){if(n==null){const e={};return e.className="linear",e.config={},wE(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},wE(e)}else return n instanceof Br?n:wE(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function M2e(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class f7 extends $p{}class p7 extends f7{constructor(e){super(),M2e(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return ge(()=>{let t=ks([1]);return this.hasL1&&(t=Pe(t,Ze(ae(this.l1,pr(e))))),this.hasL2&&(t=Pe(t,Ze(ae(this.l2,Mb(e))))),ce(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}p7.className="L1L2";Oe(p7);const RL={l1l2:"L1L2"};function bn(n){return G2(n)}function DL(n,e={}){return Rb(n,Ki.getMap().classNameMap,e,"regularizer")}function Pn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in RL?RL[n]:n,config:{}};return DL(t)}else return n instanceof f7?n:DL(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class m7 extends St{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=at(e);let s=id(e);return this.maxValue!=null&&(s=Ii(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}m7.className="ReLU";Oe(m7);class g7 extends St{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=at(e);return jk(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}g7.className="LeakyReLU";Oe(g7);class y7 extends St{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=On(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Pn(e.alphaRegularizer),this.alphaConstraint=xs(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new ie(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Gt(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new ws({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=at(e),s2(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Bn(this.alphaInitializer),alphaRegularizer:bn(this.alphaRegularizer),alphaConstraint:Ts(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}y7.className="PReLU";Oe(y7);let b7=class extends St{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new bt(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=at(e);return gx(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};b7.className="ELU";Oe(b7);class v7 extends St{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=at(e);return ae(s,Ge(Ci(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}v7.className="ThresholdedReLU";Oe(v7);class w7 extends St{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new s$().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return ge(()=>{let s=at(e);const r=t.mask;if(r!=null){const i=ae(rt(Cc(s.shape),Ge(r,s.dtype)),Yt(-1e9));s=Pe(s,i)}return this.axis instanceof Array?this.axis.length>1?Ma(rt(s,h9(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}w7.className="Softmax";Oe(w7);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Mf(n,e,t){if(typeof n=="number")return Yh(n,e);if(n.length!==e)throw new ie(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const r=n[s];if(!mke(r))throw new ie(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function Ro(n,e,t,s,r=1){if(n==null)return n;const i=e+(e-1)*(r-1);let o;return t==="same"?o=n:o=n-i+1,Math.floor((o+s-1)/s)}function fa(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+cc([t-e,0]);else if(s==="same")n=n*e;else throw new ie(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function r$(n,e){return ge(()=>(Jn(e),e==="channelsFirst"?Ft(n,[0,2,3,1]):n))}function T7(n,e){return ge(()=>(Jn(e),e==="channelsFirst"?Ft(n,[0,2,3,4,1]):n))}function O2e(n,e,t,s=1,r="valid",i,o=1){return ge(()=>{if(i==null&&(i=Po()),Jn(i),n.shape.length!==3)throw new ie(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new ie(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new ie(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if(i==="channelsFirst"&&(n=Ft(n,[0,2,1])),r==="causal")throw new bt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=t9(n,e,s,r==="same"?"same":"valid","NWC",o);return t!=null&&(a=Vo(a,t)),a})}function ML(n,e,t,s=[1,1],r="valid",i,o,a=null){return ge(()=>{if(i==null&&(i=Po()),Jn(i),n.rank!==3&&n.rank!==4)throw new ie(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new ie(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=r$(n,i);if(r==="causal")throw new bt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=HIe({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:a}),i==="channelsFirst"&&(l=Ft(l,[0,3,1,2])),l})}function P2e(n,e,t,s=[1,1,1],r="valid",i,o){return ge(()=>{if(i==null&&(i=Po()),Jn(i),n.rank!==4&&n.rank!==5)throw new ie(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new ie(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=T7(n,i);if(r==="causal")throw new bt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=r_e(a,e,s,r==="same"?"same":"valid","NDHWC",o),t!=null&&(a=Vo(a,t)),i==="channelsFirst"&&(a=Ft(a,[0,4,1,2,3])),a})}class Nx extends St{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Nx.verifyArgs(t),this.rank=e,$s(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new bt(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Mf(t.kernelSize,e,"kernelSize"),this.strides=Mf(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,Ni(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Jn(this.dataFormat),this.activation=dc(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=On(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=xs(t.biasConstraint),this.biasRegularizer=Pn(t.biasRegularizer),this.activityRegularizer=Pn(t.activityRegularizer),this.dilationRate=Mf(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new ie(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new ie(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new ie(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(da("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!H2(e.kernelSize,"number",1,3))throw new ie(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:hc(this.activation),useBias:this.useBias,biasInitializer:Bn(this.biasInitializer),biasRegularizer:bn(this.biasRegularizer),activityRegularizer:bn(this.activityRegularizer),biasConstraint:Ts(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Rp extends Nx{constructor(e,t){super(e,t),this.kernel=null,Rp.verifyArgs(t),this.filters=t.filters,$s(this.filters,"filters"),this.kernelInitializer=On(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=xs(t.kernelConstraint),this.kernelRegularizer=Pn(t.kernelRegularizer)}build(e){e=Gt(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new ie(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return ge(()=>{e=at(e);let s;const r=this.bias==null?null:this.bias.read(),i=v8(this.activation.getClassName());if(i!=null&&this.rank===2)s=ML(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)s=O2e(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=ML(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=P2e(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new bt("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=Gt(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<s.length;++i){const o=Ro(s[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);t.push(o)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:Bn(this.kernelInitializer),kernelRegularizer:bn(this.kernelRegularizer),kernelConstraint:Ts(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new ie(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Lb extends Rp{constructor(e){super(2,e),Lb.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!H2(e.kernelSize,"number",1,2))throw new ie(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Lb.className="Conv2D";Oe(Lb);class Vb extends Rp{constructor(e){super(3,e),Vb.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new ie(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Vb.className="Conv3D";Oe(Vb);class x7 extends Lb{constructor(e){if(super(e),this.inputSpec=[new ws({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new ie(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Gt(e),e.length!==4)throw new ie("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new ie("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new ws({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return ge(()=>{let s=at(e);if(s.shape.length!==4)throw new ie(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=r[o],u=r[a],h=this.kernelSize[0],f=this.kernelSize[1],p=this.strides[0],g=this.strides[1],b=fa(l,p,h,this.padding),T=fa(u,g,f,this.padding),w=[i,b,T,this.filters];this.dataFormat!=="channelsLast"&&(s=Ft(s,[0,2,3,1]));let _=n9(s,this.kernel.read(),w,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(_=Ft(_,[0,3,1,2])),this.bias!=null&&(_=Vo(_,this.bias.read(),this.dataFormat)),this.activation!=null&&(_=this.activation.apply(_)),_})}computeOutputShape(e){e=Gt(e);const t=e.slice();let s,r,i;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3):(s=3,r=1,i=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return t[s]=this.filters,t[r]=fa(t[r],l,o,this.padding),t[i]=fa(t[i],u,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}x7.className="Conv2DTranspose";Oe(x7);class S7 extends Vb{constructor(e){if(super(e),this.inputSpec=[new ws({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new ie(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Gt(e),e.length!==5)throw new ie("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new ie("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new ws({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return ge(()=>{let s=at(e);if(s.shape.length!==5)throw new ie(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const u=r[l],h=r[o],f=r[a],p=this.kernelSize[0],g=this.kernelSize[1],b=this.kernelSize[2],T=this.strides[0],w=this.strides[1],_=this.strides[2],C=fa(u,T,p,this.padding),N=fa(h,w,g,this.padding),A=fa(f,_,b,this.padding),P=[i,C,N,A,this.filters];this.dataFormat!=="channelsLast"&&(s=Ft(s,[0,2,3,4,1]));let V=a_e(s,this.kernel.read(),P,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(V=Ft(V,[0,4,1,2,3])),this.bias!==null&&(V=Vo(V,this.bias.read(),this.dataFormat)),this.activation!==null&&(V=this.activation.apply(V)),V})}computeOutputShape(e){e=Gt(e);const t=e.slice();let s,r,i,o;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3,o=4):(s=4,r=1,i=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],h=this.strides[0],f=this.strides[1],p=this.strides[2];return t[s]=this.filters,t[r]=fa(t[r],h,a,this.padding),t[i]=fa(t[i],f,l,this.padding),t[o]=fa(t[o],p,u,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}S7.className="Conv3DTranspose";Oe(S7);class _7 extends Rp{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new ie("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new ie("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new ie(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=On(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Pn(t.depthwiseRegularizer),this.depthwiseConstraint=xs(t.depthwiseConstraint),this.pointwiseInitializer=On(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Pn(t.pointwiseRegularizer),this.pointwiseConstraint=xs(t.pointwiseConstraint)}build(e){if(e=Gt(e),e.length<this.rank+2)throw new ie(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new ie(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],r=this.kernelSize.concat([s,this.depthMultiplier]),i=[];for(let a=0;a<this.rank;++a)i.push(1);i.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new ws({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return ge(()=>{e=at(e);let s;if(this.rank===1)throw new bt("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Ft(e,[0,2,3,1])),s=v9(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Vo(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=Ft(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Bn(this.depthwiseInitializer),e.pointwiseInitializer=Bn(this.pointwiseInitializer),e.depthwiseRegularizer=bn(this.depthwiseRegularizer),e.pointwiseRegularizer=bn(this.pointwiseRegularizer),e.depthwiseConstraint=Ts(this.depthwiseConstraint),e.pointwiseConstraint=Ts(this.pointwiseConstraint),e}}_7.className="SeparableConv";class E7 extends _7{constructor(e){super(2,e)}}E7.className="SeparableConv2D";Oe(E7);class Ax extends Rp{constructor(e){super(1,e),Ax.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!H2(e.kernelSize,"number",1,1))throw new ie(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Ax.className="Conv1D";Oe(Ax);class I7 extends St{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return ge(()=>{if(e=at(e),this.dataFormat==="channelsLast"){const s=A1(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return A1(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=A1(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return A1(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}I7.className="Cropping2D";Oe(I7);class C7 extends St{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Jn(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,dke(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return ge(()=>{let s=at(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=Ft(s,[0,2,3,1]);const i=this.size[0]*r[2],o=this.size[1]*r[3],a=this.interpolation==="nearest"?fl.resizeNearestNeighbor(s,[i,o]):fl.resizeBilinear(s,[i,o]);return Ft(a,[0,3,1,2])}else{const i=this.size[0]*r[1],o=this.size[1]*r[2];return this.interpolation==="nearest"?fl.resizeNearestNeighbor(s,[i,o]):fl.resizeBilinear(s,[i,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}C7.className="UpSampling2D";Oe(C7);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function F2e(n,e,t=[1,1],s="valid",r,i){return ge(()=>{r==null&&(r=Po()),Jn(r);let o=r$(n,r);if(n.rank!==4)throw new ie(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new ie(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=Kk(o,e,t,s==="same"?"same":"valid","NHWC",i),r==="channelsFirst"&&(o=Ft(o,[0,3,1,2])),o})}class N7 extends Nx{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=On(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=xs(e.depthwiseConstraint),this.depthwiseRegularizer=Pn(e.depthwiseRegularizer)}build(e){if(e=Gt(e),e.length<4)throw new ie(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new ie(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ge(()=>{e=at(e);let s=F2e(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Vo(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=Gt(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=Ro(t,this.kernelSize[0],this.padding,this.strides[0]),o=Ro(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,i,o]:[e[0],i,o,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Bn(this.depthwiseInitializer),e.depthwiseRegularizer=bn(this.depthwiseRegularizer),e.depthwiseConstraint=Ts(this.depthwiseRegularizer),e}}N7.className="DepthwiseConv2D";Oe(N7);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function A7(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new ie("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(i){return i==null||Array.isArray(i)?i:[i]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function k7(n,e,t,s=!1,r,i,o=!1,a=!1){return ge(()=>{const l=e.shape.length;if(l<3)throw new ie(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(Oo(2,l));e=Ft(e,u),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=Ge(Ge(r,"bool"),"float32"),r.rank===l-1&&(r=$r(r,-1)),r=Ft(r,u)),s&&(e=Kh(e,0),r!=null&&(r=Kh(r,0)));const h=[];let f,p=t;const g=e.shape[0],b=Xh(e);let T;r!=null&&(T=Xh(r));for(let _=0;_<g;++_){const C=b[_],N=ge(()=>n(C,p));if(r==null)f=N[0],p=N[1];else{const A=ge(()=>{const P=T[_],V=rt(eo(P),P),D=Pe(ae(N[0],P),ae(p[0],V)),M=p.map(($,O)=>Pe(ae(N[1][O],P),ae($,V)));return{output:D,newStates:M}});f=A.output,p=A.newStates}a&&h.push(f)}let w;return a&&(w=Cl(h,1)),[f,w,p]})}class Ac extends St{constructor(e){super(e);let t;if(e.cell==null)throw new ie("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new a$({cells:e.cell}):t=e.cell,t.stateSize==null)throw new ie("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new ws({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Oo(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){dC(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const i=[];for(const o of t)i.push([e[0],o]);return[r].concat(i)}else return r}computeMask(e,t){return ge(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(i=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new bt("Constants support is not implemented in RNN yet.");dC(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new ws({shape:[t,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!jt(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new ie(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new ws({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){ge(()=>{if(!this.stateful)throw new ha("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new ie("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>ks([s,r])):this.states_=[ks([s,this.cell.stateSize])];else if(e==null)_t(this.states_),this.keptStates!=null&&(_t(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>ks([s,r])):this.states_[0]=ks([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new ie(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):_t(this.states_);for(let r=0;r<this.states_.length;++r){const i=e[r],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,o];if(!jt(i.shape,a))throw new ie(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[r]=i}}this.states_=this.states_.map(r=>Sa(r.clone()))})}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const i=A7(e,s,r,this.numConstants);e=i.inputs,s=i.initialState,r=i.constants;let o=[],a=[];if(s!=null){t.initialState=s,o=o.concat(s),this.stateSpec=[];for(const u of s)this.stateSpec.push(new ws({shape:u.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(t.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof Pa){const u=[e].concat(o),h=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=h;const p=super.apply(u,t);return this.inputSpec=f,p}else return super.apply(e,t)}call(e,t){return ge(()=>{const s=t==null?null:t.mask,r=t==null?null:t.training;let i=t==null?null:t.initialState;e=at(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new ie(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},u=k7((b,T)=>{const w=this.cell.call([b].concat(T),a);return[w[0],w.slice(1)]},e,i,this.goBackwards,s,null,this.unroll,this.returnSequences),h=u[0],f=u[1],p=u[2];this.stateful&&this.resetStates(p,r);const g=this.returnSequences?f:h;return this.returnState?[g].concat(p):g})}getInitialState(e){return ge(()=>{let t=ks(e.shape);return t=Ze(t,[1,2]),t=Db(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?cC(t,[1,s]):t):this.cell.stateSize>1?[cC(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===Ac.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),t)}static fromConfig(e,t,s={}){const r=t.cell,i=yl(r,s);return new e(Object.assign(t,{cell:i}))}}Ac.className="RNN";Oe(Ac);class kx extends St{}class i$ extends kx{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,$s(this.units,"units"),this.activation=dc(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=On(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=On(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=On(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Pn(e.kernelRegularizer),this.recurrentRegularizer=Pn(e.recurrentRegularizer),this.biasRegularizer=Pn(e.biasRegularizer),this.kernelConstraint=xs(e.kernelConstraint),this.recurrentConstraint=xs(e.recurrentConstraint),this.biasConstraint=xs(e.biasConstraint),this.dropout=np([1,cc([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=np([1,cc([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Gt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ge(()=>{if(e=e,e.length!==2)throw new ie(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=fc({ones:()=>eo(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=fc({ones:()=>eo(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?i=Ia(ae(e,o),this.kernel.read()):i=Ia(e,this.kernel.read()),this.bias!=null&&(i=Vo(i,this.bias.read())),a!=null&&(s=ae(s,a));let l=Pe(i,Ia(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:hc(this.activation),useBias:this.useBias,kernelInitializer:Bn(this.kernelInitializer),recurrentInitializer:Bn(this.recurrentInitializer),biasInitializer:Bn(this.biasInitializer),kernelRegularizer:bn(this.kernelRegularizer),recurrentRegularizer:bn(this.recurrentRegularizer),biasRegularizer:bn(this.biasRegularizer),activityRegularizer:bn(this.activityRegularizer),kernelConstraint:Ts(this.kernelConstraint),recurrentConstraint:Ts(this.recurrentConstraint),biasConstraint:Ts(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}i$.className="SimpleRNNCell";Oe(i$);class $7 extends Ac{constructor(e){e.cell=new i$(e),super(e)}call(e,t){return ge(()=>{this.cell.dropoutMask!=null&&(_t(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(_t(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return new e(t)}}$7.className="SimpleRNN";Oe($7);class o$ extends kx{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new ie("GRUCell does not support reset_after parameter set to true.");this.units=e.units,$s(this.units,"units"),this.activation=dc(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=dc(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=On(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=On(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=On(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Pn(e.kernelRegularizer),this.recurrentRegularizer=Pn(e.recurrentRegularizer),this.biasRegularizer=Pn(e.biasRegularizer),this.kernelConstraint=xs(e.kernelConstraint),this.recurrentConstraint=xs(e.recurrentConstraint),this.biasConstraint=xs(e.biasConstraint),this.dropout=np([1,cc([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=np([1,cc([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Gt(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ge(()=>{if(e=e,e.length!==2)throw new ie(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=fc({ones:()=>eo(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=fc({ones:()=>eo(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(e=ae(e,i[0]));let h=Ia(e,this.kernel.read());this.useBias&&(h=Vo(h,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=ae(r,o[0]));const f=this.recurrentKernel.read(),[p,g]=_i(f,[2*this.units,this.units],f.rank-1),b=Ia(r,p),[T,w,_]=_i(h,3,h.rank-1),[C,N]=_i(b,2,b.rank-1);a=this.recurrentActivation.apply(Pe(T,C)),l=this.recurrentActivation.apply(Pe(w,N));const A=Ia(ae(l,r),g);u=this.activation.apply(Pe(_,A));const P=Pe(ae(a,r),ae(Pe(1,Kn(a)),u));return[P,P]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:hc(this.activation),recurrentActivation:hc(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Bn(this.kernelInitializer),recurrentInitializer:Bn(this.recurrentInitializer),biasInitializer:Bn(this.biasInitializer),kernelRegularizer:bn(this.kernelRegularizer),recurrentRegularizer:bn(this.recurrentRegularizer),biasRegularizer:bn(this.biasRegularizer),activityRegularizer:bn(this.activityRegularizer),kernelConstraint:Ts(this.kernelConstraint),recurrentConstraint:Ts(this.recurrentConstraint),biasConstraint:Ts(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}o$.className="GRUCell";Oe(o$);class R7 extends Ac{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new o$(e),super(e)}call(e,t){return ge(()=>{this.cell.dropoutMask!=null&&(_t(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(_t(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}R7.className="GRU";Oe(R7);class $x extends kx{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,$s(this.units,"units"),this.activation=dc(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=dc(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=On(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=On(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=On(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Pn(e.kernelRegularizer),this.recurrentRegularizer=Pn(e.recurrentRegularizer),this.biasRegularizer=Pn(e.biasRegularizer),this.kernelConstraint=xs(e.kernelConstraint),this.recurrentConstraint=xs(e.recurrentConstraint),this.biasConstraint=xs(e.biasConstraint),this.dropout=np([1,cc([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=np([1,cc([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=Gt(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;r=new(t=class extends so{apply(l,u){const h=i.apply([o]),f=new W2().apply([o]),p=i.apply([o*2]);return yL(yL(h,f),p)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return ge(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new ie(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=fc({ones:()=>eo(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=fc({ones:()=>eo(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,h,f;0<this.dropout&&this.dropout<1&&(e=ae(e,o[0]));let p=Ia(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=ae(r,a[0])),p=Pe(p,Ia(r,this.recurrentKernel.read())),this.useBias&&(p=Vo(p,this.bias.read()));const[g,b,T,w]=_i(p,4,p.rank-1);l=this.recurrentActivation.apply(g),u=this.recurrentActivation.apply(b),h=Pe(ae(u,i),ae(l,this.activation.apply(T))),f=this.recurrentActivation.apply(w);const _=ae(f,this.activation.apply(h));return[_,_,h]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:hc(this.activation),recurrentActivation:hc(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Bn(this.kernelInitializer),recurrentInitializer:Bn(this.recurrentInitializer),biasInitializer:Bn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:bn(this.kernelRegularizer),recurrentRegularizer:bn(this.recurrentRegularizer),biasRegularizer:bn(this.biasRegularizer),activityRegularizer:bn(this.activityRegularizer),kernelConstraint:Ts(this.kernelConstraint),recurrentConstraint:Ts(this.recurrentConstraint),biasConstraint:Ts(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}$x.className="LSTMCell";Oe($x);class D7 extends Ac{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new $x(e),super(e)}call(e,t){return ge(()=>{this.cell.dropoutMask!=null&&(_t(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(_t(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}D7.className="LSTM";Oe(D7);class a$ extends kx{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return ge(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const i=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?o=[e[0]].concat(s):o=[o[0]].concat(s),o=l.call(o,t),i.push(o.slice(1))}s=[];for(const a of i.slice().reverse())s.push(...a);return[o[0]].concat(s)})}build(e){dC(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,r)=>{Ch(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=i=>({className:i.getClassName(),config:i.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,s={}){const r=[];for(const i of t.cells)r.push(yl(i,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return fC(e)}setWeights(e){const t=[];for(const s of this.cells){const r=s.weights.length,i=e.splice(r);for(let o=0;o<s.weights.length;++o)t.push([s.weights[o],i[o]])}Z2(t)}}a$.className="StackedRNNCells";Oe(a$);function fc(n){const{ones:e,rate:t,training:s=!1,count:r=1,dropoutFunc:i}=n,o=()=>i!=null?i(e(),t):I8(e(),t),a=()=>Ob(o,e,s);return!r||r<=1?Sa(a().clone()):Array(r).fill(void 0).map(a).map(u=>Sa(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var L2e=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class M7 extends Ac{constructor(e){if(e.unroll)throw new bt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new bt("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new ws({ndim:5})]}call(e,t){return ge(()=>{if(this.cell.dropoutMask!=null&&(_t(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(_t(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new ie("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return ge(()=>{const{stateSize:t}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)],o=ks(i);return Array.isArray(t)?Array(t.length).fill(o):[o]})}resetStates(e,t=!1){ge(()=>{if(!this.stateful)throw new ha("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)];if(s[0]==null)throw new ie("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>ks(i)):this.states_=[ks(i)];else if(e==null)_t(this.states_),this.keptStates!=null&&(_t(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>ks(i)):this.states_[0]=ks(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new ie(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):_t(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],u=i;if(!jt(l.shape,u))throw new ie(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>Sa(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:r,padding:i,strides:o,dilationRate:a}=this.cell,l=t==="channelsFirst",u=e[l?3:2],h=e[l?4:3],f=Ro(u,r[0],i,o[0],a[0]),p=Ro(h,r[1],i,o[1],a[1]);return[...e.slice(0,2),...l?[s,f,p]:[f,p,s]]}}M7.className="ConvRNN2D";class l$ extends $x{constructor(e){const{filters:t,kernelSize:s,strides:r,padding:i,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,$s(this.filters,"filters"),this.kernelSize=Mf(s,2,"kernelSize"),this.kernelSize.forEach(l=>$s(l,"kernelSize")),this.strides=Mf(r||1,2,"strides"),this.strides.forEach(l=>$s(l,"strides")),this.padding=i||"valid",Ni(this.padding),this.dataFormat=o||"channelsLast",Jn(this.dataFormat),this.dilationRate=Mf(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>$s(l,"dilationRate"))}build(e){var t;e=Gt(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new ie(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],i=4,o=this.kernelSize.concat([r,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,h=this.filters;l=new(t=class extends so{apply(p,g){const b=u.apply([h]),T=Cc([h]),w=u.apply([h*2]);return q2([b,T,w])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return ge(()=>{if(e.length!==3)throw new ie(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,r=e[0],i=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=fc({ones:()=>eo(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(be,W,ne)=>!W||!W[ne]?be:ae(W[ne],be);let h=u(r,l,0),f=u(r,l,1),p=u(r,l,2),g=u(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=fc({ones:()=>eo(i),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const b=this.recurrentDropoutMask;let T=u(i,b,0),w=u(i,b,1),_=u(i,b,2),C=u(i,b,3);const N=3,[A,P,V,D]=_i(this.kernel.read(),a,N),[M,$,O,k]=this.useBias?_i(this.bias.read(),a):[null,null,null,null];h=this.inputConv(h,A,M,this.padding),f=this.inputConv(f,P,$,this.padding),p=this.inputConv(p,V,O,this.padding),g=this.inputConv(g,D,k,this.padding);const[z,U,te,se]=_i(this.recurrentKernel.read(),a,N);T=this.recurrentConv(T,z),w=this.recurrentConv(w,U),_=this.recurrentConv(_,te),C=this.recurrentConv(C,se);const X=this.recurrentActivation.apply(Pe(h,T)),Q=this.recurrentActivation.apply(Pe(f,w)),re=Pe(ae(Q,o),ae(X,this.activation.apply(Pe(p,_)))),fe=ae(this.recurrentActivation.apply(Pe(g,C)),this.activation.apply(re));return[fe,fe,re]})}getConfig(){const e=super.getConfig(),{units:t}=e,s=L2e(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(e,t,s,r){const i=Wh(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Vo(i,s,this.dataFormat):i}recurrentConv(e,t){return Wh(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}l$.className="ConvLSTM2DCell";Oe(l$);class O7 extends M7{constructor(e){const t=new l$(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}O7.className="ConvLSTM2D";Oe(O7);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class u$ extends St{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return s}call(e,t){return ge(()=>{this.invokeCallHook(e,t);const s=at(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,i=this.getNoiseShape(s);return Ob(()=>I8(s,this.rate,i,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}u$.className="Dropout";Oe(u$);class P7 extends u${constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}P7.className="SpatialDropout1D";Oe(P7);class F7 extends St{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,$s(this.units,"units"),this.activation=dc(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=On(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=On(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=xs(e.kernelConstraint),this.biasConstraint=xs(e.biasConstraint),this.kernelRegularizer=Pn(e.kernelRegularizer),this.biasRegularizer=Pn(e.biasRegularizer),this.activityRegularizer=Pn(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Gt(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=Gt(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return ge(()=>{this.invokeCallHook(e,t);const s=at(e),r=v8(this.activation.getClassName());let i;return r!=null?i=Ia(s,this.kernel.read(),r,this.bias?this.bias.read():null):(i=Ia(s,this.kernel.read()),this.bias!=null&&(i=Vo(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:hc(this.activation),useBias:this.useBias,kernelInitializer:Bn(this.kernelInitializer),biasInitializer:Bn(this.biasInitializer),kernelRegularizer:bn(this.kernelRegularizer),biasRegularizer:bn(this.biasRegularizer),activityRegularizer:bn(this.activityRegularizer),kernelConstraint:Ts(this.kernelConstraint),biasConstraint:Ts(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}F7.className="Dense";Oe(F7);class L7 extends St{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Gt(e);for(const t of e.slice(1))if(t==null)throw new ie(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Ku(e,1)]}call(e,t){return ge(()=>{this.invokeCallHook(e,t);let s=at(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let i=2;i<s.rank;++i)r.push(i);r.push(1),s=Ft(s,r)}return bke(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}L7.className="Flatten";Oe(L7);class V7 extends St{constructor(e){super(e),this.supportsMasking=!0,this.activation=dc(e.activation)}call(e,t){return ge(()=>{this.invokeCallHook(e,t);const s=at(e);return this.activation.apply(s)})}getConfig(){const e={activation:hc(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}V7.className="Activation";Oe(V7);class B7 extends St{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return ge(()=>(e=at(e),gke(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}B7.className="RepeatVector";Oe(B7);class U7 extends St{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",r=t.slice();let i=1,o=null;for(let l=0;l<r.length;++l){const u=r[l];if(this.isUnknown(u))if(o===null)o=l;else throw new ie("Can only specifiy one unknown dimension.");else i*=u}const a=Ku(e);if(o!==null){if(i===0||a%i!==0)throw new ie(s);r[o]=a/i}else if(a!==i)throw new ie(s);return r}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return ge(()=>{this.invokeCallHook(e,t);const s=at(e),r=s.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return ce(s,i)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}U7.className="Reshape";Oe(U7);class z7 extends St{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=Oo(1,e.dims.length+1);if(!jt(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new ws({ndim:this.dims.length+1})]}computeOutputShape(e){e=Gt(e);const t=e.slice();return this.dims.forEach((s,r)=>{t[r+1]=e[s]}),t}call(e,t){return Ft(at(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}z7.className="Permute";Oe(z7);class G7 extends St{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=at(e);return sC(tw(s,this.maskValue),-1)}call(e,t){return ge(()=>{this.invokeCallHook(e,t);const s=at(e),o=sC(tw(s,this.maskValue),-1,!0);return ae(s,Ge(o,s.dtype))})}}G7.className="Masking";Oe(G7);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class H7 extends St{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(rn(e.inputLength))}this.inputDim=e.inputDim,$s(this.inputDim,"inputDim"),this.outputDim=e.outputDim,$s(this.outputDim,"outputDim"),this.embeddingsInitializer=On(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Pn(e.embeddingsRegularizer),this.activityRegularizer=Pn(e.activityRegularizer),this.embeddingsConstraint=xs(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return ge(()=>this.maskZero?(e=at(e),tw(e,Lt(e))):null)}computeOutputShape(e){if(e=Gt(e),this.inputLength==null)return[...e,this.outputDim];const t=rn(this.inputLength);if(t.length!==e.length-1)throw new ie(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<t.length;++r){const i=t[r],o=e[r+1];if(i!=null&&o!=null&&i!==o)throw new ie(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(t[s]=o),s++}}return[e[0],...t,this.outputDim]}call(e,t){return ge(()=>{this.invokeCallHook(e,t);let s=at(e);s.dtype!=="int32"&&(s=Ea(s,"int32"));const r=E8(this.embeddings.read(),ce(s,[s.size]));return ce(r,Gt(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Bn(this.embeddingsInitializer),embeddingsRegularizer:bn(this.embeddingsRegularizer),activityRegularizer:bn(this.activityRegularizer),embeddingsConstraint:Ts(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}H7.className="Embedding";Oe(H7);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ld extends St{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new bt}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const i=e[e.length-t.length+r],o=t[r];if(i==null||o==null||i<0||o<0)s.push(null);else if(i===1)s.push(o);else if(o===1)s.push(i);else{if(i!==o)throw new ie("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(i)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Gt(e)]),e=e,e.length<2)throw new ie(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const i of e)i!=null&&i[0]!==null&&t.push(i[0]);if(t=Wu(t),t.length>1)throw new ie(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const r=e.map(i=>i.length);e.indexOf(null)===-1&&Wu(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return ge(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(i=>i.rank);if(r.indexOf(null)===-1){const i=cc(r);for(let o of e){const a=o.rank;for(let l=0;l<i-a;++l)o=Db(o,1);s.push(o)}return this.mergeFunction(s)}else{let i=!1;for(const l of e){const u=l.rank;if(u==null){const h=l.shape,f=h[0],p=h.slice(1).concat([f]);let g=ce(l,[f].concat(Ku(h.slice(1))));g=Ft(g,[1,0]),g=ce(g,p),s.push(g),i=!0}else if(u>1){const h=Oo(1,u).concat([0]);s.push(Ft(l,h)),i=!0}else s.push(l)}let o=this.mergeFunction(s);const a=o.rank;if(i){if(a==null){const l=o.shape,u=l.length,h=l[u-1],f=[h].concat(l.slice(0,l.length-1));o=ce(Ft(ce(o,[-1,h]),[1,0]),f)}else if(a>1){const l=[a-1].concat(Oo(0,a-1));o=Ft(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const i=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,i)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=Wu(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return ge(()=>{if(t==null)return null;if(!Array.isArray(t))throw new ie("`mask` should be an Array");if(!Array.isArray(e))throw new ie("`inputs` should be an Array");if(t.length!==e.length)throw new ie(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:$r(r,0));let s=t[0];for(let r=1;r<t.length-1;++r)s=Il(s,t[r]);return s})}}class q7 extends ld{constructor(e){super(e)}mergeFunction(e){return ge(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Pe(t,e[s]);return t})}}q7.className="Add";Oe(q7);class W7 extends ld{constructor(e){super(e)}mergeFunction(e){return ge(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=ae(t,e[s]);return t})}}W7.className="Multiply";Oe(W7);class K7 extends ld{constructor(e){super(e)}mergeFunction(e){return ge(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Pe(t,e[s]);return ae(1/e.length,t)})}}K7.className="Average";Oe(K7);class X7 extends ld{constructor(e){super(e)}mergeFunction(e){return ge(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=Ic(t,e[s]);return t})}}X7.className="Maximum";Oe(X7);class Y7 extends ld{constructor(e){super(e)}mergeFunction(e){return ge(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=Wg(t,e[s]);return t})}}Y7.className="Minimum";Oe(Y7);class J7 extends ld{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new ie("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const s=[];for(let r=0;r<e.length;++r){const i=e[r].slice();i.splice(this.axis,1);let o=!1;for(const a of s)if(jt(a,i)){o=!0;break}o||s.push(i)}if(s.length>1)throw new ie("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return ge(()=>q2(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new ie("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const i of t.slice(1)){if(s[r]==null||i[r]==null){s[r]=null;break}s[r]+=i[r]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new ie("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new ie("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new ie(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return ge(()=>{let s=!0;if(t.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const r=[];for(let o=0;o<e.length;++o)t[o]==null?r.push(Ge(eo(e[o]),"bool")):t[o].rank<e[o].rank?r.push($r(t[o],-1)):r.push(t[o]);const i=Mr(r,this.axis);return e9(i,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}J7.className="Concatenate";Oe(J7);function Xm(n,e){for(;n<0;)n+=e;return n}function V2e(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new bt("batchDot is not implemented for tensors of 4D or higher rank yet");if(q(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),q(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new bt("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=e.shape.length;t==null&&(t=[s-1,r-2]);const i=t;return ge(()=>{let o;if(s>r){o=s-r;const l=[];for(let u=0;u<o;++u)l.push(1);e=ce(e,e.shape.concat(l))}else if(r>s){o=r-s;const l=[];for(let u=0;u<o;++u)l.push(1);n=ce(n,n.shape.concat(l))}else o=0;let a;if(n.shape.length===2&&e.shape.length===2)i[0]===i[1]?a=Ze(ae(n,e),i[0]):a=Ze(ae(Ft(n,[1,0]),e),i[1]);else{const l=i[0]!==n.shape.length-1,u=i[1]===e.shape.length-1;a=Xt(n,e,l,u)}if(o>0){let l;s>r?l=s+r-3:l=s-1;const u=[];for(let h=l;h<l+o;++h)u.push(h);a=Cb(a,u)}return a.shape.length===1&&(a=$r(a,1)),a})}class j7 extends ld{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){q(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new bt("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);if(t[r[0]]!==s[r[1]])throw new ie(`Dimension incompatibility: ${t[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new ie(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((i,o)=>Xm(i,e[o].shape.length)):r=[Xm(this.axes,t.shape.length),Xm(this.axes,s.shape.length)],this.normalize&&(t=lw(t,r[0]),s=lw(s,r[1])),V2e(t,s,r)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[Xm(this.axes,e.length),Xm(this.axes,t.length)],s}computeOutputShape(e){q(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new bt("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);t.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const i=t.concat(s);return i.length===1&&i.push(1),i}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}j7.className="Dot";Oe(j7);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Q7 extends St{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return ge(()=>{this.invokeCallHook(e,t);const s=at(e);return Ob(()=>Pe(_x(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}Q7.className="GaussianNoise";Oe(Q7);class Z7 extends St{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ge(()=>{this.invokeCallHook(e,t);const s=at(e);return this.rate>0&&this.rate<1?Ob(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return ae(s,_x(s.shape,1,i))},()=>s,t.training||!1):s})}}Z7.className="GaussianDropout";Oe(Z7);class eK extends St{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||at(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ge(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return Ob(()=>{const i=at(e),a=-1.6732632423543772*1.0507009873554805;let l=rd(Ib(s),this.rate);l=Ea(l,"float32");const u=((1-this.rate)*(1+this.rate*a**2))**-.5,h=-u*a*this.rate,f=Pe(ae(i,l),ae(Pe(l,-1),a));return Pe(ae(f,u),h)},()=>at(e),t.training||!1)}return e})}}eK.className="AlphaDropout";Oe(eK);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jg(n,e,t,s,r,i=.001){let o;if(n.rank===2)o=MSe(n,e,t,s,r,i);else if(n.rank===3)o=PSe(n,e,t,s,r,i);else if(n.rank===4)o=LSe(n,e,t,s,r,i);else throw new bt(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return o}function B2e(n,e,t,s,r=.001){return ge(()=>{const i=e2(n,s),o=i.mean,a=i.variance;return[jg(n,o,a,t,e,r),o,a]})}function U2e(n,e,t,s,r=.001){return ge(()=>{const i=e2(n,s),o=i.mean,a=i.variance,l=[];for(const b of Oo(0,n.rank))s.indexOf(b)!==-1?l.push(1):l.push(n.shape[b]);const u=ce(o,l),h=ce(a,l),f=e==null?null:ce(e,l),p=t==null?null:ce(t,l);return[jg(n,u,h,p,f,r),o,a]})}function z2e(n,e,t,s,r=.001){return jt(s.slice().sort(),Oo(0,n.rank-1))?B2e(n,e,t,s,r):U2e(n,e,t,s,r)}class tK extends St{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=On(e.betaInitializer||"zeros"),this.gammaInitializer=On(e.gammaInitializer||"ones"),this.movingMeanInitializer=On(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=On(e.movingVarianceInitializer||"ones"),this.betaConstraint=xs(e.betaConstraint),this.gammaConstraint=xs(e.gammaConstraint),this.betaRegularizer=Pn(e.betaRegularizer),this.gammaRegularizer=Pn(e.gammaRegularizer)}build(e){e=Gt(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new ie(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new ws({ndim:e.length,axes:{[t]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return ge(()=>{const s=t.training==null?!1:t.training,r=at(e),i=r.shape,o=i.length,a=Oo(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const u=Yh(1,o);u[l]=i[l];const h=a.slice();h.sort();const f=!jt(h,Oo(0,o).slice(0,o-1)),p=()=>{if(f){const C=ce(this.movingMean.read(),u),N=ce(this.movingVariance.read(),u),A=this.center?ce(this.beta.read(),u):null,P=this.scale?ce(this.gamma.read(),u):null;return jg(r,C,N,A,P,this.epsilon)}else return jg(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return p();const[g,b,T]=z2e(r,this.gamma.read(),this.beta.read(),a,this.epsilon),w=(C,N,A)=>{ge(()=>{const P=1-A,V=C.read(),D=ae(rt(V,N),P);C.write(rt(V,D))})};return(()=>{w(this.movingMean,b,this.momentum),w(this.movingVariance,T,this.momentum)})(),g})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Bn(this.betaInitializer),gammaInitializer:Bn(this.gammaInitializer),movingMeanInitializer:Bn(this.movingMeanInitializer),movingVarianceInitializer:Bn(this.movingVarianceInitializer),betaRegularizer:bn(this.betaRegularizer),gammaRegularizer:bn(this.gammaRegularizer),betaConstraint:Ts(this.betaConstraint),gammaConstraint:Ts(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}tK.className="BatchNormalization";Oe(tK);class nK extends St{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=On(e.betaInitializer||"zeros"),this.gammaInitializer=On(e.gammaInitializer||"ones"),this.betaRegularizer=Pn(e.betaRegularizer),this.gammaRegularizer=Pn(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Gt(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=t);for(const i of this.axis)if(i<0||i>=t)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==Wu(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(i=>e[i]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const s=at(e),r=s.shape,i=r.length;return ge(()=>{let{mean:a,variance:l}=e2(s,this.axis,!0);const u=Yh(1,i);for(const T of this.axis)u[T]=r[T];const h=T=>T!=null&&T.shape.length!==i?ce(T,u):T;let f=this.scale?h(this.gamma.read()):null,p=this.center?h(this.beta.read()):null;const g=[],b=[];for(let T=0;T<i;++T)this.axis.indexOf(T)!==-1?(g.push(r[T]),b.push(1)):(g.push(1),b.push(r[T]));return a=Co(a,g),l=Co(l,g),f!=null&&(f=Co(f,b)),p!=null&&(p=Co(p,b)),jg(s,a,l,p,f,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Bn(this.betaInitializer),gammaInitializer:Bn(this.gammaInitializer),betaRegularizer:bn(this.betaRegularizer),gammaRegularizer:bn(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}nK.className="LayerNormalization";Oe(nK);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function G2e(n,e,t){return ge(()=>{if(n.rank!==4)throw new ie(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new ie("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=Po()),t!=="channelsLast"&&t!=="channelsFirst")throw new ie(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],t2(n,s)})}class sK extends St{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Po():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new ie(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new ie(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new ie(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new ws({ndim:4})]}computeOutputShape(e){e=Gt(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return ge(()=>G2e(at(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}sK.className="ZeroPadding2D";Oe(sK);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Rx(n,e,t,s,r,i){return ge(()=>{Jn(r),T8(i),Ni(s),t==null&&(t=[1,1]),s==null&&(s="valid"),r==null&&(r=Po()),i==null&&(i="max"),n=r$(n,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=Zk(n,e,t,a):o=zk(n,e,t,a),r==="channelsFirst"&&(o=Ft(o,[0,3,1,2])),o})}function rK(n,e,t,s,r,i){return ge(()=>{Jn(r),T8(i),Ni(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),r==null&&(r=Po()),i==null&&(i="max"),n=T7(n,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=SEe(n,e,t,a):o=_Se(n,e,t,a),r==="channelsFirst"&&(o=Ft(o,[0,4,1,2,3])),o})}class iK extends St{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new ie(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if($s(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new ie(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);$s(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Ni(this.padding),this.inputSpec=[new ws({ndim:3})]}computeOutputShape(e){e=Gt(e);const t=Ro(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return ge(()=>{this.invokeCallHook(e,t),e=Db(at(e),2);const s=this.poolingFunction(at(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Cb(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class oK extends iK{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return Jn(i),Ni(r),Rx(e,t,s,r,i,"max")}}oK.className="MaxPooling1D";Oe(oK);class aK extends iK{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return Jn(i),Ni(r),Rx(e,t,s,r,i,"avg")}}aK.className="AveragePooling1D";Oe(aK);class lK extends St{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new ie(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];$s(this.poolSize,"poolSize"),$s(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Jn(this.dataFormat),Ni(this.padding),this.inputSpec=[new ws({ndim:4})]}computeOutputShape(e){e=Gt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=Ro(t,this.poolSize[0],this.padding,this.strides[0]),s=Ro(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return ge(()=>(this.invokeCallHook(e,t),this.poolingFunction(at(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class uK extends lK{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return Jn(i),Ni(r),Rx(e,t,s,r,i,"max")}}uK.className="MaxPooling2D";Oe(uK);class cK extends lK{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return Jn(i),Ni(r),Rx(e,t,s,r,i,"avg")}}cK.className="AveragePooling2D";Oe(cK);class hK extends St{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new ie(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];$s(this.poolSize,"poolSize"),$s(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Jn(this.dataFormat),Ni(this.padding),this.inputSpec=[new ws({ndim:5})]}computeOutputShape(e){e=Gt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=Ro(t,this.poolSize[0],this.padding,this.strides[0]),s=Ro(s,this.poolSize[1],this.padding,this.strides[1]),r=Ro(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,r]:[e[0],t,s,r,e[4]]}call(e,t){return ge(()=>(this.invokeCallHook(e,t),this.poolingFunction(at(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class dK extends hK{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return Jn(i),Ni(r),rK(e,t,s,r,i,"max")}}dK.className="MaxPooling3D";Oe(dK);class fK extends hK{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return Jn(i),Ni(r),rK(e,t,s,r,i,"avg")}}fK.className="AveragePooling3D";Oe(fK);class pK extends St{constructor(e){super(e),this.inputSpec=[new ws({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new bt}}class mK extends pK{constructor(e){super(e||{})}call(e,t){return ge(()=>{const s=at(e);return ss(s,1)})}}mK.className="GlobalAveragePooling1D";Oe(mK);class gK extends pK{constructor(e){super(e||{})}call(e,t){return ge(()=>{const s=at(e);return $o(s,1)})}}gK.className="GlobalMaxPooling1D";Oe(gK);class yK extends St{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Jn(this.dataFormat),this.inputSpec=[new ws({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new bt}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class bK extends yK{call(e,t){return ge(()=>{const s=at(e);return this.dataFormat==="channelsLast"?ss(s,[1,2]):ss(s,[2,3])})}}bK.className="GlobalAveragePooling2D";Oe(bK);class vK extends yK{call(e,t){return ge(()=>{const s=at(e);return this.dataFormat==="channelsLast"?$o(s,[1,2]):$o(s,[2,3])})}}vK.className="GlobalMaxPooling2D";Oe(vK);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class wK extends St{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const r=t.layer,i=yl(r,s);delete t.layer;const o={layer:i};return Object.assign(o,t),new e(o)}}class TK extends wK{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Gt(e),e.length<3)throw new ie(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Gt(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,t){return ge(()=>(e=at(e),k7((o,a)=>[at(this.layer.call(o,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}TK.className="TimeDistributed";Oe(TK);function H2e(n){ad(hke,"BidirectionalMergeMode",n)}const q2e="concat";class xK extends wK{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=yl(s),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=yl(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?q2e:e.mergeMode,H2e(this.mergeMode),e.weights)throw new bt("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,r,i;return this.returnState&&(i=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(i).concat(i.slice()):[s].concat(i).concat(i.slice()):Rr(r)}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const i=A7(e,s,r,this.numConstants);if(e=i.inputs,s=i.initialState,r=i.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,t);const o=[],a=[];if(s!=null){const u=s.length;if(u%2>0)throw new ie("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,o.push(...s);const h=s.map(f=>new ws({shape:f.shape}));this.forwardLayer.stateSpec=h.slice(0,u/2),this.backwardLayer.stateSpec=h.slice(u/2),a.push(...h)}if(r!=null)throw new bt("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof Pa;for(const u of o)if(u instanceof Pa!==l)throw new ie("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[e].concat(o),h=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=h;const p=super.apply(u,t);return this.inputSpec=f,p}else return super.apply(e,t)}call(e,t){return ge(()=>{const s=t.initialState;let r,i;if(s==null)r=this.forwardLayer.call(e,t),i=this.backwardLayer.call(e,t);else{const l=s.slice(0,s.length/2),u=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),i=this.backwardLayer.call(e,Object.assign(t,{initialState:u}))}let o;this.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=Kh(i,1));let a;return this.mergeMode==="concat"?a=q2([r,i]):this.mergeMode==="sum"?a=Pe(r,i):this.mergeMode==="ave"?a=ae(.5,Pe(r,i)):this.mergeMode==="mul"?a=ae(r,i):this.mergeMode==null&&(a=[r,i]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Ch(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Ch(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(i).concat(i):[s].concat(i).concat(i)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=yl(t.layer);if(delete t.layer,t.numConstants!=null)throw new bt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=s,new e(r)}}xK.className="Bidirectional";Oe(xK);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class SK extends St{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ge(()=>(e=at(e),e.dtype!=="float32"&&(e=Ea(e,"float32")),Pe(ae(e,this.scale),this.offset)))}}SK.className="Rescaling";Oe(SK);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:W2e,cropAndResize:K2e}=fl;class _K extends St{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,s,r,i,o,a,l){return ge(()=>{let u,h=!1;const f=t/o,p=s/a,g=(r+t)/o,b=(i+s)/a,T=[f,p,g,b],w=[];e.rank===3?(h=!0,u=Cl([e])):u=e;for(let P=0;P<u.shape[0];P++)w.push(T);const _=H5(w,[w.length,4]),C=Kg(0,w.length,1,"int32"),A=K2e(u,_,C,[r,i],"nearest");return Ea(h?at(Xh(A)):A,l)})}upsize(e,t,s,r){return ge(()=>{const i=W2e(e,[t,s]);return Ea(i,r)})}call(e,t){return ge(()=>{const s=at(e),r=s.dtype,i=s.shape,o=i[i.length-3],a=i[i.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(s,l,u,this.height,this.width,o,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Gt(e);const t=e.length-3,s=e.length-2;return e[t]=this.height,e[s]=this.width,e}}_K.className="CenterCrop";Oe(_K);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function X2e(n,e,t,s){let r=at(n);if(r.dtype!=="int32"&&(r=Ea(r,"int32")),e==="int")return r;const i=r.shape;if(r.rank===0&&(r=$r(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=$r(r,-1)),r.rank>2)throw new ie(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${r.rank}.`);const o=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof s<"u"&&e==="count"?l=nL(a,s,t,o):l=nL(a,[],t,o),e!=="tfIdf")return l;if(s)return ae(l,s);throw new ie("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class EK extends St{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=Gt(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return ge(()=>{e=at(e),e.dtype!=="int32"&&(e=Ea(e,"int32"));let s;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new ie(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);s=at(t.countWeights)}const r=$o(e),i=Zv(e),o=Ci(this.numTokens,r).bufferSync().get(0),a=rd(i,0).bufferSync().get(0);if(!(o&&a))throw new ie(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return X2e(e,this.outputMode,this.numTokens,s)})}}EK.className="CategoryEncoding";Oe(EK);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Y2e=["bilinear","nearest"],OL=new Set(Y2e);class IK extends St{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(OL.has(e.interpolation))this.interpolation=e.interpolation;else throw new ie(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Gt(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ge(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return fl.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return fl.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...OL]} are supported`)})}}IK.className="Resizing";Oe(IK);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class CK{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}CK.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class NK extends St{constructor(e){super(e),this.randomGenerator=new CK(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}NK.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const J2e=["bilinear","nearest"],PL=new Set(J2e);class AK extends NK{constructor(e){super(e);const{factor:t,interpolation:s="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new ie(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new ie(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new ie(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(PL.has(s))this.interpolation=s;else throw new ie(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Gt(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return ge(()=>{const s=at(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=Ib([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*r;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return fl.resizeBilinear(e,o);case"nearest":return fl.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...PL]} are supported`)}})}}AK.className="RandomWidth";Oe(AK);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j2e=we();j2e.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var FL;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(FL||(FL={}));var LL;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(LL||(LL={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var VL;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(VL||(VL={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ye(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&q(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q2e=C9;class Dx extends WA{nextDataId(){return Dx.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new e5(this,aa())}write(e,t,s){this.firstUse&&(this.firstUse=!1,we().get("IS_NODE")&&wi(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&Ny(s[0])){const i=s.map(o=>qu(o));r=this.write(i,e,t)}else r=this.write(s,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,r,i){this.data.set(e,{values:t,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const r=this.readSync(s.real.dataId),i=this.readSync(s.imag.dataId);return Nl(r,i)}return UTe(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>uc(r));return Tt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Tt(e.shape,e.dtype,t)}makeOutput(e,t,s){return aa().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=kr();return e(),{kernelMs:kr()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Ye([e],"where");const t=this.readSync(e.dataId);return Q2e(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Dx.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kK(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const Z2e=n=>{const{x:e}=n.inputs,t=n.backend;Ye(e,"abs");let s=new Float32Array(Ee(e.shape));const r=t.data.get(e.dataId).values;return s=kK(r),t.makeOutput(s,e.shape,e.dtype)},e$e={kernelName:hT,backendName:"cpu",kernelFunc:Z2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jn(n){return(e,t,s,r,i)=>{const o=pt(e,t),a=o.length,l=Qe(o),u=Ee(o),h=ir(i,u),f=e.length,p=t.length,g=Qe(e),b=Qe(t),T=Zf(e,o),w=Zf(t,o);if(T.length+w.length===0)for(let _=0;_<h.length;++_)h[_]=n(s[_%s.length],r[_%r.length]);else for(let _=0;_<h.length;++_){const C=Ep(_,a,l),N=C.slice(-f);T.forEach(D=>N[D]=0);const A=xa(N,f,g),P=C.slice(-p);w.forEach(D=>P[D]=0);const V=xa(P,p,b);h[_]=n(s[A],r[V])}return[h,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ri(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,a=t.makeTensorInfo(s.shape,"complex64"),l=t.data.get(a.dataId);return l.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",i),imag:t.makeTensorInfo(r.shape,"float32",o)},a}const t$e={kernelName:ik,backendName:"cpu",kernelFunc:ri};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fw(n,e,t="float32"){if(t==="complex64"){const r=fw(n,e,"float32"),i=fw(n,e,"float32");return ri({inputs:{real:r,imag:i},backend:n})}const s=or(Ee(e),t);return n.makeTensorInfo(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fa(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const n$e={kernelName:Yy,backendName:"cpu",kernelFunc:Fa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jh(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.real,i=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,i)}const s$e={kernelName:Ak,backendName:"cpu",kernelFunc:Jh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $K(n,e,t,s){if(s==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(s==="bool"){const r=sd([0],t),[i,o]=jn((a,l)=>a!==l?1:0)(e,[],n,r,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function pc(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return Fa({inputs:{x:r},backend:t});const h=fw(t,r.shape,r.dtype),f=pc({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),p=ri({inputs:{real:f,imag:h},backend:t});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),p}if(r.dtype==="complex64"){const h=Jh({inputs:{input:r},backend:t}),f=pc({inputs:{x:h},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(h),f}if(!s5(r.dtype,i)){const h=Fa({inputs:{x:r},backend:t});return{dataId:h.dataId,shape:h.shape,dtype:i}}const o=t.data.get(r.dataId).values,[a,l,u]=$K(o,r.shape,r.dtype,i);return t.makeTensorInfo(a,l,u)}const r$e={kernelName:Py,backendName:"cpu",kernelFunc:pc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _s(n,e,t,s){return t==null?({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;Ye([o,a],n);const u=l.data.get(o.dataId).values,h=l.data.get(a.dataId).values,f=o.dtype==="string"?Al(u):u,p=o.dtype==="string"?Al(h):h,g=s||o.dtype,[b,T]=e(o.shape,a.shape,f,p,g);return l.makeTensorInfo(T,g,b)}:({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;if(o.dtype==="complex64"||a.dtype==="complex64"){const u=pc({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),h=l.data.get(u.dataId),f=h.complexTensorInfos.real,p=h.complexTensorInfos.imag,g=l.data.get(f.dataId).values,b=l.data.get(p.dataId).values,T=pc({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),w=l.data.get(T.dataId),_=w.complexTensorInfos.real,C=w.complexTensorInfos.imag,N=l.data.get(_.dataId).values,A=l.data.get(C.dataId).values,[P,V,D]=t(o.shape,a.shape,g,b,N,A),M=l.makeTensorInfo(D,"float32",P),$=l.makeTensorInfo(D,"float32",V),O=ri({inputs:{real:M,imag:$},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(T),l.disposeIntermediateTensorInfo(M),l.disposeIntermediateTensorInfo($),O}else{const u=l.data.get(o.dataId).values,h=l.data.get(a.dataId).values,f=s||o.dtype,[p,g]=e(o.shape,a.shape,u,h,f);return l.makeTensorInfo(g,f,p)}}}function c$(n){return(e,t,s,r,i,o)=>{const a=pt(e,t),l=Ee(a),u=a.length,h=Qe(a),f=ir("float32",l),p=ir("float32",l),g=Zf(e,a),b=Zf(t,a),T=Nl(s,r),w=Nl(i,o),_=e.length,C=Qe(e),N=t.length,A=Qe(t);if(g.length+b.length===0)for(let P=0;P<f.length;P++){const V=P%T.length,D=P%w.length,M=n(T[V*2],T[V*2+1],w[D*2],w[D*2+1]);f[P]=M.real,p[P]=M.imag}else for(let P=0;P<f.length;P++){const V=Ep(P,u,h),D=V.slice(-_);g.forEach(z=>D[z]=0);const M=xa(D,_,C),$=V.slice(-N);b.forEach(z=>$[z]=0);const O=xa($,N,A),k=n(T[M*2],T[M*2+1],w[O*2],w[O*2+1]);f[P]=k.real,p[P]=k.imag}return[f,p,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RK=jn(((n,e)=>n+e)),i$e=c$(((n,e,t,s)=>({real:n+t,imag:e+s}))),sp=_s(Ip,RK,i$e),o$e={kernelName:Ip,backendName:"cpu",kernelFunc:sp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h$(n,e,t,s,r){const i=Ee(s),o=or(r,t);for(let a=0;a<n.length;a++){const l=n[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(i>0?o[l]+=e[a]:o[l]+=1)}return o}function DK(n,e,t,s=!1){const r=n.shape[0],i=n.shape[1],o=Tt([r,t],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<i;l++){const u=n.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=t||(s?o.set(1,a,u):e.size>0?o.set(o.get(a,u)+e.get(a,l),a,u):o.set(o.get(a,u)+1,a,u))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MK=jn(((n,e)=>n&e)),a$e=_s(rk,MK),l$e={kernelName:rk,backendName:"cpu",kernelFunc:a$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function La(n){return(e,t,s)=>{const r=Wn(t,e.length);for(let i=0;i<e.length;++i)r[i]=n(e[i],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function an(n,e,t){const s=La(e);return kc(n,s,t)}function kc(n,e,t){return({inputs:s,attrs:r,backend:i})=>{const{x:o}=s;Ye(o,n);const a=i,l=a.data.get(o.dataId).values;let u;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=Al(l)}else u=l;const h=t||o.dtype,f=e(u,h,r);return a.makeTensorInfo(o.shape,h,f)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OK=La(n=>Math.ceil(n)),u$e=kc(Fy,OK),c$e={kernelName:Fy,backendName:"cpu",kernelFunc:u$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PK(n,e,t,s){const r=Wn(t,Ee(e));if(s&&t!=="string"){let i=0;n.forEach(o=>{const a=Ee(o.shape);r.set(o.vals,i),i+=a})}else{let i=0;n.forEach(o=>{const a=t==="string"?Al(o.vals):o.vals;let l=0;for(let u=0;u<o.shape[0];++u){const h=u*e[1]+i;for(let f=0;f<o.shape[1];++f)r[h+f]=a[l++]}i+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FK=jn((n,e)=>n===e?1:0),LK=_s(IT,FK,null,"bool"),h$e={kernelName:IT,backendName:"cpu",kernelFunc:LK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VK=La(n=>Math.exp(n)),BK=kc(Hy,VK,"float32"),d$e={kernelName:Hy,backendName:"cpu",kernelFunc:BK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UK=La(n=>Math.expm1(n)),f$e=kc(qy,UK),p$e={kernelName:qy,backendName:"cpu",kernelFunc:f$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zK=La(n=>Math.floor(n)),m$e=kc(Wy,zK),g$e={kernelName:Wy,backendName:"cpu",kernelFunc:m$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GK=jn((n,e)=>Math.floor(n/e)),y$e=_s(Ky,GK,null,"int32"),b$e={kernelName:Ky,backendName:"cpu",kernelFunc:y$e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HK(n,e,t,s,r,i,o,a,l){const u=Tt([s,i],t);for(let h=0;h<s;h++){const f=[];let p=0;for(let g=0;g<r;g++){const b=n[h*r+g];p+=b*o[g],f.push(b)}if(p<0||p>=l/i)throw new Error(`Invalid indices: ${f} does not index into ${a}`);for(let g=0;g<i;g++)u.values[h*i+g]=e.get(...e.indexToLoc(p*i+g))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qK(n,e,t){const s=Tt(t,n.dtype);for(let r=0;r<s.size;++r){const o=s.indexToLoc(r).slice(),a=o[0],l=o[2],u=e.locToIndex([a,l]);o[2]=e.values[u];const h=n.locToIndex(o);0<=h&&h<n.values.length&&(s.values[r]=n.values[h])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WK=jn((n,e)=>n>e?1:0),v$e=_s(kT,WK,null,"bool"),w$e={kernelName:kT,backendName:"cpu",kernelFunc:v$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KK=jn((n,e)=>n>=e?1:0),T$e=_s(Xy,KK,null,"bool"),x$e={kernelName:Xy,backendName:"cpu",kernelFunc:T$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XK=jn((n,e)=>n<e?1:0),S$e=_s(RT,XK,null,"bool"),_$e={kernelName:RT,backendName:"cpu",kernelFunc:S$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YK=jn((n,e)=>n<=e?1:0),E$e=_s(DT,YK,null,"bool"),I$e={kernelName:DT,backendName:"cpu",kernelFunc:E$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JK(n,e,t){const s=(e-n)/(t-1),r=or(t,"float32");r[0]=n;for(let i=1;i<r.length;i++)r[i]=r[i-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jK=La(n=>Math.log(n)),C$e=kc(Zy,jK),N$e={kernelName:Zy,backendName:"cpu",kernelFunc:C$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QK(n,e,t,s){const r=ir(s,Ee(t));for(let i=0;i<r.length;++i){const o=i*e;let a=n[o];for(let l=0;l<e;++l){const u=n[o+l];(Number.isNaN(u)||u>a)&&(a=u)}r[i]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZK=jn(((n,e)=>Math.max(n,e))),A$e=_s(tb,ZK),k$e={kernelName:tb,backendName:"cpu",kernelFunc:A$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eX=jn(((n,e)=>Math.min(n,e))),$$e=_s(nb,eX),R$e={kernelName:nb,backendName:"cpu",kernelFunc:$$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d$=jn(((n,e)=>n*e)),D$e=c$(((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t}))),Mx=_s(rb,d$,D$e),M$e={kernelName:rb,backendName:"cpu",kernelFunc:Mx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tX(n,e,t){const s=Sc(-1,t);return d$([],e,s,n,t)}function O$e(n){const{inputs:e,backend:t}=n,{x:s}=e;Ye(s,"neg");const r=t.data.get(s.dataId).values,[i,o]=tX(r,s.shape,s.dtype);return t.makeTensorInfo(o,s.dtype,i)}const P$e={kernelName:HT,backendName:"cpu",kernelFunc:O$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nX=jn(((n,e)=>n!==e?1:0)),F$e=_s(qT,nX,null,"bool"),L$e={kernelName:qT,backendName:"cpu",kernelFunc:F$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f$(n,e,t,s,r){const i=e.length,o=Ee(e),a=Qe(e),l=Qe(r),u=ir(t,Ee(r));for(let h=0;h<o;++h){const f=Ep(h,i,a),p=new Array(f.length);for(let b=0;b<p.length;b++)p[b]=f[s[b]];const g=xa(p,i,l);u[g]=n[h]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lr(n){const{inputs:e,attrs:t,backend:s}=n,{x:r}=e,{perm:i}=t;Ye(r,"transpose");const o=r.shape.length,a=new Array(o);for(let f=0;f<a.length;f++)a[f]=r.shape[i[f]];const l=s.data.get(r.dataId).values,u=f$(l,r.shape,r.dtype,i,a);return{dataId:s.write(u,a,r.dtype),shape:a,dtype:r.dtype}}const V$e={kernelName:$f,backendName:"cpu",kernelFunc:Lr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sX(n,e,t,s){const[r,i]=Ds(n,s),o=ai(e,"int32"),a=or(Ee(r),o),l=Ee(i);for(let u=0;u<a.length;++u){const h=u*l;let f=1;for(let p=0;p<l;++p)f*=t[h+p];a[u]=f}return{outVals:a,outShape:r,outDtype:o}}function B$e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Ye(r,"prod");const a=r.shape.length,l=xt(i,r.shape),u=zn(l,a);let h=l,f=r;const p=[];u!=null&&(f=Lr({inputs:{x:r},backend:t,attrs:{perm:u}}),p.push(f),h=Yn(h.length,a));const g=t.data.get(f.dataId).values,{outVals:b,outShape:T,outDtype:w}=sX(f.shape,f.dtype,g,h);let _=T;return o&&(_=os(T,l)),p.forEach(C=>t.disposeIntermediateTensorInfo(C)),t.makeTensorInfo(_,w,b)}const U$e={kernelName:jT,backendName:"cpu",kernelFunc:B$e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z$e(n,e,t){n.forEach((s,r)=>{if(s<0||s>=t){const i=Ep(r,e.length,Qe(e)).join(",");throw new Error(`indices[${i}] = ${s} is not in [0, ${t})`)}})}function G$e(n,e){for(let t=0;t<n.length;++t){const s=n[t],r=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let i=1;i<s.length;++i)if(s[i-1]>s[i])throw new Error("Ragged splits must be sorted in ascending order")}}function H$e(n,e,t,s){const r=[];let i=0;const o=e.length-1+t.length,a=new Array(o).fill(null).map(()=>[0]);G$e(t,s);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];const h=e[u+1];for(let f=1;f<l+1;++f)a[u].push(f*h)}for(let u=0;u<n.length;++u){let h=n[u],f=n[u]+1;for(let p=0;p<t.length;++p){const g=t[p],b=p+e.length-1;if(b>=0){const T=a[b],w=T[T.length-1]-g[h];for(let _=h;_<f;++_)a[b].push(g[_+1]+w)}h=g[h],f=g[f]}f!==h&&(r.push([h,f]),i+=f-h)}return{outSplits:a,valueSlices:r,numValues:i}}function q$e(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,r=Wn("int32",s);e.push(r),n[t].forEach((i,o)=>r[o]=i)}return e}function BL(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function W$e(n,e,t,s,r,i){const o=BL(e,2)[1],a=BL(i,2)[1];let l=0;for(const u of t)for(let h=u[0];h<u[1];++h){for(let f=0;f<s;++f)r[l*a+f]=n[h*o+f];++l}}function K$e(n,e,t,s,r){const i=e.slice();i[0]=r;const o=Wn(t,Ee(i)),a=n.length,l=a===0?0:a/e[0];return W$e(n,e,s,l,o,i),[o,i]}function rX(n,e,t,s,r,i,o,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(z$e(i,o,l),s.length===0)throw new Error("params.rank must be nonzero");const u=s[0],{outSplits:h,valueSlices:f,numValues:p}=H$e(i,o,n,u),g=q$e(h),b=K$e(t,s,r,f,p);return[g,b[0],b[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UL=2147483647;function iX(n,e,t,s,r,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,u=o.length===0,h=[];a||h.push(e[0]),l||h.push(r[0]),u||h.push(o[0]);for(let w=1;w<h.length;++w)if(h[w]!==h[w-1])throw new Error("starts, limits, and deltas must have the same shape");const f=h.length===0?1:h[0],p=Wn("int32",f+1);p[0]=0;for(let w=0;w<f;++w){const _=a?n[0]:n[w],C=l?s[0]:s[w],N=u?i[0]:i[w];if(N===0)throw new Error("Requires delta != 0");let A;if(N>0&&C<_||N<0&&C>_)A=0;else if(A=Math.ceil(Math.abs((C-_)/N)),A>UL)throw new Error(`Requires ((limit - start) / delta) <= ${UL}`);p[w+1]=p[w]+A}const g=p[f],b=Wn(t,g);let T=0;for(let w=0;w<f;++w){const _=p[w+1]-p[w];let C=a?n[0]:n[w];const N=u?i[0]:i[w];for(let A=0;A<_;++A)b[T++]=C,C+=N}return[p,b]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Gi=So;class pw{constructor(e,t,s,r,i,o,a,l,u,h){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=r,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=W9(h),this.raggedRank=K9(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Gi.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Gi.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Gi.VALUE_ROWIDS:return pw.getMaxWidthValueRowID(t);case Gi.ROW_SPLITS:return pw.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${Gi[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let r=0;r<t-1;++r){const i=e[r+1]-e[r];i>s&&(s=i)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,r=e[0],i=0;for(let o=1;o<t;++o){const a=e[o];a!==r&&(r=a,i=Math.max(o-s,i),s=o)}return Math.max(t-s,i)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return GL(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;X9(s,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=q9(this.raggedRank,r,t);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,t,s){const r=Math.min(e,s),i=[];let o=0;for(let a=0;a<r;++a,o+=t)i.push(o);for(let a=r;a<e;++a)i.push(-1);return q(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,t,s,r){const i=e.length,o=[];for(let a=0;a<i-1;++a){const l=e[a+1]-e[a];let u=Math.min(r,l),h=t[a];h===-1&&(u=0);for(let f=0;f<u;++f)o.push(h),h+=s;for(let f=0;f<l-u;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,t,s,r){const i=e.length,o=[];if(i===0)return[];let a=0,l=e[0];if(l>=t.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${t.length}`);let u=t[l];o.push(u);for(let h=1;h<i;++h){const f=e[h];if(f===l)u>=0&&(++a,a<r?u+=s:u=-1);else{if(a=0,l=f,f>=t.length)throw new Error(`Got nextValueRowId=${f} which is not less than ${t.length}`);u=t[f]}o.push(u)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,t,s,r){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Gi.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,s,r);case Gi.ROW_SPLITS:if(i.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(i,t,s,r);default:throw new Error(`Unsupported partition type: ${Gi[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case Gi.FIRST_DIM_SIZE:return e[0];case Gi.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Gi.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Gi[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),s=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const i=GL(s,!1),o=Wn(this.valuesDType,Ee(i));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(t,r[0],s[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,r[u],s[u]);this.setOutput(this.raggedRank,l,o,i)}return[i,o]}setOutput(e,t,s,r){if(s.length===0)return;const i=this.values,o=s;let a=r.slice();a=a.slice(e+1);const l=Ee(a),u=t.length;let h=this.defaultValue;if(h.length!==l&&h.length!==1){const b=this.defaultValueShape;ge(()=>{const T=ce(h,b);h=gg(T,a).dataSync()})}let f=0,p=0,g=0;for(let b=0;b<=u;++b){let T=b<u?t[b]:-1;if(T===g){++g;continue}if(p<g){const w=i.subarray(f*l),_=o.subarray(p*l),C=(g-p)*l;zL(_,w,C)}if(b>=u){const w=s.length;T=Math.floor(w/l)}if(T>g)if(this.defaultValue.length===1)o.subarray(g*l,T*l).fill(this.defaultValue[0]),g=T;else for(;T>g;){const w=o.slice(g*l);zL(w,h,l),++g}T<0?(f=b+1,p=g):(f=b,p=g,g=p+1)}}}function zL(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function GL(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function oX(n,e,t,s,r,i,o,a,l,u){return new pw(n,e,t,s,r,i,o,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aX(n,e,t,s){const r=n===e,i=n<e&&t<0,o=e<n&&t>1;if(r||i||o)return or(0,s);const a=Math.abs(Math.ceil((e-n)/t)),l=or(a,s);e<n&&t===1&&(t=-1),l[0]=n;for(let u=1;u<l.length;u++)l[u]=l[u-1]+t;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lX=La(n=>1/Math.sqrt(n)),X$e=kc(cb,lX),Y$e={kernelName:cb,backendName:"cpu",kernelFunc:X$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Th(n,e,t,s,r,i,o,a,l,u){const h=[s/r,r],f=n.values,p=e.values;if(s===0)return Tt(t,e.dtype);const g=l instanceof Bs?l:Tt(h,e.dtype);typeof l=="string"||typeof l=="number"?g.values.fill(l):typeof l=="boolean"&&g.values.fill(+l);for(let b=0;b<i;b++){const T=[];let w=0;for(let _=0;_<o;_++){const C=f[b*o+_];T.push(C),w+=C*a[_]}if(w<0||w>=s/r)throw new Error(`Invalid indices: ${T} does not index into ${t}`);for(let _=0;_<r;_++)u?g.values[w*r+_]+=p[b*r+_]:g.values[w*r+_]=e.rank===0?p[0]:p[b*r+_]}return g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J$e=La(n=>1/(1+Math.exp(-n))),uX=an(mb,n=>1/(1+Math.exp(-n))),j$e={kernelName:mb,backendName:"cpu",kernelFunc:uX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cX(n,e,t,s,r){const i=w2(s,e,t),o=Ee(t),a=Qe(s);if(i){const f=T2(e,a);return r==="string"?n.slice(f,f+o):n.subarray(f,f+o)}const l=r==="string"?Al(n):n,u=Tt(s,r,l),h=Tt(t,r);for(let f=0;f<h.size;++f){const p=h.indexToLoc(f),g=p.map((b,T)=>b+e[T]);h.set(u.get(...g),...p)}return r==="string"?p8(h.values):h.values}function jh(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,size:o}=s;Ye(r,"slice");const[a,l]=vx(r,i,o);b2(r,a,l);const u=t.data.get(r.dataId).values,h=cX(u,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,h)}const Q$e={kernelName:sx,backendName:"cpu",kernelFunc:jh};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hX(n,e,t,s,r,i,o){const a=e[0],l=i[0],u=new Array(l),h=new Array(a),f=e[1];if(l===0){if(a!==0)throw new Error(t8(a));const w=Wn(t,0),_=Wn(r,0);return[w,[0,f],_,u,h]}let p=!0,g=0;const b=new Array(l).fill(0);for(let w=0;w<a;++w){const _=n[w*f];if(_<0)throw new Error(n8(w,_));if(_>=l)throw new Error(s8(w,_,l));++b[_],p=p&&_>=g,g=_}let T=!0;for(let w=0;w<l;++w){const _=b[w]===0;u[w]=_,T=T&&!_,b[w]=Math.max(b[w],1),w>0&&(b[w]+=b[w-1])}if(T&&p){const w=n,_=s;for(let C=0;C<a;++C)h[C]=C;return[w,[a,f],_,u,h]}else{const w=b[l-1],_=Wn(t,w*f),C=Wn(r,w),N=new Array(l).fill(0);for(let A=0;A<a;++A){const P=n[A*f],V=N[P],D=(P===0?0:b[P-1])+V;N[P]++;for(let M=0;M<f;++M)_[D*f+M]=n[A*f+M];C[D]=s[A],h[A]=D}for(let A=0;A<l;++A)if(N[A]===0){const V=A===0?0:b[A-1];_[V*f+0]=A;for(let D=1;D<f;++D)_[V*f+D]=0;C[V]=o}return[_,[w,f],C,u,h]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dX(n,e,t,s,r){const i=Ee(s),o=e[0],a=r.length,l=[];let u=1,h=-1;for(let w=0;w<a;++w){const _=r[w];if(_===-1){if(h!==-1)throw new Error(r8(h,w));h=w,l.push(1)}else{if(_<0)throw new Error(i8(w,_));u*=_,l.push(_)}}if(h!==-1){if(u<=0)throw new Error(o8());const w=Math.trunc(i/u);if(u*w!==i)throw new Error(a8(s,l));l[h]=w}if(Ee(l)!==i)throw new Error(l8(s,l));const p=s.length,g=[];if(p>0){g[p-1]=1;for(let w=p-2;w>=0;--w)g[w]=g[w+1]*s[w+1]}const b=[];if(a>0){b[a-1]=1;for(let w=a-2;w>=0;--w)b[w]=b[w+1]*l[w+1]}const T=Wn(t,o*a);for(let w=0;w<o;++w){let _=0;for(let C=0;C<p;++C)_+=n[w*p+C]*g[C];for(let C=0;C<a;++C)T[w*a+C]=Math.trunc(_/b[C]),_%=b[C]}return[T,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p$(n,e,t,s,r,i=!1,o=0){const a=s.length,l=[e[0],n.length/e[0]],u=l[1],f=a>0?r[a-1]+1:0;if(f<0)throw new Error(lC());const p=e.slice();p[0]=f;const g=p.reduce((N,A)=>N*A,1),b=Wn(t,g);if(a===0)return f>0&&b.fill(o),[b,p];if(f<=0)throw new Error(lC());let T=0,w=1,_=0,C=r[T];for(;;){let N=0;if(w<a){if(N=r[w],C===N){++w;continue}if(C>=N)throw new Error(u8())}if(C<0||C>=f)throw new Error(c8(C,f));C>_&&b.fill(o,_*u,C*u);for(let A=T;A<w;++A){const P=s[A];if(P<0||P>=l[0])throw new Error(h8(A,s[A],l[0]));for(let V=0;V<u;V++)b[C*u+V]+=n[P*u+V]}if(i)for(let A=0;A<u;A++)b[C*u+A]/=w-T;if(T=w,++w,_=C+1,C=N,w>a)break}return _<f&&b.fill(o,_*u,f*u),[b,p]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z$e=La(n=>Math.sqrt(n)),eRe=an(yb,n=>Math.sqrt(n)),tRe={kernelName:yb,backendName:"cpu",kernelFunc:eRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fX=jn(((n,e)=>{const t=n-e;return t*t})),nRe=_s(bb,fX),sRe={kernelName:bb,backendName:"cpu",kernelFunc:nRe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pX=La((n,e)=>{const{pattern:t,replaceGlobal:s,rewrite:r}=e;return n.replace(new RegExp(t,s?"g":""),r)}),rRe=kc(Dk,pX),iRe={kernelName:Dk,backendName:"cpu",kernelFunc:rRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mX(n,e,t,s){const r=Tt(n,e.dtype);for(let i=0;i<r.size;i++){const o=r.indexToLoc(i),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*t[l]+s[l];r.set(e.get(...a),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oRe{constructor(e,t,s,r,i,o){this.separator=qu(e),this.nGramWidths=t,this.leftPad=qu(s),this.rightPad=qu(r),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,r,i,o){for(let a=0;a<i;++a){const l=this.getPadWidth(o),u=Math.max(0,l-a),h=Math.max(0,l-(i-(a+1))),f=o-(u+h),p=t+(u>0?0:a-l);let g=0;g+=u*this.leftPad.length;for(let C=0;C<f;++C)g+=e[p+C].length;g+=h*this.rightPad.length;const b=u+h+f-1;g+=b*this.separator.length,s[r+a]=new Uint8Array(g);const T=s[r+a];let w=0;const _=C=>C.forEach(N=>T[w++]=N);for(let C=0;C<u;++C)_(this.leftPad),_(this.separator);for(let C=0;C<f-1;++C)_(e[p+C]),_(this.separator);if(f>0){_(e[p+f-1]);for(let C=0;C<h;++C)_(this.separator),_(this.rightPad)}else{for(let C=0;C<h-1;++C)_(this.rightPad),_(this.separator);_(this.rightPad)}}}compute(e,t){const s=e.length,r=t.length;if(r>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<r;++u){let h=t[u]>=l;if(h=h&&t[u]<=s,!h)throw new Error(`Invalid split value ${t[u]}, must be in [${l}, ${s}]`);l=t[u]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const i=r-1,o=Wn("int32",r);if(s===0||r===0){const l=new Array(s);for(let u=0;u<=i;++u)o[u]=0;return[l,o]}o[0]=0;for(let l=1;l<=i;++l){const u=t[l]-t[l-1];let h=0;this.nGramWidths.forEach(f=>{h+=this.getNumNGrams(u,f)}),this.preserveShort&&u>0&&h===0&&(h=1),o[l]=o[l-1]+h}const a=new Array(o[i]);for(let l=0;l<i;++l){const u=t[l];let h=o[l];if(this.nGramWidths.forEach(f=>{const p=t[l+1]-t[l],g=this.getNumNGrams(p,f);this.createNGrams(e,u,a,h,g,f),h+=g}),this.preserveShort&&h===o[l]){const f=t[l+1]-t[l];if(f===0)continue;const p=f+2*this.padWidth;this.createNGrams(e,u,a,h,1,p)}}return[a,o]}}function gX(n,e,t,s,r,i,o,a){return new oRe(t,s,r,i,o,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aRe(n,e,t,s){if(!n.length)return;if(e.length===0){for(let i=0;i<n.length;++i)s.push(n.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=n.indexOf(i);for(;o!==-1;){const a=n.subarray(0,o);(!t||a.length!==0)&&s.push(a),n=n.subarray(o+1),o=n.indexOf(i)}(!t||n.length!==0)&&s.push(n);return}let r=0;for(let i=0;i<n.length+1;i++)if(i===n.length||e.indexOf(n[i])!==-1){const o=n.subarray(r,i);(!t||o.length!==0)&&s.push(o),r=i+1}}function yX(n,e,t){const s=n.length,r=[];let i=0,o=0;const a=new Array(s);for(let p=0;p<s;++p){const g=r.length;aRe(n[p],e,t,r);const b=r.length-g;a[p]=b,i+=b,o=Math.max(o,b)}const l=Wn("int32",i*2),u=new Array(i),h=[s,o];let f=0;for(let p=0;p<s;++p)for(let g=0;g<a[p];++g)l[f*2]=p,l[f*2+1]=g,u[f]=r[f],++f;return[l,u,h]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bX(n,e){const t=Wn("int32",n.length);for(let s=0;s<n.length;++s)t[s]=rxe(n[s]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vX=jn(((n,e)=>n-e)),lRe=c$(((n,e,t,s)=>({real:n-t,imag:e-s}))),m$=_s(vb,vX,lRe),uRe={kernelName:vb,backendName:"cpu",kernelFunc:m$};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wX(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const s=Tt(t,n.dtype);for(let r=0;r<s.values.length;++r){const i=s.indexToLoc(r),o=new Array(n.rank);for(let l=0;l<o.length;l++)o[l]=i[l]%n.shape[l];const a=n.locToIndex(o);s.values[r]=n.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rg=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function TX(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const a=s-t+1,l=e-t+1,u=Math.log(a),h=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*h*(a-h)/a)*Math.sign(l-a/2),p=Math.max(t,Math.floor(e-l*h/a+f)),g=Math.min(s,Math.floor(e+(a-l)*h/a+f));TX(n,e,p,g)}const r=n[e];let i=t,o=s;for(ff(n,t,e),rg(n[s],r)>0&&ff(n,t,s);i<o;){for(ff(n,i,o),i++,o--;rg(n[i],r)<0;)i=i+1;for(;rg(n[o],r)>0;)o=o-1}rg(n[t],r)===0?ff(n,t,o):(o=o+1,ff(n,o,s)),o<=e&&(t=o+1),e<=o&&(s=o-1)}}function xX(n,e,t,s,r){const i=e[e.length-1],[o,a]=[n.length/i,i],l=ir(t,o*s),u=ir("int32",o*s);for(let f=0;f<o;f++){const p=f*a,g=n.subarray(p,p+a);let b=new Array(g.length);g.forEach((C,N)=>b[N]={value:C,index:N}),s<b.length&&(TX(b,s),b=b.slice(0,s)),r&&b.sort(rg);const T=f*s,w=l.subarray(T,T+s),_=u.subarray(T,T+s);for(let C=0;C<s;C++)w[C]=b[C].value,_[C]=b[C].index}const h=e.slice();return h[h.length-1]=s,[Tt(h,t,l),Tt(h,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SX(n,e,t,s){const r=xt(e,t)[0],i=[1,t[0],1];for(let b=0;b<r;b++)i[0]*=t[b];i[1]=t[r];for(let b=r+1;b<t.length;b++)i[2]*=t[b];const o=new Map,a=new Int32Array(t[r]),l=new Bs(i,s,n),u=[],h=i[0]===1&&i[2]===1;for(let b=0;b<t[r];b++){let T;if(h)T=n[b].toString();else{const _=[];for(let C=0;C<i[0];C++)for(let N=0;N<i[2];N++)_.push(l.get(C,b,N));T=_.join(",")}const w=o.get(T);if(w!=null)a[b]=w;else{const _=o.size;o.set(T,_),a[b]=_,u.push(b)}}const f=i.slice();f[1]=o.size;const p=new Bs(f,s);u.forEach((b,T)=>{for(let w=0;w<i[0];w++)for(let _=0;_<i[2];_++)p.set(l.get(w,b,_),w,T,_)});const g=t.slice();return g[r]=f[1],{outputValues:p.values,outputShape:g,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cRe=Object.freeze(Object.defineProperty({__proto__:null,addImpl:RK,bincountImpl:h$,bincountReduceImpl:DK,bitwiseAndImpl:MK,castImpl:$K,ceilImpl:OK,concatImpl:PK,equalImpl:FK,expImpl:VK,expm1Impl:UK,floorDivImpl:GK,floorImpl:zK,gatherNdImpl:HK,gatherV2Impl:qK,greaterEqualImpl:KK,greaterImpl:WK,lessEqualImpl:YK,lessImpl:XK,linSpaceImpl:JK,logImpl:jK,maxImpl:QK,maximumImpl:ZK,minimumImpl:eX,multiplyImpl:d$,negImpl:tX,notEqualImpl:nX,prodImpl:sX,raggedGatherImpl:rX,raggedRangeImpl:iX,raggedTensorToTensorImpl:oX,rangeImpl:aX,rsqrtImpl:lX,scatterImpl:Th,sigmoidImpl:J$e,simpleAbsImpl:kK,sliceImpl:cX,sparseFillEmptyRowsImpl:hX,sparseReshapeImpl:dX,sparseSegmentReductionImpl:p$,sqrtImpl:Z$e,squaredDifferenceImpl:fX,staticRegexReplaceImpl:pX,stridedSliceImpl:mX,stringNGramsImpl:gX,stringSplitImpl:yX,stringToHashBucketFastImpl:bX,subImpl:vX,tileImpl:wX,topKImpl:xX,transposeImpl:f$,uniqueImpl:SX},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */q5("cpu",()=>new Dx,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _X=an(zy,n=>n>=0?n:Math.exp(n)-1),hRe={kernelName:zy,backendName:"cpu",kernelFunc:_X};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:i}=s;Ye([r],"leakyRelu");const o=Ee(r.shape),a=t.data.get(r.dataId).values,l=ir("float32",o);for(let u=0;u<a.length;u++)l[u]=a[u]<0?i*a[u]:a[u];return t.makeTensorInfo(r.shape,"float32",l)}const dRe={kernelName:$T,backendName:"cpu",kernelFunc:EX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fRe=jn((n,e)=>n<0?e*n:n);function IX(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e;Ye([s,r],"prelu");const i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,[a,l]=fRe(s.shape,r.shape,i,o,"float32");return t.makeTensorInfo(l,"float32",a)}const pRe={kernelName:JT,backendName:"cpu",kernelFunc:IX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CX=an(ab,n=>Math.max(0,n)),mRe={kernelName:ab,backendName:"cpu",kernelFunc:CX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NX=an(lb,n=>Math.min(Math.max(0,n),6)),gRe={kernelName:lb,backendName:"cpu",kernelFunc:NX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mw(n,e,t,s,r){if(t==="linear")return Fa({inputs:{x:e},backend:n});if(t==="relu")return CX({inputs:{x:e},backend:n});if(t==="elu")return _X({inputs:{x:e},backend:n});if(t==="relu6")return NX({inputs:{x:e},backend:n});if(t==="prelu")return IX({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return EX({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return uX({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cn(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:i}=s,o=Ee(r.shape),a=n5(i,o),l=Ee(a);q(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const u=t.data.get(r.dataId);if(u.complexTensorInfos!=null){const h=u.complexTensorInfos.real,f=u.complexTensorInfos.imag;h.shape=a,f.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const yRe={kernelName:QT,backendName:"cpu",kernelFunc:Cn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AX(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;Ye([r,i],"matMul");const l=r.shape.length,u=i.shape.length,h=o?r.shape[l-2]:r.shape[l-1],f=a?i.shape[u-1]:i.shape[u-2],p=o?r.shape[l-1]:r.shape[l-2],g=a?i.shape[u-2]:i.shape[u-1],b=r.shape.slice(0,-2),T=i.shape.slice(0,-2),w=Ee(b),_=Ee(T),N=pt(r.shape.slice(0,-2),i.shape.slice(0,-2)).concat([p,g]);q(h===f,()=>`Error in matMul: inner shapes (${h}) and (${f}) of Tensors with shapes ${r.shape} and ${i.shape} and transposeA=${o} and transposeB=${a} must match.`);const A=o?[w,h,p]:[w,p,h],P=a?[_,g,f]:[_,f,g],V=Cn({inputs:{x:r},backend:t,attrs:{shape:A}}),D=Cn({inputs:{x:i},backend:t,attrs:{shape:P}}),M=o?V.shape[1]:V.shape[2],$=o?V.shape[2]:V.shape[1],O=a?D.shape[1]:D.shape[2],k=Math.max(w,_),z=t.data.get(V.dataId).values,U=t.data.get(D.dataId).values,te=Qe(V.shape),se=Qe(D.shape),[X,Q,re]=o?[te[0],1,te[1]]:[te[0],te[1],1],[fe,be,W]=a?[1,se[1],se[0]]:[se[1],1,se[0]],ne=$*O,ue=Tt([k,$,O],V.dtype),Te=ue.values,Ie=t.blockSize;for(let Re=0;Re<k;Re++){const Fe=Re%w,We=Re%_;for(let Be=0;Be<$;Be+=Ie){const it=Math.min(Be+Ie,$);for(let ct=0;ct<O;ct+=Ie){const It=Math.min(ct+Ie,O);for(let Bt=0;Bt<M;Bt+=Ie){const Ut=Math.min(Bt+Ie,M);for(let Ht=Be;Ht<it;Ht++)for(let Ct=ct;Ct<It;Ct++){let nn=0;for(let Qt=Bt;Qt<Ut;Qt++){const sn=z[Fe*X+Ht*Q+Qt*re],Et=U[Qt*fe+Ct*be+We*W];nn+=sn*Et}Te[Re*ne+(Ht*O+Ct)]+=nn}}}}}return t.disposeIntermediateTensorInfo(V),t.disposeIntermediateTensorInfo(D),t.makeTensorInfo(N,ue.dtype,ue.values)}const bRe={kernelName:gT,backendName:"cpu",kernelFunc:AX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vRe(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:h,leakyreluAlpha:f}=s;let p,g,b;const T=[];p=AX({inputs:{a:r,b:i},attrs:{transposeA:l,transposeB:u},backend:t}),o&&(g=sp({inputs:{a:p,b:o},backend:t}),T.push(p),p=g),h&&(b=mw(t,p,h,a,f),T.push(p),p=b);for(const _ of T)t.disposeIntermediateTensorInfo(_);return p}const wRe={kernelName:Yv,backendName:"cpu",kernelFunc:vRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TRe=an(Ay,n=>Math.acos(n)),xRe={kernelName:Ay,backendName:"cpu",kernelFunc:TRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SRe=an(ky,n=>Math.acosh(n)),_Re={kernelName:ky,backendName:"cpu",kernelFunc:SRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ERe(n){const{inputs:e,backend:t}=n,s=e;Ye(e,"addN");const r=s.map(a=>t.data.get(a.dataId).values),i=Tt(s[0].shape,s[0].dtype),o=i.values;for(let a=0;a<s.length;a++){const l=r[a];for(let u=0;u<o.length;u++)o[u]+=l[u]}return t.makeTensorInfo(i.shape,i.dtype,i.values)}const IRe={kernelName:QA,backendName:"cpu",kernelFunc:ERe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CRe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Ye(r,"all");const a=xt(i,r.shape);let l=a;const u=zn(l,r.shape.length);let h=r;u!=null&&(h=Lr({inputs:{x:r},backend:t,attrs:{perm:u}}),l=Yn(l.length,r.shape.length)),Gs("all",l,h.shape.length);const[f,p]=Ds(h.shape,l),g=Ee(p),b=or(Ee(f),h.dtype),T=t.data.get(h.dataId).values;for(let _=0;_<b.length;++_){const C=_*g;let N=T[C];for(let A=0;A<g;++A){const P=T[C+A];N=N&&P}b[_]=N}u!=null&&t.disposeIntermediateTensorInfo(h);const w=t.makeTensorInfo(f,h.dtype,b);if(o){const _=os(f,a),C=Cn({inputs:{x:w},backend:t,attrs:{shape:_}});return t.disposeIntermediateTensorInfo(w),C}return w}const NRe={kernelName:ZA,backendName:"cpu",kernelFunc:CRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ARe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Ye(r,"any");const a=xt(i,r.shape);let l=a;const u=zn(l,r.shape.length);let h=r;u!=null&&(h=Lr({inputs:{x:r},backend:t,attrs:{perm:u}}),l=Yn(l.length,r.shape.length)),Gs("any",l,h.shape.length);const[f,p]=Ds(h.shape,l),g=Ee(p),b=or(Ee(f),h.dtype),T=t.data.get(h.dataId).values;for(let _=0;_<b.length;++_){const C=_*g;let N=T[C];for(let A=0;A<g;++A){const P=T[C+A];N=N||P}b[_]=N}u!=null&&t.disposeIntermediateTensorInfo(h);const w=t.makeTensorInfo(f,h.dtype,b);if(o){const _=os(f,a),C=Cn({inputs:{x:w},backend:t,attrs:{shape:_}});return t.disposeIntermediateTensorInfo(w),C}return w}const kRe={kernelName:ek,backendName:"cpu",kernelFunc:ARe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Re(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;Ye(r,"argMax");let o=xt(i,r.shape);const a=zn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=Lr({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=Yn(o.length,l.shape.length)),o=[o[0]],Gs("argMax",o,l.shape.length);const[h,f]=Ds(l.shape,o),p=Ee(h),g=or(p,"int32"),b=Ee(f),T=t.data.get(l.dataId).values;for(let w=0;w<g.length;++w){const _=w*b;let C=T[_],N=0;for(let A=0;A<b;++A){const P=T[_+A];P>C&&(C=P,N=A)}g[w]=N}return u.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.makeTensorInfo(h,"int32",g)}const RRe={kernelName:dT,backendName:"cpu",kernelFunc:$Re};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DRe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;Ye(r,"argMin");let o=xt(i,r.shape);const a=zn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=Lr({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=Yn(o.length,l.shape.length)),o=[o[0]],Gs("argMin",o,l.shape.length);const[h,f]=Ds(l.shape,o),p=Ee(h),g=or(p,"int32"),b=Ee(f),T=t.data.get(l.dataId).values;for(let w=0;w<g.length;++w){const _=w*b;let C=T[_],N=0;for(let A=0;A<b;++A){const P=T[_+A];P<C&&(C=P,N=A)}g[w]=N}return u.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.makeTensorInfo(h,"int32",g)}const MRe={kernelName:fT,backendName:"cpu",kernelFunc:DRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ORe=an($y,n=>Math.asin(n)),PRe={kernelName:$y,backendName:"cpu",kernelFunc:ORe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FRe=an(Ry,n=>Math.asinh(n)),LRe={kernelName:Ry,backendName:"cpu",kernelFunc:FRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VRe=an(Dy,n=>Math.atan(n)),BRe={kernelName:Dy,backendName:"cpu",kernelFunc:VRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const URe=jn((n,e)=>Math.atan2(n,e)),zRe=_s(Oy,URe),GRe={kernelName:Oy,backendName:"cpu",kernelFunc:zRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HRe=an(My,n=>Math.atanh(n)),qRe={kernelName:My,backendName:"cpu",kernelFunc:HRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g$(n,e,t,s,r,i){const o=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=r.padInfo.top,g=r.padInfo.left,b=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,T=Tt(r.outShape,t),w=T.values,_=r.outShape[1]*r.outShape[2]*r.outShape[3],C=r.outShape[2]*r.outShape[3],N=r.outShape[3];for(let A=0;A<r.batchSize;++A){const P=A*_,V=A*s[0];for(let D=0;D<r.inChannels;++D)for(let M=0;M<r.outHeight;++M){const $=M*o-p,O=Math.max(0,$),k=Math.min(r.inHeight,h+$),z=P+M*C;for(let U=0;U<r.outWidth;++U){const te=U*a-g,se=Math.max(0,te),X=Math.min(r.inWidth,f+te);let Q=b,re=0,fe=0;for(let W=O;W<k;W+=l){const ne=V+W*s[1];for(let ue=se;ue<X;ue+=u){const Te=ne+ue*s[2],Ie=n[Te+D];i==="max"&&Ie>Q?Q=Ie:i==="avg"&&(re+=Ie,fe++)}if(isNaN(Q))break}const be=z+U*N+D;w[be]=i==="avg"?re/fe:Q}}}return T}function kX(n,e,t,s,r=!1,i=!1){const o=Tt(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,u=s.dilationHeight,h=s.dilationWidth,f=s.effectiveFilterHeight,p=s.effectiveFilterWidth,g=s.padInfo.top,b=s.padInfo.left,T=Tt(e,t,n);for(let w=0;w<s.batchSize;++w)for(let _=0;_<s.inChannels;++_)for(let C=0;C<s.outHeight;++C){const N=C*a-g;let A=N;for(;A<0;)A+=u;const P=Math.min(s.inHeight,f+N);for(let V=0;V<s.outWidth;++V){const D=V*l-b;let M=D;for(;M<0;)M+=h;const $=Math.min(s.inWidth,p+D);let O=Number.NEGATIVE_INFINITY,k=-1;for(let z=A;z<P;z+=u){const U=z-N;for(let te=M;te<$;te+=h){const se=te-D,X=T.get(w,z,te,_);X>O&&(O=X,r?k=i?((w*s.inHeight+z)*s.inWidth+te)*s.inChannels+_:(z*s.inWidth+te)*s.inChannels+_:k=U*p+se)}}o.set(k,w,C,V,_)}}return o}function $X(n,e,t,s,r,i){const o=r.strideDepth,a=r.strideHeight,l=r.strideWidth,u=r.dilationDepth,h=r.dilationHeight,f=r.dilationWidth,p=r.effectiveFilterDepth,g=r.effectiveFilterHeight,b=r.effectiveFilterWidth,T=r.padInfo.front,w=r.padInfo.top,_=r.padInfo.left,C=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,N=Tt(r.outShape,t),A=N.values,P=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],V=r.outShape[2]*r.outShape[3]*r.outShape[4],D=r.outShape[3]*r.outShape[4],M=r.outShape[4];for(let $=0;$<r.batchSize;++$){const O=$*P,k=$*s[0];for(let z=0;z<r.inChannels;++z)for(let U=0;U<r.outDepth;++U){const te=U*o-T;let se=te;for(;se<0;)se+=u;const X=Math.min(r.inDepth,p+te),Q=O+U*V;for(let re=0;re<r.outHeight;++re){const fe=re*a-w;let be=fe;for(;be<0;)be+=h;const W=Math.min(r.inHeight,g+fe),ne=Q+re*D;for(let ue=0;ue<r.outWidth;++ue){const Te=ue*l-_;let Ie=Te;for(;Ie<0;)Ie+=f;const Re=Math.min(r.inWidth,b+Te),Fe=ne+ue*M;let We=C,Be=0,it=0;for(let It=se;It<X;It+=u){const Bt=k+It*s[1];for(let Ut=be;Ut<W;Ut+=h){const Ht=Bt+Ut*s[2];for(let Ct=Ie;Ct<Re;Ct+=f){const nn=Ht+Ct*s[3],Qt=n[nn+z];if(i==="max"&&Qt>We?We=Qt:i==="avg"&&(Be+=Qt,it++),isNaN(We))break}if(isNaN(We))break}if(isNaN(We))break}const ct=Fe+z;A[ct]=i==="avg"?Be/Math.max(it,1):We}}}}return N}function WRe(n,e){const t=Tt(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=e.padInfo.front,g=e.padInfo.top,b=e.padInfo.left;for(let T=0;T<e.batchSize;++T)for(let w=0;w<e.inChannels;++w)for(let _=0;_<e.outDepth;++_){const C=_*s-p;let N=C;for(;N<0;)N+=o;const A=Math.min(e.inDepth,u+C);for(let P=0;P<e.outHeight;++P){const V=P*r-g;let D=V;for(;D<0;)D+=a;const M=Math.min(e.inHeight,h+V);for(let $=0;$<e.outWidth;++$){const O=$*i-b;let k=O;for(;k<0;)k+=l;const z=Math.min(e.inWidth,f+O);let U=Number.NEGATIVE_INFINITY,te=-1;for(let se=N;se<A;se+=o){const X=se-C;for(let Q=D;Q<M;Q+=a){const re=Q-V;for(let fe=k;fe<z;fe+=l){const be=fe-O,W=n.get(T,se,Q,fe,w);W>=U&&(U=W,te=X*h*f+re*h+be)}}}t.set(te,T,_,P,$,w)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KRe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Ye(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;q(ar(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=no(r.shape,i,o,u,a,l);let f;if(h.filterWidth===1&&h.filterHeight===1&&jt(h.inShape,h.outShape))f=Fa({inputs:{x:r},backend:t});else{const p=t.data.get(r.dataId).values,g=Qe(r.shape),b=g$(p,r.shape,r.dtype,g,h,"avg");f=t.makeTensorInfo(h.outShape,r.dtype,b.values)}return f}const XRe={kernelName:pT,backendName:"cpu",kernelFunc:KRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YRe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;Ye(r,"avgPool3d");const h=Ll(r.shape,i,o,1,a,l,u),f=t.data.get(r.dataId).values,p=$X(f,r.shape,r.dtype,Qe(r.shape),h,"avg");return t.makeTensorInfo(p.shape,"float32",p.values)}const JRe={kernelName:mT,backendName:"cpu",kernelFunc:YRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jRe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;Ye([r,i],"avgPool3DGrad");const h=Ll(i.shape,o,a,1,l,u),f=h.strideDepth,p=h.strideHeight,g=h.strideWidth,b=h.filterDepth,T=h.filterHeight,w=h.filterWidth,_=h.dilationDepth,C=h.dilationHeight,N=h.dilationWidth,A=h.effectiveFilterDepth,P=h.effectiveFilterHeight,V=h.effectiveFilterWidth,D=A-1-h.padInfo.front,M=V-1-h.padInfo.left,$=P-1-h.padInfo.top,O=Tt(i.shape,"float32"),k=1/(b*T*w),z=t.bufferSync(r);for(let U=0;U<h.batchSize;++U)for(let te=0;te<h.inChannels;++te)for(let se=0;se<h.inDepth;++se)for(let X=0;X<h.inHeight;++X)for(let Q=0;Q<h.inWidth;++Q){const re=se-D,fe=X-$,be=Q-M;let W=0;for(let ne=0;ne<A;ne+=_){const ue=(re+ne)/f;if(!(ue<0||ue>=h.outDepth||Math.floor(ue)!==ue))for(let Te=0;Te<P;Te+=C){const Ie=(fe+Te)/p;if(!(Ie<0||Ie>=h.outHeight||Math.floor(Ie)!==Ie))for(let Re=0;Re<V;Re+=N){const Fe=(be+Re)/g;if(Fe<0||Fe>=h.outWidth||Math.floor(Fe)!==Fe)continue;const We=z.get(U,ue,Ie,Fe,te);W+=We}}}O.set(W*k,U,se,X,Q,te)}return t.makeTensorInfo(O.shape,O.dtype,O.values)}const QRe={kernelName:nk,backendName:"cpu",kernelFunc:jRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZRe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i;Ye([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,h=no(o.shape,a,l,1,u),f=h.strideHeight,p=h.strideWidth,g=h.filterHeight,b=h.filterWidth,T=h.dilationHeight,w=h.dilationWidth,_=h.effectiveFilterHeight,C=h.effectiveFilterWidth,N=C-1-h.padInfo.left,A=_-1-h.padInfo.top,P=Tt(o.shape,"float32"),V=1/(g*b),D=t.data.get(r.dataId).values,M=Tt(r.shape,"float32",D);for(let $=0;$<h.batchSize;++$)for(let O=0;O<h.inChannels;++O)for(let k=0;k<h.inHeight;++k)for(let z=0;z<h.inWidth;++z){const U=k-A,te=z-N;let se=0;for(let X=0;X<_;X+=T){const Q=(U+X)/f;if(!(Q<0||Q>=h.outHeight||Math.floor(Q)!==Q))for(let re=0;re<C;re+=w){const fe=(te+re)/p;if(fe<0||fe>=h.outWidth||Math.floor(fe)!==fe)continue;const be=M.get($,Q,fe,O);se+=be}}P.set(se*V,$,k,z,O)}return t.makeTensorInfo(P.shape,P.dtype,P.values)}const eDe={kernelName:tk,backendName:"cpu",kernelFunc:ZRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tDe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,scale:i,offset:o,mean:a,variance:l}=e;q(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),q(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),q(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Ye([r,a,l,i,o],"batchNorm");let{varianceEpsilon:u}=s;u==null&&(u=.001);const h=t.data.get(r.dataId).values,f=t.data.get(a.dataId).values,p=t.data.get(l.dataId).values,g=i?t.data.get(i.dataId).values:new Float32Array([1]),b=o?t.data.get(o.dataId).values:new Float32Array([0]),T=new Float32Array(h.length),w=b.length,_=g.length,C=p.length,N=f.length;let A=0,P=0,V=0,D=0;for(let M=0;M<h.length;++M)T[M]=b[A++]+(h[M]-f[P++])*g[V++]/Math.sqrt(p[D++]+u),A>=w&&(A=0),P>=N&&(P=0),V>=_&&(V=0),D>=C&&(D=0);return t.makeTensorInfo(r.shape,r.dtype,T)}const nDe={kernelName:NT,backendName:"cpu",kernelFunc:tDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sDe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,crops:o}=s;Ye([r],"batchToSpaceND");const a=i.reduce((_,C)=>_*C),l=Ab(r.shape,i,a),u=kb(l.length,i.length),h=$b(r.shape,i,a),f=I2(o,i.length),p=C2(h,o,i.length),g=Cn({inputs:{x:r},backend:t,attrs:{shape:l}}),b=Lr({inputs:{x:g},backend:t,attrs:{perm:u}}),T=Cn({inputs:{x:b},backend:t,attrs:{shape:h}}),w=jh({inputs:{x:T},backend:t,attrs:{begin:f,size:p}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(T),w}const rDe={kernelName:yT,backendName:"cpu",kernelFunc:sDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iDe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o}=s,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,u=h$(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}const oDe={kernelName:sk,backendName:"cpu",kernelFunc:iDe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aDe(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,a=pt(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const lDe={kernelName:l5,backendName:"cpu",kernelFunc:aDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uDe=an(Ly,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),cDe={kernelName:Ly,backendName:"cpu",kernelFunc:uDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hDe=n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(Ee(e.shape)),r=t.data.get(e.dataId),i=r.complexTensorInfos.real,o=r.complexTensorInfos.imag,a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values;for(let u=0;u<a.length;u++){const h=a[u],f=l[u];s[u]=Math.hypot(h,f)}return t.makeOutput(s,e.shape,"float32")},dDe={kernelName:bT,backendName:"cpu",kernelFunc:hDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rp(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.imag,i=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,i)}const fDe={kernelName:Tk,backendName:"cpu",kernelFunc:rp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ip(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,i=xt(r,e[0].shape)[0],o=e.map(T=>T.shape);S2(o,i);let a=_a(e.map(T=>T.shape),i);if(Ee(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(T=>Ee(T.shape)>0);if(l.length===1)return Fa({inputs:{x:l[0]},backend:t});if(l[0].dtype==="complex64"){const T=l.map(A=>Jh({inputs:{input:A},backend:t})),w=l.map(A=>rp({inputs:{input:A},backend:t})),_=ip({inputs:T,backend:t,attrs:{axis:i}}),C=ip({inputs:w,backend:t,attrs:{axis:i}}),N=ri({inputs:{real:_,imag:C},backend:t});return T.forEach(A=>t.disposeIntermediateTensorInfo(A)),w.forEach(A=>t.disposeIntermediateTensorInfo(A)),t.disposeIntermediateTensorInfo(_),t.disposeIntermediateTensorInfo(C),N}const u=l.map(T=>{const _=[-1,Ee(T.shape.slice(i))];return Cn({inputs:{x:T},backend:t,attrs:{shape:_}})}),h=u.map(T=>({vals:t.data.get(T.dataId).values,shape:T.shape}));a=_a(u.map(T=>T.shape),1);const f=u[0].shape[0]===1,p=PK(h,a,e[0].dtype,f),g=_a(l.map(T=>T.shape),i),b=t.makeTensorInfo(g,e[0].dtype,p);return u.forEach(T=>t.disposeIntermediateTensorInfo(T)),b}const pDe={kernelName:vT,backendName:"cpu",kernelFunc:ip};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:h}=s;Ye([r,i],"conv2d");const f=Vl(l),p=zs(r.shape,i.shape,o,u,a,h,!1,f),g=p.filterHeight,b=p.filterWidth,T=p.dilationHeight,w=p.dilationWidth,_=p.padInfo.left,C=p.padInfo.top,N=p.dataFormat==="channelsLast",A=new Bs(p.outShape,r.dtype),P=Qe(r.shape),V=Qe(i.shape),D=P[0],M=N?P[1]:P[2],$=N?P[2]:1,O=N?1:P[1],k=A.strides[0],z=N?A.strides[1]:A.strides[2],U=N?A.strides[2]:1,te=N?1:A.strides[1],se=t.data.get(r.dataId).values,X=t.data.get(i.dataId).values,Q=A.values;for(let re=0;re<p.batchSize;++re){const fe=re*D,be=re*k;for(let W=0;W<p.outHeight;++W){const ne=be+W*z,ue=W*p.strideHeight-C;for(let Te=0;Te<g;++Te){const Ie=ue+Te*T;if(Ie<0||Ie>=p.inHeight)continue;const Re=Te*V[0],Fe=fe+Ie*M;for(let We=0;We<p.outWidth;++We){const Be=ne+We*U,it=We*p.strideWidth-_;for(let ct=0;ct<b;++ct){const It=it+ct*w;if(It<0||It>=p.inWidth)continue;const Bt=Re+ct*V[1],Ut=Fe+It*$;let Ht=Bt;for(let Ct=0;Ct<p.inChannels;++Ct){const nn=se[Ut+Ct*O];for(let Qt=0;Qt<p.outChannels;++Qt)Q[Be+Qt*te]+=nn*X[Ht+Qt];Ht+=p.outChannels}}}}}}return t.makeTensorInfo(A.shape,A.dtype,Q)}const mDe={kernelName:wT,backendName:"cpu",kernelFunc:RX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gDe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:h}=s;Ye([r,i],"conv2dBackpropFilter");const f=Vl(l),p=zs(r.shape,h,o,1,a,u,!1,f),{strideHeight:g,strideWidth:b,filterHeight:T,filterWidth:w}=p,_=p.dataFormat==="channelsLast",C=new Bs(p.filterShape,"float32"),N=p.padInfo.left,A=p.padInfo.top,P=t.data.get(r.dataId).values,V=t.data.get(i.dataId).values,D=new Bs(r.shape,r.dtype,P),M=new Bs(i.shape,i.dtype,V);for(let $=0;$<T;++$){const O=Math.max(0,Math.ceil((A-$)/g)),k=Math.min(p.outHeight,(p.inHeight+A-$)/g);for(let z=0;z<w;++z){const U=Math.max(0,Math.ceil((N-z)/b)),te=Math.min(p.outWidth,(p.inWidth+N-z)/b);for(let se=0;se<p.inChannels;++se)for(let X=0;X<p.outChannels;++X){let Q=0;for(let re=0;re<p.batchSize;++re)for(let fe=O;fe<k;++fe){const be=$+fe*g-A;for(let W=U;W<te;++W){const ne=z+W*b-N;_?Q+=D.get(re,be,ne,se)*M.get(re,fe,W,X):Q+=D.get(re,se,be,ne)*M.get(re,X,fe,W)}}C.set(Q,$,z,se,X)}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const yDe={kernelName:ok,backendName:"cpu",kernelFunc:gDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bDe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:h}=s;Ye([r,i],"conv2dBackpropInput");const f=Qe(i.shape),p=Qe(r.shape);let g=Vl(u);const b=zs(o,i.shape,a,1,l,h,!1,g),T=new Bs(b.inShape,"float32"),w=T.values,_=t.data.get(r.dataId).values,C=t.data.get(i.dataId).values,[N,A,P]=f,{batchSize:V,filterHeight:D,filterWidth:M,inChannels:$,inHeight:O,inWidth:k,outChannels:z,outHeight:U,outWidth:te,strideHeight:se,strideWidth:X}=b;g=b.dataFormat;const Q=D-1-b.padInfo.top,re=M-1-b.padInfo.left,fe=g==="channelsLast",be=T.strides[0],W=fe?T.strides[1]:T.strides[2],ne=fe?T.strides[2]:1,ue=fe?1:T.strides[1],Te=p[0],Ie=fe?p[1]:p[2],Re=fe?p[2]:1,Fe=fe?1:p[1];for(let We=0;We<V;++We)for(let Be=0;Be<$;++Be)for(let it=0;it<O;++it){const ct=it-Q,It=Math.max(0,Math.ceil(ct/se)),Bt=Math.min(U,(D+ct)/se);for(let Ut=0;Ut<k;++Ut){const Ht=Ut-re,Ct=Math.max(0,Math.ceil(Ht/X)),nn=Math.min(te,(M+Ht)/X);let Qt=0;for(let Et=It;Et<Bt;++Et){const qs=Et*se-ct;for(let Ws=Ct;Ws<nn;++Ws){const Ai=Ws*X-Ht,wn=Te*We+Ie*Et+Re*Ws,Ks=N*(D-1-qs)+A*(M-1-Ai)+P*Be;for(let Ur=0;Ur<z;++Ur){const zr=_[wn+Fe*Ur],Xs=C[Ks+Ur];Qt+=zr*Xs}}}const sn=be*We+W*it+ne*Ut+ue*Be;w[sn]=Qt}}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const vDe={kernelName:TT,backendName:"cpu",kernelFunc:bDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wDe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s;Ye([r,i],"conv3d");const u=_c(r.shape,i.shape,o,l,a),{filterDepth:h,filterHeight:f,filterWidth:p,dilationDepth:g,dilationHeight:b,dilationWidth:T,padInfo:w}=u,_=w.front,C=w.left,N=w.top,A=new Bs(u.outShape,r.dtype),P=t.data.get(r.dataId).values,V=t.data.get(i.dataId).values,D=A.values,M=Qe(r.shape),$=Qe(i.shape);for(let O=0;O<u.batchSize;++O){const k=O*M[0],z=O*A.strides[0];for(let U=0;U<u.outDepth;++U){const te=z+U*A.strides[1],se=U*u.strideDepth-_;for(let X=0;X<h;++X){const Q=se+X*g;if(Q<0||Q>=u.inDepth)continue;const re=X*$[0],fe=k+Q*M[1];for(let be=0;be<u.outHeight;++be){const W=te+be*A.strides[2],ne=be*u.strideHeight-N;for(let ue=0;ue<f;++ue){const Te=ne+ue*b;if(Te<0||Te>=u.inHeight)continue;const Ie=re+ue*$[1],Re=fe+Te*M[2];for(let Fe=0;Fe<u.outWidth;++Fe){const We=W+Fe*u.outChannels,Be=Fe*u.strideWidth-C;for(let it=0;it<p;++it){const ct=Be+it*T;if(ct<0||ct>=u.inWidth)continue;const It=Ie+it*$[2],Bt=Re+ct*u.inChannels;let Ut=It;for(let Ht=0;Ht<u.inChannels;++Ht){const Ct=P[Bt+Ht];for(let nn=0;nn<u.outChannels;++nn)D[We+nn]+=Ct*V[Ut+nn];Ut+=u.outChannels}}}}}}}}return t.makeTensorInfo(A.shape,A.dtype,A.values)}const TDe={kernelName:xT,backendName:"cpu",kernelFunc:wDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xDe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s;Ye([r,i],"conv3dBackpropFilterV2");const u=Qe(r.shape),h=Qe(i.shape),f=_c(r.shape,l,o,1,a),p=f.strideDepth,g=f.strideHeight,b=f.strideWidth,T=f.filterDepth,w=f.filterHeight,_=f.filterWidth,C=new Bs(f.filterShape,"float32"),N=C.values,[A,P,V,D]=C.strides,M=t.data.get(i.dataId).values,[$,O,k,z]=h,U=t.data.get(r.dataId).values,[te,se,X,Q]=u,re=f.padInfo.front,fe=f.padInfo.left,be=f.padInfo.top;for(let W=0;W<T;++W){const ne=Math.max(0,Math.ceil((re-W)/p)),ue=Math.min(f.outDepth,(f.inDepth+re-W)/p),Te=W*A;for(let Ie=0;Ie<w;++Ie){const Re=Math.max(0,Math.ceil((be-Ie)/g)),Fe=Math.min(f.outHeight,(f.inHeight+be-Ie)/g),We=Ie*P+Te;for(let Be=0;Be<_;++Be){const it=Math.max(0,Math.ceil((fe-Be)/b)),ct=Math.min(f.outWidth,(f.inWidth+fe-Be)/b),It=Be*V+We;for(let Bt=0;Bt<f.inChannels;++Bt){const Ut=Bt*D+It;for(let Ht=0;Ht<f.outChannels;++Ht){let Ct=0;for(let nn=0;nn<f.batchSize;++nn){const Qt=nn*te,sn=nn*$;for(let Et=ne;Et<ue;++Et){const Ws=(W+Et*p-re)*se+Qt,Ai=Et*O+sn;for(let wn=Re;wn<Fe;++wn){const Ur=(Ie+wn*g-be)*X+Ws,zr=wn*k+Ai;for(let Xs=it;Xs<ct;++Xs){const Ul=(Be+Xs*b-fe)*Q+Ur,zl=Xs*z+zr;Ct+=U[Ul+Bt]*M[zl+Ht]}}}}N[Ut+Ht]=Ct}}}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const SDe={kernelName:ak,backendName:"cpu",kernelFunc:xDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _De(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s;Ye([r],"conv3dBackpropInputV2");const u=Qe(r.shape),h=Qe(i.shape),f=_c(l,i.shape,a,1,o),p=new Bs(f.inShape,"float32"),g=p.values,[b,T,w,_]=p.strides,C=t.data.get(r.dataId).values,[N,A,P,V]=u,D=t.data.get(i.dataId).values,[M,$,O,k]=h,{batchSize:z,filterDepth:U,filterHeight:te,filterWidth:se,inChannels:X,inDepth:Q,inHeight:re,inWidth:fe,outChannels:be,outDepth:W,outHeight:ne,outWidth:ue,strideDepth:Te,strideHeight:Ie,strideWidth:Re}=f,Fe=U-1-f.padInfo.front,We=te-1-f.padInfo.top,Be=se-1-f.padInfo.left;for(let it=0;it<z;++it)for(let ct=0;ct<X;++ct)for(let It=0;It<Q;++It){const Bt=It-Fe,Ut=Math.max(0,Math.ceil(Bt/Te)),Ht=Math.min(W,(U+Bt)/Te);for(let Ct=0;Ct<re;++Ct){const nn=Ct-We,Qt=Math.max(0,Math.ceil(nn/Ie)),sn=Math.min(ne,(te+nn)/Ie);for(let Et=0;Et<fe;++Et){const qs=Et-Be,Ws=Math.max(0,Math.ceil(qs/Re)),Ai=Math.min(ue,(se+qs)/Re);let wn=0;for(let Ks=Ut;Ks<Ht;++Ks){const Ur=Ks*Te-Bt;for(let zr=Qt;zr<sn;++zr){const Xs=zr*Ie-nn;for(let Va=Ws;Va<Ai;++Va){const Ul=Va*Re-qs,zl=N*it+A*Ks+P*zr+V*Va,fd=M*(U-1-Ur)+$*(te-1-Xs)+O*(se-1-Ul)+k*ct;for(let ur=0;ur<be;++ur){const Es=C[zl+ur],Gr=D[fd+ur];wn+=Es*Gr}}}}g[b*it+T*It+w*Ct+_*Et+ct]=wn}}}return t.makeTensorInfo(p.shape,p.dtype,p.values)}const EDe={kernelName:lk,backendName:"cpu",kernelFunc:_De};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IDe=an(Vy,n=>Math.cos(n)),CDe={kernelName:Vy,backendName:"cpu",kernelFunc:IDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NDe=an(By,n=>Math.cosh(n)),ADe={kernelName:By,backendName:"cpu",kernelFunc:NDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kDe(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,[h,f,p,g]=r.shape,b=i.shape[0],[T,w]=a,_=Tt([b,T,w,g],"float32"),C=t.data.get(i.dataId).values,N=t.data.get(o.dataId).values,A=t.data.get(r.dataId).values,P=Qe(r.shape),V=Qe(_.shape);for(let D=0;D<b;D++){const M=D*4,$=C[M],O=C[M+1],k=C[M+2],z=C[M+3],U=N[D];if(U>=h)continue;const te=T>1?(k-$)*(f-1)/(T-1):0,se=w>1?(z-O)*(p-1)/(w-1):0;for(let X=0;X<T;X++){const Q=T>1?$*(f-1)+X*te:.5*($+k)*(f-1);if(Q<0||Q>f-1){for(let re=0;re<w;re++)for(let fe=0;fe<g;fe++){const be=fe+re*V[2]+X*V[1]+D*V[0];_.values[be]=u}continue}if(l==="bilinear"){const re=Math.floor(Q),fe=Math.ceil(Q),be=Q-re;for(let W=0;W<w;W++){const ne=w>1?O*(p-1)+W*se:.5*(O+z)*(p-1);if(ne<0||ne>p-1){for(let Re=0;Re<g;Re++){const Fe=Re+W*V[2]+X*V[1]+D*V[0];_.values[Fe]=u}continue}const ue=Math.floor(ne),Te=Math.ceil(ne),Ie=ne-ue;for(let Re=0;Re<g;Re++){let Fe=Re+ue*P[2]+re*P[1]+U*P[0];const We=A[Fe];Fe=Re+Te*P[2]+re*P[1]+U*P[0];const Be=A[Fe];Fe=Re+ue*P[2]+fe*P[1]+U*P[0];const it=A[Fe];Fe=Re+Te*P[2]+fe*P[1]+U*P[0];const ct=A[Fe],It=We+(Be-We)*Ie,Bt=it+(ct-it)*Ie;Fe=Re+W*V[2]+X*V[1]+D*V[0],_.values[Fe]=It+(Bt-It)*be}}}else for(let re=0;re<w;++re){const fe=w>1?O*(p-1)+re*se:.5*(O+z)*(p-1);if(fe<0||fe>p-1){for(let ne=0;ne<g;ne++){const ue=ne+re*V[2]+X*V[1]+D*V[0];_.values[ue]=u}continue}const be=Math.round(fe),W=Math.round(Q);for(let ne=0;ne<g;ne++){const ue=ne+be*P[2]+W*P[1]+U*P[0],Te=ne+re*V[2]+X*V[1]+D*V[0];_.values[Te]=A[ue]}}}}return t.makeTensorInfo(_.shape,_.dtype,_.values)}const $De={kernelName:ck,backendName:"cpu",kernelFunc:kDe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RDe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;Ye(r,"cumprod");const l=zn([i],r.shape.length);let u=r;l!=null&&(u=Lr({inputs:{x:r},backend:t,attrs:{perm:l}}));const h=Yn(1,r.shape.length)[0];if(h!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${h}`);const f=ai(u.dtype,"int32"),p=YA(Ee(u.shape),f),g=t.data.get(u.dataId).values,b=u.shape[u.shape.length-1],T=a?(_,C)=>_+b-C-1:(_,C)=>_+C;for(let _=0;_<g.length;_+=b)for(let C=0;C<b;C++){const N=T(_,C);if(C===0)p[N]=o?1:g[N];else{const A=T(_,C-1);p[N]=o?g[A]*p[A]:g[N]*p[A]}}const w=t.makeTensorInfo(u.shape,f,p);if(l!=null){const _=Ec(l),C=Lr({inputs:{x:w},backend:t,attrs:{perm:_}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(u),C}return w}const DDe={kernelName:uk,backendName:"cpu",kernelFunc:RDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MDe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;Ye(r,"cumsum");const l=zn([i],r.shape.length);let u=r;l!=null&&(u=Lr({inputs:{x:r},backend:t,attrs:{perm:l}}));const h=Yn(1,r.shape.length)[0];if(h!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${h}`);const f=ai(u.dtype,"int32"),p=or(Ee(u.shape),f),g=t.data.get(u.dataId).values,b=u.shape[u.shape.length-1],T=a?(_,C)=>_+b-C-1:(_,C)=>_+C;for(let _=0;_<g.length;_+=b)for(let C=0;C<b;C++){const N=T(_,C);if(C===0)p[N]=o?0:g[N];else{const A=T(_,C-1);p[N]=o?g[A]+p[A]:g[N]+p[A]}}const w=t.makeTensorInfo(u.shape,f,p);if(l!=null){const _=Ec(l),C=Lr({inputs:{x:w},backend:t,attrs:{perm:_}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(u),C}return w}const ODe={kernelName:ST,backendName:"cpu",kernelFunc:MDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PDe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,h=h$(l,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,h)}else if(r.shape.length===2){const l=t.bufferSync(r),u=t.bufferSync(i),h=DK(l,u,o,a);return t.makeTensorInfo(h.shape,i.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const FDe={kernelName:hk,backendName:"cpu",kernelFunc:PDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LDe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:i,dataFormat:o}=s;q(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=r.shape[0],l=r.shape[1],u=r.shape[2],h=r.shape[3],f=l*i,p=u*i,g=h/(i*i),b=t.data.get(r.dataId).values,T=new Float32Array(a*f*p*g);let w=0;for(let _=0;_<a;++_)for(let C=0;C<f;++C){const N=Math.floor(C/i),A=C%i;for(let P=0;P<p;++P){const V=Math.floor(P/i),D=P%i,M=(A*i+D)*g;for(let $=0;$<g;++$){const k=$+M+h*(V+u*(N+l*_));T[w++]=b[k]}}}return t.makeTensorInfo([a,f,p,g],r.dtype,T)}const VDe={kernelName:dk,backendName:"cpu",kernelFunc:LDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;Ye([r,i],"depthwiseConv2DNative");const h=Qe(r.shape),f=Qe(i.shape);let p=l;p==null&&(p=[1,1]),q(ar(o,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${p}'`);const g=zs(r.shape,i.shape,o,p,a,u,!0),{filterHeight:b,filterWidth:T,dilationHeight:w,dilationWidth:_,padInfo:C}=g,N=C.left,A=C.top,P=g.outChannels/g.inChannels,V=new Bs(g.outShape,r.dtype),D=t.data.get(r.dataId).values,M=t.data.get(i.dataId).values,$=V.values;for(let O=0;O<g.batchSize;++O){const k=O*h[0],z=O*V.strides[0];for(let U=0;U<g.outHeight;++U){const te=z+U*V.strides[1],se=U*g.strideHeight-A;for(let X=0;X<b;++X){const Q=se+X*w;if(Q<0||Q>=g.inHeight)continue;const re=X*f[0],fe=k+Q*h[1];for(let be=0;be<g.outWidth;++be){const W=te+be*V.strides[2],ne=be*g.strideWidth-N;for(let ue=0;ue<T;++ue){const Te=ne+ue*_;if(Te<0||Te>=g.inWidth)continue;const Ie=re+ue*f[1],Re=fe+Te*g.inChannels;let Fe=W,We=Ie;for(let Be=0;Be<g.inChannels;++Be){const it=D[Re+Be];for(let ct=0;ct<P;++ct)$[Fe+ct]+=it*M[We+ct];Fe+=P,We+=P}}}}}}return t.makeTensorInfo(V.shape,V.dtype,V.values)}const BDe={kernelName:_T,backendName:"cpu",kernelFunc:DX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UDe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:h}=s;Ye([r,i],"depthwiseConv2dNativeBackpropFilter");const f=zs(r.shape,h,o,a,l,u,!0),{strideHeight:p,strideWidth:g,filterHeight:b,filterWidth:T}=f,w=new Bs(f.filterShape,"float32"),_=f.padInfo.left,C=f.padInfo.top,N=f.outChannels/f.inChannels,A=t.data.get(r.dataId).values,P=new Bs(r.shape,r.dtype,A),V=t.data.get(i.dataId).values,D=new Bs(i.shape,i.dtype,V);for(let M=0;M<b;++M){const $=Math.max(0,Math.ceil((C-M)/p)),O=Math.min(f.outHeight,(f.inHeight+C-M)/p);for(let k=0;k<T;++k){const z=Math.max(0,Math.ceil((_-k)/g)),U=Math.min(f.outWidth,(f.inWidth+_-k)/g);for(let te=0;te<f.outChannels;++te){const se=Math.trunc(te/N),X=te%N;let Q=0;for(let re=0;re<f.batchSize;++re)for(let fe=$;fe<O;++fe){const be=M+fe*p-C;for(let W=z;W<U;++W){const ne=k+W*g-_;Q+=P.get(re,be,ne,se)*D.get(re,fe,W,te)}}w.set(Q,M,k,se,X)}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const zDe={kernelName:fk,backendName:"cpu",kernelFunc:UDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GDe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:h}=s;Ye([r,i],"depthwiseConv2DNativeBackpropInput");const f=Qe(r.shape),p=Qe(i.shape),g=zs(h,i.shape,o,a,l,u,!0),b=new Bs(g.inShape,"float32"),T=b.values,[w,_,C]=b.strides,N=t.data.get(r.dataId).values,[A,P,V]=f,D=t.data.get(i.dataId).values,[M,$,O]=p,{batchSize:k,filterHeight:z,filterWidth:U,inChannels:te,inHeight:se,inWidth:X,outChannels:Q,outHeight:re,outWidth:fe,strideHeight:be,strideWidth:W}=g,ne=z-1-g.padInfo.top,ue=U-1-g.padInfo.left,Te=Q/te;for(let Ie=0;Ie<k;++Ie)for(let Re=0;Re<te;++Re)for(let Fe=0;Fe<se;++Fe){const We=Fe-ne,Be=Math.max(0,Math.ceil(We/be)),it=Math.min(re,(z+We)/be);for(let ct=0;ct<X;++ct){const It=ct-ue,Bt=Math.max(0,Math.ceil(It/W)),Ut=Math.min(fe,(U+It)/W);let Ht=0;for(let Ct=Be;Ct<it;++Ct){const nn=Ct*be-We;for(let Qt=Bt;Qt<Ut;++Qt){const sn=Qt*W-It,Et=A*Ie+P*Ct+V*Qt,qs=M*(z-1-nn)+$*(U-1-sn)+O*Re;for(let Ws=0;Ws<Te;++Ws){const Ai=Re*Te+Ws,wn=N[Et+Ai],Ks=D[qs+Ws];Ht+=wn*Ks}}}T[w*Ie+_*Fe+C*ct+Re]=Ht}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const HDe={kernelName:pk,backendName:"cpu",kernelFunc:GDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qDe(n){const{inputs:e,backend:t}=n,{x:s}=e,r=Ee(s.shape),i=t.data.get(s.dataId).values,o=Tt([r,r],s.dtype),a=o.values;for(let u=0;u<i.length;u++)a[u*r+u]=i[u];const l=[...s.shape,...s.shape];return t.makeTensorInfo(l,o.dtype,o.values)}const WDe={kernelName:u5,backendName:"cpu",kernelFunc:qDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KDe={kernelName:ET,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r}=n,{strides:i,pad:o,dilations:a}=t,l=e,u=l.data.get(s.dataId).values,h=s.shape.length,f=l.data.get(r.dataId).values,p=r.shape.length,{batchSize:g,inHeight:b,inWidth:T,inChannels:w,outHeight:_,outWidth:C,padInfo:N,strideHeight:A,strideWidth:P,filterHeight:V,filterWidth:D,dilationHeight:M,dilationWidth:$,outShape:O}=_b(s.shape,r.shape,i,o,"NHWC",a),k=Ee(O),z=O.length,U=Wn(s.dtype,k);for(let se=0;se<g;++se)for(let X=0;X<_;++X){const Q=X*A-N.top;for(let re=0;re<C;++re){const fe=re*P-N.left;for(let be=0;be<w;++be){let W=Number.MIN_SAFE_INTEGER;for(let ue=0;ue<V;++ue){const Te=Q+ue*M;if(Te>=0&&Te<b)for(let Ie=0;Ie<D;++Ie){const Re=fe+Ie*$;if(Re>=0&&Re<T){const Fe=xa([se,Te,Re,be],h,Qe(s.shape)),We=xa([ue,Ie,be],p,Qe(r.shape)),Be=u[Fe]+f[We];Be>W&&(W=Be)}}}const ne=xa([se,X,re,be],z,Qe(O));U[ne]=W}}}return{dataId:l.write(sd(U,s.dtype),O,s.dtype),shape:O,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XDe={kernelName:KI,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:a,dilations:l}=t,u=e,h=ko(s.shape,u.data.get(s.dataId).values),f=ko(r.shape,u.data.get(r.dataId).values),{batchSize:p,inHeight:g,inWidth:b,inChannels:T,outHeight:w,outWidth:_,padInfo:C,strideHeight:N,strideWidth:A,filterHeight:P,filterWidth:V,dilationHeight:D,dilationWidth:M,outShape:$}=_b(s.shape,r.shape,o,a,"NHWC",l);q(i.rank===$.length,()=>`Error in ${KI}, dy must have the same rank as output ${$.length}, but got ${i.rank}`);const O=ko($,u.data.get(i.dataId).values),k=i5(r.shape,r.dtype);for(let U=0;U<p;++U)for(let te=0;te<w;++te){const se=te*N-C.top;for(let X=0;X<_;++X){const Q=X*A-C.left;for(let re=0;re<T;++re){let fe=Number.MIN_SAFE_INTEGER,be=0,W=0;for(let ne=0;ne<P;++ne){const ue=se+ne*D;if(ue>=0&&ue<g)for(let Te=0;Te<V;++Te){const Ie=Q+Te*M;if(Ie>=0&&Ie<b){const Re=h[U][ue][Ie][re]+f[ne][Te][re];Re>fe&&(fe=Re,be=ne,W=Te)}}}k[be][W][re]+=O[U][te][X][re]}}}return{dataId:u.write(sd(k,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YDe={kernelName:WI,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:a,dilations:l}=t,u=e,h=ko(s.shape,u.data.get(s.dataId).values),f=ko(r.shape,u.data.get(r.dataId).values),{batchSize:p,inHeight:g,inWidth:b,inChannels:T,outHeight:w,outWidth:_,padInfo:C,strideHeight:N,strideWidth:A,filterHeight:P,filterWidth:V,dilationHeight:D,dilationWidth:M,outShape:$}=_b(s.shape,r.shape,o,a,"NHWC",l);q(i.rank===$.length,()=>`Error in ${WI}, dy must have the same rank as output ${$.length}, but got ${i.rank}`);const O=ko($,u.data.get(i.dataId).values),k=i5(s.shape,s.dtype);for(let U=0;U<p;++U)for(let te=0;te<w;++te){const se=te*N-C.top;for(let X=0;X<_;++X){const Q=X*A-C.left;for(let re=0;re<T;++re){let fe=Number.MIN_SAFE_INTEGER,be=se<0?0:se,W=Q<0?0:Q;for(let ne=0;ne<P;++ne){const ue=se+ne*D;if(ue>=0&&ue<g)for(let Te=0;Te<V;++Te){const Ie=Q+Te*M;if(Ie>=0&&Ie<b){const Re=h[U][ue][Ie][re]+f[ne][Te][re];Re>fe&&(fe=Re,be=ue,W=Ie)}}}k[U][be][W][re]+=O[U][te][X][re]}}}return{dataId:u.write(sd(k,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JDe(n){const{inputs:e,backend:t,attrs:s}=n,{image:r}=e,{canvas:i,options:o}=s,{contextOptions:a,imageOptions:l}=o||{},u=(l==null?void 0:l.alpha)||1,h=(a==null?void 0:a.contextType)||"2d";if(h!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const f=i.getContext(h,(a==null?void 0:a.contextAttributes)||{});if(f==null)throw new Error(`Could not get the context with ${h} type.`);const[p,g]=r.shape.slice(0,2),b=r.shape.length===2?1:r.shape[2],T=t.data.get(r.dataId).values,w=r.dtype==="float32"?255:1,_=new Uint8ClampedArray(g*p*4);for(let N=0;N<p*g;++N){const A=[0,0,0,255*u];for(let V=0;V<b;V++){const D=T[N*b+V];if(r.dtype==="float32"){if(D<0||D>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${D}.`)}else if(r.dtype==="int32"&&(D<0||D>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${D}.`);b===1?(A[0]=D*w,A[1]=D*w,A[2]=D*w):A[V]=D*w}const P=N*4;_[P+0]=Math.round(A[0]),_[P+1]=Math.round(A[1]),_[P+2]=Math.round(A[2]),_[P+3]=Math.round(A[3])}i.width=g,i.height=p;const C=new ImageData(_,g,p);return f.putImageData(C,0,0),r}const jDe={kernelName:YTe,backendName:"cpu",kernelFunc:JDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bb(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Ye(r,"sum");let a;r.dtype==="bool"?a=pc({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):a=Fa({inputs:{x:r},backend:t});const l=a.shape.length,u=xt(i,a.shape),h=zn(u,l);let f=u,p=a;h!=null&&(p=Lr({inputs:{x:a},backend:t,attrs:{perm:h}}),f=Yn(f.length,l)),Gs("sum",f,p.shape.length);const[g,b]=Ds(p.shape,f),T=ai(p.dtype,"int32");let w=fw(t,g,T);const _=Ee(b),C=t.data.get(w.dataId).values,N=t.data.get(p.dataId).values;for(let A=0;A<C.length;++A){const P=A*_;let V=0;for(let D=0;D<_;++D)V+=N[P+D];C[A]=V}if(o){const A=os(w.shape,u),P=w;w=Cn({inputs:{x:w},backend:t,attrs:{shape:A}}),t.disposeIntermediateTensorInfo(P)}return t.disposeIntermediateTensorInfo(a),h!=null&&t.disposeIntermediateTensorInfo(p),w}const QDe={kernelName:rx,backendName:"cpu",kernelFunc:Bb};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZDe(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=O2(r,i.length);F2(o.length,l,i);const{path:u,steps:h}=L2(a,l),f=h.length;let p=null,g=o.length;const b=[];for(let T=0;T<f;++T){for(const w of h[T]){const{permutationIndices:_,expandDims:C}=P2(g,l[w]);let N;V2(_)?N=i[w]:(N=Lr({inputs:{x:i[w]},backend:t,attrs:{perm:_}}),b.push(N));const A=N.shape.slice();for(let P=0;P<C.length;++P)A.splice(C[P],0,1);jt(N.shape,A)||(N=Cn({inputs:{x:N},backend:t,attrs:{shape:A}}),b.push(N)),p===null?p=N:(p=Mx({inputs:{a:N,b:p},backend:t}),b.push(p))}T<f-1&&(u[T]>=0&&(p=Bb({inputs:{x:p},backend:t,attrs:{axis:u[T]-(o.length-g),keepDims:!1}}),b.push(p)),g--)}for(const T of b)T!==p&&t.disposeIntermediateTensorInfo(T);return p}const eMe={kernelName:mk,backendName:"cpu",kernelFunc:ZDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tMe(n){const{inputs:e,backend:t}=n,{dy:s,y:r}=e;Ye([s,r],"eluGrad");const i=new Float32Array(Ee(r.shape)),o=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values;for(let l=0;l<o.length;++l){const u=o[l];u>=0?i[l]=a[l]:i[l]=a[l]*(u+1)}return t.makeTensorInfo(r.shape,"float32",i)}const nMe={kernelName:gk,backendName:"cpu",kernelFunc:tMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sMe=N2,rMe=A2,iMe=k2,oMe=$2,aMe=R2,lMe=D2,uMe=an(Gy,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+sMe*t);return e*(1-((((lMe*s+aMe)*s+oMe)*s+iMe)*s+rMe)*s*Math.exp(-t*t))}),cMe={kernelName:Gy,backendName:"cpu",kernelFunc:uMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gw(n){const{inputs:e,backend:t,attrs:s}=n,{input:r}=e,{dim:i}=s,o=r.shape.length,a=r.shape.slice();let l=i;return i<0&&(q(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),Cn({inputs:{x:r},backend:t,attrs:{shape:a}})}const hMe={kernelName:CT,backendName:"cpu",kernelFunc:gw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dMe=jn((n,e)=>n/e),y$=_s(Uy,dMe),vC={kernelName:Uy,backendName:"cpu",kernelFunc:y$};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MX(n,e,t){const s=n.shape,r=s[0],i=s[1],o=t.data.get(n.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,u=[r,i],h=Ee(u),f=ir("float32",h),p=ir("float32",h);for(let w=0;w<r;w++){const _=jh({inputs:{x:a},backend:t,attrs:{begin:[w,0],size:[1,i]}}),C=jh({inputs:{x:l},backend:t,attrs:{begin:[w,0],size:[1,i]}}),N=ri({inputs:{real:_,imag:C},backend:t}),{real:A,imag:P}=fMe(N,e,t),V=Nl(A,P);for(let D=0;D<i;D++){const M=M2(V,D);f[w*i+D]=M.real,p[w*i+D]=M.imag}t.disposeIntermediateTensorInfo(_),t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo(N)}const g=t.makeTensorInfo(u,"float32",f),b=t.makeTensorInfo(u,"float32",p),T=ri({inputs:{real:g,imag:b},backend:t});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(b),T}function fMe(n,e,t){const s=Ee(n.shape),r=t.data.get(n.dataId),i=t.data.get(r.complexTensorInfos.real.dataId).values,o=t.data.get(r.complexTensorInfos.imag.dataId).values;if(pMe(s)){const a=wC(i,o,s,e,t),l=[n.shape[0],n.shape[1]];if(e){const u=t.makeTensorInfo(l,"float32",a.real),h=t.makeTensorInfo(l,"float32",a.imag),f=t.makeTensorInfo([],"float32",Sc(s,"float32")),p=Fa({inputs:{x:f},backend:t}),g=vC.kernelFunc({inputs:{a:u,b:f},backend:t}),b=vC.kernelFunc({inputs:{a:h,b:p},backend:t}),T=t.data.get(g.dataId).values,w=t.data.get(b.dataId).values;return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(b),{real:T,imag:w}}return a}else{const a=Nl(i,o),l=mMe(a,s,e);return Y9(l)}}function pMe(n){return(n&n-1)===0}function wC(n,e,t,s,r){if(t===1)return{real:n,imag:e};const i=Nl(n,e),o=t/2,a=J9(i),l=a.real,u=a.imag,h=[l.length],f=r.makeTensorInfo(h,"float32",l),p=r.makeTensorInfo(h,"float32",u),g=ri({inputs:{real:f,imag:p},backend:r}),b=j9(i),T=b.real,w=b.imag,_=[T.length],C=r.makeTensorInfo(_,"float32",T),N=r.makeTensorInfo(_,"float32",w),A=ri({inputs:{real:C,imag:N},backend:r}),P=wC(l,u,o,s,r),V=P.real,D=P.imag,M=[V.length],$=r.makeTensorInfo(M,"float32",V),O=r.makeTensorInfo(M,"float32",D),k=ri({inputs:{real:$,imag:O},backend:r}),z=wC(T,w,o,s,r),U=z.real,te=z.imag,se=[U.length],X=r.makeTensorInfo(se,"float32",U),Q=r.makeTensorInfo(se,"float32",te),re=ri({inputs:{real:X,imag:Q},backend:r}),fe=Z9(t,s),be=[fe.real.length],W=r.makeTensorInfo(be,"float32",fe.real),ne=r.makeTensorInfo(be,"float32",fe.imag),ue=ri({inputs:{real:W,imag:ne},backend:r}),Te=Mx({inputs:{a:ue,b:re},backend:r}),Ie=sp({inputs:{a:k,b:Te},backend:r}),Re=m$({inputs:{a:k,b:Te},backend:r}),Fe=Jh({inputs:{input:Ie},backend:r}),We=Jh({inputs:{input:Re},backend:r}),Be=rp({inputs:{input:Ie},backend:r}),it=rp({inputs:{input:Re},backend:r}),ct=ip({inputs:[Fe,We],backend:r,attrs:{axis:0}}),It=ip({inputs:[Be,it],backend:r,attrs:{axis:0}}),Bt=r.data.get(ct.dataId).values,Ut=r.data.get(It.dataId).values;return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(C),r.disposeIntermediateTensorInfo(N),r.disposeIntermediateTensorInfo(A),r.disposeIntermediateTensorInfo($),r.disposeIntermediateTensorInfo(O),r.disposeIntermediateTensorInfo(k),r.disposeIntermediateTensorInfo(X),r.disposeIntermediateTensorInfo(Q),r.disposeIntermediateTensorInfo(re),r.disposeIntermediateTensorInfo(W),r.disposeIntermediateTensorInfo(ne),r.disposeIntermediateTensorInfo(ue),r.disposeIntermediateTensorInfo(Te),r.disposeIntermediateTensorInfo(Ie),r.disposeIntermediateTensorInfo(Re),r.disposeIntermediateTensorInfo(Fe),r.disposeIntermediateTensorInfo(Be),r.disposeIntermediateTensorInfo(We),r.disposeIntermediateTensorInfo(it),r.disposeIntermediateTensorInfo(ct),r.disposeIntermediateTensorInfo(It),{real:Bt,imag:Ut}}function mMe(n,e,t){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let i=0,o=0;for(let a=0;a<e;a++){const l=e8(r*a,e,t),u=M2(n,a);i+=u.real*l.real-u.imag*l.imag,o+=u.real*l.imag+u.imag*l.real}t&&(i/=e,o/=e),Q9(s,i,o,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gMe(n){const{inputs:e,backend:t}=n,{input:s}=e,r=Ee(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=Cn({inputs:{x:s},backend:t,attrs:{shape:[o,i]}}),l=MX(a,!1,t),u=Cn({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const yMe={kernelName:yk,backendName:"cpu",kernelFunc:gMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b$(n){const{backend:e,attrs:t}=n,{shape:s,value:r,dtype:i}=t,o=i||_p(r),a=Wn(o,Ee(s));return vMe(a,r,o),e.makeTensorInfo(s,o,a)}const bMe={kernelName:bk,backendName:"cpu",kernelFunc:b$};function vMe(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wMe={kernelName:vk,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,r=t,i=ir(s.dtype,Ee(s.shape)),[o,a,l,u]=s.shape,h=r.data.get(s.dataId).values;for(let p=0;p<o;p++){const g=p*l*a*u;for(let b=0;b<a;b++){const T=b*(l*u);for(let w=0;w<l;w++){const _=w*u;for(let C=0;C<u;C++){const N=Math.round(l-w-1),A=g+T+_+C;let P=h[A];if(N>=0&&N<l){const V=N*u,D=g+T+V+C;P=h[D]}i[A]=P}}}}return{dataId:r.write(i,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TMe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:h,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:b}=s;let T=RX({inputs:{x:r,filter:i},backend:t,attrs:{strides:l,pad:u,dataFormat:h,dilations:f,dimRoundingMode:p}});if(o){const w=T;if(h==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const _=Cn({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});T=sp({inputs:{a:T,b:_},backend:t}),t.disposeIntermediateTensorInfo(_)}else T=sp({inputs:{a:T,b:o},backend:t});t.disposeIntermediateTensorInfo(w)}if(g){const w=T;if(h==="NCHW"&&g==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const _=Cn({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});T=mw(t,T,g,_,b),t.disposeIntermediateTensorInfo(_)}else T=mw(t,T,g,a,b);t.disposeIntermediateTensorInfo(w)}return T}const xMe={kernelName:Jv,backendName:"cpu",kernelFunc:TMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SMe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:h,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:b}=s;let T=DX({inputs:{x:r,filter:i},backend:t,attrs:{strides:l,pad:u,dataFormat:h,dilations:f,dimRoundingMode:p}});if(o){const w=T;T=sp({inputs:{a:T,b:o},backend:t}),t.disposeIntermediateTensorInfo(w)}if(g){const w=T;T=mw(t,T,g,a,b),t.disposeIntermediateTensorInfo(w)}return T}const _Me={kernelName:N5,backendName:"cpu",kernelFunc:SMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EMe(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,i=Ee(s.shape),o=r.shape,a=o[o.length-1],[l,u,h,f]=y2(s,r);if(u===0)return t.makeTensorInfo(l,s.dtype,[]);const p=t.data.get(r.dataId).values,g=t.bufferSync(s),b=HK(p,g,s.dtype,u,a,h,f,s.shape,i);return t.makeTensorInfo(l,s.dtype,b.values)}const IMe={kernelName:c5,backendName:"cpu",kernelFunc:EMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CMe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:i}=e,{axis:o,batchDims:a}=s;Ye([r,i],"gatherV2");const l=xt(o,r.shape)[0],u=t.data.get(i.dataId).values,h=r.shape[l];for(let A=0;A<u.length;++A){const P=u[A];q(P<=h-1&&P>=0,()=>`GatherV2: the index value ${P} is not in [0, ${h-1}]`)}let f=a;a==null&&(f=0);const p=Ee(i.shape),g=U2(r,i,l,f),b=Cn({inputs:{x:r},backend:t,attrs:{shape:[g.batchSize,g.outerSize,g.dimSize,g.sliceSize]}}),T=Cn({inputs:{x:i},backend:t,attrs:{shape:[g.batchSize,p/g.batchSize]}}),w=[g.batchSize,g.outerSize,p/g.batchSize,g.sliceSize],_=t.bufferSync(T),C=t.bufferSync(b),N=qK(C,_,w);return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(T),t.makeTensorInfo(g.outputShape,N.dtype,N.values)}const NMe={kernelName:AT,backendName:"cpu",kernelFunc:CMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AMe(n){const{inputs:e,backend:t}=n,{input:s}=e,r=Ee(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=Cn({inputs:{x:s},backend:t,attrs:{shape:[o,i]}}),l=MX(a,!0,t),u=Cn({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const kMe={kernelName:wk,backendName:"cpu",kernelFunc:AMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Me=an(Jy,n=>Number.isFinite(n)?1:0,"bool"),RMe={kernelName:Jy,backendName:"cpu",kernelFunc:$Me};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DMe=an(jy,n=>Math.abs(n)===1/0?1:0,"bool"),MMe={kernelName:jy,backendName:"cpu",kernelFunc:DMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OMe=an(Qy,n=>Number.isNaN(n)?1:0,"bool"),PMe={kernelName:Qy,backendName:"cpu",kernelFunc:OMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FMe(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:i}=t,o=JK(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const LMe={kernelName:h5,backendName:"cpu",kernelFunc:FMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VMe=an(eb,n=>Math.log1p(n)),BMe={kernelName:eb,backendName:"cpu",kernelFunc:VMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UMe=jn((n,e)=>n&&e),zMe=_s(MT,UMe,null,"bool"),GMe={kernelName:MT,backendName:"cpu",kernelFunc:zMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HMe=an(OT,n=>n?0:1,"bool"),qMe={kernelName:OT,backendName:"cpu",kernelFunc:HMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WMe=jn((n,e)=>n||e),KMe=_s(PT,WMe,null,"bool"),XMe={kernelName:PT,backendName:"cpu",kernelFunc:KMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YMe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s;Ye(r,"LRN");const u=r.shape[3],h=u-1,f=t.data.get(r.dataId).values,p=Ee(r.shape),g=new Float32Array(p);function b(T){const w=T%u;let _=T-w+Math.max(0,w-i);const C=T-w+Math.min(w+i,h);let N=0;for(;_<=C;_++){const A=f[_];N+=A*A}return N}for(let T=0;T<p;T++){const w=b(T),_=f[T]*Math.pow(o+a*w,-l);g[T]=_}return t.makeTensorInfo(r.shape,r.dtype,g)}const JMe={kernelName:FT,backendName:"cpu",kernelFunc:YMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jMe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:h}=s;Ye(o,"LRNGrad");const f=Ee(o.shape),p=o.shape[3],g=t.data.get(o.dataId).values,b=t.data.get(r.dataId).values,T=t.data.get(i.dataId).values,w=new Float32Array(f),_=f;for(let C=0;C<_;C++){const N=C%p,A=C-N+Math.max(0,N-a),P=C-N+Math.min(p,N+a+1);let V=0;for(let D=A;D<P;D++)V+=Math.pow(b[D],2);V=u*V+l;for(let D=A;D<P;D++){let M=-2*u*h*b[D]*T[C]/V;C===D&&(M+=Math.pow(V,-h)),M*=g[C],w[D]+=M}}return t.makeTensorInfo(o.shape,r.dtype,w)}const QMe={kernelName:xk,backendName:"cpu",kernelFunc:jMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=t;let l=r.shape;const u=l.length,h=xt(i,l);let f=h;const p=zn(f,u);let g=a.data.get(r.dataId).values;if(p!=null){const A=new Array(u);for(let P=0;P<A.length;P++)A[P]=l[p[P]];g=f$(g,l,r.dtype,p,A),f=Yn(f.length,u),l=A}Ye(r,"max"),Gs("max",f,u);const[b,T]=Ds(l,f),w=Ee(T),_=QK(g,w,b,r.dtype),C=a.write(_,b,r.dtype);let N=b;return o&&(N=os(b,h)),{dataId:C,shape:N,dtype:r.dtype}}const ZMe={kernelName:LT,backendName:"cpu",kernelFunc:OX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eOe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Ye(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;q(ar(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=no(r.shape,i,o,u,a,l);let f;if(h.filterWidth===1&&h.filterHeight===1&&jt(h.inShape,h.outShape))f=Fa({inputs:{x:r},backend:t});else{const p=t.data.get(r.dataId).values,g=Qe(r.shape),b=g$(p,r.shape,r.dtype,g,h,"max");f=t.makeTensorInfo(h.outShape,r.dtype,b.values)}return f}const tOe={kernelName:VT,backendName:"cpu",kernelFunc:eOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nOe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;Ye(r,"maxPool3d");const h=Ll(r.shape,i,o,1,a,l,u),f=t.data.get(r.dataId).values,p=$X(f,r.shape,r.dtype,Qe(r.shape),h,"max");return t.makeTensorInfo(p.shape,"float32",p.values)}const sOe={kernelName:BT,backendName:"cpu",kernelFunc:nOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rOe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;Ye([r,i],"maxPool3DGrad");const h=Ll(i.shape,o,a,1,l,u),f=t.bufferSync(i),p=WRe(f,h),g=h.strideDepth,b=h.strideHeight,T=h.strideWidth,w=h.dilationDepth,_=h.dilationHeight,C=h.dilationWidth,N=h.effectiveFilterDepth,A=h.effectiveFilterHeight,P=h.effectiveFilterWidth,V=N-1-h.padInfo.front,D=P-1-h.padInfo.left,M=A-1-h.padInfo.top,$=Tt(i.shape,"float32"),O=t.bufferSync(r);for(let k=0;k<h.batchSize;++k)for(let z=0;z<h.inChannels;++z)for(let U=0;U<h.inDepth;++U)for(let te=0;te<h.inHeight;++te)for(let se=0;se<h.inWidth;++se){const X=U-V,Q=te-M,re=se-D;let fe=0;for(let be=0;be<N;be+=w){const W=(X+be)/g;if(!(W<0||W>=h.outDepth||Math.floor(W)!==W))for(let ne=0;ne<A;ne+=_){const ue=(Q+ne)/b;if(!(ue<0||ue>=h.outHeight||Math.floor(ue)!==ue))for(let Te=0;Te<P;Te+=C){const Ie=(re+Te)/T;if(Ie<0||Ie>=h.outWidth||Math.floor(Ie)!==Ie)continue;const Re=N*A*P-1-p.get(k,W,ue,Ie,z),Fe=be*A*P+ne*P+Te,We=Re===Fe?1:0;if(We===0)continue;const Be=O.get(k,W,ue,Ie,z);fe+=Be*We}}}$.set(fe,k,U,te,se,z)}return t.makeTensorInfo($.shape,$.dtype,$.values)}const iOe={kernelName:_k,backendName:"cpu",kernelFunc:rOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oOe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i,output:o}=e,a=i;Ye([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:h,dimRoundingMode:f}=s,p=no(a.shape,l,u,1,h,f),g=t.data.get(a.dataId).values,b=Tt(p.outShape,a.dtype,kX(g,a.shape,a.dtype,p).values),T=p.strideHeight,w=p.strideWidth,_=p.dilationHeight,C=p.dilationWidth,N=p.effectiveFilterHeight,A=p.effectiveFilterWidth,P=A-1-p.padInfo.left,V=N-1-p.padInfo.top,D=Tt(a.shape,"float32"),M=t.data.get(r.dataId).values,$=Tt(r.shape,"float32",M);for(let O=0;O<p.batchSize;++O)for(let k=0;k<p.inChannels;++k)for(let z=0;z<p.inHeight;++z)for(let U=0;U<p.inWidth;++U){const te=z-V,se=U-P;let X=0;for(let Q=0;Q<N;Q+=_){const re=(te+Q)/T;if(!(re<0||re>=p.outHeight||Math.floor(re)!==re))for(let fe=0;fe<A;fe+=C){const be=(se+fe)/w;if(be<0||be>=p.outWidth||Math.floor(be)!==be)continue;const W=N*A-1-b.get(O,re,be,k),ne=Q*A+fe,ue=W===ne?1:0;if(ue===0)continue;const Te=$.get(O,re,be,k);X+=Te*ue}}D.set(X,O,z,U,k)}return t.makeTensorInfo(D.shape,D.dtype,D.values)}const aOe={kernelName:Sk,backendName:"cpu",kernelFunc:oOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lOe(n,e,t,s,r){const i=Qe(e),o=g$(n,e,t,i,r,"max"),a=kX(n,e,t,r,!0,s);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uOe={kernelName:d5,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;Ye(s,"MaxPoolWithArgmax");const u=l.data.get(s.dataId).values,h=no(s.shape,r,i,[1,1],o),[f,p]=lOe(u,s.shape,s.dtype,a,h),g=l.write(f,h.outShape,s.dtype),b=l.write(p,h.outShape,s.dtype);return[{dataId:g,shape:h.outShape,dtype:s.dtype},{dataId:b,shape:h.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cOe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=xt(i,r.shape),u=Ds(r.shape,a)[1],h=Ee(u),f=[],p=t.makeTensorInfo([],"float32",new Float32Array([h]));f.push(p);const g=pc({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});f.push(g);const b=y$({inputs:{a:g,b:p},backend:t});f.push(b);const T=Bb({inputs:{x:b},backend:t,attrs:{axis:i,keepDims:o}});return f.forEach(w=>t.disposeIntermediateTensorInfo(w)),T}const hOe={kernelName:UT,backendName:"cpu",kernelFunc:cOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dOe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Ye(r,"min");const a=xt(i,r.shape);let l=a;const u=zn(l,r.shape.length);let h=r;u!=null&&(h=Lr({inputs:{x:r},backend:t,attrs:{perm:u}}),l=Yn(l.length,r.shape.length)),Gs("min",l,h.shape.length);const[f,p]=Ds(h.shape,l),g=Ee(p),b=or(Ee(f),h.dtype),T=t.data.get(h.dataId).values;for(let _=0;_<b.length;++_){const C=_*g;let N=T[C];for(let A=0;A<g;++A){const P=T[C+A];(Number.isNaN(P)||P<N)&&(N=P)}b[_]=N}u!=null&&t.disposeIntermediateTensorInfo(h);const w=t.makeTensorInfo(f,h.dtype,b);if(o){const _=os(f,a),C=Cn({inputs:{x:w},backend:t,attrs:{shape:_}});return t.disposeIntermediateTensorInfo(w),C}return w}const fOe={kernelName:zT,backendName:"cpu",kernelFunc:dOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pOe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,mode:o}=s;Ye(r,"mirrorPad");const a=i.map((N,A)=>N[0]+r.shape[A]+N[1]),l=i.map(N=>N[0]),u=i.map((N,A)=>N[0]+r.shape[A]),h=o==="reflect"?0:1,f=t.data.get(r.dataId).values,p=r.shape.length,g=Qe(r.shape),b=Ee(a),T=a.length,w=Qe(a),_=ir(r.dtype,b);for(let N=0;N<b;N++){let A=Ep(N,T,w);for(let V=0;V<T;V++)A[V]<l[V]?A[V]=l[V]*2-A[V]-h:A[V]>=u[V]&&(A[V]=(u[V]-1)*2-A[V]+h);A=A.map((V,D)=>V-l[D]);const P=xa(A,p,g);_[N]=f[P]}return{dataId:t.write(_,a,r.dtype),shape:a,dtype:r.dtype}}const mOe={kernelName:GT,backendName:"cpu",kernelFunc:pOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gOe=jn(((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e})),yOe=_s(sb,gOe),bOe={kernelName:sb,backendName:"cpu",kernelFunc:yOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PX(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:i}=s,o=r.shape.length;let a=i;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=xt([a],r.shape),u=OX({inputs:{x:r},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),h=os(u.shape,l),f=Cn({inputs:{x:u},backend:t,attrs:{shape:h}}),p=m$({inputs:{a:r,b:f},backend:t}),g=BK({inputs:{x:p},backend:t}),b=Bb({inputs:{x:g},backend:t,attrs:{axis:l,keepDims:!1}}),T=Cn({inputs:{x:b},backend:t,attrs:{shape:h}}),w=y$({inputs:{a:g,b:T},backend:t});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(T),w}const vOe={kernelName:ax,backendName:"cpu",kernelFunc:PX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wOe(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s;Ye(r,"multinomial");const l=a?r:PX({inputs:{logits:r},backend:t,attrs:{dim:-1}}),u=l.shape[0],h=l.shape[1],f=t.data.get(l.dataId).values,p=[u,i],g=or(Ee(p),"int32");for(let b=0;b<u;++b){const T=b*h,w=new Float32Array(h-1);w[0]=f[T];for(let N=1;N<w.length;++N)w[N]=w[N-1]+f[T+N];const _=xp.alea(o.toString()),C=b*i;for(let N=0;N<i;++N){const A=_();g[C+N]=w.length;for(let P=0;P<w.length;P++)if(A<w[P]){g[C+N]=P;break}}}return a||t.disposeIntermediateTensorInfo(l),t.makeTensorInfo(p,"int32",g)}const TOe={kernelName:f5,backendName:"cpu",kernelFunc:wOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xOe=d2;function SOe(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s;Ye(r,"NonMaxSuppression");const u=t.data.get(r.dataId).values,h=t.data.get(i.dataId).values,{selectedIndices:f}=xOe(u,h,o,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const _Oe={kernelName:Ek,backendName:"cpu",kernelFunc:SOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EOe=f2;function IOe(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s;Ye(r,"NonMaxSuppressionPadded");const h=t.data.get(r.dataId).values,f=t.data.get(i.dataId).values,{selectedIndices:p,validOutputs:g}=EOe(h,f,o,a,l,u);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const COe={kernelName:Ik,backendName:"cpu",kernelFunc:IOe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NOe=p2;function AOe(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s;Ye(r,"NonMaxSuppressionWithScore");const h=t.data.get(r.dataId).values,f=t.data.get(i.dataId).values,p=o,g=a,b=l,T=u,{selectedIndices:w,selectedScores:_}=NOe(h,f,p,g,b,T);return[t.makeTensorInfo([w.length],"int32",new Int32Array(w)),t.makeTensorInfo([_.length],"float32",new Float32Array(_))]}const kOe={kernelName:Ck,backendName:"cpu",kernelFunc:AOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Oe(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s;Ye(r,"oneHot");const u=Ee(r.shape),h=new Float32Array(u*o);h.fill(l);const f=t.data.get(r.dataId).values;for(let p=0;p<u;++p)f[p]>=0&&f[p]<o&&(h[p*o+f[p]]=a);return t.makeTensorInfo([...r.shape,o],i,h)}const ROe={kernelName:KT,backendName:"cpu",kernelFunc:$Oe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yw(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Jh({inputs:{input:s},backend:t}),i=yw({inputs:{x:r},backend:t}),o=rp({inputs:{input:s},backend:t}),a=yw({inputs:{x:o},backend:t}),l=ri({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return b$({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const DOe={kernelName:cx,backendName:"cpu",kernelFunc:yw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FX(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Jh({inputs:{input:s},backend:t}),i=FX({inputs:{x:r},backend:t}),o=rp({inputs:{input:s},backend:t}),a=yw({inputs:{x:o},backend:t}),l=ri({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return b$({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const MOe={kernelName:WT,backendName:"cpu",kernelFunc:FX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LX(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return gw({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(h=>{XA(i,h.shape,"All tensors passed to stack must have matching shapes"),q(o===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(h=>{const f=gw({inputs:{input:h},backend:t,attrs:{dim:r}});return a.push(f),f}),u=ip({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(h=>t.disposeIntermediateTensorInfo(h)),u}const OOe={kernelName:XT,backendName:"cpu",kernelFunc:LX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function POe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,constantValue:o}=s;Ye(r,"pad");const a=i.map((C,N)=>C[0]+r.shape[N]+C[1]),l=i.map(C=>C[0]),u=t.data.get(r.dataId).values,h=Ee(r.shape),f=r.shape.length,p=Qe(r.shape),g=Ee(a),b=a.length,T=Qe(a),w=ir(r.dtype,g);o!==0&&w.fill(o);for(let C=0;C<h;C++){const A=Ep(C,f,p).map((V,D)=>V+l[D]),P=xa(A,b,T);w[P]=u[C]}return{dataId:t.write(w,a,r.dtype),shape:a,dtype:r.dtype}}const VX={kernelName:YT,backendName:"cpu",kernelFunc:POe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FOe=jn((n,e)=>Math.pow(n,e)),LOe=_s(ib,FOe),VOe={kernelName:ib,backendName:"cpu",kernelFunc:LOe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BOe(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(_=>t.data.get(_.dataId).values),u=r.map(_=>_.shape),h=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,[p,g,b]=rX(l,u,h,i.shape,i.dtype,f,o.shape),T=p.map(_=>t.makeTensorInfo([_.length],"int32",_)),w=t.makeTensorInfo(b,i.dtype,g);return T.concat([w])}const UOe={kernelName:p5,backendName:"cpu",kernelFunc:BOe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zOe(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:i}=e,o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,h]=iX(o,s.shape,s.dtype,a,r.shape,l,i.shape),f=t.makeTensorInfo([u.length],"int32",u),p=t.makeTensorInfo([h.length],s.dtype,h);return[f,p]}const GOe={kernelName:m5,backendName:"cpu",kernelFunc:zOe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HOe(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=t.data.get(r.dataId).values,h=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,p=a.map(w=>t.data.get(w.dataId).values),g=a.map(w=>w.shape),[b,T]=oX(u,r.shape,h,i.shape,i.dtype,f,o.shape,p,g,l);return t.makeTensorInfo(b,i.dtype,T)}const qOe={kernelName:g5,backendName:"cpu",kernelFunc:HOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WOe(n){const{backend:e,attrs:t}=n,{start:s,stop:r,dtype:i,step:o}=t,a=aX(s,r,o,i);return e.makeTensorInfo([a.length],i,a)}const KOe={kernelName:Nk,backendName:"cpu",kernelFunc:WOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XOe=an(ob,n=>1/n),YOe={kernelName:ob,backendName:"cpu",kernelFunc:XOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JOe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;Ye(r,"resizeBilinear");const l=Qe(r.shape),[u,h]=a,[f,p,g,b]=r.shape,T=t.data.get(r.dataId).values,w=new Float32Array(Ee([f,u,h,b])),_=[i&&u>1?p-1:p,i&&h>1?g-1:g],C=[i&&u>1?u-1:u,i&&h>1?h-1:h];let N=0;const A=_[0]/C[0],P=_[1]/C[1];for(let V=0;V<f;V++)for(let D=0;D<u;D++){let M;o?M=A*(D+.5)-.5:M=A*D;const $=Math.max(0,Math.floor(M)),O=M-$,k=Math.min(p-1,Math.ceil(M)),z=V*l[0]+$*l[1],U=V*l[0]+k*l[1];for(let te=0;te<h;te++){let se;o?se=P*(te+.5)-.5:se=P*te;const X=Math.max(0,Math.floor(se)),Q=se-X,re=Math.min(g-1,Math.ceil(se)),fe=z+X*l[2],be=U+X*l[2],W=z+re*l[2],ne=U+re*l[2];for(let ue=0;ue<b;ue++){const Te=T[fe+ue],Ie=T[be+ue],Re=T[W+ue],Fe=T[ne+ue],We=Te+(Re-Te)*Q,Be=Ie+(Fe-Ie)*Q,it=We+(Be-We)*O;w[N++]=it}}}return t.makeTensorInfo([f,u,h,b],"float32",w)}const jOe={kernelName:ex,backendName:"cpu",kernelFunc:JOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QOe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s;Ye([i,r],"resizeBilinearGrad");const a=Qe(r.shape),[l,u,h,f]=r.shape,[,p,g]=i.shape,b=new Float32Array(l*u*h*f),T=[o&&p>1?u-1:u,o&&g>1?h-1:h],w=[o&&p>1?p-1:p,o&&g>1?g-1:g],_=T[0]/w[0],C=T[1]/w[1],N=t.data.get(i.dataId).values;let A=0;for(let P=0;P<l;P++){const V=P*a[0];for(let D=0;D<p;D++){const M=D*_,$=Math.floor(M),O=Math.min(Math.ceil(M),u-1),k=V+$*a[1],z=V+O*a[1],U=M-$,te=1-U;for(let se=0;se<g;se++){const X=se*C,Q=Math.floor(X),re=Math.min(Math.ceil(X),h-1),fe=X-Q,be=1-fe,W=k+Q*a[2],ne=k+re*a[2],ue=z+Q*a[2],Te=z+re*a[2],Ie=te*be,Re=te*fe,Fe=U*be,We=U*fe;for(let Be=0;Be<f;Be++){const it=N[A++];b[W+Be]+=it*Ie,b[ne+Be]+=it*Re,b[ue+Be]+=it*Fe,b[Te+Be]+=it*We}}}}return t.makeTensorInfo([l,h,u,f],"float32",b)}const ZOe={kernelName:$k,backendName:"cpu",kernelFunc:QOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ePe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;Ye(r,"resizeNearestNeighbor");const l=Qe(r.shape),[u,h]=a,[f,p,g,b]=r.shape,T=t.data.get(r.dataId).values,w=new Float32Array(f*u*h*b),_=[i&&u>1?p-1:p,i&&h>1?g-1:g],C=[i&&u>1?u-1:u,i&&h>1?h-1:h],N=_[0]/C[0],A=_[1]/C[1];let P=0;for(let V=0;V<f;V++){const D=V*l[0];for(let M=0;M<u;M++){const $=o?N*(M+.5):N*M;let O=Math.min(p-1,i?Math.round($):Math.floor($));o&&(O=Math.max(0,O));const k=D+O*l[1];for(let z=0;z<h;z++){const U=o?A*(z+.5):A*z;let te=Math.min(g-1,i?Math.round(U):Math.floor(U));o&&(te=Math.max(0,te));const se=k+te*l[2];for(let X=0;X<b;X++){const Q=T[se+X];w[P++]=Q}}}}return t.makeTensorInfo([f,u,h,b],r.dtype,w)}const tPe={kernelName:ZT,backendName:"cpu",kernelFunc:ePe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nPe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s;Ye([i,r],"resizeNearestNeighborGrad");const a=Qe(r.shape),l=Qe(i.shape),[u,h,f,p]=r.shape,[,g,b]=i.shape,T=new Float32Array(u*h*f*p),w=t.data.get(i.dataId).values,_=[o&&g>1?h-1:h,o&&b>1?f-1:f],C=[o&&g>1?g-1:g,o&&b>1?b-1:b],N=_[0]/C[0],A=_[1]/C[1],P=1/N,V=1/A,D=Math.ceil(P)*2+2,M=Math.ceil(V)*2+2;for(let $=0;$<u;$++){const O=$*a[0];for(let k=0;k<h;k++){const z=O+k*a[1],U=Math.floor(k*P),te=Math.floor(U-D/2);for(let se=0;se<f;se++){const X=z+se*a[2],Q=Math.floor(se*V),re=Math.floor(Q-M/2);for(let fe=0;fe<p;fe++){let be=0;for(let W=0;W<D;W++){const ne=W+te;if(ne<0||ne>=g)continue;const ue=O+ne*l[1],Te=ne*N,Ie=Math.min(h-1,o?Math.round(Te):Math.floor(Te));if(k===Ie)for(let Re=0;Re<M;Re++){const Fe=Re+re;if(Fe<0||Fe>=b)continue;const We=ue+Fe*l[2],Be=Fe*A,it=Math.min(f-1,o?Math.round(Be):Math.floor(Be));se===it&&(be+=w[We+fe])}}T[X+fe]=be}}}}return t.makeTensorInfo(r.shape,r.dtype,T)}const sPe={kernelName:kk,backendName:"cpu",kernelFunc:nPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rPe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:i}=s;Ye(r,"reverse");const o=r.shape.length,a=xt(i,r.shape);if(o===0)return Fa({inputs:{x:r},backend:t});const l=new Bs(r.shape,r.dtype),u=t.bufferSync(r);for(let h=0;h<l.size;h++){const f=l.indexToLoc(h),p=f.slice();a.forEach(g=>p[g]=r.shape[g]-1-p[g]),l.set(u.get(...p),...f)}return t.makeTensorInfo(l.shape,l.dtype,l.values)}const iPe={kernelName:tx,backendName:"cpu",kernelFunc:rPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oPe={kernelName:Lk,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=e,a=t,l=ir(s.dtype,Ee(s.shape)),[u,h,f,p]=s.shape,[g,b]=E2(o,h,f),T=255,w=Math.sin(r),_=Math.cos(r),C=a.data.get(s.dataId).values;for(let A=0;A<u;A++){const P=A*f*h*p;for(let V=0;V<h;V++){const D=V*(f*p);for(let M=0;M<f;M++){const $=M*p;for(let O=0;O<p;O++){const k=[u,V,M,O],z=k[2],U=k[1];let te=(z-g)*_-(U-b)*w,se=(z-g)*w+(U-b)*_;te=Math.round(te+g),se=Math.round(se+b);let X=i;if(typeof i!="number"&&(O===3?X=T:X=i[O]),te>=0&&te<f&&se>=0&&se<h){const re=se*(f*p),fe=te*p,be=P+re+fe+O;X=C[be]}const Q=P+D+$+O;l[Q]=X}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aPe=an(ub,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),lPe={kernelName:ub,backendName:"cpu",kernelFunc:aPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uPe(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:h,outputSize:f}=od(i,r,o),p=!0,g=t.bufferSync(r),b=t.bufferSync(i),T=Th(g,b,o,f,u,l,a,h,0,p);return t.makeTensorInfo(o,T.dtype,T.values)}const cPe={kernelName:y5,backendName:"cpu",kernelFunc:uPe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hPe(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<e?t=r+1:s=r;return s}function dPe(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<=e?t=r+1:s=r;return s}function fPe(n,e,t,s,r,i){const o=Wn("int32",t*r);for(let a=0;a<t;++a){const l=n.slice(a*s,(a+1)*s),u=a*r;for(let h=0;h<r;++h)o[u+h]=i==="left"?hPe(l,e[h+u]):dPe(l,e[h+u])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pPe(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:i}=e,{side:o}=s,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,u=fPe(a,l,r.shape[0],r.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",u)}const mPe={kernelName:v5,backendName:"cpu",kernelFunc:pPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gPe(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:i}=e;Ye([s,r,i],"select");const o=s.shape.length,a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,h=ai(r.dtype,i.dtype),f=or(Ee(r.shape),h);let p=0;const g=o===0||o>1||r.shape.length===1?1:Ee(r.shape.slice(1));for(let b=0;b<a.length;b++)for(let T=0;T<g;T++)a[b]===1?f[p++]=l[b]:f[p++]=u[b];return t.makeTensorInfo(r.shape,h,f)}const yPe={kernelName:nx,backendName:"cpu",kernelFunc:gPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bPe=Tx,vPe=xx,wPe=an(hb,n=>n>=0?vPe*n:bPe*(Math.exp(n)-1)),TPe={kernelName:hb,backendName:"cpu",kernelFunc:wPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xPe=an(pb,n=>n<0?-1:n>0?1:0),SPe={kernelName:pb,backendName:"cpu",kernelFunc:xPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Pe=an(db,n=>Math.sin(n)),EPe={kernelName:db,backendName:"cpu",kernelFunc:_Pe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IPe=an(fb,n=>Math.sinh(n)),CPe={kernelName:fb,backendName:"cpu",kernelFunc:IPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NPe=11920928955078125e-23,HL=Math.log(NPe)+2,APe=an(gb,n=>{const e=n>-HL,t=n<HL,s=Math.exp(n);let r;return t?r=s:e?r=n:r=Math.log(1+s),r}),kPe={kernelName:gb,backendName:"cpu",kernelFunc:APe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Pe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,paddings:o}=s;Ye([r],"spaceToBatchND");const a=Ee(i),l=[[0,0]];l.push(...o);for(let V=1+i.length;V<r.shape.length;++V)l.push([0,0]);const u=VX.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),h=Ab(u.shape,i,a,!1),f=kb(h.length,i.length,!1),p=$b(u.shape,i,a,!1),T=Cn({inputs:{x:u},backend:t,attrs:{shape:h}}),C=Lr({inputs:{x:T},backend:t,attrs:{perm:f}}),P=Cn({inputs:{x:C},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(T),t.disposeIntermediateTensorInfo(C),P}const RPe={kernelName:ix,backendName:"cpu",kernelFunc:$Pe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DPe(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,h=t.data.get(o.dataId).values[0],[f,p,g,b,T]=hX(a,s.shape,s.dtype,l,r.dtype,u,h);return[t.makeTensorInfo(p,s.dtype,f),t.makeTensorInfo([p[0]],r.dtype,g),t.makeTensorInfo([b.length],"bool",new Uint8Array(b.map(w=>Number(w)))),t.makeTensorInfo([T.length],s.dtype,new Int32Array(T))]}const MPe={kernelName:w5,backendName:"cpu",kernelFunc:DPe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OPe(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.data.get(r.dataId).values),a=t.data.get(s.dataId).values,l=Array.from(t.data.get(i.dataId).values),[u,h,f]=dX(a,s.shape,s.dtype,o,l);return[t.makeTensorInfo(h,s.dtype,u),t.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}const PPe={kernelName:T5,backendName:"cpu",kernelFunc:OPe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FPe(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,h]=p$(o,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(h,s.dtype,u)}const LPe={kernelName:x5,backendName:"cpu",kernelFunc:FPe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VPe(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,h]=p$(o,s.shape,s.dtype,a,l);return t.makeTensorInfo(h,s.dtype,u)}const BPe={kernelName:S5,backendName:"cpu",kernelFunc:VPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UPe(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:h,strides:f,outputSize:p}=od(i,r,a),g=!1,b=t.bufferSync(r);let T;switch(i.dtype){case"bool":{const w=t.bufferSync(i),_=!!t.data.get(o.dataId).values[0];T=Th(b,w,a,p,h,u,l,f,_,g);break}case"float32":{const w=t.bufferSync(i),_=t.data.get(o.dataId).values[0];T=Th(b,w,a,p,h,u,l,f,_,g);break}case"int32":{const w=t.bufferSync(i),_=t.data.get(o.dataId).values[0];T=Th(b,w,a,p,h,u,l,f,_,g);break}case"string":{const w=t.bufferSync(i),_=uc(t.data.get(o.dataId).values[0]);T=Th(b,w,a,p,h,u,l,f,_,g);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return t.makeTensorInfo(a,T.dtype,T.values)}const zPe={kernelName:_5,backendName:"cpu",kernelFunc:UPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GPe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=xt(o,r.shape)[0],l=B2(r,i,a),u=new Array(r.shape.length).fill(0),h=r.shape.slice();return l.map(f=>{const p=[...h];p[a]=f;const g=jh({inputs:{x:r},backend:t,attrs:{begin:u,size:p}});return u[a]+=f,g})}const HPe={kernelName:ox,backendName:"cpu",kernelFunc:GPe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qPe={kernelName:Rk,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;Ye(t,"square");const r=s.data.get(t.dataId).values,i=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];i[a]=l*l}return{dataId:s.write(i,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WPe=an(Sb,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),KPe={kernelName:Sb,backendName:"cpu",kernelFunc:WPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XPe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:h,newAxisMask:f,shrinkAxisMask:p}=s;Ye(r,"stridedSlice");const{finalShapeSparse:g,finalShape:b,isIdentity:T,sliceDim0:w,isSimpleSlice:_,begin:C,end:N,strides:A}=x2(r.shape,i,o,a,l,u,h,f,p);let P;if(T)P=Cn({inputs:{x:r},backend:t,attrs:{shape:b}});else if(w||_){q(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const V=v2(C,N,A),D=jh({inputs:{x:r},backend:t,attrs:{begin:C,size:V}});P=Cn({inputs:{x:D},backend:t,attrs:{shape:b}}),t.disposeIntermediateTensorInfo(D)}else{const V=t.bufferSync(r),D=mX(g,V,A,C);P=t.makeTensorInfo(b,D.dtype,D.values)}return P}const YPe={kernelName:Mk,backendName:"cpu",kernelFunc:XPe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JPe(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:h,dataSplits:f}=e,p=t.data.get(h.dataId).values,g=t.data.get(f.dataId).values,[b,T]=gX(p,g,r,i,o,a,l,u);return[t.makeTensorInfo([b.length],"string",b),t.makeTensorInfo(f.shape,"int32",T)]}const jPe={kernelName:E5,backendName:"cpu",kernelFunc:JPe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QPe(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values[0],[u,h,f]=yX(a,l,r),p=h.length;return[t.makeTensorInfo([p,2],"int32",u),t.makeTensorInfo([p],"string",h),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const ZPe={kernelName:I5,backendName:"cpu",kernelFunc:QPe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eFe(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=t.data.get(i.dataId).values,a=bX(o,r);return t.makeTensorInfo(i.shape,"int32",a)}const tFe={kernelName:C5,backendName:"cpu",kernelFunc:eFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nFe=an(wb,n=>Math.tan(n)),sFe={kernelName:wb,backendName:"cpu",kernelFunc:nFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rFe=an(Tb,n=>Math.tanh(n)),iFe={kernelName:Tb,backendName:"cpu",kernelFunc:rFe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oFe(n){const{inputs:e,backend:t}=n,{tensor:s,indices:r,updates:i}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:u,outputSize:h}=od(i,r,s.shape),f=!1,p=t.bufferSync(r),g=t.bufferSync(i),b=t.bufferSync(s),T=Th(p,g,s.shape,h,l,a,o,u,b,f);return t.makeTensorInfo(s.shape,T.dtype,T.values)}const aFe={kernelName:b5,backendName:"cpu",kernelFunc:oFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lFe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:i}=s;Ye(r,"tile");const o=wX(t.bufferSync(r),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}const uFe={kernelName:xb,backendName:"cpu",kernelFunc:lFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cFe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:i,sorted:o}=s;Ye(r,"topk");const a=t.data.get(r.dataId).values,[l,u]=xX(a,r.shape,r.dtype,i,o);return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(u.shape,u.dtype,u.values)]}const hFe={kernelName:Ok,backendName:"cpu",kernelFunc:cFe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dFe(n){const{inputs:e,attrs:t,backend:s}=n,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=t,[h,f,p,g]=r.shape,[b,T]=u??[f,p],w=[h,b,T,g],_=Qe(r.shape),C=_[0],N=_[1],A=_[2],P=Qe(w),V=P[0],D=P[1],M=P[2],$=ir(r.dtype,Ee(w));$.fill(l);const O=s.data.get(r.dataId).values,k=s.data.get(i.dataId).values;for(let U=0;U<h;++U){const te=i.shape[0]===1?k:k.subarray(U*8,U*8+8);for(let se=0;se<b;++se)for(let X=0;X<T;++X)for(let Q=0;Q<g;++Q){let re;const fe=te[6]*X+te[7]*se+1;if(fe===0)continue;const be=(te[0]*X+te[1]*se+te[2])/fe,W=(te[3]*X+te[4]*se+te[5])/fe,ne=qL(be,p,a),ue=qL(W,f,a);switch(o){case"nearest":re=bFe(O,f,p,C,N,A,U,ue,ne,Q,l);break;case"bilinear":re=vFe(O,f,p,C,N,A,U,ue,ne,Q,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const Te=U*V+se*D+X*M+Q;$[Te]=re}return s.makeTensorInfo(w,r.dtype,$)}return{dataId:s.write($,w,r.dtype),shape:r.shape,dtype:r.dtype}}const fFe={kernelName:Pk,backendName:"cpu",kernelFunc:dFe};function qL(n,e,t){switch(t){case"reflect":return pFe(n,e);case"wrap":return mFe(n,e);case"nearest":return yFe(n,e);case"constant":default:return gFe(n)}}function pFe(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return Bh(0,t,e-1)}function mFe(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return Bh(0,t,e-1)}function gFe(n,e){return n}function yFe(n,e){return Bh(0,n,e-1)}function ig(n,e,t,s,r,i,o,a,l,u,h){const f=o*s+a*r+l*i+u;return 0<=a&&a<e&&0<=l&&l<t?n[f]:h}function bFe(n,e,t,s,r,i,o,a,l,u,h){const f=Math.round(a),p=Math.round(l);return ig(n,e,t,s,r,i,o,f,p,u,h)}function vFe(n,e,t,s,r,i,o,a,l,u,h){const f=Math.floor(a),p=Math.floor(l),g=f+1,b=p+1,T=(b-l)*ig(n,e,t,s,r,i,o,f,p,u,h)+(l-p)*ig(n,e,t,s,r,i,o,f,b,u,h),w=(b-l)*ig(n,e,t,s,r,i,o,g,p,u,h)+(l-p)*ig(n,e,t,s,r,i,o,g,b,u,h);return(g-a)*T+(a-f)*w}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wFe(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:i}=e;Ye(i,"unique");const o=s.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:u}=SX(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const TFe={kernelName:Fk,backendName:"cpu",kernelFunc:wFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xFe(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r.shape.length,a=r.shape[i],l=new Array(o-1);let u=0;for(let g=0;g<o;g++)g!==i&&(l[u++]=r.shape[g]);const h=new Array(o).fill(0),f=r.shape.slice();f[i]=1;const p=new Array(a);for(let g=0;g<p.length;g++){h[i]=g;const b=jh({inputs:{x:r},backend:t,attrs:{begin:h,size:f}});p[g]=Cn({inputs:{x:b},backend:t,attrs:{shape:l}}),t.disposeIntermediateTensorInfo(b)}return p}const SFe={kernelName:lx,backendName:"cpu",kernelFunc:xFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Fe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:i}=e,{numSegments:o}=s;Ye(r,"unsortedSegmentSum");const a=r.shape.length,l=i.shape.length,u=[],h=[],f=a-l;let p=i;for(let b=0;b<f;++b){const T=gw({inputs:{input:p},backend:t,attrs:{dim:b+1}});p=T,h.push(T)}for(let b=0;b<o;++b){const T=Sc(b,"int32"),w=t.makeTensorInfo([],"int32",T),_=LK({inputs:{a:w,b:p},backend:t}),C=pc({inputs:{x:_},backend:t,attrs:{dtype:"float32"}}),N=Mx({inputs:{a:C,b:r},backend:t}),A=Bb({inputs:{x:N},backend:t,attrs:{axis:0,keepDims:!1}});u.push(A),h.push(w),h.push(_),h.push(C),h.push(N),h.push(A)}const g=LX({inputs:u,backend:t,attrs:{axis:0}});return h.forEach(b=>t.disposeIntermediateTensorInfo(b)),g}const EFe={kernelName:ux,backendName:"cpu",kernelFunc:_Fe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IFe=[wRe,e$e,xRe,_Re,o$e,IRe,NRe,kRe,RRe,MRe,PRe,LRe,BRe,GRe,qRe,XRe,JRe,QRe,eDe,bRe,nDe,rDe,oDe,l$e,lDe,r$e,c$e,cDe,t$e,dDe,pDe,mDe,yDe,vDe,TDe,SDe,EDe,CDe,ADe,$De,DDe,ODe,FDe,VDe,BDe,zDe,HDe,WDe,KDe,XDe,YDe,jDe,eMe,hRe,nMe,h$e,cMe,d$e,hMe,p$e,yMe,bMe,wMe,g$e,b$e,xMe,_Me,IMe,NMe,w$e,x$e,n$e,kMe,fDe,RMe,MMe,PMe,dRe,_$e,I$e,LMe,N$e,BMe,GMe,qMe,XMe,JMe,QMe,ZMe,k$e,tOe,sOe,iOe,aOe,uOe,hOe,fOe,R$e,mOe,bOe,TOe,M$e,P$e,_Oe,COe,kOe,L$e,ROe,MOe,OOe,VX,VOe,pRe,U$e,UOe,GOe,qOe,KOe,s$e,vC,YOe,mRe,gRe,yRe,jOe,ZOe,tPe,sPe,iPe,oPe,lPe,Y$e,cPe,mPe,yPe,TPe,j$e,SPe,EPe,CPe,Q$e,vOe,kPe,RPe,MPe,PPe,LPe,BPe,zPe,HPe,tRe,qPe,sRe,iRe,KPe,YPe,jPe,ZPe,tFe,uRe,QDe,sFe,iFe,aFe,uFe,hFe,fFe,V$e,TFe,SFe,EFe,DOe];for(const n of IFe)A5(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yh={},$1={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function CFe(n,e){yh[n]=e}function Fo(n,e){if(!(n in yh)||e!=null){const s=AFe(n,e);if(s!==null)yh[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=yh[n];return t==null||t.isContextLost()?(delete yh[n],Fo(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),yh[n])}function NFe(n){if(!we().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function AFe(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??NFe(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete yh[n]},!1),we().getBool("SOFTWARE_WEBGL_ENABLED")&&($1.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",$1)||t.getContext("experimental-webgl",$1):t.getContext("webgl2",$1)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Qg;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(Qg||(Qg={}));var Si;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(Si||(Si={}));var Vs;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Vs||(Vs={}));function Ub(n,e){return[e,n]}function kFe(n,e){return n*e}function R1(n){const e=Ee(n),t=Math.ceil(e/4);return zI(t)}function Dp(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function $Fe(n,e){const[t,s]=Dp(n,e);return t*s*4}function v$(n,e){const t=n;let s,r,i,o,a,l,u,h,f,p;return we().getNumber("WEBGL_VERSION")===2?(s=t.R32F,r=t.R16F,i=t.RGBA16F,o=t.RGBA32F,a=t.RED,u=4,h=1,f=t.HALF_FLOAT,p=t.FLOAT,l=t.RGBA8):(s=n.RGBA,r=n.RGBA,i=n.RGBA,o=t.RGBA,a=n.RGBA,u=4,h=4,f=e!=null?e.HALF_FLOAT_OES:null,p=n.FLOAT,l=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:h,textureTypeHalfFloat:f,textureTypeFloat:p}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ze(n,e){const t=e();return we().getBool("DEBUG")&&RFe(n),t}function RFe(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+PFe(n,e))}const DFe=596e-10,MFe=65504;function OFe(n){return!!(we().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||DFe<Math.abs(n)&&Math.abs(n)<MFe)}function PFe(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function D1(n,e){return Bl(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function FFe(n,e){const t=Bl(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(ze(n,()=>n.shaderSource(t,e)),ze(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function LFe(n,e){const t=Bl(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(ze(n,()=>n.shaderSource(t,e)),ze(n,()=>n.compileShader(t)),we().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw BX(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const VFe=/ERROR: [0-9]+:([0-9]+):/g;function BX(n,e){const t=VFe.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],r=n.split(`
`),i=r.length.toString().length+2,o=r.map((f,p)=>kf((p+1).toString(),i)+f);let a=0;for(let f=0;f<o.length;f++)a=Math.max(o[f].length,a);const l=o.slice(0,s-1),u=o.slice(s-1,s),h=o.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${kf(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join(`
`))}function BFe(n){return Bl(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function UFe(n,e){if(ze(n,()=>n.linkProgram(e)),!we().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function TE(n,e){if(ze(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function zFe(n,e){const t=Bl(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return ze(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),ze(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function GFe(n,e){const t=Bl(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return ze(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),ze(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function HFe(n){return Bl(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function qFe(n,e){const t=we().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function WFe(n){return Bl(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function WL(n,e,t,s,r,i,o){const a=n.getAttribLocation(e,t);return a===-1?!1:(ze(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),ze(n,()=>n.vertexAttribPointer(a,r,n.FLOAT,!1,i,o)),ze(n,()=>n.enableVertexAttribArray(a)),!0)}function KFe(n,e,t){QFe(n,t),ze(n,()=>n.activeTexture(n.TEXTURE0+t)),ze(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function XFe(n,e,t){return Bl(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function YFe(n,e,t){return n.getUniformLocation(e,t)}function JFe(n,e,t,s){ze(n,()=>KFe(n,e,s)),ze(n,()=>n.uniform1i(t,s))}function xE(n,e,t){ze(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),ze(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function KL(n,e){ze(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),ze(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function M1(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+jFe(n,e))}function jFe(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Bl(n,e,t){const s=ze(n,()=>e());if(s==null)throw new Error(t);return s}function QFe(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function op(n,e=2){return Ee(n.slice(0,n.length-e))}function ap(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function O1(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[op(n),...ap(n)]),e}function ZFe(n,e=!1){let t=we().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=we().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&we().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((a,l)=>l>=n.length-2?KA(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=xc(n).newShape);let r=Ee(n),i=null;n.length<=1&&r<=t?i=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?i=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?i=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?i=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?i=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(i=[n[0],n[1]*n[2]*n[3]]);const o=i!=null&&Math.max(...i)>s&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const a=op(n);let l=2,u=2;n.length&&([l,u]=ap(n)),r=a*(l/2)*(u/2),i=zI(r).map(h=>h*2)}else i=zI(r);return i}function P1(n){return n%2===0}function bw(n,e){if(n=n.slice(-2),e=e.slice(-2),jt(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],s=e[e.length-1];if(t===s||P1(t)&&P1(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&P1(n[0])&&P1(e[0])}let SE,_E;function e3e(n){if(SE==null){const e=Fo(n);SE=e.getParameter(e.MAX_TEXTURE_SIZE)}return SE}function t3e(n){if(_E==null){const e=Fo(n);_E=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,_E)}function n3e(n){if(n===0)return 0;let e;const t=Fo(n);return Yi(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:Yi(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Yi(n,e){return n.getExtension(e)!=null}function XL(n){try{if(Fo(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function s3e(n){if(n===0)return!1;const e=Fo(n);if(n===1){if(!Yi(e,"OES_texture_float"))return!1}else if(!Yi(e,"EXT_color_buffer_float"))return!1;return TC(e)}function r3e(n){if(n===0)return!1;const e=Fo(n);if(n===1){if(!Yi(e,"OES_texture_float")||!Yi(e,"WEBGL_color_buffer_float"))return!1}else{if(Yi(e,"EXT_color_buffer_float"))return TC(e);const s="EXT_color_buffer_half_float";if(Yi(e,s)){const r=e.getExtension(s);return i3e(e,r)}return!1}return TC(e)}function TC(n){const e=v$(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(i),o}function i3e(n,e){const t=v$(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(o),a}function o3e(n){return n!==2?!1:Fo(n).fenceSync!=null}function zb(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&q(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Je=we();Je.registerFlag("HAS_WEBGL",()=>Je.getNumber("WEBGL_VERSION")>0);Je.registerFlag("WEBGL_VERSION",()=>XL(2)?2:XL(1)?1:0);Je.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Je.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Je.get("WEBGL_VERSION")===2);Je.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Je.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Je.registerFlag("WEBGL_PACK",()=>Je.getBool("HAS_WEBGL"));Je.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_PACK_CLIP",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_PACK_REDUCE",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_LAZILY_UNPACK",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_CONV_IM2COL",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Je.getBool("WEBGL_PACK"));Je.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>e3e(Je.getNumber("WEBGL_VERSION")));Je.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>t3e(Je.getNumber("WEBGL_VERSION")));Je.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Je.getNumber("WEBGL_VERSION");return n===0?0:n3e(n)});Je.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Je.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!B5());Je.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>s3e(Je.getNumber("WEBGL_VERSION")));Je.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Je.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Je.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Je.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>r3e(Je.getNumber("WEBGL_VERSION")));Je.registerFlag("WEBGL_FENCE_API_ENABLED",()=>o3e(Je.getNumber("WEBGL_VERSION")));Je.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Je.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Je.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Je.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>B5()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Je.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Je.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Je.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Je.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Je.registerFlag("WEBGL_EXP_CONV",()=>!1);Je.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Je.getBool("IS_TEST"));Je.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Je.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Je.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Je.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cr(){let n,e,t,s,r,i,o,a,l,u;return we().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",r="texture",i="outputColor",o="out vec4 outputColor;",a=we().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",r="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:r,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ud(n,e,t="index"){const s=Qe(e);return s.map((r,i)=>{const o=`int ${n[i]} = ${t} / ${r}`,a=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${r}`:`index -= ${n[i]} * ${r}`;return`${o}; ${a};`}).join("")}function Ox(n,e,t="index"){const s=Qe(e);return s.map((r,i)=>{const o=`int ${n[i]} = ${t} / outShapeStrides[${i}]`,a=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * outShapeStrides[${i}]`:`index -= ${n[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function a3e(n,e){const t=n.length,s=n.map(i=>`${e}[${i}]`),r=new Array(t-1);r[t-2]=s[t-1];for(let i=t-3;i>=0;--i)r[i]=`(${r[i+1]} * ${s[i+1]})`;return r}function l3e(n,e,t="index"){const s=n.map((i,o)=>o),r=a3e(s,e);return r.map((i,o)=>{const a=`int ${n[o]} = ${t} / ${r[o]}`,l=o===r.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${r[o]}`:`index -= ${n[o]} * ${r[o]}`;return`${a}; ${l};`}).join("")}function w$(n){const e=Qe(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function T$(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const UX=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:zX}=QCe;function u3e(n,e,t){const s=[];if(n.forEach(g=>{const b=Ee(g.shapeInfo.logicalShape);if(g.shapeInfo.isUniform?s.push(`uniform float ${g.name}${b>1?`[${b}]`:""};`):(s.push(`uniform sampler2D ${g.name};`),s.push(`uniform int offset${g.name};`)),t.enableShapeUniforms){const{uniformShape:T}=x$(t.packedInputs,g.shapeInfo.logicalShape,g.shapeInfo.texShape);switch(T.length){case 1:s.push(`uniform int ${g.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${g.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${g.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${g.name}Shape;`);break}s.push(`uniform ivec2 ${g.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(g=>{s.push(`uniform ${g.type} ${g.name}${g.arrayIndex?`[${g.arrayIndex}]`:""};`)});const r=s.join(`
`),i=n.map(g=>c3e(g,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),o=e.texShape,a=Cr(),l=f3e(a);let u,h,f=g3e(a);return e.isPacked?(u=h3e(e.logicalShape,o,t.enableShapeUniforms),h=m3e(a)):(u=d3e(e.logicalShape,o,t.enableShapeUniforms),h=p3e(a)),t.packedInputs&&(f+=w3e),[f,l,h,r,u,i,t.userCode].join(`
`)}function Mp(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return R3e(n,e);case 1:return M3e(n,e);case 2:return P3e(n,e);case 3:return L3e(n,e);case 4:return B3e(n,e);case 5:return U3e(n);case 6:return z3e(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function GX(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return $3e(n);case 1:return D3e(n,e);case 2:return O3e(n,e);case 3:return F3e(n,e);default:return V3e(n,e)}}function c3e(n,e,t=!1,s){let r="";t?r+=GX(n,s):r+=Mp(n,s);const i=n.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?r+=G3e(n,e):r+=H3e(n,e)),r}function h3e(n,e,t){switch(n.length){case 0:return HX();case 1:return T3e(n,e,t);case 2:return A3e(n,e,t);case 3:return S3e(n,e,t);default:return E3e(n,e,t)}}function d3e(n,e,t){switch(n.length){case 0:return HX();case 1:return x3e(n,e,t);case 2:return k3e(n,e,t);case 3:return _3e(n,e,t);case 4:return I3e(n,e,t);case 5:return C3e(n,e);case 6:return N3e(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function f3e(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function p3e(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function m3e(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function g3e(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${y3e}
    ${b3e}
    ${v3e}
  `}const y3e=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,b3e=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,v3e=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,w3e=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function HX(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function T3e(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function x3e(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function S3e(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),i=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function _3e(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Ox(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=ud(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function E3e(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),i=r*Math.ceil(n[n.length-2]/2);let o=i,a="",l="b, r, c";for(let u=2;u<n.length-1;u++)o*=n[n.length-u-1],a=`
      int b${u} = index / ${o};
      index -= b${u} * ${o};
    `+a,l=`b${u}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${l});
    }
  `}function I3e(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Ox(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=ud(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function C3e(n,e){const t=ud(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function N3e(n,e){const t=ud(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function A3e(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(jt(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function k3e(n,e,t){return jt(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function cd(n){return`offset${n}`}function $3e(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=Cr();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function R3e(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[r,i]=n.shapeInfo.texShape;if(r===1&&i===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const o=cd(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${o});
      return sampleTexture(${t}, uv);
    }
  `;const[a,l]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${t}, uv);
    }
  `}function D3e(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,i=Cr();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${t}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${t}, uv);
    }
  `}function M3e(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Op(n)}
      }
    `;const r=n.shapeInfo.texShape,i=r[0],o=r[1];if(o===1&&i===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=cd(t);return o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${t}, uv);
      }
    `:i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function O3e(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=i[0],a=i[1],l=Cr();if(i!=null&&jt(t,i))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],h=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${h}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function P3e(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape;if(i!=null&&jt(t,i)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const p=i[0],g=i[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${g}.0, ${p}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:a}=xc(t),l=o;if(l.length<t.length){const p=Pp(n,l),g=["row","col"];return`
      ${Mp(p,e)}
      float ${r}(int row, int col) {
        return ${r}(${Fp(g,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${Op(n)}
      }
    `;const u=i[0],h=i[1],f=cd(s);return h===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${s}, uv);
    }
  `:u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${h}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${f};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${f};
    vec2 uv = uvFromFlat(${u}, ${h}, index);
    return sampleTexture(${s}, uv);
  }
`}function F3e(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){const p=t.slice(1),g=[1,2],b=Pp(n,p),T=["b","row","col"];return`
        ${GX(b,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Fp(T,g)});
        }
      `}const a=Cr();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=o[0],u=o[1],h=Math.ceil(t[2]/2),f=h*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${f}, ${h}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function L3e(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t[1]*t[2],o=t[2],{newShape:a,keptDims:l}=xc(t),u=a;if(u.length<t.length){const T=Pp(n,u),w=["row","col","depth"];return`
        ${Mp(T,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Fp(w,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${Op(n)}
      }
    `;const h=n.shapeInfo.texShape,f=h[0],p=h[1],g=n.shapeInfo.flatOffset;if(p===i&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${p}.0, ${f}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(p===o&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `;const b=cd(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${b};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${b};
        vec2 uv = uvFromFlat(${f}, ${p}, index);
        return sampleTexture(${s}, uv);
      }
  `}function V3e(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Cr();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const i=n.shapeInfo.logicalShape,o=i.length,a=n.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],h=l[1],f=Math.ceil(i[o-1]/2);let p=f*Math.ceil(i[o-2]/2),g="int b, int row, int col",b=`b * ${p} + (row / 2) * ${f} + (col / 2)`;for(let T=2;T<o-1;T++)g=`int b${T}, `+g,p*=i[o-T-1],b=`b${T} * ${p} + `+b;return`
    vec4 ${s}(${g}) {
      int index = ${b};
      int texR = index / ${h};
      int texC = index - texR * ${h};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}, ${u});
      return ${r.texture2D}(${t}, uv);
    }
  `}function B3e(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t[3],o=t[2]*i,a=t[1]*o,{newShape:l,keptDims:u}=xc(t);if(l.length<t.length){const C=Pp(n,l),N=["row","col","depth","depth2"];return`
      ${Mp(C,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Fp(N,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${Op(n)}
      }
    `;const h=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,p=f[0],g=f[1],b=`int stride2 = ${s}Shape[3];`,T=`int stride1 = ${s}Shape[2] * stride2;`,w=`int stride0 = ${s}Shape[1] * stride1;`;if(g===a&&h==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${b}
        ${T}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(g===i&&h==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;const _=cd(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${b}
      ${T}
      ${w}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${_});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${p}, ${g}, index + ${_});
      return sampleTexture(${s}, uv);
    }
  `}function U3e(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],i=e[3]*r,o=e[2]*i,a=e[1]*o,{newShape:l,keptDims:u}=xc(e);if(l.length<e.length){const T=Pp(n,l),w=["row","col","depth","depth2","depth3"];return`
      ${Mp(T)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Fp(w,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${r})) +
          depth3;
        ${Op(n)}
      }
    `;const h=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,p=f[0],g=f[1];if(g===a&&h==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(g===r&&h==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;const b=cd(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${r} + depth3 + ${b};
      vec2 uv = uvFromFlat(${p}, ${g}, index);
      return sampleTexture(${t}, uv);
    }
  `}function z3e(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:i}=xc(e);if(r.length<e.length){const w=Pp(n,r),_=["row","col","depth","depth2","depth3","depth4"];return`
      ${Mp(w)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Fp(_,i)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,u=e[2]*l,h=e[1]*u;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${h}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${Op(n)}
      }
    `;const f=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,g=p[0],b=p[1];if(b===h&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${b}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(b===o&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${b}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;const T=cd(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${h} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${T};
      vec2 uv = uvFromFlat(${g}, ${b}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Op(n){const e=n.name,t=Ee(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function G3e(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",i=n.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=zX(n.shapeInfo.logicalShape,e.logicalShape),l=fn(o),u=o-i;let h;const f=["x","y","z","w","u","v"];i===0?h="":o<2&&a.length>=1?h="coords = 0;":h=a.map(C=>`coords.${f[C+u]} = 0;`).join(`
`);let p="";o<2&&i>0?p="coords":p=n.shapeInfo.logicalShape.map((C,N)=>`coords.${f[N+u]}`).join(", ");let g="return outputValue;";const T=Ee(n.shapeInfo.logicalShape)===1,_=Ee(e.logicalShape)===1;if(i===1&&!T&&!_)g=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(T&&!_)o===1?g=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:g=`
        return vec4(outputValue.x);
      `;else if(a.length){const C=i-2,N=i-1;a.indexOf(C)>-1&&a.indexOf(N)>-1?g="return vec4(outputValue.x);":a.indexOf(C)>-1?g="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(N)>-1&&(g="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${h}
      vec4 outputValue = get${s}(${p});
      ${g}
    }
  `}function H3e(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",i=e.texShape,o=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===l&&n.shapeInfo.flatOffset==null&&jt(o,i))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const u=fn(l),h=zX(n.shapeInfo.logicalShape,e.logicalShape),f=l-a;let p;const g=["x","y","z","w","u","v"];a===0?p="":l<2&&h.length>=1?p="coords = 0;":p=h.map(T=>`coords.${g[T+f]} = 0;`).join(`
`);let b="";return l<2&&a>0?b="coords":b=n.shapeInfo.logicalShape.map((T,w)=>`coords.${g[w+f]}`).join(", "),`
    float ${r}() {
      ${u} coords = getOutputCoords();
      ${p}
      return get${s}(${b});
    }
  `}function fn(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function x$(n,e,t){const{newShape:s,keptDims:r}=xc(e),i=e.length,o=n&&i===3&&e[0]===1,a=o?e.slice(1):s,l=!n&&i>1&&!jt(e,t)&&s.length<i||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function Pp(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Fp(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q3e(n,e,t,s){const r=t.map((h,f)=>{const p={logicalShape:h.shape,texShape:h.isUniform?null:h.texData.texShape,isUniform:h.isUniform,isPacked:h.isUniform?!1:h.texData.isPacked,flatOffset:null};return h.texData!=null&&h.texData.slice!=null&&h.texData.slice.flatOffset>0&&(p.flatOffset=h.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:p}}),i=r.map(h=>h.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=u3e(r,o,e),l=LFe(n.gl,a),u=n.createProgram(l);return we().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(u),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o},qX(n,e,u)))}function qX(n,e,t){const s=[],r=[];let i,o,a,l=null,u=null;u=n.getUniformLocation(t,"NAN",!1),we().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));const h=!1;for(const f of e.variableNames){const p={name:f,uniform:n.getUniformLocation(t,f,h),offset:n.getUniformLocation(t,`offset${f}`,h)};e.enableShapeUniforms&&(p.shape=n.getUniformLocation(t,`${f}Shape`,h),p.texShape=n.getUniformLocation(t,`${f}TexShape`,h)),s.push(p)}if(e.enableShapeUniforms&&(i=n.getUniformLocation(t,"outShape",h),a=n.getUniformLocation(t,"outShapeStrides",h),o=n.getUniformLocation(t,"outTexShape",h)),e.customUniforms)for(const f of e.customUniforms)r.push(n.getUniformLocation(t,f.name,h));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:u,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function YL(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const r=t.logicalShape,i=e[s],o=i.shape;if(!jt(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(t.isUniform&&i.isUniform)return;const a=t.texShape,l=i.isUniform?null:i.texData.texShape;if(!jt(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function W3e(n,e,t,s,r){e.program.enableShapeUniforms||(YL(e.inShapeInfos,t),YL([e.outShapeInfo],[s]));const i=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):n.setOutputMatrixTexture(i.texture,o[0],o[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),we().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<t.length;++l){const u=t[l],{uniform:h,offset:f,shape:p,texShape:g}=e.variablesLocations[l];if(p){const{uniformShape:b}=x$(e.program.packedInputs,u.shape,u.texData.texShape);switch(b.length){case 1:n.gl.uniform1iv(p,new Int32Array(b));break;case 2:n.gl.uniform2iv(p,new Int32Array(b));break;case 3:n.gl.uniform3iv(p,new Int32Array(b));break;case 4:n.gl.uniform4iv(p,new Int32Array(b));break}}if(g&&n.gl.uniform2i(g,u.texData.texShape[0],u.texData.texShape[1]),h!=null){if(u.isUniform){if(Ee(u.shape)<2)n.gl.uniform1f(h,u.uniformValues[0]);else{let b=u.uniformValues;b instanceof Float32Array||(b=new Float32Array(b)),n.gl.uniform1fv(h,b)}continue}u.texData.slice!=null&&f!=null&&n.gl.uniform1i(f,u.texData.slice.flatOffset),n.setInputMatrixTexture(u.texData.texture.texture,h,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=Qe(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const u=e.program.customUniforms[l],h=e.customUniformLocations[l],f=r[l];if(u.type==="float")n.gl.uniform1fv(h,f);else if(u.type==="vec2")n.gl.uniform2fv(h,f);else if(u.type==="vec3")n.gl.uniform3fv(h,f);else if(u.type==="vec4")n.gl.uniform4fv(h,f);else if(u.type==="int")n.gl.uniform1iv(h,f);else if(u.type==="ivec2")n.gl.uniform2iv(h,f);else if(u.type==="ivec3")n.gl.uniform3iv(h,f);else if(u.type==="ivec4")n.gl.uniform4iv(h,f);else throw Error(`uniform type ${u.type} is not supported yet.`)}n.executeProgram()}function K3e(n,e,t){let s="";e.concat(t).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:u,uniformShape:h,keptDims:f}=x$(n.packedInputs,o.shape,l);let p="",g="",b="";if(h.length===1&&n.packedInputs){const P=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];p=`${P[0]>1}_${P[1]>1}`}else if(h.length===2&&!n.packedInputs)g=`${h[0]>1}_${h[1]>1}`;else if(h.length>2&&!n.packedInputs){const P=Qe(h);b=`${P[0]===l[1]}_${P[P.length-1]===l[1]}`}const T=o.shape.length,w=h.length===2&&jt(o.shape,l),_=Ee(o.shape)===1,C=Zf(o.shape,t.shape),N=!n.packedInputs&&T===t.shape.length&&jt(l,t.texData.texShape),A=n.packedInputs||h.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${T}_${N}_${u?f:""}_${h.length}_${_}_${C}_${w}_${p}_${g}_${b}_${A}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${l}_${a}`}});const r=n.userCode;let i=n.constructor.name;return i+="_"+s+"_"+r+`${we().getNumber("WEBGL_VERSION")}`,i}function lr(n){return we().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class X3e{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Qg.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Cr();this.outputShape=e,this.enableShapeUniforms=lr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Ox(["r","c","d"],e):ud(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Y3e{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Qg.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Cr();this.outputShape=e,this.enableShapeUniforms=lr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Ox(["r","c","d"],e):ud(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J3e{constructor(e){this.variableNames=["A"],this.outTexUsage=Si.DOWNLOAD;const t=Cr();this.outputShape=e,this.userCode=`
      ${UX}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j3e{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Si.DOWNLOAD;const t=Cr();this.outputShape=e,this.userCode=`
      ${UX}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q3e={R:0,G:1,B:2,A:3};class JL{constructor(e,t=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=Cr();this.outputShape=e,this.enableShapeUniforms=lr(this.outputShape.length);let i="result";t&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<s.length;a++){const l=s[a];o+=`
          if(offset == ${a}) {
            result = values[${Q3e[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?T$():w$(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Z3e{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Cr();this.outputShape=e,this.enableShapeUniforms=lr(this.outputShape.length);let r="",i="result";t&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?T$():w$(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eLe(n){const e=Cr(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return FFe(n,t)}function tLe(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return zFe(n,e)}function nLe(n){const e=new Uint16Array([0,1,2,2,1,3]);return GFe(n,e)}function Gb(n,e,t,s,r,i){qFe(e,t);const o=HFe(n),a=n.TEXTURE_2D;return ze(n,()=>n.bindTexture(a,o)),ze(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),ze(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),ze(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),ze(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),we().getNumber("WEBGL_VERSION")===1?ze(n,()=>n.texImage2D(a,0,s,e,t,0,r,i,null)):ze(n,()=>n.texStorage2D(a,1,s,e,t)),ze(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:o,texShape:[t,e]}}function WX(n){return n.internalFormatFloat}function sLe(n,e,t,s){const[r,i]=Ub(e,t);return Gb(n,r,i,WX(s),s.textureFormatFloat,n.FLOAT)}function KX(n){return n.internalFormatHalfFloat}function rLe(n,e,t,s){const[r,i]=Ub(e,t);return Gb(n,r,i,KX(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function XX(n){return n.downloadTextureFormat}function iLe(n,e,t,s){const[r,i]=Ub(e,t);return Gb(n,r,i,XX(s),n.RGBA,n.UNSIGNED_BYTE)}function YX(n){return n.internalFormatPackedFloat}function oLe(n,e,t,s){const[r,i]=Dp(e,t);return Gb(n,r,i,YX(s),n.RGBA,n.FLOAT)}function JX(n){return n.internalFormatPackedHalfFloat}function aLe(n,e,t,s){const[r,i]=Dp(e,t);return Gb(n,r,i,JX(s),n.RGBA,s.textureTypeHalfFloat)}function lLe(n,e,t){return ze(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),WL(n,e,"clipSpacePos",t,3,20,0)&&WL(n,e,"uv",t,2,20,12)}function uLe(n,e,t,s,r,i){ze(n,()=>n.bindTexture(n.TEXTURE_2D,e));let o,a,l;r instanceof Uint8Array?(o=new Uint8Array(t*s*4),a=n.UNSIGNED_BYTE,l=n.RGBA):(o=new Float32Array(t*s*4),a=n.FLOAT,l=i.internalFormatPackedFloat),o.set(r),we().getNumber("WEBGL_VERSION")===2?ze(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,a,o)):ze(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,t,s,0,n.RGBA,a,o)),ze(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function cLe(n,e,t){ze(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?we().getNumber("WEBGL_VERSION")===2?ze(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):ze(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):we().getNumber("WEBGL_VERSION")===2?ze(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):ze(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),ze(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function hLe(n,e,t,s){const r=n.createBuffer();ze(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const a=4*4*e*t;return ze(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),ze(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),ze(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function dLe(n,e,t){const s=n,r=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function fLe(n,e,t,s){const[r,i]=Ub(e,t),o=4,a=new Uint8Array(kFe(e*t,o));return ze(n,()=>n.readPixels(0,0,r,i,s.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function pLe(n,e,t,s,r,i,o,a){const l=n,u=new Float32Array($Fe(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function mLe(n,e,t){const s=new Float32Array(e*t*4);return ze(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EE{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=we().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,CFe(t,e)):this.gl=Fo(t),e=this.gl,we().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>ze(i,()=>i.createVertexArray()),this.bindVertexArray=o=>ze(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>ze(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>ze(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>ze(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>ze(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>ze(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>ze(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),we().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=D1(this.gl,i),Yi(this.gl,o))this.textureHalfFloatExtension=D1(this.gl,o);else if(we().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Yi(this.gl,r))this.colorBufferHalfFloatExtension=D1(this.gl,r);else if(we().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Yi(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Yi(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=tLe(this.gl),this.indexBuffer=nLe(this.gl),this.framebuffer=WFe(this.gl),this.textureConfig=v$(this.gl,this.textureHalfFloatExtension)}get debug(){return we().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;ze(e,()=>e.finish()),ze(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),ze(e,()=>e.deleteFramebuffer(this.framebuffer)),ze(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),ze(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),ze(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),sLe(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),rLe(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),iLe(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),cLe(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,r){this.throwIfDisposed(),uLe(this.gl,e,t,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),aLe(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),oLe(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(KL(this.gl,this.framebuffer),this.outputTexture=null),ze(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>fLe(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,r,i,o){return pLe(this.gl,e,t,s,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return dLe(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const r=hLe(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(we().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const o=r.clientWaitSync(i,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},t=i}else we().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,we().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>mLe(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=eLe(t));const s=BFe(t);ze(t,()=>t.attachShader(s,this.vertexShader)),ze(t,()=>t.attachShader(s,e)),UFe(t,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&TE(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;ze(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),lLe(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(ze(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&TE(this.gl,this.program),ze(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?XFe(this.gl,e,t):YFe(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),ze(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),JFe(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[r,i]=Dp(t,s);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,t,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&TE(this.gl,this.program),M1(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}ze(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),ze(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=D1(this.gl,we().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(we().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(we().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await U3(()=>this.disposed||this.isQueryAvailable(e,we().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,we().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=gLe(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in we().platform&&(s=we().platform.setTimeoutCustom.bind(we().platform)),U3(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),xE(this.gl,e,this.framebuffer),this.debug&&M1(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(xE(this.gl,this.outputTexture,this.framebuffer),this.debug&&M1(this.gl)):KL(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const r=this.gl;xE(r,e,this.framebuffer),this.debug&&M1(r),this.outputTexture=e,ze(r,()=>r.viewport(0,0,t,s)),ze(r,()=>r.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,r){this.throwIfDisposed(),ze(this.gl,()=>this.gl.scissor(e,t,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function gLe(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:yLe,bincountImpl:jX,bincountReduceImpl:bLe,bitwiseAndImpl:vLe,castImpl:wLe,ceilImpl:TLe,concatImpl:xLe,equalImpl:SLe,expImpl:_Le,expm1Impl:ELe,floorImpl:ILe,gatherNdImpl:CLe,gatherV2Impl:NLe,greaterImpl:ALe,greaterEqualImpl:kLe,lessImpl:$Le,lessEqualImpl:RLe,linSpaceImpl:DLe,logImpl:MLe,maxImpl:OLe,maximumImpl:PLe,minimumImpl:FLe,multiplyImpl:LLe,negImpl:VLe,notEqualImpl:BLe,prodImpl:ULe,raggedGatherImpl:zLe,raggedRangeImpl:GLe,raggedTensorToTensorImpl:HLe,rangeImpl:qLe,rsqrtImpl:WLe,scatterImpl:KLe,sigmoidImpl:XLe,simpleAbsImpl:QX,sliceImpl:YLe,sparseFillEmptyRowsImpl:JLe,sparseReshapeImpl:jLe,sparseSegmentReductionImpl:ZX,sqrtImpl:QLe,staticRegexReplaceImpl:ZLe,stridedSliceImpl:eVe,stringNGramsImpl:tVe,stringSplitImpl:nVe,stringToHashBucketFastImpl:sVe,subImpl:rVe,tileImpl:iVe,topKImpl:oVe,transposeImpl:S$,uniqueImpl:aVe}=cRe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eY(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function vr(n,e){return e===1?[n]:eY(n,e)}function lVe(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uVe{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=lr(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=vr("rc",this.rank),s=fn(this.rank),r=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let i=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;t.push(i)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tY{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=lr(this.outputShape.length);let s="";for(let r=0;r<4;r++){let i="thisRC = rc;";r%2===1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),s+=`
        ${i}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${cVe(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?T$():w$(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function cVe(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?l3e(["r","c","d"],"inputShape"):ud(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hVe{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,s){const r=QL(t,s),i=ZL(e,r,s);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=jL(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return r===Vs.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Vs.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Vs.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Vs.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Vs.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,t,s,r){if(this.freeTextures==null)return;const i=QL(s,r),o=ZL(t,i,r);o in this.freeTextures||(this.freeTextures[o]=[]);const a=jL(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=we().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[o],h=u&&u.indexOf(e);if(h==null||h<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[h]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function dVe(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function jL(n,e,t,s,r){const i=fVe(e,s);let o;if(r){const[l,u]=Dp(n[0],n[1]);o=l*u}else{const[l,u]=Ub(n[0],n[1]);o=l*u}const a=dVe(t,i);return o*a}function fVe(n,e){switch(n){case Vs.PACKED_2X2_FLOAT32:return YX(e);case Vs.PACKED_2X2_FLOAT16:return JX(e);case Vs.UNPACKED_FLOAT32:return WX(e);case Vs.UNPACKED_FLOAT16:return KX(e);case Vs.PACKED_4X1_UNSIGNED_BYTE:return XX(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function pVe(n){return we().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Vs.PACKED_2X2_FLOAT32:Vs.UNPACKED_FLOAT32:n?Vs.PACKED_2X2_FLOAT16:Vs.UNPACKED_FLOAT16}function QL(n,e){if(n===Si.UPLOAD)return Vs.PACKED_2X2_FLOAT32;if(n===Si.RENDER||n==null)return pVe(e);if(n===Si.DOWNLOAD||n===Si.PIXELS)return Vs.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function ZL(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pa{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=lr(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const ro="if (isnan(x)) return x;",mVe="return x;",eV="return abs(x);",gVe="return (x >= 0.0) ? x : (exp(x) - 1.0);",yVe=ro+`
  return (x < 0.0) ? 0.0 : x;
`,bVe=ro+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Su="return x;",vVe="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wVe="return x;",TVe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,xVe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,SVe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,_Ve="return 1.0 / (1.0 + exp(-1.0 * x));";class Ou{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=lr(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EVe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=lr(this.outputShape.length);const t=e.length,s=vr("rc",t),r=fn(t),i=lVe(t,s),o=s.slice(-2),a=t<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IVe=C9,CVe=1e-7,NVe=1e-4,F1={};function AVe(n){return n in F1||(F1[n]={}),F1[n]}const kVe=we().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),$Ve=600;function RVe(){return we().global.screen==null?1024:we().global.screen.height*we().global.screen.width*window.devicePixelRatio*$Ve/1024/1024}class Px extends WA{nextDataId(){return Px.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!we().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof EE)t=e;else{const s=Fo(we().getNumber("WEBGL_VERSION"),e);t=new EE(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=Fo(we().getNumber("WEBGL_VERSION"));t=new EE(s),this.binaryCache=AVe(we().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new hVe(this.gpgpu),this.numMBBeforeWarning=RVe(),this.texData=new e5(this,aa())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,s,r,i,o){const a=this.makeTensorInfo(t,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,i]},l.texShape=[r,i];const u=O1(t),h=new JL(u,!1,o),f=this.runWebGLProgram(h,[a],s,[[r,i]]);return f.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(a),f.dataId}write(e,t,s){if((we().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||we().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:s,values:e,usage:Si.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,r,i){if(we().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:t,usage:Si.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:i,slice:o,shape:a,isPacked:l}=t;if(o!=null){let p;l?p=new Ou(a,Su):p=new pa(a,Su);const g=this.runWebGLProgram(p,[{dataId:e,shape:a,dtype:r}],r),b=this.readSync(g.dataId);return this.disposeIntermediateTensorInfo(g),b}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const u=this.activeTimers!=null;let h;u&&(h=kr());let f;if(r==="complex64"){const p=this.readSync(i.real.dataId),g=this.readSync(i.imag.dataId);f=Nl(p,g)}else f=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=kr()-h),this.convertAndCacheOnCPU(e,f)}async read(e){if(this.pendingRead.has(e)){const b=this.pendingRead.get(e);return new Promise(T=>b.push(T))}const t=this.texData.get(e),{values:s,shape:r,slice:i,dtype:o,complexTensorInfos:a,isPacked:l}=t;if(i!=null){let b;l?b=new Ou(r,Su):b=new pa(r,Su);const T=this.runWebGLProgram(b,[{dataId:e,shape:r,dtype:o}],o),w=this.read(T.dataId);return this.disposeIntermediateTensorInfo(T),w}if(s!=null)return this.convertAndCacheOnCPU(e);if(we().getBool("DEBUG")&&!we().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&we().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,h;if(o!=="complex64"&&we().get("WEBGL_BUFFER_SUPPORTED")){h=this.decode(e);const b=this.texData.get(h.dataId);u=this.gpgpu.createBufferFromTexture(b.texture.texture,...R1(r))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let f;if(o==="complex64"){const b=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),T=b[0],w=b[1];f=Nl(T,w)}else if(u==null)f=this.getValuesFromTexture(e);else{const b=Ee(r);f=this.gpgpu.downloadFloat32MatrixFromBuffer(u,b)}if(h!=null&&this.disposeIntermediateTensorInfo(h),u!=null){const b=this.gpgpu.gl;ze(b,()=>b.deleteBuffer(u))}const p=this.convertAndCacheOnCPU(e,f),g=this.pendingRead.get(e);return this.pendingRead.delete(e),g.forEach(b=>b(p)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&aa().removeDataId(e,this),this.pendingDeletes--),p}readToGPU(e,t={}){const s=this.texData.get(e),{values:r,shape:i,slice:o,dtype:a,isPacked:l,texture:u}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let g;l?g=new Ou(i,Su):g=new pa(i,Su);const b=this.runWebGLProgram(g,[{dataId:e,shape:i,dtype:a}],a),T=this.readToGPU(b,t);return this.disposeIntermediateTensorInfo(b),T}if(u==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const h=this.decode(e,t.customTexShape),f=aa().makeTensorFromTensorInfo(h),p=this.texData.get(h.dataId);return Object.assign({tensorRef:f},p.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>uc(r));return Tt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Tt(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!OFe(s))throw we().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:r}=this.texData.get(e),i=Ee(t);if(we().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const p=this.decode(e),g=this.texData.get(p.dataId),b=this.gpgpu.downloadMatrixFromPackedTexture(g.texture.texture,...R1(t)).subarray(0,i);return this.disposeIntermediateTensorInfo(p),b}const o=we().getBool("WEBGL_PACK")&&r===!0,a=o?O1(t):t,l=o?new j3e(a):new J3e(a),u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),h=this.texData.get(u.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(h.texture.texture,h.texShape[0],h.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(u),f}timerAvailable(){return we().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const i=Uh(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=Uh(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(we().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);a.kernelMs=PTe(l),a.getExtraProfileInfo=()=>l.map((u,h)=>({name:o[h],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return we().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:kr(),endMs:null}}endTimer(e){return we().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=kr(),e)}async getQueryTime(e){if(we().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:r,usage:i,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(t,r,i,o)));const h=this.texData.get(e);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=kVe){return we().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&Ee(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){wi("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return IVe(e.shape,t)}packedUnaryOp(e,t,s){const r=new Ou(e.shape,t),i=this.compileAndRun(r,[e],s);return aa().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=QX(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(we().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,eV,e.dtype);const t=new pa(e.shape,eV),s=this.compileAndRun(t,[e]);return aa().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&Ny(s[0])){const i=s.map(o=>qu(o));r=this.write(i,e,t)}else r=this.write(s,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,s){return aa().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new EVe(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new uVe(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const s=[op(e.shape),...ap(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},i=[op(t),...ap(t)],o=new tY(i,s),a=!0,l=[s],u=this.runWebGLProgram(o,[r],e.dtype,l,a);return{dataId:u.dataId,shape:t,dtype:u.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:r,shape:i,dtype:o}=s;if(t!=null){const p=Ee(i),g=t[0]*t[1]*4;q(p<=g,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=O1(i);let l;r?l=new Y3e(a):l=new X3e(a);const u=!0,h=[t??R1(a)],f=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,h,u,t);return{dtype:o,shape:i,dataId:f.dataId}}runWebGLProgram(e,t,s,r,i=!1,o){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===Qg.DENSE){const _=o??R1(e.outputShape);l.texShape=_.map(C=>C*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),Ee(a.shape)===0)return l.values=ir(a.dtype,0),a;const u=[],h=t.map(_=>{if(_.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let C=this.texData.get(_.dataId);if(C.texture==null){if(!e.packedInputs&&Ee(_.shape)<=we().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:_.shape,texData:null,isUniform:!0,uniformValues:C.values};e.packedInputs&&(C.isPacked=!0,C.shape=_.shape)}if(this.uploadToGPU(_.dataId),!!C.isPacked!=!!e.packedInputs)_=C.isPacked?this.unpackTensor(_):this.packTensor(_),u.push(_),C=this.texData.get(_.dataId);else if(C.isPacked&&!bw(C.shape,_.shape)){const N=_,A=_.shape;_.shape=C.shape,_=this.packedReshape(_,A),u.push(_),C=this.texData.get(_.dataId),N.shape=A}return{shape:_.shape,texData:C,isUniform:!1}});this.uploadToGPU(a.dataId);const f={shape:a.shape,texData:l,isUniform:!1},p=K3e(e,h,f),g=this.getAndSaveBinary(p,()=>q3e(this.gpgpu,e,h,f)),b=this.activeTimers!=null;let T;b&&(T=this.startTimer()),we().get("ENGINE_COMPILE_ONLY")||W3e(this.gpgpu,g,h,f,r),u.forEach(_=>this.disposeIntermediateTensorInfo(_)),b&&(T=this.endTimer(T),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(T)}));const w=we().getNumber("WEBGL_FLUSH_THRESHOLD");if(w>0){const _=kr();_-this.lastGlFlushTime>w&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=_)}if(!we().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const _=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),_}return a}compileAndRun(e,t,s,r,i=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,r,i)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(we().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ge(()=>{if(!we().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=we().getBool("DEBUG");we().set("DEBUG",!1);const t=this.abs(Yt(1e-8)).dataSync()[0];if(we().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?CVe:NVe}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:r,values:i,texture:o,usage:a,isPacked:l}=t;if(o!=null)return;const u=this.activeTimers!=null;let h;u&&(h=kr());let f=t.texShape;if(f==null&&(f=ZFe(s,l),t.texShape=f),i!=null){const p=O1(s);let g,b=f[1],T=f[0];const w=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!w)&&([b,T]=Dp(f[0],f[1])),l?g=new Z3e(p,w):g=new JL(p,w);const _=w?[T,b]:f,C=this.makeTensorInfo(_,r),N=this.texData.get(C.dataId);w?N.usage=Si.PIXELS:N.usage=Si.UPLOAD,N.texShape=_,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(C.dataId),b,T,i);const A=[[T,b]],V=this.runWebGLProgram(g,[C],r,A,!0),D=this.texData.get(V.dataId);t.texShape=D.texShape,t.isPacked=D.isPacked,t.usage=D.usage,we().get("ENGINE_COMPILE_ONLY")?this.disposeData(V.dataId):(t.texture=D.texture,t.values=null,this.texData.delete(V.dataId)),this.disposeIntermediateTensorInfo(C),u&&(this.uploadWaitMs+=kr()-h)}else{const p=this.acquireTexture(f,a,r,l);t.texture=p}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:r}=s;return t!=null&&(s.values=DVe(t,r)),s.values}acquireTexture(e,t,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*Xv(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(i){throw i}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await H9(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(BX(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:s,infLoc:r,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=qX(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,t,s){e.channels=e.channels||"RGBA";const{texture:r,height:i,width:o,channels:a}=e,l=aa().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(r,t,s,i,o,a);return aa().makeTensorFromDataId(u,t,s,l)}}Px.nextDataId=0;function DVe(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */U5()&&q5("webgl",()=>new Px,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _$=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Qh{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=pt(t,s),this.enableShapeUniforms=lr(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hd=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Lp{constructor(e,t,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=pt(t,s);const i=this.outputShape.length;this.enableShapeUniforms=lr(i);let o="";if(r)if(i===0||Ee(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${fn(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=vr("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ui(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const MVe={kernelName:Yy,backendName:"webgl",kernelFunc:ui};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $c(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,i=t.makeTensorInfo(s.shape,"complex64"),o=t.texData.get(i.dataId),a=ui({inputs:{x:s},backend:t}),l=ui({inputs:{x:r},backend:t});return o.complexTensorInfos={real:a,imag:l},i}const OVe={kernelName:ik,backendName:"webgl",kernelFunc:$c};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nY="return (a < 0.) ? b * a : a;",sY=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function PVe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:i}=s,o=t.makeTensorInfo([],"float32",Sc(i,"float32")),a=we().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Lp(sY,r.shape,o.shape):new Qh(nY,r.shape,o.shape),l=t.runWebGLProgram(a,[r,o],"float32");return t.disposeIntermediateTensorInfo(o),l}const FVe={kernelName:$T,backendName:"webgl",kernelFunc:PVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rY="return (a < 0.) ? b * a : a;",iY=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function LVe(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e,i=we().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Lp(iY,s.shape,r.shape):new Qh(rY,s.shape,r.shape);return t.runWebGLProgram(i,[s,r],"float32")}const VVe={kernelName:JT,backendName:"webgl",kernelFunc:LVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vp="if (isnan(x)) return x;";function Vt({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:r,backend:i})=>{const{x:o}=r,a=i,l=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&t!=null){const f=a.texData.get(o.dataId),p=t(f.values,l);return a.makeTensorInfo(o.shape,l,p)}const u=we().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let h;return u?h=new Ou(o.shape,e):h=new pa(o.shape,n),a.runWebGLProgram(h,[o],l)}}function Hs({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:i}){return({inputs:o,backend:a})=>{const{a:l,b:u}=o,h=a;if(s&&l.dtype==="complex64"){const b=h.texData.get(l.dataId),T=h.texData.get(u.dataId),[w,_]=[[b.complexTensorInfos.real,T.complexTensorInfos.real],[b.complexTensorInfos.imag,T.complexTensorInfos.imag]].map(N=>{const[A,P]=N,V={dataId:A.dataId,dtype:A.dtype,shape:l.shape},D={dataId:P.dataId,dtype:P.dtype,shape:u.shape},M=new Qh(n,l.shape,u.shape);return h.runWebGLProgram(M,[V,D],ai(A.dtype,P.dtype))}),C=$c({inputs:{real:w,imag:_},backend:h});return h.disposeIntermediateTensorInfo(w),h.disposeIntermediateTensorInfo(_),C}const f=i||ai(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||h.shouldExecuteOnCPU([l,u]))&&r!=null){const b=h.texData.get(l.dataId).values,T=h.texData.get(u.dataId).values,w=l.dtype==="string"?Al(b):b,_=l.dtype==="string"?Al(T):T,[C,N]=r(l.shape,u.shape,w,_,f),A=h.makeTensorInfo(N,f),P=h.texData.get(A.dataId);return P.values=C,A}const p=we().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let g;return p?g=new Lp(e,l.shape,u.shape,t):g=new Qh(n,l.shape,u.shape),h.runWebGLProgram(g,[l,u],f)}}function Zg(n,e=!1){if(n==="linear")return e?wVe:mVe;if(n==="relu")return e?xVe:yVe;if(n==="elu")return e?TVe:gVe;if(n==="relu6")return e?SVe:bVe;if(n==="prelu")return e?iY:rY;if(n==="leakyrelu")return e?sY:nY;if(n==="sigmoid")return e?_Ve:vVe;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oY{constructor(e,t,s,r=!1,i=!1,o=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=lr(this.outputShape.length);const h=r?e[1]:e[2],f=Math.ceil(h/2),p=r?"i * 2, rc.y":"rc.y, i * 2",g=i?"rc.z, i * 2":"i * 2, rc.z",b=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],T=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let w="",_="";a&&(l?w=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?w=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:w=`vec4 activation(vec4 x) {
          ${a}
        }`,_="result = activation(result);");const C=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let N="rc.x",A="rc.x";e[0]<t[0]?N=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(A=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${w}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${f}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${N};
        int batchB = ${A};
        for (int i = 0; i < ${f}; i++) {
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${g});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${b[0]} * ${T[0]});
          result += (${b[1]} * ${T[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${C}

        ${_}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tV={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class nV{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=pt(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sV="return a * b;";function E$(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,i=ai(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),u=new nV(tV.REAL,s.shape,r.shape),h=new nV(tV.IMAG,s.shape,r.shape),f=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],p=t.runWebGLProgram(u,f,"float32"),g=t.runWebGLProgram(h,f,"float32"),b=$c({inputs:{real:p,imag:g},backend:t});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),b}if(t.shouldExecuteOnCPU([s,r])){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),[u,h]=LLe(s.shape,r.shape,a.values,l.values,i),f=t.makeTensorInfo(h,i),p=t.texData.get(f.dataId);return p.values=u,f}let o;return we().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new Lp(sV,s.shape,r.shape):o=new Qh(sV,s.shape,r.shape),t.runWebGLProgram(o,[s,r],i)}const BVe={kernelName:rb,backendName:"webgl",kernelFunc:E$};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UVe(n,e,t){const s=[op(n.shape),...ap(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},i=[op(e),...ap(e)],o=new tY(i,s),a=!0,l=[s],u=t.runWebGLProgram(o,[r],n.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ve(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:i}=s,o=t,a=Ee(r.shape),l=n5(i,a),u=Ee(l);q(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const h=o.texData.get(r.dataId);return h.isPacked&&!bw(r.shape,l)&&!(h.texture!==null&&bw(h.shape,l))?UVe(r,l,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const zVe={kernelName:QT,backendName:"webgl",kernelFunc:Ve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rV{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];const a=Math.floor(s/4)*4,l=s%4;let u="sumValue += dot(values, ones);";if(t!=null){const f=1/t;u=`sumValue += dot(values * ${Jf(f)?f.toPrecision(2):f}, ones);`}let h="";i%s>0&&(h=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${h}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GVe{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];let a="0.0",l="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",l="min"):t==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");const h=Math.floor(s/4)*4,f=s%4;let p=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,g="vec4";t==="all"?(a="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,g="bvec4"):t==="any"&&(a="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,g="bvec4");let b="";i%s>0&&(b=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${b}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${h};
        if (${f===1}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${f===2}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${f===3}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HVe(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=wx(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function dd(n,e,t,s){const r=HVe(n.shape);let i=n;for(let o=0;o<r.length;o++){const{inSize:a,windowSize:l,outSize:u}=r[o];let h,f;t==="mean"?h=o===0?new rV({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},a):new rV({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u}):h=new GVe({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},t),f=i,i=s.runWebGLProgram(h,[i],e),f.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(f)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qVe{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[t[o]];this.outputShape=s,this.rank=s.length;const r=fn(this.rank),i=WVe(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function WVe(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<n.length;r++)s[n[r]]=t[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KVe{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let h=0;h<s.length;h++)s[h]=e[t[h]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=fn(this.rank),i=eY("rc",this.rank),o=new Array(this.rank);for(let h=0;h<t.length;h++)o[t[h]]=i[h];const a=`vec2(${o.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${s[this.rank-1]}`,u=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fx(n,e,t){const s=we().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new KVe(n.shape,e):new qVe(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XVe(n,e,t,s){const r=e,i=n.shape.length,o=xt(r,n.shape);let a=o;const l=zn(a,i),u=l!=null;let h=n;u&&(h=Fx(n,l,s),a=Yn(a.length,i)),Gs("sum",a,i);const[f,p]=Ds(h.shape,a);let g=f;t&&(g=os(f,o));const b=Ee(p),w=Ee(n.shape)/b,_=Ve({inputs:{x:h},attrs:{shape:[w,b]},backend:s}),C=Vk(n.dtype),N=dd(_,C,"sum",s),A=Ve({inputs:{x:N},attrs:{shape:g},backend:s});return s.disposeIntermediateTensorInfo(_),s.disposeIntermediateTensorInfo(N),u&&s.disposeIntermediateTensorInfo(h),A}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lx(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;return XVe(r,i,o,t)}const YVe={kernelName:rx,backendName:"webgl",kernelFunc:Lx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Er(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{perm:i}=s,o=t,a=r.shape.length,l=new Array(a);for(let h=0;h<l.length;h++)l[h]=r.shape[i[h]];let u;if(o.shouldExecuteOnCPU([r])){const f=o.texData.get(r.dataId).values,p=S$(f,r.shape,r.dtype,i,l);u=o.makeTensorInfo(l,r.dtype);const g=o.texData.get(u.dataId);g.values=p}else u=Fx(r,i,o);return u}const JVe={kernelName:$f,backendName:"webgl",kernelFunc:Er};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aY=1e3;function vw({a:n,b:e,transposeA:t,transposeB:s,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const u=n.shape.length,h=e.shape.length,f=t?n.shape[u-2]:n.shape[u-1],p=s?e.shape[h-1]:e.shape[h-2],g=t?n.shape[u-1]:n.shape[u-2],b=s?e.shape[h-2]:e.shape[h-1],T=n.shape.slice(0,-2),w=e.shape.slice(0,-2),_=Ee(T),C=Ee(w),A=pt(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([g,b]);q(f===p,()=>`Error in matMul: inner shapes (${f}) and (${p}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const P=t?[_,f,g]:[_,g,f],V=s?[C,b,p]:[C,p,b],D=Ve({inputs:{x:n},backend:r,attrs:{shape:P}}),M=Ve({inputs:{x:e},backend:r,attrs:{shape:V}}),$=[D,M],O=Math.max(_,C),k=t?D.shape[1]:D.shape[2],z=i!=null,U=o!=null,te=l==="leakyrelu",se=l!=null?Zg(l,!0):null,X=z||U||te||se!=null;let Q;if((g===1||b===1)&&k>aY&&X===!1){let fe=D,be=M;t&&(fe=Er({inputs:{x:D},backend:r,attrs:{perm:[0,2,1]}}),$.push(fe)),s&&(be=Er({inputs:{x:M},backend:r,attrs:{perm:[0,2,1]}}),$.push(be));const W=b!==1,ne=b===1;let ue=fe;W&&(ue=Ve({inputs:{x:fe},backend:r,attrs:{shape:[O,k,1]}}),$.push(ue));const Te=b===1?2:1;let Ie=be;ne&&(Ie=Ve({inputs:{x:be},backend:r,attrs:{shape:[O,1,k]}}),$.push(Ie));const Re=E$({inputs:{a:ue,b:Ie},backend:r});Q=Lx({inputs:{x:Re},backend:r,attrs:{axis:Te,keepDims:!0}}),$.push(Re)}else{const fe=ai(n.dtype,e.dtype),be=new oY(P,V,[O,g,b],t,s,z,se,U,te),W=[D,M];if(i!=null&&W.push(i),U&&W.push(o),te){const ne=r.makeTensorInfo([],"float32",Sc(a,"float32"));W.push(ne),$.push(ne)}Q=r.runWebGLProgram(be,W,fe)}const re=Ve({inputs:{x:Q},backend:r,attrs:{shape:A}});$.push(Q);for(const fe of $)r.disposeIntermediateTensorInfo(fe);return re}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jVe(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:h,leakyreluAlpha:f}=s;return vw({a:r,b:i,transposeA:l,transposeB:u,backend:t,bias:o,preluActivationWeights:a,leakyreluAlpha:f,activation:h})}const QVe={kernelName:Yv,backendName:"webgl",kernelFunc:jVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iV="return abs(x);";function ZVe(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const i=t.texData.get(s.dataId),o=QX(i.values);return t.makeTensorInfo(s.shape,s.dtype,o)}let r;return we().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Ou(s.shape,iV):r=new pa(s.shape,iV),t.runWebGLProgram(r,[s],s.dtype)}const e4e={kernelName:hT,backendName:"webgl",kernelFunc:ZVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t4e=ro+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,n4e=Vt({opSnippet:t4e}),s4e={kernelName:Ay,backendName:"webgl",kernelFunc:n4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r4e=ro+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,i4e=Vt({opSnippet:r4e}),o4e={kernelName:ky,backendName:"webgl",kernelFunc:i4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oV="return a + b;",a4e=Hs({opSnippet:oV,packedOpSnippet:oV,supportsComplex:!0,cpuKernelImpl:yLe}),l4e={kernelName:Ip,backendName:"webgl",kernelFunc:a4e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class u4e{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`float v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c4e{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`vec4 v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uv(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return ui({inputs:{x:s[0]},backend:t});if(s.length>we().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),u=uv({inputs:s.slice(0,l),backend:t}),h=uv({inputs:s.slice(l),backend:t});return uv({inputs:[u,h],backend:t})}const r=s.map(l=>l.dtype).reduce((l,u)=>ai(l,u)),i=s.map(l=>l.shape),a=we().getBool("WEBGL_PACK")?new c4e(s[0].shape,i):new u4e(s[0].shape,i);return t.runWebGLProgram(a,s,r)}const h4e={kernelName:QA,backendName:"webgl",kernelFunc:uv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d4e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=xt(i,r.shape);let u=l;const h=zn(u,a);let f=r;h!=null&&(f=Er({inputs:{x:r},backend:t,attrs:{perm:h}}),u=Yn(u.length,a)),Gs("all",u,a);const[p,g]=Ds(f.shape,u),b=Ee(g),T=Ve({inputs:{x:f},backend:t,attrs:{shape:[-1,b]}}),w=dd(T,T.dtype,"all",t);let _;if(o){const C=os(p,l);_=Ve({inputs:{x:w},backend:t,attrs:{shape:C}})}else _=Ve({inputs:{x:w},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(T),t.disposeIntermediateTensorInfo(w),h!=null&&t.disposeIntermediateTensorInfo(f),_}const f4e={kernelName:ZA,backendName:"webgl",kernelFunc:d4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p4e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=xt(i,r.shape);let u=l;const h=zn(u,a);let f=r;h!=null&&(f=Er({inputs:{x:r},backend:t,attrs:{perm:h}}),u=Yn(u.length,a)),Gs("any",u,a);const[p,g]=Ds(f.shape,u),b=Ee(g),T=Ve({inputs:{x:f},backend:t,attrs:{shape:[-1,b]}}),w=dd(T,T.dtype,"any",t);let _;if(o){const C=os(p,l);_=Ve({inputs:{x:w},backend:t,attrs:{shape:C}})}else _=Ve({inputs:{x:w},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(T),t.disposeIntermediateTensorInfo(w),h!=null&&t.disposeIntermediateTensorInfo(f),_}const m4e={kernelName:ek,backendName:"webgl",kernelFunc:p4e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g4e{constructor(e,t,s){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=t==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y4e{constructor(e,t,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,q(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=fn(l),h=vr("coords",l);let f,p;if(o===1){p=l+1;const M=fn(p);f=`
        ${M} sourceLocR = ${M}(${h.join()}, 0);
        ++${h[l-1]};
        ${M} sourceLocG = ${M}(${h.join()}, 0);
        ++${h[l-2]};
        ${M} sourceLocA = ${M}(${h.join()}, 0);
        --${h[l-1]};
        ${M} sourceLocB = ${M}(${h.join()}, 0);
        --${h[l-2]};`}else p=l,f=`
        ${u} sourceLocR = coords;
        ++${h[l-1]};
        ${u} sourceLocG = coords;
        ++${h[l-2]};
        ${u} sourceLocA = coords;
        --${h[l-1]};
        ${u} sourceLocB = coords;
        --${h[l-2]};`;const g=["x","y","z","w","u","v"].slice(0,p),b="."+g[p-1],T=g.map(M=>"int "+M),w=vr("sourceLocR",p-1).concat("inIdx.r"),_=vr("sourceLocG",p-1).concat("inIdx.g"),C=vr("sourceLocB",p-1).concat("inIdx.b"),N=vr("sourceLocA",p-1).concat("inIdx.a"),A=s==="max"?"greaterThan":"lessThan",P=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${w.join()}),
                             getBestIndicesAChannel(${_.join()}),
                             getBestIndicesAChannel(${C.join()}),
                             getBestIndicesAChannel(${N.join()})));`,V=`vec4(
            getAChannel(${w.join()}),
            hasNextCol ? getAChannel(${_.join()}) : 0.,
            hasNextRow ? getAChannel(${C.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${N.join()}) : 0.)`,D=r?"":`
      float getBestIndicesAChannel(${T.join()}) {
        return getChannel(getBestIndicesA(${g.join()}),
                                          vec2(${g.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${T.join()}) {
        return getChannel(getA(${g.join()}),
                               vec2(${g.slice(-2).join()}));
      }
      ${D}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${h[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${h[l-2]} < ${a[l-2]-1};
        ${f}
        ivec4 srcIdx = ivec4(sourceLocR${b}, sourceLocG${b},
          sourceLocB${b}, sourceLocA${b}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${V};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${P}
          vec4 candidate = ${V};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${A}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lY(n,e,t,s=null){let r=e.shape[0],i=e.shape[1];s!=null&&(r=s.shape[0],i=s.shape[1]);const o=wx(i),a={windowSize:o,inSize:i,batchSize:r,outSize:Math.ceil(i/o)},l=new g4e(a,t,s==null),u=[e];s!=null&&u.push(s);const h=n.runWebGLProgram(l,u,"int32");if(h.shape[1]===1)return h;const f=lY(n,e,t,h);return n.disposeIntermediateTensorInfo(h),f}function uY(n,e,t,s=null){const r=s!=null?s.shape:e.shape,i=r[r.length-1],o=wx(i),a=new y4e(r,o,t,s==null),l=s==null?[e]:[e,s],u=n.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){const h=uY(n,e,t,u);return n.disposeIntermediateTensorInfo(u),h}return u}function cY(n,e,t,s){const r=[t];if(Gs("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!we().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=n.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=n.unpackTensor(e),i.push(l));const[u,h]=Ds(l.shape,r),f=Ee(h),p=Ve({inputs:{x:l},backend:n,attrs:{shape:[-1,f]}});i.push(p);const g=lY(n,p,s);i.push(g);const b=Ve({inputs:{x:g},backend:n,attrs:{shape:u}});return i.forEach(T=>n.disposeIntermediateTensorInfo(T)),b}return uY(n,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b4e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;let o=xt(i,r.shape);const a=zn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=Er({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=Yn(o.length,l.shape.length)),Gs("argMax",[o[0]],l.shape.length);const h=cY(t,l,o[0],"max");return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),h}const v4e={kernelName:dT,backendName:"webgl",kernelFunc:b4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w4e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;let o=xt(i,r.shape);const a=zn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=Er({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=Yn(o.length,l.shape.length)),Gs("argMin",[o[0]],l.shape.length);const h=cY(t,l,o[0],"min");return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),h}const T4e={kernelName:fT,backendName:"webgl",kernelFunc:w4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x4e=ro+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,S4e=Vt({opSnippet:x4e}),_4e={kernelName:$y,backendName:"webgl",kernelFunc:S4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E4e=ro+"return log(x + sqrt(x * x + 1.0));",I4e=Vt({opSnippet:E4e}),C4e={kernelName:Ry,backendName:"webgl",kernelFunc:I4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N4e=ro+`
  return atan(x);
`,A4e=Vt({opSnippet:N4e}),k4e={kernelName:Dy,backendName:"webgl",kernelFunc:A4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $4e=_$+`
  return atan(a, b);
`,R4e=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+hd+`
  return result;
`,D4e=Hs({opSnippet:$4e,packedOpSnippet:R4e}),M4e={kernelName:Oy,backendName:"webgl",kernelFunc:D4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O4e=ro+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,P4e=Vt({opSnippet:O4e}),F4e={kernelName:My,backendName:"webgl",kernelFunc:P4e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ey{constructor(e,t,s,r=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,h=e.dilationWidth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,g=e.padInfo.top,b=e.padInfo.left;this.outputShape=e.outShape;const T=t==="avg",w=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,_=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let C="0.0";if(T||(C="-1.0 / 1e-20"),s){this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${g}, ${b});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${f};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${h}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?w:_:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const N="max";let A=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(A="avgValue / max(count, 1.0)");const P=Math.floor(o/4)*4,V=o%4,D=`
      if (${T}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${N}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${g}, ${b});
      const float initializationValue = ${C};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${C});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${f};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${P}; wC += 4) {
            int xC = xCCorner + wC * ${h};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              getValue(batch, xR, xC + 3 * ${h}, d)
            );

            ${D}
          }

          int xC = xCCorner + ${P};
          if (${V===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${D}
          } else if (${V===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              initializationValue,
              initializationValue
            );

            ${D}
          } else if (${V===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              initializationValue
            );

            ${D}
          }
        }
        setOutput(${A});
      }
    `}}class I${constructor(e,t,s,r=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,h=e.dilationDepth,f=e.dilationHeight,p=e.dilationWidth,g=e.effectiveFilterDepth,b=e.effectiveFilterHeight,T=e.effectiveFilterWidth,w=e.padInfo.front,_=e.padInfo.top,C=e.padInfo.left;this.outputShape=e.outShape;const N=t==="avg";let A="0.0";if(N||(A="-1.0 / 1e-20"),s){this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${w}, ${_}, ${C});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${g};
              wD += ${h}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${b};
                wR += ${f}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${T};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${b} * ${T} +
                      wR * ${T} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const P="max";let V=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(V="avgValue / max(count, 1.0)");const D=Math.floor(o/4)*4,M=o%4,$=`
      if (${N}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${P}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${w}, ${_}, ${C});
      const float initializationValue = ${A};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${A});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${g};
            wD += ${h}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${b};
            wR += ${f}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${D}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${$}
            }

            int xC = xCCorner + ${D};
            if (${M===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${$}
            } else if (${M===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${$}
            } else if (${M===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${$}
            }
          }
        }
        setOutput(${V});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L4e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;zb(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;q(ar(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=no(r.shape,i,o,u,a,l);if(h.filterWidth===1&&h.filterHeight===1&&jt(h.inShape,h.outShape))return ui({inputs:{x:r},backend:t});const f=new ey(h,"avg",!1);return t.runWebGLProgram(f,[r],"float32")}const V4e={kernelName:pT,backendName:"webgl",kernelFunc:L4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B4e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s,h=[1,1,1],f=Ll(r.shape,i,o,h,a,l,u),p=new I$(f,"avg",!1);return t.runWebGLProgram(p,[r],"float32")}const U4e={kernelName:mT,backendName:"webgl",kernelFunc:B4e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class z4e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,h=l-1-e.padInfo.top,f=u-1-e.padInfo.left,p=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${h}, ${f});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class G4e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,h=e.dilationWidth,f=e.effectiveFilterDepth,p=e.effectiveFilterHeight,g=e.effectiveFilterWidth,b=f-1-e.padInfo.front,T=p-1-e.padInfo.top,w=g-1-e.padInfo.left,_=1/(t*s*r);this.userCode=`
      const ivec3 pads = ivec3(${b}, ${T}, ${w});
      const float avgMultiplier = float(${_});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${g};
                wC += ${h}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H4e(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:h}=s,f=[1,1,1],p=Ll(o.shape,a,l,f,u,h),g=new G4e(p);return t.runWebGLProgram(g,[r],o.dtype)}const q4e={kernelName:nk,backendName:"webgl",kernelFunc:H4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W4e(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i;zb([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,h=no(o.shape,a,l,1,u),f=new z4e(h);return t.runWebGLProgram(f,[r],o.dtype)}const K4e={kernelName:tk,backendName:"webgl",kernelFunc:W4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X4e(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;return vw({a:r,b:i,transposeA:o,transposeB:a,backend:t})}const Y4e={kernelName:gT,backendName:"webgl",kernelFunc:X4e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J4e{constructor(e,t,s,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],pt(e,t),pt(e,s);let a="0.0";r!=null&&(pt(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(pt(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j4e{constructor(e,t,s,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],pt(e,t),pt(e,s);let a="vec4(0.0)";r!=null&&(pt(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(pt(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q4e=({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:r,variance:i,offset:o,scale:a}=n;q(r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),q(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),q(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=t;l==null&&(l=.001);const u=[s,r,i];let h=null;o!=null&&(h=o.shape,u.push(o));let f=null;a!=null&&(f=a.shape,u.push(a));const p=we().getBool("WEBGL_PACK_NORMALIZATION")?new j4e(s.shape,r.shape,i.shape,h,f,l):new J4e(s.shape,r.shape,i.shape,h,f,l);return e.runWebGLProgram(p,u,u[0].dtype)},Z4e={kernelName:NT,backendName:"webgl",kernelFunc:Q4e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eBe{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=fn(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=tBe(this.rank);let r;const i=e.map((o,a)=>`sourceLoc.${xC[a]} = start[${a}] + coords.${xC[a]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const xC=["x","y","z","w","u","v"];function tBe(n){if(n===1)return"sourceLoc";if(n<=6)return xC.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nBe{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=fn(this.rank),s=vr("coords",this.rank),r=vr("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((h,f)=>`start[${f}]`).join()});`:e.map((h,f)=>`${r[f]} = ${s[f]} + start[${f}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sBe(n,e,t,s){const r=s.texData.get(n.dataId),i=s.makeTensorInfo(t,n.dtype),o=s.texData.get(i.dataId);Object.assign(o,r),o.refCount=1,o.shape=t,o.dtype=n.dtype;let a=T2(e,Qe(n.shape));r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||n.dataId};const l=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,l+1),i}function Bp(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,size:o}=s,[a,l]=vx(r,i,o);if(b2(r,a,l),Ee(l)===0)return t.makeTensorInfo(l,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const f=t.texData.get(r.dataId),p=YLe(f.values,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,p)}const{isPacked:u}=t.texData.get(r.dataId),h=w2(r.shape,a,l);if(u||!h){const f=we().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nBe(l):new eBe(l),p=[a];return t.runWebGLProgram(f,[r],r.dtype,p)}return t.uploadToGPU(r.dataId),sBe(r,a,l,t)}const rBe={kernelName:sx,backendName:"webgl",kernelFunc:Bp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iBe=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,crops:o}=s;q(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((C,N)=>C*N),l=Ab(r.shape,i,a),u=kb(l.length,i.length),h=$b(r.shape,i,a),f=I2(o,i.length),p=C2(h,o,i.length),g=[],b=Ve({inputs:{x:r},backend:t,attrs:{shape:l}}),T=Er({inputs:{x:b},backend:t,attrs:{perm:u}}),w=Ve({inputs:{x:T},backend:t,attrs:{shape:h}}),_=Bp({inputs:{x:w},backend:t,attrs:{begin:f,size:p}});return g.push(b),g.push(T),g.push(w),g.forEach(C=>t.disposeIntermediateTensorInfo(C)),_},oBe={kernelName:yT,backendName:"webgl",kernelFunc:iBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aBe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o}=s,a=t.readSync(r.dataId),l=t.readSync(i.dataId),u=jX(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}const lBe={kernelName:sk,backendName:"webgl",kernelFunc:aBe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uBe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,cBe=`
  return float(int(a.r) & int(b.r));
`;function hBe(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,i=we().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=we().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([s,r])||o===1){const l=t.texData.get(s.dataId).values,u=t.texData.get(r.dataId).values,[h,f]=vLe(s.shape,r.shape,l,u,s.dtype),p=t.makeTensorInfo(f,s.dtype),g=t.texData.get(p.dataId);return g.values=h,p}let a;return i?a=new Lp(uBe,s.shape,r.shape,!1):a=new Qh(cBe,s.shape,r.shape),t.runWebGLProgram(a,[s,r],s.dtype)}const dBe={kernelName:rk,backendName:"webgl",kernelFunc:hBe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fBe(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,i=t.readSync(s.dataId),o=t.readSync(r.dataId),a=pt(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const pBe={kernelName:l5,backendName:"webgl",kernelFunc:fBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mBe="return float(a != b);",hY=Hs({opSnippet:mBe,cpuKernelImpl:BLe,dtype:"bool"}),gBe={kernelName:qT,backendName:"webgl",kernelFunc:hY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hb(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return ui({inputs:{x:r.complexTensorInfos.real},backend:t})}const yBe={kernelName:Ak,backendName:"webgl",kernelFunc:Hb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bBe="return float(int(x));";function vBe(n,e){const t=new pa(n.shape,bBe),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SC(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return ui({inputs:{x:r},backend:t});const o=ks(r.shape),a=SC({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),l=$c({inputs:{real:a,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const o=Hb({inputs:{input:r},backend:t}),a=SC({inputs:{x:o},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(o),a}if(!s5(r.dtype,i)){const o=ui({inputs:{x:r},backend:t});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(t.shouldExecuteOnCPU([r])){const o=t.texData.get(r.dataId).values,[a,l,u]=wLe(o,r.shape,r.dtype,i);return t.makeTensorInfo(a,l,u)}if(i==="int32")return vBe(r,t);if(i==="bool"){const o=t.makeTensorInfo([],"bool",ir("bool",1)),l=hY({inputs:{a:r,b:o},backend:t});return t.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const wBe={kernelName:Py,backendName:"webgl",kernelFunc:SC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aV="return ceil(x);",TBe=Vt({opSnippet:aV,packedOpSnippet:aV,cpuKernelImpl:TLe}),xBe={kernelName:Fy,backendName:"webgl",kernelFunc:TBe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SBe{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _Be{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EBe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{clipValueMin:i,clipValueMax:o}=s;let a;we().getBool("WEBGL_PACK_CLIP")?a=new _Be(r.shape):a=new SBe(r.shape);const l=[[i],[o]];return t.runWebGLProgram(a,[r],r.dtype,l)}const IBe={kernelName:Ly,backendName:"webgl",kernelFunc:EBe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CBe{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lV(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function NBe(n){const{inputs:e,backend:t}=n,{x:s}=e,r=t.texData.get(s.dataId),i=new CBe(s.shape),o=[lV(s,r.complexTensorInfos.real),lV(s,r.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}const ABe={kernelName:bT,backendName:"webgl",kernelFunc:NBe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kBe{constructor(e){this.outputShape=[],this.outputShape=_a(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let o=1;o<t.length;o++)t[o]=t[o-1]+e[o][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<t.length;o++){const a=t[o-1];s.push(`else if (yC < ${t[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const r=t.length,i=t[t.length-1];s.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Be{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=_a(e,t);const s=this.outputShape,r=s.length,i=fn(r),o=vr("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((T,w)=>`T${w}`);const l=new Array(e.length-1);l[0]=e[0][t];for(let T=1;T<l.length;T++)l[T]=l[T-1]+e[T][t];const u=a[t],h=a.slice(-2),f=a.join();let p=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${f}), vec2(${h.join()}));
        }`;for(let T=1;T<l.length;T++){const w=l[T-1];p+=`
        if (${u} < ${l[T]}  && ${u} >= ${l[T-1]}) {
          return getChannel(
            getT${T}(${L1(a,u,w)}),
            vec2(${L1(h,u,w)}));
        }`}const g=l.length,b=l[l.length-1];p+=`
        return getChannel(
          getT${g}(${L1(a,u,b)}),
          vec2(${L1(h,u,b)}));`,this.userCode=`
      float getValue(${a.map(T=>"int "+T)}) {
        ${p}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${s[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${s[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${s[r-2]} &&
            ${o[r-1]} < ${s[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function L1(n,e,t){const s=n.indexOf(e);return n.map((i,o)=>o===s?`${i} - ${t}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vx(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return ui({inputs:{x:r.complexTensorInfos.imag},backend:t})}const RBe={kernelName:Tk,backendName:"webgl",kernelFunc:Vx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function og(n,e,t){const s=n[0].dtype;if(s==="complex64"){const g=n.map(C=>Hb({inputs:{input:C},backend:t})),b=n.map(C=>Vx({inputs:{input:C},backend:t})),T=og(g,e,t),w=og(b,e,t),_=$c({inputs:{real:T,imag:w},backend:t});return g.forEach(C=>t.disposeIntermediateTensorInfo(C)),b.forEach(C=>t.disposeIntermediateTensorInfo(C)),t.disposeIntermediateTensorInfo(T),t.disposeIntermediateTensorInfo(w),_}let r=t.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const g=n.map(A=>{const V=[-1,Ee(A.shape.slice(e))];return Ve({inputs:{x:A},backend:t,attrs:{shape:V}})}),b=g.map(A=>({vals:t.readSync(A.dataId),shape:A.shape})),T=_a(g.map(A=>A.shape),1),w=g[0].shape[0]===1,_=xLe(b,T,s,w),C=_a(n.map(A=>A.shape),e),N=t.makeTensorInfo(C,s,_);return g.forEach(A=>t.disposeIntermediateTensorInfo(A)),N}const i=n.filter(g=>Ee(g.shape)>0),o=we().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const g=o?new pa(n[0].shape,Su):new Ou(n[0].shape,Su);return t.runWebGLProgram(g,n,s)}const a=we().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const g=[];for(let T=0;T<i.length;T+=a){const w=i.slice(T,T+a);g.push(og(w,e,t))}const b=og(g,e,t);for(const T of g)t.disposeIntermediateTensorInfo(T);return b}if(o){const g=new $Be(i.map(b=>b.shape),e);return t.runWebGLProgram(g,i,s)}const{tensors2D:l,outShape:u}=DBe(i,e,t),h=new kBe(l.map(g=>g.shape)),f=t.runWebGLProgram(h,l,s);l.forEach(g=>t.disposeIntermediateTensorInfo(g));const p=Ve({inputs:{x:f},attrs:{shape:u},backend:t});return t.disposeIntermediateTensorInfo(f),p}function DBe(n,e,t){const s=_a(n.map(i=>i.shape),e);return{tensors2D:n.map(i=>Ve({inputs:{x:i},attrs:{shape:[-1,Ee(i.shape.slice(e))]},backend:t})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dY(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,i=xt(r,e[0].shape)[0],o=e.map(u=>u.shape);S2(o,i);const a=_a(e.map(u=>u.shape),i);if(Ee(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>Ee(u.shape)>0);return l.length===1?ui({inputs:{x:l[0]},backend:t}):og(l,i,t)}const MBe={kernelName:vT,backendName:"webgl",kernelFunc:dY};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fY{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,h=e.dilationHeight,f=e.dilationWidth,p=e.filterHeight,g=e.filterWidth,b=Math.floor(e.inChannels/4)*4,T=e.inChannels%4,w=e.dataFormat==="channelsLast",_=w?1:2,C=w?2:3,N=w?3:1;let A="",P="";s&&(r?A=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?A=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:A=`
          float activation(float x) {
            ${s}
          }
        `,P="result = activation(result);");const V=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${A}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${N}];

        ivec2 xRCCorner =
            ivec2(coords[${_}], coords[${C}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${h};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${g}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${b}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${w}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${T===1}) {

              if (${w}) {
                dotProd +=
                    getX(batch, xR, xC, ${b}) *
                    getW(wR, wC, ${b}, d2);
              } else {
                dotProd +=
                    getX(batch, ${b}, xR, xC) *
                    getW(wR, wC, ${b}, d2);
              }

            } else if (${T===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${b}, d2),
                getW(wR, wC, ${b} + 1, d2)
              );

              if (${w}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${b}),
                  getX(batch, xR, xC, ${b} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${b}, xR, xC),
                  getX(batch, ${b} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${T===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${b}, d2),
                getW(wR, wC, ${b} + 1, d2),
                getW(wR, wC, ${b} + 2, d2)
              );

              if (${w}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${b}),
                  getX(batch, xR, xC, ${b} + 1),
                  getX(batch, xR, xC, ${b} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${b}, xR, xC),
                  getX(batch, ${b} + 1, xR, xC),
                  getX(batch, ${b} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${V}
        ${P}
        setOutput(result);
      }
    `}}class OBe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,h=e.dilationWidth,f=e.filterDepth,p=e.filterHeight,g=e.filterWidth,b=Math.floor(e.inChannels/4)*4,T=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${t}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${f}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${g}; wC++) {
              int xC = xCCorner + wC * ${h};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${b}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${T===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${b}) *
                  getW(wF, wR, wC, ${b}, d2);
              } else if (${T===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${b}),
                  getX(batch, xF, xR, xC, ${b} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${b}, d2),
                  getW(wF, wR, wC, ${b} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${T===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${b}),
                  getX(batch, xF, xR, xC, ${b} + 1),
                  getX(batch, xF, xR, xC, ${b} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${b}, d2),
                  getW(wF, wR, wC, ${b} + 1, d2),
                  getW(wF, wR, wC, ${b} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pY{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=lr(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,h=e.filterWidth,f=h;let p=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let w=0;w<h;w++)p+=`
           vec4 xTexelC${w*2};
           int xTexelC${w*2}Ready;
           vec4 xTexelC${w*2+1};
           int xTexelC${w*2+1}Ready;
           vec4 xC${w};`;p+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let w=0;w<h;w++)p+=`
           xTexelC${w*2} = vec4(0.0);
           xTexelC${w*2}Ready = 0;
           xTexelC${w*2+1} = vec4(0.0);
           xTexelC${w*2+1}Ready = 0;
           xC${w} = vec4(0.0);`;p+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let w=0;w<(f+1)/2;w++){const _=w*2;if(p+=`
           xC = xCCorner + ${_*l};
           `,a===1){if(_<h&&(o%2===1?(p+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${_}Ready == 0) {
                   xTexelC${_} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${_}.zw = vec2(0.0);
                   }
                   xTexelC${_}Ready = 1;
                 }
               `,l===1&&_>0?p+=`
                 xC${_} = vec4(xTexelC${_-2}.zw, xTexelC${_}.xy);
                 `:p+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${_} = vec4(previous.zw, xTexelC${_}.xy);
                   } else {
                     xC${_} = vec4(0.0, 0.0, xTexelC${_}.xy);
                   }
                   `):p+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${_}Ready == 0) {
                   xTexelC${_} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${_}.zw = vec2(0.0);
                   }
                   xTexelC${_}Ready = 1;
                 }

                 xC${_} = xTexelC${_};
                 `,_+1<h)){const C=o%2===0?KA(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(p+=`
                   xCOffset = xC + imod(pads[1], 2) + ${C};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${_+1}Ready == 0) {
                     xTexelC${_+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${_+1}.zw = vec2(0.0);
                     }
                     xTexelC${_+1}Ready = 1;
                   }
                   `,l>1?p+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${_+1} = vec4(previous.zw, xTexelC${_+1}.xy);
                     } else {
                      xC${_+1} = vec4(0.0, 0.0, xTexelC${_+1}.xy);
                     }
                     `:p+=`
                     xC${_+1} = vec4(xTexelC${_}.zw, xTexelC${_+1}.xy);
                     `):C===1?p+=`
                     xC${_+1} = xTexelC${_};
                     `:p+=`
                     xCOffset = xC + ${C};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${_+1}Ready == 0) {
                       xTexelC${_+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${_+1}.zw = vec2(0.0);
                       }
                       xTexelC${_+1}Ready = 1;
                     }

                     xC${_+1} = xTexelC${_+1};
                     `}}else _<h&&(o%2===1?(p+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${_}Ready == 0) {
                   xTexelC${_} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${_}.zw = vec2(0.0);
                   }
                   xTexelC${_}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${_+1}Ready == 0) {
                   xTexelC${_+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${_+1}.zw = vec2(0.0);
                   }
                   xTexelC${_+1}Ready = 1;
                 }

                 xC${_} = vec4(xTexelC${_}.zw, xTexelC${_+1}.zw);
               `,_+1<h&&(p+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${_+1} = vec4(xTexelC${_+1}.xy, final.xy);
                 `)):(p+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${_}Ready == 0) {
                   xTexelC${_} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${_}.zw = vec2(0.0);
                   }
                   xTexelC${_}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${_+1}Ready == 0) {
                   xTexelC${_+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${_+1}.zw = vec2(0.);
                   }
                   xTexelC${_+1}Ready = 1;
                 }

                 xC${_} = vec4(
                   xTexelC${_}.xy, xTexelC${_+1}.xy);
               `,_+1<h&&(p+=`
                   xC${_+1} = vec4(xTexelC${_}.zw, xTexelC${_+1}.zw);
                 `)));_<h&&(p+=`
             wTexel = getW(r, ${_}, d1, d2);
             dotProd += xC${_}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${_}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,_+1<h&&(p+=`
               wTexel = getW(r, ${_+1}, d1, d2);
               dotProd += xC${_+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${_+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}p+=`
     }
   `,p+=`
     }
   `,p+=`
     }
   `;let g="",b="";s&&(r?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:i?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:g=`vec4 activation(vec4 x) {
           ${s}
         }`,b="result = activation(result);");const T=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${g}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${p}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${T}
         ${b}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PBe{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=lr(this.outputShape.length);const{dataFormat:s}=t,r=Cr(),i=s==="channelsLast",o=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let h=0;h<=1;h++)for(let f=0;f<=1;f++)u+=`
          blockIndex = rc.z + ${f};
          pos = rc.y + ${h};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${h*2+f}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${h*2+f}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ww(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function mY({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=n.shape,u=s.texData.get(n.dataId),h=t.inChannels,f=l[0]*l[1]*l[2],p=t.outChannels,g=t.dataFormat==="channelsLast",b=!1,T=!1;let w;const _=[];if(i!=null){const A=ww(i.shape,g);A!=null&&(i=Ve({inputs:{x:i},backend:s,attrs:{shape:A}}),_.push(i))}if(r!=null){const A=ww(r.shape,g);A!=null&&(r=Ve({inputs:{x:r},backend:s,attrs:{shape:A}}),_.push(r))}if(!((f===1||p===1)&&h>aY)&&u.isPacked&&g&&u.texture!=null&&l[2]%2!==0&&jt(u.shape.slice(-3),l.slice(-3))){const A=l[0]*l[1]*(l[2]+1),P={dataId:n.dataId,shape:[1,A,t.inChannels],dtype:n.dtype},V=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,q(bw(u.shape,P.shape),()=>`packed reshape ${u.shape} to ${P.shape} isn't free`);const D=Ve({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});_.push(D);const M=vw({a:P,b:D,backend:s,transposeA:b,transposeB:T,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),$=s.texData.get(M.dataId);q($.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=V,$.shape=t.outShape,w=ui({inputs:{x:M},backend:s}),w.shape=t.outShape,_.push(M)}else{const A=t.outHeight*t.outWidth,P=Ve({inputs:{x:n},backend:s,attrs:{shape:g?[t.batchSize,A,t.inChannels]:[t.batchSize,t.inChannels,A]}}),V=Ve({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),D=vw({a:g?P:V,b:g?V:P,transposeA:!g,transposeB:T,backend:s,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o});w=Ve({inputs:{x:D},backend:s,attrs:{shape:t.outShape}}),_.push(P),_.push(V),_.push(D)}for(const A of _)s.disposeIntermediateTensorInfo(A);return w}function gY({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:h,outWidth:f,outHeight:p,dataFormat:g}=t,b=g==="channelsLast",T=l*u*h,w=p*f,_=[t.batchSize,T,w],C=!0,N=!1,A=[];if(i!=null){const re=ww(i.shape,b);re!=null&&(i=Ve({inputs:{x:i},backend:s,attrs:{shape:re}}),A.push(i))}if(r!=null){const re=ww(r.shape,b);re!=null&&(r=Ve({inputs:{x:r},backend:s,attrs:{shape:re}}),A.push(r))}const P=Ve({inputs:{x:e},backend:s,attrs:{shape:[1,T,Ee(e.shape)/T]}});A.push(P);const V=new PBe(_,t),D=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],M=s.runWebGLProgram(V,[n],"float32",D),$=Ve({inputs:{x:M},backend:s,attrs:{shape:_}});A.push(M),A.push($);const O=r!=null,k=i!=null,z=a==="leakyrelu",U=a?Zg(a,!0):null,te=new oY(b?$.shape:P.shape,b?P.shape:$.shape,b?[t.batchSize,w,t.outChannels]:[t.batchSize,t.outChannels,w],C,N,O,U,k,z),se=b?[$,P]:[P,$];if(r&&se.push(r),k&&se.push(i),z){const re=s.makeTensorInfo([],"float32",Sc(o,"float32"));se.push(re),A.push(re)}const X=s.runWebGLProgram(te,se,"float32"),Q=Ve({inputs:{x:X},backend:s,attrs:{shape:t.outShape}});A.push(X);for(const re of A)s.disposeIntermediateTensorInfo(re);return Q}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FBe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:h}=s,f=Vl(l),p=zs(r.shape,i.shape,o,u,a,h,!1,f);let g;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))g=mY({x:r,filter:i,convInfo:p,backend:t});else if(p.strideWidth<=2&&f==="channelsLast"&&we().getBool("WEBGL_EXP_CONV")){const T=new pY(p),w=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];g=t.runWebGLProgram(T,[r,i],"float32",w)}else if(we().getBool("WEBGL_CONV_IM2COL"))g=gY({x:r,filter:i,convInfo:p,backend:t});else{const T=new fY(p);g=t.runWebGLProgram(T,[r,i],"float32")}const b=Ve({inputs:{x:g},backend:t,attrs:{shape:p.outShape}});return t.disposeIntermediateTensorInfo(g),b}const LBe={kernelName:wT,backendName:"webgl",kernelFunc:FBe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VBe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class BBe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,l=s-1-e.padInfo.left,u=o?1:2,h=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${f}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${h}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class UBe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class zBe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=t-1-e.padInfo.front,u=s-1-e.padInfo.top,h=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${h});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GBe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:h}=s,f=Vl(l),p=zs(r.shape,h,o,1,a,u,!1,f),g=new VBe(p);return t.runWebGLProgram(g,[r,i],"float32")}const HBe={kernelName:ok,backendName:"webgl",kernelFunc:GBe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qBe{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=lr(this.outputShape.length);const t=e.filterHeight,s=e.filterWidth,r=t-1-e.padInfo.top,i=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WBe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:h}=s,f=Vl(u),p=zs(o,i.shape,a,1,l,h,!1,f);if(we().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&f==="channelsLast"){const g=[[p.strideHeight,p.strideWidth]],b=new qBe(p);return t.runWebGLProgram(b,[r,i],"float32",g)}else{const g=new BBe(p);return t.runWebGLProgram(g,[r,i],"float32")}}const KBe={kernelName:TT,backendName:"webgl",kernelFunc:WBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XBe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=_c(r.shape,i.shape,o,l,a),h=new OBe(u);return t.runWebGLProgram(h,[r,i],"float32")}const YBe={kernelName:xT,backendName:"webgl",kernelFunc:XBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JBe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s,u=_c(r.shape,l,o,1,a),h=new UBe(u);return t.runWebGLProgram(h,[r,i],"float32")}const jBe={kernelName:ak,backendName:"webgl",kernelFunc:JBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QBe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s,u=_c(l,i.shape,a,1,o),h=new zBe(u);return t.runWebGLProgram(h,[r,i],"float32")}const ZBe={kernelName:lk,backendName:"webgl",kernelFunc:QBe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eUe=Vp+`
  return cos(x);
`,tUe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${hd}
  return result;
`,nUe=Vt({opSnippet:eUe,packedOpSnippet:tUe}),sUe={kernelName:Vy,backendName:"webgl",kernelFunc:nUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rUe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,iUe=Vt({opSnippet:rUe}),oUe={kernelName:By,backendName:"webgl",kernelFunc:iUe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aUe{constructor(e,t,s,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,u]=e,[h]=t,[f,p]=s;this.outputShape=[h,f,p,u];const g=r==="bilinear"?1:0,[b,T]=[`${a-1}.0`,`${l-1}.0`],[w,_,C]=f>1?[`${(a-1)/(f-1)}`,"(y2-y1) * height_ratio",`y1*${b} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${b}`],[N,A,P]=p>1?[`${(l-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${T} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${T}`];this.userCode=`
      const float height_ratio = float(${w});
      const float width_ratio = float(${N});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${_};
        float width_scale = ${A};

        float in_y = ${C};
        if( in_y < 0.0 || in_y > ${b} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${P};
        if( in_x < 0.0 || in_x > ${T} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${g} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lUe=n=>{const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,h=new aUe(r.shape,i.shape,a,l,u);return t.runWebGLProgram(h,[r,i,o],"float32")},uUe={kernelName:ck,backendName:"webgl",kernelFunc:lUe};var ty;(function(n){n.Prod="*",n.Sum="+"})(ty||(ty={}));class uV{constructor(e,t,s,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===ty.Prod?"1.0":"0.0",a=s?o:`getX(${cV(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",h="";s?(u=r?`end != ${l-1}`:"end != 0",h=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${l}`:"end >= pow2",h=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${fn(i)} coords = getOutputCoords();
        int end = ${hV(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${h};
          ${hV(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${cV(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function cV(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function hV(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yY(n,e,t,s,r,i){const o=e.shape.length,a=zn([s],o);let l=e;a!=null&&(l=Er({inputs:{x:e},backend:t,attrs:{perm:a}}));const u=Yn(1,o)[0];if(u!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const h=l.shape[u];let f=ui({inputs:{x:l},backend:t});for(let p=0;p<=Math.ceil(Math.log2(h))-1;p++){const g=new uV(n,l.shape,!1,i),b=[[p]],T=f;f=t.runWebGLProgram(g,[f],f.dtype,b),t.disposeIntermediateTensorInfo(T)}if(r){const p=new uV(n,l.shape,r,i),g=f;f=t.runWebGLProgram(p,[f],f.dtype),t.disposeIntermediateTensorInfo(g)}if(a!=null){const p=Ec(a),g=Er({inputs:{x:f},backend:t,attrs:{perm:p}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(l),g}return f}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cUe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return yY(ty.Prod,r,t,i,o,a)}const hUe={kernelName:uk,backendName:"webgl",kernelFunc:cUe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dUe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return yY(ty.Sum,r,t,i,o,a)}const fUe={kernelName:ST,backendName:"webgl",kernelFunc:dUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pUe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=t.readSync(r.dataId),u=t.readSync(i.dataId),h=jX(l,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,h)}else if(r.shape.length===2){const l=t.bufferSync(r),u=t.bufferSync(i),h=bLe(l,u,o,a);return t.makeTensorInfo(h.shape,i.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const mUe={kernelName:hk,backendName:"webgl",kernelFunc:pUe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gUe{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yUe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:i,dataFormat:o}=s,a=r.shape[0],l=o==="NHWC"?r.shape[1]:r.shape[2],u=o==="NHWC"?r.shape[2]:r.shape[3],h=o==="NHWC"?r.shape[3]:r.shape[1],f=l*i,p=u*i,g=h/(i*i),b=o==="NHWC"?[a,f,p,g]:[a,g,f,p],T=new gUe(b,i,o);return t.runWebGLProgram(T,[r],r.dtype)}const bUe={kernelName:dk,backendName:"webgl",kernelFunc:yUe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bY{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=lr(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let u="",h="";s&&(r?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:u=`
          float activation(float x) {
            ${s}
          }
        `,h="result = activation(result);");const f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${f}
        ${h}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vY{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=lr(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,h=e.filterHeight,f=e.filterWidth,p=f;let g=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let _=0;_<f;_++)g+=`
          vec4 xTexelC${_*2};
          int xTexelC${_*2}Ready;
          vec4 xTexelC${_*2+1};
          int xTexelC${_*2+1}Ready;
          vec4 xC${_};`;g+=`
    for (int r = 0; r < ${h}; r++) {
      `;for(let _=0;_<f;_++)g+=`
          xTexelC${_*2} = vec4(0.0);
          xTexelC${_*2}Ready = 0;
          xTexelC${_*2+1} = vec4(0.0);
          xTexelC${_*2+1}Ready = 0;
          xC${_} = vec4(0.0);`;g+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let _=0;_<(p+1)/2;_++){const C=_*2;if(g+=`
          xC = xCCorner + ${C*u};
          `,l===1){if(C<f&&(a%2===1?(g+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }
              `,u===1&&C>0?g+=`
                xC${C} = vec4(xTexelC${C-2}.zw, xTexelC${C}.xy);
                `:g+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${C} = vec4(previous.zw, xTexelC${C}.xy);
                  } else {
                    xC${C} = vec4(0.0, 0.0, xTexelC${C}.xy);
                  }
                  `):g+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                xC${C} = xTexelC${C};
                `,C+1<f)){const N=a%2===0?KA(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(g+=`
                  xCOffset = xC + imod(pads[1], 2) + ${N};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                    xTexelC${C+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${C+1}.zw = vec2(0.0);
                    }
                    xTexelC${C+1}Ready = 1;
                  }
                  `,u>1?g+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${C+1} = vec4(previous.zw, xTexelC${C+1}.xy);
                    } else {
                     xC${C+1} = vec4(0.0, 0.0, xTexelC${C+1}.xy);
                    }
                    `:g+=`
                    xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.xy);
                    `):N===1?g+=`
                    xC${C+1} = xTexelC${C};
                    `:g+=`
                    xCOffset = xC + ${N};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                      xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${C+1}.zw = vec2(0.0);
                      }
                      xTexelC${C+1}Ready = 1;
                    }

                    xC${C+1} = xTexelC${C+1};
                    `}}else C<f&&(a%2===1?(g+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${C+1}Ready == 0) {
                  xTexelC${C+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${C+1}.zw = vec2(0.0);
                  }
                  xTexelC${C+1}Ready = 1;
                }

                xC${C} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
              `,C+1<f&&(g+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${C+1} = vec4(xTexelC${C+1}.xy, final.xy);
                `)):(g+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                  xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C+1}.zw = vec2(0.);
                  }
                  xTexelC${C+1}Ready = 1;
                }

                xC${C} = vec4(
                  xTexelC${C}.xy, xTexelC${C+1}.xy);
              `,C+1<f&&(g+=`
                  xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
                `)));C<f&&(g+=`
            wTexel = getW(r, ${C}, d1, q);
            dotProd += xC${C} * vec4(wTexel.xz, wTexel.xz);
          `,C+1<f&&(g+=`
              wTexel = getW(r, ${C+1}, d1, q);
              dotProd += xC${C+1} * vec4(wTexel.xz, wTexel.xz);
            `))}g+=`
    }
  `,g+=`
      }
    `;let b="",T="";s&&(r?b=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?b=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:b=`vec4 activation(vec4 x) {
          ${s}
        }`,T="result = activation(result);");const w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${b}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${g}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${w}
        ${T}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vUe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;let h=l;h==null&&(h=[1,1]),q(ar(o,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`);const f=zs(r.shape,i.shape,o,h,a,u,!0);let p;we().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?p=new vY(f):p=new bY(f);const g=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(p,[r,i],"float32",g)}const wUe={kernelName:_T,backendName:"webgl",kernelFunc:vUe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TUe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class xUe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SUe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:h}=s,f=zs(r.shape,h,o,a,l,u,!0),p=new TUe(f);return t.runWebGLProgram(p,[r,i],"float32")}const _Ue={kernelName:fk,backendName:"webgl",kernelFunc:SUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EUe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:h}=s,f=zs(h,i.shape,o,a,l,u,!0),p=new xUe(f);return t.runWebGLProgram(p,[r,i],"float32")}const IUe={kernelName:pk,backendName:"webgl",kernelFunc:EUe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CUe{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NUe(n){const{inputs:e,backend:t}=n,{x:s}=e,r=[...s.shape,...s.shape],i=Ee(s.shape),o=Ve({inputs:{x:s},backend:t,attrs:{shape:[i]}}),a=new CUe(i),l=t.runWebGLProgram(a,[o],o.dtype),u=Ve({inputs:{x:l},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),u}const AUe={kernelName:u5,backendName:"webgl",kernelFunc:NUe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kUe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:h}=e,{top:f,left:p}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${f}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${h};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ue(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=_b(r.shape,i.shape,o,a,"NHWC",l);let h;const f=new kUe(u);h=t.runWebGLProgram(f,[r,i],"float32");const p=Ve({inputs:{x:h},backend:t,attrs:{shape:u.outShape}});return t.disposeIntermediateTensorInfo(h),p}const RUe={kernelName:ET,backendName:"webgl",kernelFunc:$Ue};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DUe(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=O2(r,i.length);F2(o.length,l,i);const{path:u,steps:h}=L2(a,l),f=h.length;let p=null,g=o.length;const b=[];for(let T=0;T<f;++T){for(const w of h[T]){const{permutationIndices:_,expandDims:C}=P2(g,l[w]);let N;V2(_)?N=i[w]:(N=Er({inputs:{x:i[w]},backend:t,attrs:{perm:_}}),b.push(N));const A=N.shape.slice();for(let P=0;P<C.length;++P)A.splice(C[P],0,1);jt(N.shape,A)||(N=Ve({inputs:{x:N},backend:t,attrs:{shape:A}}),b.push(N)),p===null?p=N:(p=E$({inputs:{a:N,b:p},backend:t}),b.push(p))}T<f-1&&(u[T]>=0&&(p=Lx({inputs:{x:p},backend:t,attrs:{axis:u[T]-(o.length-g),keepDims:!1}}),b.push(p)),g--)}for(const T of b)T!==p&&t.disposeIntermediateTensorInfo(T);return p}const MUe={kernelName:mk,backendName:"webgl",kernelFunc:DUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OUe="return (x >= 0.0) ? x : (exp(x) - 1.0);",PUe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,FUe=Vt({opSnippet:OUe,packedOpSnippet:PUe}),LUe={kernelName:zy,backendName:"webgl",kernelFunc:FUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VUe="return (b >= 0.0) ? a : a * (b + 1.0);",BUe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,UUe=n=>{const{inputs:e,backend:t}=n,{dy:s,y:r}=e,i=we().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Lp(BUe,s.shape,r.shape):new Qh(VUe,s.shape,r.shape);return t.runWebGLProgram(i,[s,r],s.dtype)},zUe={kernelName:gk,backendName:"webgl",kernelFunc:UUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GUe=`
  return vec4(equal(a, b));
`,HUe="return float(a == b);",qUe=Hs({opSnippet:HUe,packedOpSnippet:GUe,dtype:"bool",cpuKernelImpl:SLe}),WUe={kernelName:IT,backendName:"webgl",kernelFunc:qUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KUe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${N2};
  float a1 = ${A2};
  float a2 = ${k2};
  float a3 = ${$2};
  float a4 = ${R2};
  float a5 = ${D2};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,XUe=Vt({opSnippet:KUe}),YUe={kernelName:Gy,backendName:"webgl",kernelFunc:XUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JUe=Vp+`
  return exp(x);
`,jUe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,wY=Vt({opSnippet:JUe,packedOpSnippet:jUe,cpuKernelImpl:_Le,dtype:"float32"}),QUe={kernelName:Hy,backendName:"webgl",kernelFunc:wY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _C(n){const{inputs:e,attrs:t,backend:s}=n,{dim:r}=t,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=r;return r<0&&(q(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+r+1),a.splice(l,0,1),Ve({inputs:{x:i},backend:s,attrs:{shape:a}})}const ZUe={kernelName:CT,backendName:"webgl",kernelFunc:_C};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dV="return exp(x) - 1.0;",eze=Vt({opSnippet:dV,packedOpSnippet:dV,cpuKernelImpl:ELe}),tze={kernelName:qy,backendName:"webgl",kernelFunc:eze};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fV{constructor(e,t,s){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const i=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TY(n,e,t){const s=t.texData.get(n.dataId),r=Ee(n.shape),i=n.shape[n.shape.length-1],o=r/i,a=Ve({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),l=a.shape,u=new fV("real",l,e),h=new fV("imag",l,e),f=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],p=t.runWebGLProgram(u,f,"float32"),g=t.runWebGLProgram(h,f,"float32"),b=$c({inputs:{real:p,imag:g},backend:t});t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g);const T=Ve({inputs:{x:b},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(b),T}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nze(n){const{inputs:e,backend:t}=n,{input:s}=e;return TY(s,!1,t)}const sze={kernelName:yk,backendName:"webgl",kernelFunc:nze};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rze{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qb(n){const{backend:e,attrs:t}=n,{shape:s,value:r}=t;let{dtype:i}=t;if(i=i||_p(r),i==="string"){const o=Wn(i,Ee(s));return o.fill(r),e.makeTensorInfo(s,i,o)}else{const o=new rze(s,r),a=[[r]];return e.runWebGLProgram(o,[],i,a)}}const ize={kernelName:bk,backendName:"webgl",kernelFunc:qb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oze{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aze={kernelName:vk,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,r=new oze(t.shape);return s.runWebGLProgram(r,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pV="return floor(x);",lze=Vt({opSnippet:pV,packedOpSnippet:pV,cpuKernelImpl:ILe}),uze={kernelName:Wy,backendName:"webgl",kernelFunc:lze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cze=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,hze=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,dze=Hs({opSnippet:cze,packedOpSnippet:hze,dtype:"int32"}),fze={kernelName:Ky,backendName:"webgl",kernelFunc:dze};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pze{constructor(e){this.variableNames=["A"];const t=Cr(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mze{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=Cr(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gze={kernelName:jTe,backendName:"webgl",kernelFunc:yze};let sf,IE=we().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function yze(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:r}=e;const{numChannels:i}=s,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,u]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],h=[u,l],f=[u,l,i];if(a||o){const T=we().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(sf==null||T!==IE)&&(IE=T,sf=document.createElement("canvas").getContext("2d",{willReadFrequently:IE})),sf.canvas.width=l,sf.canvas.height=u,sf.drawImage(r,0,0,l,u),r=sf.canvas}const p=t.makeTensorInfo(h,"int32");t.texData.get(p.dataId).usage=Si.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(p.dataId),r);const g=we().getBool("WEBGL_PACK")?new mze(f):new pze(f),b=t.runWebGLProgram(g,[p],"int32");return t.disposeData(p.dataId),b}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bze(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:h,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:b}=s,T=Vl(h),w=zs(r.shape,i.shape,l,f,u,p,!1,T);let _;const C=[],N=o!=null,A=a!=null,P=g==="leakyrelu",V=()=>{const M=[r,i],$=(O,k)=>{if(k==="NCHW"&&O.shape.length===1&&O.shape[0]!==1){const z=Ve({inputs:{x:O},backend:t,attrs:{shape:[O.shape[0],1,1]}});return C.push(z),z}return O};if(N&&M.push($(o,h)),A&&M.push($(a,h)),P){const O=t.makeTensorInfo([],"float32",Sc(b,"float32"));M.push(O),C.push(O)}return M};if(w.filterHeight===1&&w.filterWidth===1&&w.dilationHeight===1&&w.dilationWidth===1&&w.strideHeight===1&&w.strideWidth===1&&(w.padInfo.type==="SAME"||w.padInfo.type==="VALID"))_=mY({x:r,filter:i,convInfo:w,backend:t,bias:o,activation:g,preluActivationWeights:a,leakyreluAlpha:b});else if(w.strideWidth<=2&&T==="channelsLast"&&we().getBool("WEBGL_EXP_CONV")){const M=g?Zg(g,!0):null,$=new pY(w,N,M,A,P),O=[[w.padInfo.top,w.padInfo.left],[w.strideHeight,w.strideWidth],[w.dilationHeight,w.dilationWidth],[w.inHeight,w.inWidth]],k=V();_=t.runWebGLProgram($,k,"float32",O)}else if(we().getBool("WEBGL_CONV_IM2COL"))_=gY({x:r,filter:i,convInfo:w,backend:t,bias:o,activation:g,preluActivationWeights:a,leakyreluAlpha:b});else{const M=g?Zg(g,!1):null,$=new fY(w,N,M,A,P),O=V();_=t.runWebGLProgram($,O,"float32")}const D=Ve({inputs:{x:_},backend:t,attrs:{shape:w.outShape}});return C.push(_),C.forEach(M=>t.disposeIntermediateTensorInfo(M)),D}const vze={kernelName:Jv,backendName:"webgl",kernelFunc:bze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wze(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:h,dimRoundingMode:f,activation:p,leakyreluAlpha:g}=s,b=[];let T=h;T==null&&(T=[1,1]),q(ar(l,T),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${T}'`);const w=zs(r.shape,i.shape,l,T,u,f,!0),_=we().getBool("WEBGL_PACK_DEPTHWISECONV")&&w.strideWidth<=2&&w.outChannels/w.inChannels===1,C=p?Zg(p,_):null,N=[r,i],A=o!=null,P=a!=null,V=p==="leakyrelu";if(A&&N.push(o),P&&N.push(a),V){const O=t.makeTensorInfo([],"float32",Sc(g,"float32"));N.push(O),b.push(O)}let D;_?D=new vY(w,A,C,P,V):D=new bY(w,A,C,P,V);const M=[[w.padInfo.top,w.padInfo.left],[w.strideHeight,w.strideWidth],[w.dilationHeight,w.dilationWidth],[w.inHeight,w.inWidth]],$=t.runWebGLProgram(D,N,"float32",M);return b.forEach(O=>t.disposeIntermediateTensorInfo(O)),$}const Tze={kernelName:N5,backendName:"webgl",kernelFunc:wze};class xze{constructor(e,t,s,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const i=fn(s.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sze(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,i=r.shape,o=i[i.length-1],a=Ee(s.shape),[l,u,h,f]=y2(s,r),p=Ve({inputs:{x:r},backend:t,attrs:{shape:[u,o]}}),g=Ve({inputs:{x:s},backend:t,attrs:{shape:[Ee(s.shape)/h,h]}});if(t.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const _=t.readSync(r.dataId),C=t.bufferSync(s),N=CLe(_,C,s.dtype,u,o,h,f,s.shape,a);return t.makeTensorInfo(l,s.dtype,N.values)}const b=new xze(o,f,[u,h],s.shape),T=t.runWebGLProgram(b,[g,p],g.dtype),w=Ve({inputs:{x:T},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(T),w}const _ze={kernelName:c5,backendName:"webgl",kernelFunc:Sze};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Eze{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=fn(this.rank),r=Ize(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function Ize(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${t[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:i}=e,{axis:o,batchDims:a}=s,l=xt(o,r.shape)[0];if(we().get("DEBUG")){const C=t.readSync(i.dataId),N=r.shape[l];for(let A=0;A<C.length;++A){const P=C[A];q(P<=N-1&&P>=0,()=>`GatherV2: the index value ${P} is not in [0, ${N-1}]`)}}const u=U2(r,i,l,a),h=Ee(i.shape),f=[],p=Ve({inputs:{x:r},backend:t,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),g=Ve({inputs:{x:i},backend:t,attrs:{shape:[u.batchSize,h/u.batchSize]}});f.push(p),f.push(g);const b=[u.batchSize,u.outerSize,h/u.batchSize,u.sliceSize];if(t.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const C=t.bufferSync(g),N=t.bufferSync(p),A=NLe(N,C,b);return f.forEach(P=>t.disposeIntermediateTensorInfo(P)),t.makeTensorInfo(u.outputShape,A.dtype,A.values)}const T=new Eze(p.shape,b),w=t.runWebGLProgram(T,[p,g],p.dtype);f.push(w);const _=Ve({inputs:{x:w},backend:t,attrs:{shape:u.outputShape}});return f.forEach(C=>t.disposeIntermediateTensorInfo(C)),_}const Cze={kernelName:AT,backendName:"webgl",kernelFunc:xY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nze="return float(a > b);",Aze=`
  return vec4(greaterThan(a, b));
`,kze=Hs({opSnippet:Nze,packedOpSnippet:Aze,cpuKernelImpl:ALe,dtype:"bool"}),$ze={kernelName:kT,backendName:"webgl",kernelFunc:kze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rze="return float(a >= b);",Dze=`
  return vec4(greaterThanEqual(a, b));
`,Mze=Hs({opSnippet:Rze,packedOpSnippet:Dze,dtype:"bool",cpuKernelImpl:kLe}),Oze={kernelName:Xy,backendName:"webgl",kernelFunc:Mze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pze(n){const{inputs:e,backend:t}=n,{input:s}=e;return TY(s,!0,t)}const Fze={kernelName:wk,backendName:"webgl",kernelFunc:Pze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lze="return float(!isnan(x) && !isinf(x));",Vze=Vt({opSnippet:Lze,dtype:"bool"}),Bze={kernelName:Jy,backendName:"webgl",kernelFunc:Vze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uze="return float(isinf(x));",zze=Vt({opSnippet:Uze,dtype:"bool"}),Gze={kernelName:jy,backendName:"webgl",kernelFunc:zze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hze="return float(isnan(x));",qze=Vt({opSnippet:Hze,dtype:"bool"}),Wze={kernelName:Qy,backendName:"webgl",kernelFunc:qze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kze="return float(a < b);",Xze=`
  return vec4(lessThan(a, b));
`,Yze=Hs({opSnippet:Kze,packedOpSnippet:Xze,cpuKernelImpl:$Le,dtype:"bool"}),Jze={kernelName:RT,backendName:"webgl",kernelFunc:Yze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jze="return float(a <= b);",Qze=`
  return vec4(lessThanEqual(a, b));
`,Zze=Hs({opSnippet:jze,packedOpSnippet:Qze,cpuKernelImpl:RLe,dtype:"bool"}),eGe={kernelName:DT,backendName:"webgl",kernelFunc:Zze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tGe(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:i}=t,o=DLe(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const nGe={kernelName:h5,backendName:"webgl",kernelFunc:tGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sGe=Vp+`
  return x < 0.0 ? 0./0. : log(x);
`,rGe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,iGe=Vt({opSnippet:sGe,packedOpSnippet:rGe,cpuKernelImpl:MLe}),oGe={kernelName:Zy,backendName:"webgl",kernelFunc:iGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aGe=Vp+`
  return log(1.0 + x);
`,lGe=Vt({opSnippet:aGe}),uGe={kernelName:eb,backendName:"webgl",kernelFunc:lGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cGe="return float(a >= 1.0 && b >= 1.0);",hGe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,dGe=Hs({opSnippet:cGe,packedOpSnippet:hGe,dtype:"bool"}),fGe={kernelName:MT,backendName:"webgl",kernelFunc:dGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pGe="return float(!(x >= 1.0));",mGe=Vt({opSnippet:pGe}),gGe={kernelName:OT,backendName:"webgl",kernelFunc:mGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yGe="return float(a >= 1.0 || b >= 1.0);",bGe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,vGe=Hs({opSnippet:yGe,packedOpSnippet:bGe,dtype:"bool"}),wGe={kernelName:PT,backendName:"webgl",kernelFunc:vGe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TGe{constructor(e,t,s,r,i){this.variableNames=["x"],this.outputShape=[];const o=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xGe{constructor(e,t,s,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SGe=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s,u=we().getBool("WEBGL_PACK_NORMALIZATION")?new xGe(r.shape,i,o,a,l):new TGe(r.shape,i,o,a,l);return t.runWebGLProgram(u,[r],r.dtype)},_Ge={kernelName:FT,backendName:"webgl",kernelFunc:SGe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EGe{constructor(e,t,s,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IGe=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:h}=s,f=new EGe(r.shape,a,l,u,h);return t.runWebGLProgram(f,[r,i,o],r.dtype)},CGe={kernelName:xk,backendName:"webgl",kernelFunc:IGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NGe(n,e,t,s){const r=Ee(e),o=Ee(n.shape)/r,a=Ve({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),l=dd(a,n.dtype,"max",s),u=Ve({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=r.shape.length,l=xt(i,r.shape);let u=l;const h=zn(u,a),f=h!=null,p=t.shouldExecuteOnCPU([r]);let g=r;if(f){if(p){const N=t.texData.get(g.dataId).values,A=new Array(a);for(let D=0;D<A.length;D++)A[D]=r.shape[h[D]];const P=S$(N,r.shape,r.dtype,h,A);g=t.makeTensorInfo(A,r.dtype);const V=t.texData.get(g.dataId);V.values=P}else g=Fx(r,h,t);u=Yn(u.length,a)}Gs("max",u,a);const[b,T]=Ds(g.shape,u);let w=b;o&&(w=os(b,l));let _;if(p){const N=t.texData.get(g.dataId).values,A=OLe(N,Ee(T),w,r.dtype);_=t.makeTensorInfo(w,r.dtype);const P=t.texData.get(_.dataId);P.values=A}else _=NGe(g,T,w,t);return f&&t.disposeIntermediateTensorInfo(g),_}const AGe={kernelName:LT,backendName:"webgl",kernelFunc:SY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kGe=_$+`
  return max(a, b);
`,$Ge=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+hd+`
  return result;
`,RGe=Hs({opSnippet:kGe,packedOpSnippet:$Ge,cpuKernelImpl:PLe}),DGe={kernelName:tb,backendName:"webgl",kernelFunc:RGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MGe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;zb(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;q(ar(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=no(r.shape,i,o,u,a,l);if(h.filterWidth===1&&h.filterHeight===1&&jt(h.inShape,h.outShape))return ui({inputs:{x:r},backend:t});const f=new ey(h,"max",!1);return t.runWebGLProgram(f,[r],r.dtype)}const OGe={kernelName:VT,backendName:"webgl",kernelFunc:MGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PGe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:u}=s,h=[1,1,1],f=Ll(r.shape,i,o,h,a,u,l),p=new I$(f,"max",!1);return t.runWebGLProgram(p,[r],r.dtype)}const FGe={kernelName:BT,backendName:"webgl",kernelFunc:PGe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LGe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,l=o-1-e.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class VGe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=l-1-e.padInfo.front,p=u-1-e.padInfo.top,g=h-1-e.padInfo.left,b=l*u*h-1;this.userCode=`
      const ivec3 pads = ivec3(${f}, ${p}, ${g});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${h};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${b} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${h} +
                  wR * ${h} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BGe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:h}=s,f=[1,1,1],p=Ll(o.shape,a,l,f,u,h),g=new I$(p,"max",!0),b=t.runWebGLProgram(g,[o],o.dtype),T=new VGe(p),w=t.runWebGLProgram(T,[r,b],o.dtype);return t.disposeIntermediateTensorInfo(b),w}const UGe={kernelName:_k,backendName:"webgl",kernelFunc:BGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zGe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i,output:o}=e,a=i;zb([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:h,dimRoundingMode:f}=s,p=no(a.shape,l,u,1,h,f),g=!0,b=new ey(p,"max",g),T=t.runWebGLProgram(b,[a],a.dtype),w=new LGe(p),_=t.runWebGLProgram(w,[r,T],a.dtype);return t.disposeIntermediateTensorInfo(T),_}const GGe={kernelName:Sk,backendName:"webgl",kernelFunc:zGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HGe(n,e,t,s){let r=new ey(t,"max",!1);const i=s.runWebGLProgram(r,[n],"float32");r=new ey(t,"max",!0,!0,e);const o=s.runWebGLProgram(r,[n],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qGe={kernelName:d5,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;q(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const u=[1,1];q(ar(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const h=no(s.shape,r,i,u,o),[f,p]=HGe(s,a,h,l);return[f,p]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WGe(n,e,t,s){const r=Ee(e),o=Ee(n.shape)/r,a=Ve({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),l=dd(a,"float32","mean",s),u=Ve({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KGe={kernelName:UT,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:r,axis:i}=e,o=t,a=s.shape.length,l=xt(i,s.shape);let u=l;const h=zn(u,a),f=h!=null,p=o.shouldExecuteOnCPU([s]),g=[];let b=s;if(f){if(p){const A=o.texData.get(b.dataId).values,P=new Array(a);for(let M=0;M<P.length;M++)P[M]=s.shape[h[M]];const V=S$(A,s.shape,s.dtype,h,P);b=o.makeTensorInfo(P,s.dtype);const D=o.texData.get(b.dataId);D.values=V}else b=Fx(s,h,o);g.push(b),u=Yn(u.length,a)}Gs("sum",u,a);const[T,w]=Ds(b.shape,u);let _=T;r&&(_=os(T,l));const C=WGe(b,w,_,o);for(const N of g)o.disposeIntermediateTensorInfo(N);return C}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XGe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=xt(i,r.shape);let u=l;const h=zn(u,a);let f=r;h!=null&&(f=Er({inputs:{x:r},backend:t,attrs:{perm:h}}),u=Yn(u.length,r.shape.length)),Gs("min",u,a);const[p,g]=Ds(f.shape,u),b=Ee(g),T=Ve({inputs:{x:f},backend:t,attrs:{shape:[-1,b]}}),w=dd(T,T.dtype,"min",t);let _;if(o){const C=os(p,l);_=Ve({inputs:{x:w},backend:t,attrs:{shape:C}})}else _=Ve({inputs:{x:w},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(T),t.disposeIntermediateTensorInfo(w),h!=null&&t.disposeIntermediateTensorInfo(f),_}const YGe={kernelName:zT,backendName:"webgl",kernelFunc:XGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JGe=_$+`
  return min(a, b);
`,jGe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+hd+`
  return result;
`,QGe=Hs({opSnippet:JGe,packedOpSnippet:jGe,cpuKernelImpl:FLe}),ZGe={kernelName:nb,backendName:"webgl",kernelFunc:QGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e6e{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((h,f)=>h[0]+e[f]+h[1]);const r=e.length,i=fn(r),o=t.map(h=>h[0]).join(","),a=t.map((h,f)=>h[0]+e[f]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class t6e{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((b,T)=>b[0]+e[T]+b[1]);const r=e.length,i=fn(r),o=t.map(b=>b[0]).join(","),a=t.map((b,T)=>b[0]+e[T]).join(","),l=vr("rc",r),u=vr("source",r),h=`${l[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${u.slice(-2).join()})`,p=s==="reflect"?0:1;let g="";if(r===1){const b=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;g=`
        ${i} rc = outputLoc;
        ${b}
        result[0] = getChannel(getX(${u.join()}), ${f});
        ${l[r-1]} += 1;
        if(${h}) {
          ${b}
          result[1] = getChannel(getX(${u.join()}), ${f});
        }
      `}else{const b=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;g=`
        ${i} rc = outputLoc;
        ${b}
        result[0] = getChannel(getX(${u.join()}), ${f});
        ${l[r-1]} += 1;
        if(${h}) {
          ${b}
          result[1] = getChannel(getX(${u.join()}), ${f});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${b}
          result[2] = getChannel(getX(${u.join()}), ${f});
          ${l[r-1]} += 1;
          if(${h}) {
            ${b}
            result[3] = getChannel(getX(${u.join()}), ${f});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n6e=({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:r,mode:i}=t,o=we().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new t6e(s.shape,r,i):new e6e(s.shape,r,i);return e.runWebGLProgram(o,[s],s.dtype)},s6e={kernelName:GT,backendName:"webgl",kernelFunc:n6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r6e=`if (b == 0.0) return NAN;
  return mod(a, b);`,i6e=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+hd+`
  return result;
`,o6e=Hs({opSnippet:r6e,packedOpSnippet:i6e}),a6e={kernelName:sb,backendName:"webgl",kernelFunc:o6e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l6e{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u6e=`
if (a == b) {
  return 1.0;
};
return a / b;`,c6e=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,_Y=Hs({opSnippet:u6e,packedOpSnippet:c6e,checkOutOfBounds:!0}),h6e={kernelName:Uy,backendName:"webgl",kernelFunc:_Y};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mV="return a - b;",EY=Hs({opSnippet:mV,packedOpSnippet:mV,supportsComplex:!0,cpuKernelImpl:rVe}),d6e={kernelName:vb,backendName:"webgl",kernelFunc:EY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IY(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:i}=s,o=xt([i],r.shape),a=SY({inputs:{x:r},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),l=os(a.shape,o),u=Ve({inputs:{x:a},backend:t,attrs:{shape:l}}),h=EY({inputs:{a:r,b:u},backend:t}),f=wY({inputs:{x:h},backend:t}),p=Lx({inputs:{x:f},backend:t,attrs:{axis:o,keepDims:!1}}),g=Ve({inputs:{x:p},backend:t,attrs:{shape:l}}),b=_Y({inputs:{a:f,b:g},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),b}const f6e={kernelName:ax,backendName:"webgl",kernelFunc:IY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p6e(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s,l=a?r:IY({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),u=l.shape[0],h=l.shape[1],f=new l6e(u,h,i),p=[[o]],g=t.runWebGLProgram(f,[l],"int32",p);return a||t.disposeIntermediateTensorInfo(l),g}const m6e={kernelName:f5,backendName:"webgl",kernelFunc:p6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g6e=ro+`
  return -x;
`,y6e=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function b6e(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const i=t.texData.get(s.dataId),[o,a]=VLe(i.values,s.shape,s.dtype);return t.makeTensorInfo(a,s.dtype,o)}let r;return we().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Ou(s.shape,y6e):r=new pa(s.shape,g6e),t.runWebGLProgram(r,[s],s.dtype)}const v6e={kernelName:HT,backendName:"webgl",kernelFunc:b6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w6e=d2;function T6e(n){wi("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s,u=t.readSync(r.dataId),h=t.readSync(i.dataId),{selectedIndices:f}=w6e(u,h,o,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const x6e={kernelName:Ek,backendName:"webgl",kernelFunc:T6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S6e=f2;function _6e(n){wi("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s,h=t.readSync(r.dataId),f=t.readSync(i.dataId),{selectedIndices:p,validOutputs:g}=S6e(h,f,o,a,l,u);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const E6e={kernelName:Ik,backendName:"webgl",kernelFunc:_6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I6e=p2;function C6e(n){wi("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s,h=t.readSync(r.dataId),f=t.readSync(i.dataId),p=o,g=a,b=l,T=u,{selectedIndices:w,selectedScores:_}=I6e(h,f,p,g,b,T);return[t.makeTensorInfo([w.length],"int32",new Int32Array(w)),t.makeTensorInfo([_.length],"float32",new Float32Array(_))]}const N6e={kernelName:Ck,backendName:"webgl",kernelFunc:C6e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A6e{constructor(e,t,s,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k6e=n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s,u=Ee(r.shape),h=new A6e(u,o,a,l),f=Ve({inputs:{x:r},backend:t,attrs:{shape:[u]}}),p=t.runWebGLProgram(h,[f],i);t.disposeIntermediateTensorInfo(f);const g=[...r.shape,o],b=Ve({inputs:{x:p},backend:t,attrs:{shape:g}});return t.disposeIntermediateTensorInfo(p),b},$6e={kernelName:KT,backendName:"webgl",kernelFunc:k6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tw(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const r=Hb({inputs:{input:s},backend:t}),i=Tw({inputs:{x:r},backend:t}),o=Vx({inputs:{input:s},backend:t}),a=Tw({inputs:{x:o},backend:t}),l=$c({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return qb({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const R6e={kernelName:cx,backendName:"webgl",kernelFunc:Tw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CY(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Hb({inputs:{input:s},backend:t}),i=CY({inputs:{x:r},backend:t}),o=Vx({inputs:{input:s},backend:t}),a=Tw({inputs:{x:o},backend:t}),l=$c({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return qb({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const D6e={kernelName:WT,backendName:"webgl",kernelFunc:CY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M6e(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return _C({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(h=>{XA(i,h.shape,"All tensors passed to stack must have matching shapes"),q(o===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(h=>{const f=_C({inputs:{input:h},backend:t,attrs:{dim:r}});return a.push(f),f}),u=dY({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(h=>t.disposeIntermediateTensorInfo(h)),u}const O6e={kernelName:XT,backendName:"webgl",kernelFunc:M6e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P6e{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((u,h)=>u[0]+e[h]+u[1]);const r=e.length,i=fn(r),o=t.map(u=>u[0]).join(","),a=t.map((u,h)=>u[0]+e[h]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F6e{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((T,w)=>T[0]+e[w]+T[1]);const r=e.length,i=fn(r),o=t.map(T=>T[0]).join(","),a=t.map((T,w)=>T[0]+e[w]).join(","),l=vr("rc",r),u=vr("source",r),h=`${l[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${u.slice(-2).join()})`,p=[`${i} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${h}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${h}) {`],g=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let b="";for(let T=0,w=r===1?2:4;T<w;T++)b+=`
        ${p[T]}
        if (${g}) {
          result[${T}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${T}] = getChannel(getX(${u.join()}), ${f});
        }
      `;b+=r===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${b}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NY=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,constantValue:o}=s;if(Ee(r.shape)===0){const u=i.map((h,f)=>h[0]+r.shape[f]+h[1]);return qb({backend:t,attrs:{shape:u,value:o,dtype:r.dtype}})}const a=we().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new F6e(r.shape,i,o):new P6e(r.shape,i,o),l=[[o]];return t.runWebGLProgram(a,[r],r.dtype,l)},L6e={kernelName:YT,backendName:"webgl",kernelFunc:NY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V6e=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,B6e=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+hd+`
  return result;
`,U6e=Hs({opSnippet:V6e,packedOpSnippet:B6e}),z6e={kernelName:ib,backendName:"webgl",kernelFunc:U6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G6e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=[],u=xt(i,r.shape);let h=u;const f=zn(h,a);let p=r;f!=null&&(p=Er({inputs:{x:r},backend:t,attrs:{perm:f}}),h=Yn(h.length,a),l.push(p)),Gs("prod",h,a);let g;if(t.shouldExecuteOnCPU([p])){const b=t.texData.get(p.dataId).values,{outVals:T,outShape:w,outDtype:_}=ULe(p.shape,p.dtype,b,h);g=t.makeTensorInfo(w,_,T)}else{const[b,T]=Ds(p.shape,h),w=Ee(T),_=Ve({inputs:{x:p},backend:t,attrs:{shape:[-1,w]}}),C=Vk(r.dtype),N=dd(_,C,"prod",t);g=Ve({inputs:{x:N},backend:t,attrs:{shape:b}}),l.push(_),l.push(N)}if(o){l.push(g);const b=os(g.shape,u);g=Ve({inputs:{x:g},backend:t,attrs:{shape:b}})}return l.forEach(b=>t.disposeIntermediateTensorInfo(b)),g}const H6e={kernelName:jT,backendName:"webgl",kernelFunc:G6e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q6e(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(_=>t.readSync(_.dataId)),u=r.map(_=>_.shape),h=t.readSync(i.dataId),f=t.readSync(o.dataId),[p,g,b]=zLe(l,u,h,i.shape,i.dtype,f,o.shape,a),T=p.map(_=>t.makeTensorInfo([_.length],"int32",_)),w=t.makeTensorInfo(b,i.dtype,g);return T.concat([w])}const W6e={kernelName:p5,backendName:"webgl",kernelFunc:q6e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K6e(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:i}=e,o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,h]=GLe(o,s.shape,s.dtype,a,r.shape,l,i.shape),f=t.makeTensorInfo([u.length],"int32",u),p=t.makeTensorInfo([h.length],s.dtype,h);return[f,p]}const X6e={kernelName:m5,backendName:"webgl",kernelFunc:K6e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y6e(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=t.readSync(r.dataId),h=t.readSync(i.dataId),f=t.readSync(o.dataId),p=a.map(w=>t.readSync(w.dataId)),g=a.map(w=>w.shape),[b,T]=HLe(u,r.shape,h,i.shape,i.dtype,f,o.shape,p,g,l);return t.makeTensorInfo(b,i.dtype,T)}const J6e={kernelName:g5,backendName:"webgl",kernelFunc:Y6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AY=n=>{const{backend:e,attrs:t}=n,{start:s,stop:r,step:i,dtype:o}=t,a=qLe(s,r,i,o);return e.makeTensorInfo([a.length],o,a)},j6e={kernelName:Nk,backendName:"webgl",kernelFunc:AY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q6e="return 1.0 / x;",Z6e=Vt({opSnippet:Q6e}),eHe={kernelName:ob,backendName:"webgl",kernelFunc:Z6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tHe=ro+`
  return (x < 0.0) ? 0.0 : x;
`,nHe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,sHe=Vt({opSnippet:tHe,packedOpSnippet:nHe}),rHe={kernelName:ab,backendName:"webgl",kernelFunc:sHe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iHe=ro+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,oHe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,aHe=Vt({opSnippet:iHe,packedOpSnippet:oHe}),lHe={kernelName:lb,backendName:"webgl",kernelFunc:aHe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uHe{constructor(e,t,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const h=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/f[0]},
          ${h[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cHe{constructor(e,t,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const h=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/f[0]},
          ${h[1]/f[1]},
          ${h[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hHe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,h=we().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new cHe(r.shape,l,u,i,o):new uHe(r.shape,l,u,i,o);return t.runWebGLProgram(h,[r],"float32")}const dHe={kernelName:ex,backendName:"webgl",kernelFunc:hHe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fHe{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],h=l[0]/u[0],f=l[1]/u[1],p=1/h,g=1/f,b=Math.ceil(p)*2+2,T=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${f});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${g});

        const int winHeight = int(${b});
        const int winWidth = int(${T});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pHe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s,a=new fHe(i.shape,r.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const mHe={kernelName:$k,backendName:"webgl",kernelFunc:pHe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gHe{constructor(e,t,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const h=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],p=r?"0.5":"0.0";let g;i?g="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":g="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/f[0]},
          ${h[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yHe{constructor(e,t,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const h=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],p=r?"0.5":"0.0";let g;i?g="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":g="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/f[0]},
          ${h[1]/f[1]},
          ${h[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bHe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,h=we().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new yHe(r.shape,l,u,i,o):new gHe(r.shape,l,u,i,o);return t.runWebGLProgram(h,[r],r.dtype)}const vHe={kernelName:ZT,backendName:"webgl",kernelFunc:bHe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wHe{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],h=l[0]/u[0],f=l[1]/u[1],p=1/h,g=1/f,b=Math.ceil(p)*2+2,T=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${f});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${g});

        const int winHeight = int(${b});
        const int winWidth = int(${T});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function THe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s,a=new wHe(i.shape,r.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const xHe={kernelName:kk,backendName:"webgl",kernelFunc:THe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SHe{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,i=e.map((a,l)=>r(l)).join(","),o=fn(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _He{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=vr("rc",s),i=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=fn(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${i}){
            result.g = ${u(r.slice())};
          }
          if(${o}) {
            result.b = ${h(r.slice())};
            if(${i}) {
              result.a = ${f(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(b){return p(b)}function u(b){return b[s-1]="("+b[s-1]+" + 1)",p(b)}function h(b){return b[s-2]="("+b[s-2]+" + 1)",p(b)}function f(b){return b[s-1]="("+b[s-1]+" + 1)",b[s-2]="("+b[s-2]+" + 1)",p(b)}function p(b){const T=e.map((C,N)=>g(N,b)),w=T.join(","),_=T.slice(-2).join(",");return`getChannel(getX(${w}), vec2(${_}))`}function g(b,T){return t.indexOf(b)!==-1&&e[b]!==1?`${e[b]} - ${T[b]} - 1`:`${T[b]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EHe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:i}=s,o=r.shape.length,a=xt(i,r.shape);if(o===0)return ui({inputs:{x:r},backend:t});const l=we().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _He(r.shape,a):new SHe(r.shape,a);return t.runWebGLProgram(l,[r],r.dtype)}const IHe={kernelName:tx,backendName:"webgl",kernelFunc:EHe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CHe{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let i="";typeof t=="number"?i=`float outputValue = ${t.toFixed(2)};`:i=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NHe={kernelName:Lk,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=e,a=t,l=new CHe(s.shape,i),[u,h]=E2(o,s.shape[1],s.shape[2]),f=[[u,h,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,f)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AHe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,kHe=Vt({opSnippet:AHe}),$He={kernelName:ub,backendName:"webgl",kernelFunc:kHe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RHe="return inversesqrt(x);",DHe=Vt({opSnippet:RHe,cpuKernelImpl:WLe}),MHe={kernelName:cb,backendName:"webgl",kernelFunc:DHe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class C${constructor(e,t,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const u=fn(i.length),h=fn(o.length);let f="";s===1?f="i":s===2&&(f="i, j");const p=`getIndices(${f})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const b=`getUpdates(${g})`;let T="";l&&(T="coords[0], coords[1]");const w=`getDefaultValue(${T})`,_=t>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${h} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${p});
              flattenedIndex += index * ${_};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${b};
              found = true;
            }
          }
          setOutput(mix(${w}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OHe{constructor(e,t,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const u=fn(i.length),h=fn(o.length);let f="";s===1?f="i":s===2&&(f="i, j");const p=`getIndices(${f})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const b=`getUpdates(${g})`;let T="";l&&(T="coords[0], coords[1]");const w=`getDefaultValue(${T})`,_=t>1?"strides[j]":"strides",C=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${h} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${p});
              flattenedIndex += index.xz * ${_};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${C};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${b};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${w}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PHe(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:h,outputSize:f}=od(i,r,o),p=[f/u,u];if(f===0)return t.makeTensorInfo(o,r.dtype);const g=Ve({inputs:{x:r},backend:t,attrs:{shape:[l,a]}}),b=Ve({inputs:{x:i},backend:t,attrs:{shape:[l,u]}}),T=t.makeTensorInfo([],"float32",new Float32Array([0]));let w;we().getBool("WEBGL_PACK")?w=new OHe(l,a,g.shape.length,b.shape.length,h,p):w=new C$(l,a,g.shape.length,b.shape.length,h,p);const _=t.runWebGLProgram(w,[b,g,T],b.dtype),C=Ve({inputs:{x:_},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(_),t.disposeIntermediateTensorInfo(T),C}const FHe={kernelName:y5,backendName:"webgl",kernelFunc:PHe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LHe{constructor(e,t,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=we().getNumber("WEBGL_VERSION")===2?i:o,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VHe(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:i}=e,{side:o}=s,a=new LHe(r.shape[0],r.shape[1],i.shape[1],o),l=[[r.shape[1]]];return t.runWebGLProgram(a,[r,i],"int32",l)}const BHe={kernelName:v5,backendName:"webgl",kernelFunc:VHe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UHe{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let r,i;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)i="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let h=0;h<t.length;h++)u.push(`${a[h]}`),h<e&&l.push(`${a[h]}`);r=l.join(),i=u.join()}const o=fn(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zHe(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:i}=e,o=new UHe(s.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(o,[s,r,i],ai(r.dtype,i.dtype))}const GHe={kernelName:nx,backendName:"webgl",kernelFunc:zHe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HHe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Tx};
  float scale = ${xx};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,qHe=Vt({opSnippet:HHe}),WHe={kernelName:hb,backendName:"webgl",kernelFunc:qHe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KHe=Vp+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,XHe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,YHe=Vt({opSnippet:KHe,packedOpSnippet:XHe,cpuKernelImpl:XLe}),JHe={kernelName:mb,backendName:"webgl",kernelFunc:YHe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jHe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,QHe=Vt({opSnippet:jHe}),ZHe={kernelName:pb,backendName:"webgl",kernelFunc:QHe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eqe=Vp+`
  return sin(x);
`,tqe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${hd}
  return result;
`,nqe=Vt({opSnippet:eqe,packedOpSnippet:tqe}),sqe={kernelName:db,backendName:"webgl",kernelFunc:nqe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rqe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,iqe=Vt({opSnippet:rqe}),oqe={kernelName:fb,backendName:"webgl",kernelFunc:iqe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aqe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,lqe=Vt({opSnippet:aqe}),uqe={kernelName:gb,backendName:"webgl",kernelFunc:lqe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cqe=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,paddings:o}=s;q(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((_,C)=>_*C),l=[[0,0]];l.push(...o);for(let _=1+i.length;_<r.shape.length;++_)l.push([0,0]);const u=[],h=NY({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),f=Ab(h.shape,i,a,!1),p=kb(f.length,i.length,!1),g=$b(h.shape,i,a,!1),b=Ve({inputs:{x:h},backend:t,attrs:{shape:f}}),T=Er({inputs:{x:b},backend:t,attrs:{perm:p}}),w=Ve({inputs:{x:T},backend:t,attrs:{shape:g}});return u.push(h),u.push(b),u.push(T),u.forEach(_=>t.disposeIntermediateTensorInfo(_)),w},hqe={kernelName:ix,backendName:"webgl",kernelFunc:cqe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dqe(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.readSync(s.dataId),l=t.readSync(r.dataId),u=t.readSync(i.dataId),h=t.readSync(o.dataId)[0],[f,p,g,b,T]=JLe(a,s.shape,s.dtype,l,r.dtype,u,h);return[t.makeTensorInfo(p,s.dtype,f),t.makeTensorInfo([p[0]],r.dtype,g),t.makeTensorInfo([b.length],"bool",new Uint8Array(b.map(w=>Number(w)))),t.makeTensorInfo([T.length],s.dtype,new Int32Array(T))]}const fqe={kernelName:w5,backendName:"webgl",kernelFunc:dqe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pqe(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.readSync(r.dataId)),a=t.readSync(s.dataId),l=Array.from(t.readSync(i.dataId)),[u,h,f]=jLe(a,s.shape,s.dtype,o,l);return[t.makeTensorInfo(h,s.dtype,u),t.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}const mqe={kernelName:T5,backendName:"webgl",kernelFunc:pqe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gqe(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,h]=ZX(o,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(h,s.dtype,u)}const yqe={kernelName:x5,backendName:"webgl",kernelFunc:gqe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bqe(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,h]=ZX(o,s.shape,s.dtype,a,l);return t.makeTensorInfo(h,s.dtype,u)}const vqe={kernelName:S5,backendName:"webgl",kernelFunc:bqe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wqe(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:h,strides:f,outputSize:p}=od(i,r,a),g=!1;if(i.dtype==="string"){const _=t.bufferSync(r),C=t.bufferSync(i),N=uc(t.readSync(o.dataId)[0]),A=KLe(_,C,a,p,h,u,l,f,N,g);return t.makeTensorInfo(a,A.dtype,A.values)}const b=new C$(u,l,r.shape.length,i.shape.length,f,[p,1],g),T=t.runWebGLProgram(b,[i,r,o],i.dtype),w=Ve({inputs:{x:T},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(T),w}const Tqe={kernelName:_5,backendName:"webgl",kernelFunc:wqe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xqe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=xt(o,r.shape)[0],l=B2(r,i,a),u=r.shape.length,h=new Array(u).fill(0),f=r.shape.slice();return l.map(p=>{const g=[...f];g[a]=p;const b=Bp({inputs:{x:r},backend:t,attrs:{begin:h,size:g}});return h[a]+=p,b})}const Sqe={kernelName:ox,backendName:"webgl",kernelFunc:xqe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gV="return sqrt(x);",_qe=Vt({opSnippet:gV,packedOpSnippet:gV,cpuKernelImpl:QLe}),Eqe={kernelName:yb,backendName:"webgl",kernelFunc:_qe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iqe="return x * x;",Cqe=Vt({opSnippet:Iqe}),Nqe={kernelName:Rk,backendName:"webgl",kernelFunc:Cqe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yV="return (a - b) * (a - b);",Aqe=Hs({opSnippet:yV,packedOpSnippet:yV}),kqe={kernelName:bb,backendName:"webgl",kernelFunc:Aqe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $qe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const i=t.readSync(r.dataId),o=Al(i),a=ZLe(o,"string",s);return t.makeTensorInfo(r.shape,"string",a)}const Rqe={kernelName:Dk,backendName:"webgl",kernelFunc:$qe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dqe({inputs:n,attrs:e,backend:t}){const{x:s}=n,r=ro+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new pa(s.shape,r);return t.runWebGLProgram(i,[s],s.dtype)}const Mqe={kernelName:Sb,backendName:"webgl",kernelFunc:Dqe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oqe{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,i=fn(s.length),o=fn(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((u,h)=>(l++,s.length===1?`coords * strides[${h}] + begin[${h}]`:`coords[${l-1}] * strides[${h}] + begin[${h}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${t});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pqe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:h,newAxisMask:f,shrinkAxisMask:p}=s,{finalShapeSparse:g,finalShape:b,isIdentity:T,sliceDim0:w,isSimpleSlice:_,begin:C,end:N,strides:A}=x2(r.shape,i,o,a,l,u,h,f,p);let P;if(T)P=Ve({inputs:{x:r},backend:t,attrs:{shape:b}});else if(w||_){q(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const D=v2(C,N,A),M=Bp({inputs:{x:r},backend:t,attrs:{begin:C,size:D}});P=Ve({inputs:{x:M},backend:t,attrs:{shape:b}}),t.disposeIntermediateTensorInfo(M)}else if(t.shouldExecuteOnCPU([r])){const M=t.readSync(r.dataId),$=Tt(r.shape,r.dtype,M),O=eVe(g,$,A,C);P=t.makeTensorInfo(b,r.dtype,O.values)}else{const M=new Oqe(C,A,g);P=t.runWebGLProgram(M,[r],r.dtype)}const V=Ve({inputs:{x:P},backend:t,attrs:{shape:b}});return t.disposeIntermediateTensorInfo(P),V}const Fqe={kernelName:Mk,backendName:"webgl",kernelFunc:Pqe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lqe(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:h,dataSplits:f}=e,p=t.readSync(h.dataId),g=t.readSync(f.dataId),[b,T]=tVe(p,g,r,i,o,a,l,u);return[t.makeTensorInfo([b.length],"string",b),t.makeTensorInfo(f.shape,"int32",T)]}const Vqe={kernelName:E5,backendName:"webgl",kernelFunc:Lqe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bqe(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.readSync(i.dataId),l=t.readSync(o.dataId)[0],[u,h,f]=nVe(a,l,r),p=h.length;return[t.makeTensorInfo([p,2],"int32",u),t.makeTensorInfo([p],"string",h),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const Uqe={kernelName:I5,backendName:"webgl",kernelFunc:Bqe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zqe(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=t.readSync(i.dataId),a=sVe(o,r);return t.makeTensorInfo(i.shape,"int32",a)}const Gqe={kernelName:C5,backendName:"webgl",kernelFunc:zqe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hqe="return tan(x);",qqe=Vt({opSnippet:Hqe}),Wqe={kernelName:wb,backendName:"webgl",kernelFunc:qqe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kqe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Xqe=Vt({opSnippet:Kqe}),Yqe={kernelName:Tb,backendName:"webgl",kernelFunc:Xqe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jqe(n){const{inputs:e,backend:t,attrs:s}=n,{tensor:r,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:h,outputSize:f}=od(o,i,r.shape),p=[f/u,u];if(f===0)return t.makeTensorInfo(r.shape,i.dtype);const g=Ve({inputs:{x:i},backend:t,attrs:{shape:[l,a]}}),b=Ve({inputs:{x:o},backend:t,attrs:{shape:[l,u]}}),T=Ve({inputs:{x:r},backend:t,attrs:{shape:p}}),w=new C$(l,a,g.shape.length,b.shape.length,h,p,!1,!0),_=t.runWebGLProgram(w,[b,g,T],T.dtype),C=Ve({inputs:{x:_},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(T),t.disposeIntermediateTensorInfo(_),C}const jqe={kernelName:b5,backendName:"webgl",kernelFunc:Jqe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qqe{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[o]*t[o];this.outputShape=s,this.rank=s.length;const r=fn(this.rank),i=Zqe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function Zqe(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${t[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:i}=s;if(r.dtype==="string"||r.shape.length>5){const l=t.readSync(r.dataId),u=r.dtype==="string"?l.map(p=>uc(p)):l,h=Tt(r.shape,r.dtype,u),f=iVe(h,i);return t.makeTensorInfo(f.shape,f.dtype,f.values)}const o=new Qqe(r.shape,i);return t.runWebGLProgram(o,[r],r.dtype)}const eWe={kernelName:xb,backendName:"webgl",kernelFunc:kY};class tWe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class nWe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lh(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function bV(n){let e=1;for(;e<n;)e*=2;return e}function sWe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:i,sorted:o}=s,a=we().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=we().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=r.shape,h=u[u.length-1];if(t.shouldExecuteOnCPU([r])||h<a||i>l){const O=t.readSync(r.dataId),[k,z]=oVe(O,u,r.dtype,i,o);return[t.makeTensorInfo(k.shape,k.dtype,k.values),t.makeTensorInfo(z.shape,z.dtype,z.values)]}if(i===0)return u[u.length-1]=0,[t.makeTensorInfo(u,r.dtype,[]),t.makeTensorInfo(u,"int32",[])];if(h===1)return[r,qb({attrs:{shape:u,dtype:"int32",value:0},backend:t})];const f=t.texData.get(r.dataId),p=f!==null&&f.isPacked,g=p?t.unpackTensor(r):r,T=Ee(u)/h,w=Ve({inputs:{x:g},attrs:{shape:[T,h]},backend:t});p&&lh(t,g);const _=bV(i),C=bV(h);let N=null;const A=()=>N===null?[w,w]:[w,N],P=(O,k,z)=>{const U=A(),te=new tWe(z),X=[[h],[N===null?1:0],[Number.NEGATIVE_INFINITY],[O],[k]],Q=N;N=t.runWebGLProgram(te,U,"int32",X),lh(t,Q)};for(let O=1;O<_;O*=2){const k=O*2;for(let z=O;z>=1;z/=2)P(k,z,[T,C])}for(let O=C;O>_;O/=2){const k=A(),z=new nWe([T,O/2]),te=[[h],[N===null?1:0],[_]],se=N;N=t.runWebGLProgram(z,k,"int32",te),lh(t,se);const X=_/2,Q=X*2;for(let re=X;re>=1;re/=2)P(Q,re,N.shape)}let V=N;N=Bp({inputs:{x:N},backend:t,attrs:{begin:0,size:[T,i]}}),lh(t,V);let D=xY({inputs:{x:w,indices:N},backend:t,attrs:{axis:1,batchDims:1}});lh(t,w);const M=u.slice(0,-1);M.push(i),V=N,N=Ve({inputs:{x:N},attrs:{shape:M},backend:t}),lh(t,V);const $=D;return D=Ve({inputs:{x:D},attrs:{shape:M},backend:t}),lh(t,$),[D,N]}const rWe={kernelName:Ok,backendName:"webgl",kernelFunc:sWe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iWe{constructor(e,t,s,r,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oWe(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=s,[h,f,p,g]=r.shape,[b,T]=u??[f,p],w=[h,b,T,g],_=new iWe(f,p,o,a,l,w);return t.runWebGLProgram(_,[r,i],"float32")}const aWe={kernelName:Pk,backendName:"webgl",kernelFunc:oWe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lWe(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:i}=e;zb(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(i.dataId),{outputValues:a,outputShape:l,indices:u}=aVe(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const uWe={kernelName:Fk,backendName:"webgl",kernelFunc:lWe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cWe(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r,a=o.shape.length,l=r.shape[i],u=new Array(a-1);let h=0;for(let T=0;T<a;T++)T!==i&&(u[h++]=o.shape[T]);const f=[],p=new Array(a).fill(0),g=o.shape.slice();g[i]=1;const b=new Array(l);for(let T=0;T<b.length;T++){p[i]=T;const w=Bp({inputs:{x:o},backend:t,attrs:{begin:p,size:g}}),_=Ve({inputs:{x:w},backend:t,attrs:{shape:u}});b[T]=_,f.push(w)}return f.forEach(T=>t.disposeIntermediateTensorInfo(T)),b}const hWe={kernelName:lx,backendName:"webgl",kernelFunc:cWe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dWe{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/s);this.outputShape=[r,a];const l="0.0",u="sumValue",h=Math.floor(s/4)*4,f=s%4,p=`
        sumValue += dot(values, segFilter);
    `;let g="";i%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let b="";i%s>0&&(b=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${b}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${h};
        if (${f===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${f===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${f===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fWe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:i}=e,{numSegments:o}=s,a=r.shape.length,l=[];let u=0;const h=zn([u],a);let f=r;h!=null&&(f=Er({inputs:{x:r},backend:t,attrs:{perm:h}}),l.push(f),u=Yn(1,a)[0]);const p=f8(f.shape,u,o),g=Ee([f.shape[u]]),b=Ve({inputs:{x:f},backend:t,attrs:{shape:[-1,g]}});l.push(b);const T=Vk(r.dtype),w=(A,P,V,D,M)=>{const $=A.shape[0],O=A.shape[1],k=d8(O,M),z={windowSize:k,inSize:O,batchSize:$,numSegments:M},U=new dWe(z,P),te=t.compileAndRun(U,[A,V],D);if(l.push(te),te.shape[1]===M)return te;const se=AY({backend:t,attrs:{start:0,stop:M,step:1,dtype:"float32"}}),X=kY({inputs:{x:se},backend:t,attrs:{reps:[O/k]}});return l.push(se),l.push(X),w(te,P,X,D,M)},_=w(b,"unsortedSegmentSum",i,T,o),C=Ve({inputs:{x:_},backend:t,attrs:{shape:p}});let N=C;if(h!=null){l.push(C);const A=Ec(h);N=Er({inputs:{x:N},backend:t,attrs:{perm:A}})}return l.forEach(A=>t.disposeIntermediateTensorInfo(A)),N}const pWe={kernelName:ux,backendName:"webgl",kernelFunc:fWe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mWe=[QVe,e4e,s4e,o4e,l4e,h4e,f4e,m4e,v4e,T4e,_4e,C4e,k4e,M4e,F4e,V4e,U4e,q4e,K4e,Y4e,Z4e,oBe,lBe,dBe,pBe,wBe,xBe,IBe,OVe,ABe,MBe,LBe,HBe,KBe,YBe,jBe,ZBe,sUe,oUe,uUe,hUe,fUe,mUe,bUe,wUe,_Ue,IUe,AUe,RUe,MUe,LUe,zUe,WUe,YUe,QUe,ZUe,tze,sze,ize,aze,uze,fze,gze,vze,Tze,_ze,Cze,$ze,Oze,MVe,Fze,RBe,Bze,Gze,Wze,FVe,Jze,eGe,nGe,oGe,uGe,fGe,gGe,wGe,_Ge,CGe,AGe,DGe,OGe,FGe,UGe,GGe,qGe,KGe,YGe,ZGe,s6e,a6e,m6e,BVe,v6e,x6e,E6e,N6e,gBe,$6e,D6e,O6e,L6e,z6e,VVe,H6e,W6e,X6e,J6e,j6e,yBe,h6e,eHe,rHe,lHe,zVe,dHe,mHe,vHe,xHe,IHe,NHe,$He,MHe,FHe,BHe,GHe,WHe,JHe,ZHe,sqe,oqe,rBe,f6e,uqe,hqe,fqe,mqe,yqe,vqe,Tqe,Sqe,Eqe,Nqe,kqe,Rqe,Mqe,Fqe,Vqe,Uqe,Gqe,d6e,YVe,Wqe,Yqe,jqe,eWe,rWe,aWe,JVe,uWe,hWe,pWe,R6e];for(const n of mWe)A5(n);let bg=null,CE=!1;const $Y=async()=>{if(!(bg||CE)){CE=!0;try{console.log("   MobileNet..."),bg=await kTe({version:2,alpha:1}),console.log("  !")}catch(n){console.error("  MobileNet:",n)}finally{CE=!1}}},gWe=async n=>{if(bg||await $Y(),!bg)return[];try{return(await bg.classify(n)).map(t=>t.className.toLowerCase())}catch(e){return console.error(" :",e),[]}},yWe={:["tree","plant"],:["flower","plant","daisy","rose","pot"],:["car","cab","taxi","vehicle","jeep","racer"],:["car","cab","taxi","vehicle","jeep"],:["wheel","tire","car"],:["phone","cell","screen"],:["laptop","notebook","monitor","screen","computer"],:["keyboard","typewriter"],:["mouse"],:["mug","cup","coffee"],:["cup","mug","coffeepot"],:["bottle","water bottle","wine bottle"],:["pen","pencil","ballpoint"],:["desk","table","dining table"],:["chair","seat","armchair"],:["sofa","couch"],:["cat","tabby","tiger cat","kitten"],:["cat","tabby","tiger cat","kitten"],:["dog","pup","terrier","retriever","shepherd"],:["dog","pup"],:["bicycle","bike","cycle","mountain bike"],:["scooter"],:["shoe","sneaker","boot","sandal","running shoe"],:["shoe","sneaker","running shoe"],:["watch","clock","stopwatch"],:["sunglasses","glasses","shades"],:["bag","backpack","purse","handbag"],:["backpack","pack"],:["book","paper"],:["bench","park bench"],:["trash","can","basket"],:["traffic light","light"],:["sign","street sign"],:["banana"],:["apple"],:["orange"]},bWe=(n,e)=>{const t=n.toLowerCase();for(const[s,r]of Object.entries(yWe))if(t.includes(s)&&e.some(i=>r.some(o=>i.includes(o))))return!0;return!1},vWe="AIzaSyCiFX0b28tzHBS9Ablcdogy2HzDtO8Svt0",RY=new whe({apiKey:vWe,baseUrl:void 0}),DY="pq_task_history",MY="pq_task_queue_v1",vV=["  (, , , )","  (, , , )","  (, , , )"," (  , ,  , )","  ( ,  , )","   (,  , , )","  (, ,  , )","  (,  ,  , )","  ( , , , )","   (, , ,  )","  (, , ,  )","   ( , ,  )"],OY=()=>{try{const n=localStorage.getItem(DY);return n?JSON.parse(n):[]}catch{return[]}},wV=n=>{const t=[...OY(),n].slice(-15);localStorage.setItem(DY,JSON.stringify(t))},wWe=()=>{try{const n=localStorage.getItem(MY);return n?JSON.parse(n):[]}catch{return[]}},TV=n=>{localStorage.setItem(MY,JSON.stringify(n))},TWe=n=>new Promise(e=>setTimeout(e,n));async function PY(n,e=3,t=2e3){var r,i,o;let s=0;for(;;)try{return await n()}catch(a){s++;const l=a.status===503||a.code===503||((r=a.message)==null?void 0:r.includes("overloaded")),u=((i=a.message)==null?void 0:i.includes("fetch failed"))||((o=a.message)==null?void 0:o.includes("NetworkError"));if(s>=e||!l&&!u)throw a;const h=t*Math.pow(2,s-1);await TWe(h)}}$Y();const xWe=async()=>{const n=wWe();if(n.length>0){const e=n.shift();if(TV(n),e)return wV(e.description),e}try{const e=vV[Math.floor(Math.random()*vV.length)],t=Math.random().toString(36).substring(7),s=OY(),r=s.length>0?s.join(", "):"",i=`  "-".
    :
    1. : "${e}".
    2. : [ ${r} ].
    3. Seed: ${t}.
    
    :
      8      .
    :     (, , , , ).
    
     JSON: { tasks: [{ description, difficulty, points }] }`,o=await PY(()=>RY.models.generateContent({model:"gemini-2.5-flash",contents:i,config:{temperature:1.3,responseMimeType:"application/json",responseSchema:{type:tr.OBJECT,properties:{tasks:{type:tr.ARRAY,items:{type:tr.OBJECT,properties:{description:{type:tr.STRING},difficulty:{type:tr.STRING,enum:["easy","medium","hard"]},points:{type:tr.INTEGER}},required:["description","difficulty","points"]}}},required:["tasks"]}}}));if(o.text){const a=JSON.parse(o.text);if(a.tasks&&Array.isArray(a.tasks)&&a.tasks.length>0){const l=a.tasks.map(h=>({id:Math.random().toString(36).substr(2,9),description:h.description,difficulty:h.difficulty,points:h.points})).sort(()=>Math.random()-.5),u=l.shift();if(TV(l),u)return wV(u.description),u}}return i3()}catch{return i3()}},SWe=async(n,e)=>{var t,s,r;try{const i=new Image;i.src=n,await new Promise(l=>{i.onload=l});const o=await gWe(i);if(console.log(" :",o),bWe(e,o))return{verified:!0,reason:` : ${o[0]}`};console.log("  ,  ...")}catch(i){console.warn("  :",i)}try{const i=n.split(",")[1]||n,o=`: . : "${e}".
     ?
        - .
    JSON: { "verified": boolean, "reason": string }`,a=await PY(()=>RY.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{inlineData:{mimeType:"image/jpeg",data:i}},{text:o}]},config:{responseMimeType:"application/json",responseSchema:{type:tr.OBJECT,properties:{verified:{type:tr.BOOLEAN},reason:{type:tr.STRING}},required:["verified","reason"]}}}));if(a.text)return JSON.parse(a.text);throw new Error("Empty response")}catch(i){return console.error("Cloud verification error:",i),i.status===429||i.code===429||(t=i.message)!=null&&t.includes("429")||(s=i.message)!=null&&s.includes("quota")||(r=i.message)!=null&&r.includes("fetch failed")?{verified:!0,reason:" ,   ,    ! (-)"}:{verified:!1,reason:" ."}}},_We=({user:n,refreshUser:e})=>{const[t,s]=Dn.useState(n.currentTask||null),[r,i]=Dn.useState(!1),[o,a]=Dn.useState(!1),[l,u]=Dn.useState(null),[h,f]=Dn.useState(!1),p=Dn.useCallback(async()=>{if(n.currentTask){s(n.currentTask);return}await g(!0)},[n.currentTask]);Dn.useEffect(()=>{p()},[]);const g=async(_=!1)=>{if(!o){a(!0),u(null),f(!1);try{const C=await xWe();await zre(C),s(C),e()}catch{u({type:"error",message:"   "})}finally{a(!1)}}},b=async()=>{if(o||r)return;const _=await Gre();_.success?(e(),await g()):(u({type:"error",message:_.message||" "}),setTimeout(()=>u(null),3e3))},T=async _=>{if(!(!t||r||o)){i(!0),u({type:"info",message:" ..."});try{const C=await SWe(_,t.description);C.verified?(await Ure(t.points),s(null),e(),u({type:"success",message:`! +${t.points} .`}),f(!0)):(u({type:"error",message:C.reason||"  .   ."}),setTimeout(()=>u(null),4e3))}catch{u({type:"error",message:" ."})}finally{i(!1)}}},w=3-(n.skipsUsedToday||0);return Me.jsxs("div",{className:"relative h-full flex flex-col",children:[Me.jsxs("div",{className:"absolute top-0 left-0 right-0 z-10 p-4 flex justify-between items-start bg-gradient-to-b from-black/80 to-transparent",children:[Me.jsxs("div",{className:"bg-black/40 backdrop-blur-md px-3 py-1 rounded-full border border-white/10",children:[Me.jsx("span",{className:"text-xs text-slate-300 uppercase",children:""}),Me.jsx("div",{className:"text-xl font-bold text-indigo-400",children:n.score})]}),Me.jsxs("div",{className:"flex-1 mx-4 bg-slate-900/90 backdrop-blur-md p-3 rounded-xl border border-indigo-500/30 shadow-lg animate-fade-in min-h-[80px] flex flex-col justify-center",children:[Me.jsx("div",{className:"text-xs text-indigo-300 uppercase font-bold tracking-wider mb-1",children:" "}),o?Me.jsxs("div",{className:"flex items-center space-x-2",children:[Me.jsx("span",{className:"w-4 h-4 border-2 border-indigo-500 border-t-transparent rounded-full animate-spin"}),Me.jsx("span",{className:"text-slate-400 text-sm animate-pulse",children:" ..."})]}):t?Me.jsxs(Me.Fragment,{children:[Me.jsxs("div",{className:"text-lg font-bold text-white leading-tight",children:[": ",Me.jsx("span",{className:"text-indigo-400",children:t.description})]}),Me.jsxs("div",{className:"text-xs text-slate-400 mt-1 flex justify-between",children:[Me.jsxs("span",{children:[": ",t.difficulty==="easy"?"":t.difficulty==="medium"?"":""]}),Me.jsxs("span",{className:"text-yellow-400 font-bold",children:[t.points," XP"]})]})]}):Me.jsx("span",{className:"text-red-400 text-sm",children:" "})]})]}),Me.jsxs("div",{className:"flex-1 relative bg-black",children:[Me.jsx(qre,{onCapture:T,isProcessing:r||o}),l&&!h&&Me.jsxs("div",{className:`
            absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2
            px-6 py-4 rounded-xl shadow-2xl backdrop-blur-md text-center max-w-[80%]
            animate-bounce-in z-30
            ${l.type==="error"?"bg-red-500/90 text-white":""}
            ${l.type==="info"?"bg-blue-500/90 text-white":""}
            ${l.type==="success"?"hidden":""}
          `,children:[l.type==="info"&&Me.jsx("div",{className:"animate-pulse mb-2 text-2xl",children:""}),Me.jsx("div",{className:"font-bold",children:l.message})]})]}),Me.jsxs("div",{className:"absolute bottom-6 right-6 z-20 mb-20 md:mb-8 flex flex-col items-end",children:[Me.jsxs("span",{className:"text-[10px] text-white/50 mb-1 mr-1",children:[": ",w]}),Me.jsx("button",{onClick:b,disabled:o||r||w<=0,className:`
            p-3 rounded-full backdrop-blur-sm border border-white/10 text-xs transition-all active:scale-95
            ${w>0?"bg-black/40 text-white/70 hover:text-white":"bg-red-900/40 text-red-300 opacity-50 cursor-not-allowed"}
          `,children:o?"...":""})]}),h&&Me.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-6",children:Me.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 w-full max-w-sm text-center border border-indigo-500/50 shadow-2xl transform scale-100 animate-pop-in",children:[Me.jsx("div",{className:"text-6xl mb-4",children:""}),Me.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:" !"}),Me.jsxs("p",{className:"text-slate-300 mb-6",children:["  ",Me.jsx("span",{className:"text-indigo-400 font-bold",children:t==null?void 0:t.description}),"   ",t==null?void 0:t.points," ."]}),Me.jsx(SN,{onClick:()=>g(!0),className:"w-full",children:o?" ...":" "})]})})]})},EWe=()=>{const[n,e]=Dn.useState("day"),[t,s]=Dn.useState([]),[r,i]=Dn.useState(!1);return Dn.useEffect(()=>{(async()=>{i(!0);try{const a=await Hre(n);s(a)}catch{console.error("Failed to load leaderboard")}finally{i(!1)}})()},[n]),Me.jsxs("div",{className:"flex flex-col h-full bg-slate-900 p-4",children:[Me.jsx("h2",{className:"text-2xl font-bold text-center mb-6 text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400",children:" "}),Me.jsx("div",{className:"flex bg-slate-800 p-1 rounded-xl mb-6",children:["day","week","all"].map(o=>Me.jsx("button",{onClick:()=>e(o),className:`flex-1 py-2 text-sm font-medium rounded-lg transition-colors ${n===o?"bg-indigo-600 text-white shadow-lg":"text-slate-400 hover:text-white"}`,children:o==="day"?"":o==="week"?"":" "},o))}),Me.jsx("div",{className:"flex-1 overflow-y-auto space-y-3 pb-20 relative",children:r?Me.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:Me.jsx("span",{className:"w-8 h-8 border-2 border-indigo-500 border-t-transparent rounded-full animate-spin"})}):t.length===0?Me.jsx("div",{className:"text-center text-slate-500 mt-10",children:" "}):t.map(o=>Me.jsxs("div",{className:`
                flex items-center p-4 rounded-xl border animate-fade-in
                ${o.isCurrentUser?"bg-indigo-900/30 border-indigo-500/50":"bg-slate-800 border-slate-700"}
              `,children:[Me.jsx("div",{className:`
                w-8 h-8 flex items-center justify-center rounded-full font-bold mr-4
                ${o.rank<=3?"bg-yellow-500 text-black":"bg-slate-700 text-slate-300"}
              `,children:o.rank}),Me.jsx("div",{className:"flex-1",children:Me.jsxs("div",{className:"font-bold text-white",children:[o.username,o.isCurrentUser&&Me.jsx("span",{className:"text-xs text-indigo-400 ml-2",children:"()"})]})}),Me.jsx("div",{className:"text-indigo-300 font-mono font-bold",children:o.score})]},`${o.username}-${o.rank}`))})]})},IWe=()=>Me.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[Me.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),Me.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),CWe=()=>Me.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[Me.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"}),Me.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})]}),NWe=()=>{const[n,e]=Dn.useState(null),[t,s]=Dn.useState(bo.REGISTER),[r,i]=Dn.useState(""),[o,a]=Dn.useState(""),[l,u]=Dn.useState(!0),[h,f]=Dn.useState("register"),[p,g]=Dn.useState(null);Dn.useEffect(()=>{(async()=>{const _=setTimeout(()=>u(!1),3e3);try{const C=await Av();C&&(e(C),s(bo.GAME))}catch(C){console.error("Failed to load user",C)}finally{clearTimeout(_),u(!1)}})()},[]);const b=async w=>{if(w.preventDefault(),g(null),r.trim().length<3){g("    3 ");return}if(o.length<3){g("  ");return}u(!0);try{let _=null;if(h==="register")_=await Bre(r.trim(),o);else if(_=await Vre(r.trim(),o),!_)throw new Error("  .");e(_),s(bo.GAME)}catch(_){console.error("Auth error:",_),g(_.message||" ")}finally{u(!1)}},T=async()=>{const w=await Av();w&&e(w)};return l?Me.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center",children:Me.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})}):!n||t===bo.REGISTER?Me.jsxs("div",{className:"min-h-screen bg-slate-900 flex flex-col items-center justify-center p-6 text-white relative overflow-hidden",children:[Me.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-64 h-64 bg-indigo-600 rounded-full blur-[100px] opacity-20"}),Me.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-80 h-80 bg-purple-600 rounded-full blur-[100px] opacity-20"}),Me.jsxs("div",{className:"relative z-10 w-full max-w-md bg-slate-800/50 p-8 rounded-3xl border border-slate-700 backdrop-blur-xl shadow-2xl",children:[Me.jsxs("div",{className:"text-center mb-8",children:[Me.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent mb-2",children:"PhotoQuest"}),Me.jsx("p",{className:"text-slate-400",children:"  "}),!$l()&&Me.jsx("span",{className:"text-[10px] text-yellow-500/50 bg-yellow-900/20 px-2 py-1 rounded mt-2 inline-block",children:" "})]}),Me.jsxs("div",{className:"flex bg-slate-900/50 rounded-lg p-1 mb-6",children:[Me.jsx("button",{onClick:()=>{f("register"),g(null),a("")},className:`flex-1 py-2 text-sm font-medium rounded-md transition-all ${h==="register"?"bg-indigo-600 text-white shadow":"text-slate-400 hover:text-white"}`,children:" "}),Me.jsx("button",{onClick:()=>{f("login"),g(null),a("")},className:`flex-1 py-2 text-sm font-medium rounded-md transition-all ${h==="login"?"bg-indigo-600 text-white shadow":"text-slate-400 hover:text-white"}`,children:""})]}),Me.jsxs("form",{onSubmit:b,className:"space-y-4",children:[Me.jsxs("div",{children:[Me.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:""}),Me.jsx("input",{type:"text",value:r,onChange:w=>i(w.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all placeholder-slate-600",placeholder:"  ",maxLength:20})]}),Me.jsxs("div",{children:[Me.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:""}),Me.jsx("input",{type:"password",value:o,onChange:w=>a(w.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all placeholder-slate-600",placeholder:h==="register"?"  ":" "}),h==="register"&&Me.jsx("p",{className:"text-[10px] text-yellow-500/70 mt-2 bg-yellow-900/20 p-2 rounded",children:" :         .  -  (: 12345)."})]}),p&&Me.jsx("p",{className:"text-red-400 text-xs mt-2 text-center bg-red-900/20 p-2 rounded",children:p}),Me.jsx(SN,{type:"submit",className:"w-full mt-4",disabled:r.trim().length<3||o.length<3||l,children:l?"...":h==="register"?" ":""})]})]})]}):Me.jsxs("div",{className:"fixed inset-0 bg-slate-900 overflow-hidden flex flex-col",children:[Me.jsxs("div",{className:"flex-1 overflow-hidden relative",children:[t===bo.GAME&&Me.jsx(_We,{user:n,refreshUser:T}),t===bo.LEADERBOARD&&Me.jsx(EWe,{}),Lre()&&Me.jsx("div",{className:"absolute top-20 right-4 z-40",children:Me.jsxs("div",{className:"bg-yellow-500/10 backdrop-blur-md border border-yellow-500/20 text-yellow-500 text-[10px] px-2 py-1 rounded-full flex items-center gap-1",children:[Me.jsx("div",{className:"w-2 h-2 rounded-full bg-yellow-500 animate-pulse"}),"Offline Mode"]})})]}),Me.jsxs("nav",{className:"h-16 bg-slate-800 border-t border-slate-700 flex items-center justify-around z-20 shrink-0",children:[Me.jsxs("button",{onClick:()=>s(bo.GAME),className:`flex flex-col items-center justify-center w-full h-full transition-colors ${t===bo.GAME?"text-indigo-400":"text-slate-500 hover:text-slate-300"}`,children:[Me.jsx(IWe,{}),Me.jsx("span",{className:"text-xs mt-1 font-medium",children:""})]}),Me.jsxs("button",{onClick:()=>s(bo.LEADERBOARD),className:`flex flex-col items-center justify-center w-full h-full transition-colors ${t===bo.LEADERBOARD?"text-indigo-400":"text-slate-500 hover:text-slate-300"}`,children:[Me.jsx(CWe,{}),Me.jsx("span",{className:"text-xs mt-1 font-medium",children:""})]})]})]})},FY=document.getElementById("root");if(!FY)throw new Error("Could not find root element to mount to");const AWe=Cj.createRoot(FY);AWe.render(Me.jsx(vj.StrictMode,{children:Me.jsx(NWe,{})}));
